# 小说创作平台 - 功能模块说明

## 项目概述
这是一个基于 Next.js 16 + React 19 + TypeScript 开发的全栈小说创作平台，提供完整的小说创作、管理和AI辅助写作功能。

## 核心功能模块

### 1. 用户认证系统
#### 功能特性
- 用户注册（/register）
  - 邮箱/密码注册
  - 密码加密存储
- 用户登录（/login）
  - 邮箱/密码登录
  - JWT令牌认证
  - 自动登录状态保持
- 管理员登录（/admin/login）
  - 独立的管理员登录入口
  - admin/1234 验证
  - 与普通用户完全分离

#### API端点
- POST /api/auth/register - 用户注册
- POST /api/auth/login - 用户登录
- POST /api/auth/admin/login - 管理员登录
- GET /api/user/me - 获取当前用户信息
- PUT /api/user/me - 更新用户信息

### 2. 小说创作管理
#### 功能特性
- 小说列表页（/dashboard/novels）
  - 三种视图模式：网格、列表、卡片
  - 高级搜索功能（标题、描述）
  - 多维度筛选（状态、类型）
  - 批量操作（删除、导出）
  - 排序功能（更新时间、标题、章节数等）
- 创建小说（/dashboard/novels/create）
  - 基本信息录入（标题、简介）
  - 世界观设定
  - 故事大纲
  - 主角设定
- 小说详情页（/dashboard/novels/[id]）
  - 小说基本信息展示
  - 章节列表管理
  - 快速导航到其他模块
- 小说设置（/dashboard/novels/[id]/settings）
  - 编辑小说信息
  - 更新设定内容

#### API端点
- GET /api/novels - 获取小说列表
- POST /api/novels - 创建小说
- GET /api/novels/[id] - 获取小说详情
- PUT /api/novels/[id] - 更新小说
- DELETE /api/novels/[id] - 删除小说

### 3. 章节管理系统
#### 功能特性
- 章节列表
  - 拖拽排序
  - 快速编辑
  - 批量操作
- 创建章节（/dashboard/novels/[id]/chapters/create）
  - 章节标题
  - 章节简介
  - AI辅助生成内容
- 编辑章节（/dashboard/novels/[id]/chapters/[chapterId]）
  - 沉浸式编辑器
  - Markdown支持
  - 自动保存（3秒）
  - 字数统计
  - 快捷键支持（Ctrl+S保存）
  - 格式化工具栏
  - 全屏编辑模式
  - 预览模式
- 章节详情
  - 章节内容展示
  - 编辑历史记录
  - 字数统计
  - 阅读时间计算

#### API端点
- GET /api/novels/[id]/chapters - 获取章节列表
- POST /api/novels/[id]/chapters - 创建章节
- GET /api/novels/[id]/chapters/[chapterId] - 获取章节详情
- PUT /api/novels/[id]/chapters/[chapterId] - 更新章节
- DELETE /api/novels/[id]/chapters/[chapterId] - 删除章节
- PUT /api/novels/[id]/chapters/reorder - 章节排序

### 4. AI辅助写作
#### 功能特性
- AI章节生成（/api/ai/generate-chapter）
  - 基于小说设定生成章节内容
  - 支持世界观、大纲、主角设定
  - 流式输出，实时生成
  - 高质量文本生成
- AI模型配置（/dashboard/ai-workshop）
  - 多模型管理
  - API密钥配置
  - 自定义Base URL
  - 模型参数调整（温度、最大令牌、Top P、Top N等）
  - 激活/默认模型设置
  - 模型测试功能
  - 系统提示词配置
  - 角色设定

#### API端点
- POST /api/ai/generate-chapter - AI生成章节
- GET /api/ai-models - 获取AI模型列表
- POST /api/ai-models - 创建AI模型
- GET /api/ai-models/[id] - 获取AI模型详情
- PUT /api/ai-models/[id] - 更新AI模型
- DELETE /api/ai-models/[id] - 删除AI模型
- PUT /api/ai-models/[id]/activate - 激活模型
- PUT /api/ai-models/[id]/default - 设置默认模型
- POST /api/ai-models/test - 测试模型

### 5. 角色管理系统
#### 功能特性
- 角色列表（/dashboard/novels/[id]/characters）
  - 角色卡片展示
  - 头像显示
  - 角色统计
- 创建角色（/dashboard/novels/[id]/characters/create）
  - 基本信息（名称、描述、头像）
  - 特性设定（性格、年龄、外貌、背景、技能、目标）
  - 关系网络
- 编辑角色（/dashboard/novels/[id]/characters/[characterId]/edit）
  - 完整的角色信息编辑
  - 关系管理

#### API端点
- GET /api/novels/[id]/characters - 获取角色列表
- POST /api/novels/[id]/characters - 创建角色
- GET /api/novels/[id]/characters/[characterId] - 获取角色详情
- PUT /api/novels/[id]/characters/[characterId] - 更新角色
- DELETE /api/novels/[id]/characters/[characterId] - 删除角色

### 6. 世界观管理
#### 功能特性
- 世界观列表（/dashboard/novels/[id]/world-settings）
  - 分类展示（地理、历史、文化、政治、经济、科技、魔法、种族、宗教等）
  - 分类筛选
  - 分类统计
  - 视觉化展示
- 创建世界观设定（/dashboard/novels/[id]/world-settings/create）
  - 标题
  - 内容
  - 分类选择
  - 支持多种分类类型

#### API端点
- GET /api/novels/[id]/world-settings - 获取世界观设定列表
- POST /api/novels/[id]/world-settings - 创建世界观设定
- GET /api/novels/[id]/world-settings/[settingId] - 获取设定详情
- PUT /api/novels/[id]/world-settings/[settingId] - 更新设定
- DELETE /api/novels/[id]/world-settings/[settingId] - 删除设定

### 7. 数据统计分析
#### 功能特性
- 创作统计（/dashboard/novels/statistics）
  - 总览统计（作品数、章节数、总字数、阅读时长）
  - 写作进度（今日、本周、本月目标）
  - 类型分布
  - 最近活动
- 小说统计（/dashboard/novels/[id]/statistics）
  - 小说级别统计
  - 章节分析
  - 数据导出（CSV）
  - 时间范围选择

#### API端点
- GET /api/user/stats - 获取用户统计
- GET /api/novels/[id]/stats - 获取小说统计

### 8. 个人设置
#### 功能特性
- 个人信息管理（/dashboard/settings）
  - 头像设置
  - 昵称
  - 性别
  - 出生日期
  - 手机号
  - 会员等级展示
  - 注册时间
  - 编辑/查看模式切换
- 账户安全
  - 修改密码
  - 登出功能

#### API端点
- GET /api/user/me - 获取个人信息
- PUT /api/user/me - 更新个人信息

### 9. 后台管理系统
#### 功能特性
- 管理员登录（/admin/login）
  - 独立登录入口
  - admin/1234 验证
- 系统概览（/dashboard/admin）
  - 系统统计（用户数、小说数、章节数、字数）
  - 数据库信息
  - 系统状态
  - 数据库备份功能
- 用户管理
  - 用户列表
  - 搜索功能
  - 编辑用户
  - 删除用户
  - 状态管理
- 内容管理
  - 小说管理
  - 筛选功能
  - 内容审核
  - 批量操作
- 数据库管理
  - 数据导出
  - 数据导入
  - 数据清理
  - 数据统计
- 系统设置
  - 系统配置（名称、Logo）
  - 用户设置（注册开关、邮箱验证）
  - AI配置（生成限额）

#### API端点
- GET /api/admin/stats - 获取系统统计
- POST /api/admin/backup - 数据库备份

### 10. 营销落地页
#### 功能特性
- 首页（/）
  - 现代化设计
  - Hero区域
  - 功能特性展示
  - CTA按钮
  - 页脚信息

### 11. 工作台
#### 功能特性
- 工作台首页（/dashboard/workspace）
  - 快速导航
  - 最近编辑
  - 创作统计
  - 快捷操作

## 技术特性

### 前端技术
- Next.js 16.1.0（App Router）
- React 19.2.1
- TypeScript 5
- Tailwind CSS 4
- Lucide React（图标库）

### 后端技术
- Next.js API Routes
- Prisma 5.22.0（ORM）
- SQLite（数据库）
- JWT（认证）
- bcryptjs（密码加密）

### AI集成
- LangChain
- OpenAI API兼容接口
- 流式输出支持
- 多模型支持

### 核心特性
- 响应式设计（移动端适配）
- 自动保存功能
- 实时字数统计
- 拖拽排序
- Markdown支持
- 快捷键支持
- 深色模式（后台管理）
- 无障碍访问

## 项目结构
```
novel-writing-platform/
├── src/
│   ├── app/                          # Next.js App Router
│   │   ├── page.tsx                  # 首页（营销落地页）
│   │   ├── login/                    # 用户登录
│   │   ├── register/                 # 用户注册
│   │   ├── admin/                    # 管理员模块
│   │   ├── dashboard/                # 工作台
│   │   │   ├── novels/              # 小说管理
│   │   │   ├── ai-workshop/         # AI工坊
│   │   │   ├── settings/            # 个人设置
│   │   │   └── admin/               # 后台管理
│   │   └── api/                      # API路由
│   ├── components/                   # 组件
│   └── lib/                          # 工具库
│       ├── ai.ts                     # AI工具
│       ├── auth.ts                   # 认证工具
│       └── prisma.ts                 # 数据库客户端
├── prisma/
│   └── schema.prisma                # 数据库模型
└── package.json

```

## 数据库模型
- User（用户）
  - 基本信息字段
  - 扩展字段（头像、昵称、性别、生日、手机、会员等级）
- Novel（小说）
  - 基本信息
  - 设定字段（大纲、世界观、主角）
- Chapter（章节）
  - 章节信息
  - 内容字段
  - 字数统计
- Character（角色）
  - 角色信息
  - 特性字段（JSON）
  - 关系字段（JSON）
- WorldSetting（世界观设定）
  - 设定信息
  - 分类字段
- AIConfig（AI模型配置）
  - 模型信息
  - 参数配置
  - 激活状态

## 部署说明
1. 开发环境：`npm run dev`（端口5000）
2. 生产环境：`npm run build && npm start`
3. 数据库迁移：`npx prisma migrate dev`
4. 数据库重置：`npx prisma migrate reset`

## 环境变量
```env
DATABASE_URL="file:./dev.db"
NEXTAUTH_SECRET="your-secret-key"
COZE_WORKLOAD_IDENTITY_API_KEY="your-api-key"
COZE_INTEGRATION_MODEL_BASE_URL="your-base-url"
```

## 已完成的功能模块

✅ 用户认证系统（注册、登录、管理员登录）
✅ 小说创建和管理
✅ 章节创建、编辑和管理
✅ AI章节生成
✅ AI模型配置管理
✅ 角色管理
✅ 世界观管理
✅ 创作统计
✅ 个人设置
✅ 后台管理系统（用户管理、内容管理、数据库管理、系统设置）
✅ 营销落地页
✅ 工作台
✅ 响应式设计
✅ 自动保存
✅ 批量操作
✅ 搜索和筛选
✅ 拖拽排序
✅ Markdown支持

## 注意事项
1. 所有API都需要JWT认证（除了注册和登录）
2. AI生成功能需要配置有效的API密钥
3. 数据库使用SQLite，适合中小规模应用
4. 前端页面已启用热更新（HMR）
5. 管理员账号：admin / 1234

## 后续优化建议
1. 添加更多AI写作模板
2. 实现协作写作功能
3. 添加评论和反馈系统
4. 实现作品发布功能
5. 添加数据分析和可视化
6. 优化移动端体验
7. 添加多语言支持
8. 实现更复杂的权限控制

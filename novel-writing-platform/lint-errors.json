
> novel-writing-platform@0.1.0 lint
> eslint --format=json

[{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\scripts\\reset-password.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\scripts\\setup-env.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\admin\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin-login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_request' is defined but never used.","line":11,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\n// CORS配置\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Mobile-Optimized, X-Client-Info',\n  'Access-Control-Max-Age': '86400',\n}\n\nexport async function OPTIONS(_request: NextRequest) {\n  const response = new NextResponse(null, { status: 200 })\n  Object.entries(corsHeaders).forEach(([key, value]) => {\n    response.headers.set(key, value)\n  })\n  return response\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { username, password } = await request.json()\n\n    // 验证用户名和密码\n    if (username !== 'admin' || password !== '1234') {\n      const response = NextResponse.json(\n        { \n          error: '用户名或密码错误',\n          code: 'INVALID_CREDENTIALS'\n        },\n        { status: 401 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 生成简单的token\n    const token = Buffer.from(JSON.stringify({\n      userId: 'admin-user',\n      username: 'admin',\n      role: 'admin',\n      timestamp: Date.now()\n    })).toString('base64')\n\n    const user = {\n      id: 'admin-user',\n      username: 'admin',\n      email: 'admin@example.com',\n      role: 'admin'\n    }\n\n    const response = NextResponse.json({\n      message: '登录成功',\n      token,\n      user\n    })\n\n    Object.entries(corsHeaders).forEach(([key, value]) => {\n      response.headers.set(key, value)\n    })\n\n    return response\n  } catch (error) {\n    console.error('Admin登录错误:', error)\n    const response = NextResponse.json(\n      { \n        error: '登录失败，请重试',\n        code: 'SERVER_ERROR'\n      },\n      { status: 500 }\n    )\n    Object.entries(corsHeaders).forEach(([key, value]) => {\n      response.headers.set(key, value)\n    })\n    return response\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin\\backup\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_request' is defined but never used.","line":9,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\nconst prisma = globalForPrisma.prisma || new PrismaClient()\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n\n// POST - 导出数据库备份\nexport async function POST(_request: NextRequest) {\n  try {\n    console.log('开始数据库备份')\n\n    const timestamp = new Date().toISOString()\n\n    // 获取所有数据进行完整备份\n    const users = await prisma.user.findMany()\n    const novels = await prisma.novel.findMany()\n    const chapters = await prisma.chapter.findMany()\n\n    console.log('备份数据统计:', {\n      users: users.length,\n      novels: novels.length,\n      chapters: chapters.length\n    })\n\n    // 创建备份数据\n    const backupData = {\n      version: '1.0',\n      timestamp,\n      statistics: {\n        users: users.length,\n        novels: novels.length,\n        chapters: chapters.length\n      },\n      data: {\n        users,\n        novels,\n        chapters\n      }\n    }\n\n    // 备份文件内容\n    const backupContent = JSON.stringify(backupData, null, 2)\n\n    // 返回备份文件作为下载\n    const filename = `backup-${timestamp.split('T')[0]}.json`\n\n    return new NextResponse(backupContent, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Content-Disposition': `attachment; filename=\"${filename}\"`,\n      },\n    })\n  } catch (error) {\n    console.error('数据库备份失败:', error)\n    return NextResponse.json(\n      { error: '备份失败', details: error instanceof Error ? error.message : '未知错误' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin\\import\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin\\novels\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin\\novels\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin\\stats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_request' is defined but never used.","line":6,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { PrismaClient } from '@prisma/client'\n\nconst prisma = new PrismaClient()\n\nexport async function GET(_request: NextRequest) {\n  try {\n    console.log('[Admin Stats] 访问管理员统计数据API')\n\n    try {\n      // 获取真实的统计数据\n      const [totalUsers, totalNovels, totalChapters, chaptersWithContent] = await Promise.all([\n        prisma.user.count(),\n        prisma.novel.count(),\n        prisma.chapter.count(),\n        prisma.chapter.findMany({\n          select: {\n            wordCount: true,\n            content: true\n          }\n        })\n      ])\n\n      console.log('[Admin Stats] 数据 - 用户:', totalUsers, '小说:', totalNovels, '章节:', totalChapters)\n\n      // 计算总字数：优先使用wordCount，如果没有则根据content长度估算\n      const totalWords = chaptersWithContent.reduce((total: number, chapter: { wordCount: number | null; content: string | null }) => {\n        if (chapter.wordCount && chapter.wordCount > 0) {\n          return total + chapter.wordCount\n        }\n        // 如果没有wordCount，根据content长度估算\n        if (chapter.content) {\n          return total + Math.floor(chapter.content.length / 1.5)\n        }\n        return total\n      }, 0)\n\n      // 估算数据库大小\n      const estimatedBytes = totalUsers * 2000 + totalNovels * 5000 + totalChapters * 15000\n      const databaseSize = `${(estimatedBytes / (1024 * 1024)).toFixed(2)} MB`\n\n      const stats = {\n        totalUsers,\n        totalNovels,\n        totalChapters,\n        totalWords,\n        databaseSize,\n        systemStatus: 'normal' as const,\n        lastBackup: '未备份'\n      }\n\n      console.log('[Admin Stats] 返回数据:', stats)\n      return NextResponse.json(stats)\n    } catch (dbError) {\n      console.error('[Admin Stats] 数据库错误，使用模拟数据:', dbError)\n      const mockStats = {\n        totalUsers: 1,\n        totalNovels: 3,\n        totalChapters: 12,\n        totalWords: 45000,\n        databaseSize: '2.5 MB',\n        systemStatus: 'normal' as const,\n        lastBackup: '未备份'\n      }\n      return NextResponse.json(mockStats)\n    }\n  } catch (error) {\n    console.error('[Admin Stats] 未知错误:', error)\n    const fallbackStats = {\n      totalUsers: 1,\n      totalNovels: 3,\n      totalChapters: 12,\n      totalWords: 45000,\n      databaseSize: '2.5 MB',\n      systemStatus: 'normal' as const,\n      lastBackup: '未备份'\n    }\n    return NextResponse.json(fallbackStats)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin\\users\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\admin\\users\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai-configs\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai-configs\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai-models\\[id]\\activate\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai-models\\[id]\\default\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai-models\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1553,1556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1553,1556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\n// 获取单个AI模型\nexport async function GET(\n  request: NextRequest,\n  context: { params: Promise<{ id: string }> }\n) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json({ error: '未授权' }, { status: 401 })\n    }\n\n    const { id } = await context.params\n\n    const model = await prisma.aIConfig.findFirst({\n      where: { id, userId: user.userId }\n    })\n\n    if (!model) {\n      return NextResponse.json({ error: '模型不存在' }, { status: 404 })\n    }\n\n    return NextResponse.json({ model })\n  } catch (error) {\n    console.error('获取AI模型失败:', error)\n    return NextResponse.json({ error: '获取AI模型失败' }, { status: 500 })\n  }\n}\n\n// 更新AI模型\nexport async function PUT(\n  request: NextRequest,\n  context: { params: Promise<{ id: string }> }\n) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json({ error: '未授权' }, { status: 401 })\n    }\n\n    const { id } = await context.params\n\n    const data = await request.json()\n    const { name, apiKey, baseUrl, model, role, systemPrompt, temperature, maxTokens, contextWindow, topP, topN, frequencyPenalty, presencePenalty, isActive, isDefault } = data\n\n    const existingModel = await prisma.aIConfig.findFirst({\n      where: { id, userId: user.userId }\n    })\n\n    if (!existingModel) {\n      return NextResponse.json({ error: '模型不存在' }, { status: 404 })\n    }\n\n    const updateData: any = {}\n    if (name !== undefined) updateData.name = name\n    if (apiKey !== undefined) updateData.apiKey = apiKey\n    if (baseUrl !== undefined) updateData.baseUrl = baseUrl\n    if (model !== undefined) updateData.model = model\n    if (role !== undefined) updateData.role = role\n    if (systemPrompt !== undefined) updateData.systemPrompt = systemPrompt\n    if (temperature !== undefined) updateData.temperature = temperature\n    if (maxTokens !== undefined) updateData.maxTokens = maxTokens\n    if (contextWindow !== undefined) updateData.contextWindow = contextWindow\n    if (topP !== undefined) updateData.topP = topP\n    if (topN !== undefined) updateData.topN = topN\n    if (frequencyPenalty !== undefined) updateData.frequencyPenalty = frequencyPenalty\n    if (presencePenalty !== undefined) updateData.presencePenalty = presencePenalty\n    if (isActive !== undefined) updateData.isActive = isActive\n    if (isDefault !== undefined) updateData.isDefault = isDefault\n\n    // 如果设置为激活，则将其他模型设为非激活\n    if (isActive) {\n      await prisma.aIConfig.updateMany({\n        where: { userId: user.userId, id: { not: id } },\n        data: { isActive: false }\n      })\n    }\n\n    // 如果设置为默认，则将其他模型设为非默认\n    if (isDefault) {\n      await prisma.aIConfig.updateMany({\n        where: { userId: user.userId, id: { not: id } },\n        data: { isDefault: false }\n      })\n    }\n\n    const updatedModel = await prisma.aIConfig.update({\n      where: { id },\n      data: { ...updateData, updatedAt: new Date() }\n    })\n\n    return NextResponse.json({ model: updatedModel })\n  } catch (error) {\n    console.error('更新AI模型失败:', error)\n    return NextResponse.json({ error: '更新AI模型失败' }, { status: 500 })\n  }\n}\n\n// 删除AI模型\nexport async function DELETE(\n  request: NextRequest,\n  context: { params: Promise<{ id: string }> }\n) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json({ error: '未授权' }, { status: 401 })\n    }\n\n    const { id } = await context.params\n\n    const existingModel = await prisma.aIConfig.findFirst({\n      where: { id, userId: user.userId }\n    })\n\n    if (!existingModel) {\n      return NextResponse.json({ error: '模型不存在' }, { status: 404 })\n    }\n\n    await prisma.aIConfig.delete({\n      where: { id }\n    })\n\n    return NextResponse.json({ message: '模型删除成功' })\n  } catch (error) {\n    console.error('删除AI模型失败:', error)\n    return NextResponse.json({ error: '删除AI模型失败' }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai-models\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2006,2009],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2006,2009],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\n// 获取所有AI模型\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json({ error: '未授权' }, { status: 401 })\n    }\n\n    const models = await prisma.aIConfig.findMany({\n      where: { userId: user.userId },\n      orderBy: { createdAt: 'desc' }\n    })\n\n    return NextResponse.json({ models })\n  } catch (error) {\n    console.error('获取AI模型失败:', error)\n    return NextResponse.json({ error: '获取AI模型失败' }, { status: 500 })\n  }\n}\n\n// 创建新的AI模型\nexport async function POST(request: NextRequest) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json({ error: '未授权' }, { status: 401 })\n    }\n\n    const data = await request.json()\n    const { name, apiKey, baseUrl, model, role, systemPrompt, temperature, maxTokens, contextWindow, topP, topN, frequencyPenalty, presencePenalty } = data\n\n    if (!name || !apiKey || !model || !role) {\n      return NextResponse.json({ error: '缺少必要参数' }, { status: 400 })\n    }\n\n    // 检查是否已存在激活的模型\n    const activeModelCount = await prisma.aIConfig.count({\n      where: { userId: user.userId, isActive: true }\n    })\n\n    const newModel = await prisma.aIConfig.create({\n      data: {\n        userId: user.userId,\n        name,\n        apiKey,\n        baseUrl,\n        model,\n        role,\n        systemPrompt,\n        temperature: temperature || 0.7,\n        maxTokens: maxTokens || 2000,\n        contextWindow: contextWindow || 4096,\n        topP: topP || 1,\n        topN: topN || 0,\n        frequencyPenalty: frequencyPenalty || 0,\n        presencePenalty: presencePenalty || 0,\n        isActive: activeModelCount === 0, // 如果没有激活模型，则设置为激活\n        isDefault: activeModelCount === 0 // 如果没有模型，则设为默认\n      }\n    })\n\n    return NextResponse.json({ model: newModel }, { status: 201 })\n  } catch (error: any) {\n    console.error('创建AI模型失败:', error)\n    return NextResponse.json({ error: `创建AI模型失败: ${error.message}` }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai-models\\test\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[869,872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[869,872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1335,1338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1335,1338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport OpenAI from 'openai'\n\n// 测试AI模型\nexport async function POST(request: NextRequest) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json({ error: '未授权' }, { status: 401 })\n    }\n\n    const { modelId, prompt } = await request.json()\n\n    if (!modelId || !prompt) {\n      return NextResponse.json({ error: '缺少必要参数' }, { status: 400 })\n    }\n\n    // 获取模型配置\n    const model = await prisma.aIConfig.findFirst({\n      where: { id: modelId, userId: user.userId }\n    })\n\n    if (!model) {\n      return NextResponse.json({ error: '模型不存在' }, { status: 404 })\n    }\n\n    // 创建OpenAI客户端\n    const openai = new OpenAI({\n      apiKey: model.apiKey\n    })\n\n    // 构建消息\n    const messages: any[] = [\n      { role: 'system', content: model.role }\n    ]\n\n    messages.push({ role: 'user', content: prompt })\n\n    // 调用AI模型\n    const completion = await openai.chat.completions.create({\n      model: model.model || 'gpt-3.5-turbo',\n      messages,\n      temperature: model.temperature,\n      max_tokens: model.maxTokens\n    })\n\n    const response = completion.choices[0]?.message?.content || '无回复'\n\n    return NextResponse.json({ response })\n  } catch (error: any) {\n    console.error('测试AI模型失败:', error)\n\n    let errorMessage = '测试失败'\n    if (error.message) {\n      if (error.message.includes('401')) {\n        errorMessage = 'API密钥无效'\n      } else if (error.message.includes('404')) {\n        errorMessage = '模型不存在'\n      } else if (error.message.includes('429')) {\n        errorMessage = 'API请求频率超限'\n      } else if (error.message.includes('500')) {\n        errorMessage = '服务器内部错误'\n      } else {\n        errorMessage = error.message\n      }\n    }\n\n    return NextResponse.json({ error: errorMessage }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\ai\\generate-chapter\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\auth\\admin\\login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":11,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\n// CORS配置\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Mobile-Optimized, X-Client-Info',\n  'Access-Control-Max-Age': '86400',\n}\n\nexport async function OPTIONS(request: NextRequest) {\n  const response = new NextResponse(null, { status: 200 })\n  Object.entries(corsHeaders).forEach(([key, value]) => {\n    response.headers.set(key, value)\n  })\n  return response\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { username, password } = await request.json()\n\n    // 验证用户名和密码\n    if (username !== 'admin' || password !== '1234') {\n      const response = NextResponse.json(\n        { \n          error: '用户名或密码错误',\n          code: 'INVALID_CREDENTIALS'\n        },\n        { status: 401 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 生成简单的token（使用Base64编码，不使用JWT）\n    const token = Buffer.from(JSON.stringify({\n      userId: 'admin-user',\n      username: 'admin',\n      role: 'admin',\n      timestamp: Date.now()\n    })).toString('base64')\n\n    const user = {\n      id: 'admin-user',\n      username: 'admin',\n      email: 'admin@example.com',\n      role: 'admin'\n    }\n\n    const response = NextResponse.json({\n      message: '登录成功',\n      token,\n      user\n    })\n\n    Object.entries(corsHeaders).forEach(([key, value]) => {\n      response.headers.set(key, value)\n    })\n\n    return response\n  } catch (error) {\n    console.error('Admin登录错误:', error)\n    const response = NextResponse.json(\n      { \n        error: '登录失败，请重试',\n        code: 'SERVER_ERROR'\n      },\n      { status: 500 }\n    )\n    Object.entries(corsHeaders).forEach(([key, value]) => {\n      response.headers.set(key, value)\n    })\n    return response\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\auth\\demo-login\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\auth\\login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":14,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1479,1482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1479,1482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport bcrypt from 'bcryptjs'\nimport jwt from 'jsonwebtoken'\nimport { prisma } from '@/lib/prisma'\n\n// CORS配置\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Mobile-Optimized, X-Client-Info',\n  'Access-Control-Max-Age': '86400',\n}\n\nexport async function OPTIONS(request: NextRequest) {\n  const response = new NextResponse(null, { status: 200 })\n  Object.entries(corsHeaders).forEach(([key, value]) => {\n    response.headers.set(key, value)\n  })\n  return response\n}\n\nexport async function POST(request: NextRequest) {\n  const startTime = Date.now()\n  const requestId = `login_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n  \n  try {\n    // 记录请求信息\n    const userAgent = request.headers.get('user-agent') || ''\n    const ip = request.headers.get('x-forwarded-for') || \n               request.headers.get('x-real-ip') || \n               request.headers.get('cf-connecting-ip') || \n               'unknown'\n    const contentType = request.headers.get('content-type')\n    const origin = request.headers.get('origin')\n    \n    console.log(`[${requestId}] 登录请求开始:`, { \n      timestamp: new Date().toISOString(),\n      userAgent: userAgent.substring(0, 150),\n      ip,\n      contentType,\n      origin,\n      method: request.method\n    })\n\n    // 解析请求体\n    let requestData: any\n    try {\n      const requestText = await request.text()\n      console.log(`[${requestId}] 请求体内容长度: ${requestText.length}`)\n      \n      if (!requestText.trim()) {\n        throw new Error('请求体为空')\n      }\n      \n      requestData = JSON.parse(requestText)\n    } catch (parseError) {\n      console.error(`[${requestId}] 请求体解析失败:`, parseError)\n      const response = NextResponse.json(\n        { \n          error: '请求数据格式错误',\n          code: 'INVALID_REQUEST_BODY',\n          requestId,\n          details: parseError instanceof Error ? parseError.message : 'JSON解析失败'\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    const { email, password } = requestData\n\n    console.log(`[${requestId}] 收到登录请求: email=${email}, password=${password}`)\n\n    // 特殊处理：admin管理员登录\n    if (email === 'admin' && password === '1234') {\n      console.log(`[${requestId}] Admin用户登录`)\n      \n      // 生成简单的token\n      const token = Buffer.from(JSON.stringify({\n        userId: 'admin-user',\n        username: 'admin',\n        role: 'admin',\n        timestamp: Date.now()\n      })).toString('base64')\n\n      const user = {\n        id: 'admin-user',\n        username: 'admin',\n        email: 'admin@example.com',\n        role: 'admin'\n      }\n\n      const response = NextResponse.json({\n        message: '登录成功',\n        token,\n        user\n      })\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 输入验证\n    if (!email || !password) {\n      console.log(`[${requestId}] 验证失败: 缺少必要字段`)\n      const response = NextResponse.json(\n        { \n          error: '邮箱和密码是必需的',\n          code: 'MISSING_FIELDS',\n          requestId,\n          details: {\n            email: !!email,\n            password: !!password\n          }\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 清理和标准化输入\n    const cleanEmail = email.trim().normalize('NFC')\n\n    if (cleanEmail.length === 0) {\n      console.log(`[${requestId}] 验证失败: 邮箱为空`)\n      const response = NextResponse.json(\n        { \n          error: '邮箱不能为空',\n          code: 'EMPTY_EMAIL',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    if (password.length < 1) {\n      console.log(`[${requestId}] 验证失败: 密码为空`)\n      const response = NextResponse.json(\n        { \n          error: '密码不能为空',\n          code: 'EMPTY_PASSWORD',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 邮箱格式验证\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(cleanEmail)) {\n      console.log(`[${requestId}] 验证失败: 邮箱格式不正确`)\n      const response = NextResponse.json(\n        { \n          error: '请输入有效的邮箱地址',\n          code: 'INVALID_EMAIL',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    console.log(`[${requestId}] 输入验证通过，开始查询用户...`)\n\n    // 确保数据库连接\n    try {\n      await prisma.$connect()\n      console.log(`[${requestId}] 数据库连接成功`)\n    } catch (dbError) {\n      console.error(`[${requestId}] 数据库连接失败:`, dbError)\n      const response = NextResponse.json(\n        { \n          error: '服务器内部错误，请稍后重试',\n          code: 'DATABASE_CONNECTION_ERROR',\n          requestId\n        },\n        { status: 500 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { email: cleanEmail }\n    })\n\n    if (!user) {\n      console.log(`[${requestId}] 登录失败: 用户不存在 - ${cleanEmail}`)\n      const response = NextResponse.json(\n        { \n          error: '用户不存在',\n          code: 'USER_NOT_FOUND',\n          requestId,\n          suggestion: '请检查邮箱地址是否正确，或者先注册账户'\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    console.log(`[${requestId}] 用户找到，开始验证密码...`)\n\n    let isPasswordValid = false\n    try {\n      isPasswordValid = await bcrypt.compare(password, user.password)\n      console.log(`[${requestId}] 密码验证结果: ${isPasswordValid}`)\n    } catch (bcryptError) {\n      console.error(`[${requestId}] 密码验证出错:`, bcryptError)\n      const response = NextResponse.json(\n        { \n          error: '密码验证失败',\n          code: 'PASSWORD_VERIFICATION_ERROR',\n          requestId\n        },\n        { status: 500 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    if (!isPasswordValid) {\n      console.log(`[${requestId}] 登录失败: 密码错误 - ${cleanEmail}`)\n      const response = NextResponse.json(\n        { \n          error: '密码错误',\n          code: 'INVALID_PASSWORD',\n          requestId,\n          suggestion: '请检查密码是否正确，或者使用忘记密码功能'\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    console.log(`[${requestId}] 密码验证通过，生成JWT令牌...`)\n\n    // 生成JWT令牌\n    let token = ''\n    try {\n      token = jwt.sign(\n        { \n          userId: user.id, \n          username: user.username,\n          email: user.email\n        },\n        process.env.NEXTAUTH_SECRET!,\n        { expiresIn: '7d' }\n      )\n      console.log(`[${requestId}] JWT令牌生成成功`)\n    } catch (jwtError) {\n      console.error(`[${requestId}] JWT生成失败:`, jwtError)\n      const response = NextResponse.json(\n        { \n          error: '令牌生成失败',\n          code: 'TOKEN_GENERATION_ERROR',\n          requestId\n        },\n        { status: 500 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    const duration = Date.now() - startTime\n    console.log(`[${requestId}] 登录成功完成，耗时: ${duration}ms`)\n\n    const responseData = {\n      message: '登录成功',\n      token,\n      user: {\n        id: user.id,\n        email: user.email,\n        username: user.username\n      },\n      requestId,\n      duration\n    }\n\n    const response = NextResponse.json(responseData)\n    Object.entries(corsHeaders).forEach(([key, value]) => {\n      response.headers.set(key, value)\n    })\n    \n    return response\n\n  } catch (error) {\n    const duration = Date.now() - startTime\n    console.error(`[${requestId}] 登录过程中发生未预期的错误，耗时: ${duration}ms:`, error)\n    \n    const response = NextResponse.json(\n      { \n        error: '登录失败，请稍后重试',\n        code: 'UNEXPECTED_ERROR',\n        requestId,\n        details: error instanceof Error ? error.message : '未知错误',\n        duration\n      },\n      { status: 500 }\n    )\n    \n    Object.entries(corsHeaders).forEach(([key, value]) => {\n      response.headers.set(key, value)\n    })\n    \n    return response\n  } finally {\n    try {\n      await prisma.$disconnect()\n      console.log(`[${requestId}] 数据库连接已断开`)\n    } catch (disconnectError) {\n      console.error(`[${requestId}] 断开数据库连接时出错:`, disconnectError)\n    }\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\auth\\register\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":17,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1761,1764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1761,1764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport bcrypt from 'bcryptjs'\nimport jwt from 'jsonwebtoken'\nimport { prisma } from '@/lib/prisma'\n\n// CORS配置\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Mobile-Optimized, X-Client-Info',\n  'Access-Control-Max-Age': '86400',\n  'Cache-Control': 'no-cache, no-store, must-revalidate',\n  'Pragma': 'no-cache',\n  'Expires': '0'\n}\n\nexport async function OPTIONS(request: NextRequest) {\n  const response = new NextResponse(null, { status: 200 })\n  Object.entries(corsHeaders).forEach(([key, value]) => {\n    response.headers.set(key, value)\n  })\n  return response\n}\n\nexport async function POST(request: NextRequest) {\n  const startTime = Date.now()\n  const requestId = `reg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n  \n  try {\n    // 记录请求信息\n    const userAgent = request.headers.get('user-agent') || ''\n    const isMobile = /Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)\n    const ip = request.headers.get('x-forwarded-for') || \n               request.headers.get('x-real-ip') || \n               request.headers.get('cf-connecting-ip') || \n               'unknown'\n    const contentType = request.headers.get('content-type')\n    const origin = request.headers.get('origin')\n    const referer = request.headers.get('referer')\n    \n    console.log(`[${requestId}] 注册请求开始:`, { \n      timestamp: new Date().toISOString(),\n      userAgent: userAgent.substring(0, 150),\n      isMobile,\n      ip,\n      contentType,\n      origin,\n      referer,\n      method: request.method\n    })\n\n    // 解析请求体\n    let requestData: any\n    try {\n      const requestText = await request.text()\n      console.log(`[${requestId}] 请求体内容长度: ${requestText.length}`)\n      \n      if (!requestText.trim()) {\n        throw new Error('请求体为空')\n      }\n      \n      requestData = JSON.parse(requestText)\n    } catch (parseError) {\n      console.error(`[${requestId}] 请求体解析失败:`, parseError)\n      const response = NextResponse.json(\n        { \n          error: '请求数据格式错误',\n          code: 'INVALID_REQUEST_BODY',\n          requestId,\n          details: parseError instanceof Error ? parseError.message : 'JSON解析失败',\n          suggestions: [\n            '检查网络连接是否稳定',\n            '刷新页面后重试',\n            '确认表单数据完整'\n          ]\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    const { email, username, password } = requestData\n\n    // 输入验证\n    if (!email || !username || !password) {\n      console.log(`[${requestId}] 验证失败: 缺少必要字段`)\n      const response = NextResponse.json(\n        { \n          error: '所有字段都是必需的',\n          code: 'MISSING_FIELDS',\n          requestId,\n          details: {\n            email: !!email,\n            username: !!username,\n            password: !!password\n          }\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 清理和标准化输入\n    const cleanEmail = email.trim().normalize('NFC')\n    const cleanUsername = username.trim().normalize('NFC')\n\n    if (cleanEmail.length === 0 || cleanUsername.length === 0) {\n      console.log(`[${requestId}] 验证失败: 邮箱或用户名为空`)\n      const response = NextResponse.json(\n        { \n          error: '邮箱和用户名不能为空',\n          code: 'EMPTY_FIELDS',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    if (password.length < 6) {\n      console.log(`[${requestId}] 验证失败: 密码太短`)\n      const response = NextResponse.json(\n        { \n          error: '密码长度至少6位',\n          code: 'PASSWORD_TOO_SHORT',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    if (cleanUsername.length < 2) {\n      console.log(`[${requestId}] 验证失败: 用户名太短`)\n      const response = NextResponse.json(\n        { \n          error: '用户名长度至少2位',\n          code: 'USERNAME_TOO_SHORT',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 邮箱格式验证\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(cleanEmail)) {\n      console.log(`[${requestId}] 验证失败: 邮箱格式不正确`)\n      const response = NextResponse.json(\n        { \n          error: '请输入有效的邮箱地址',\n          code: 'INVALID_EMAIL',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    // 用户名格式验证\n    const usernameRegex = /^[\\w\\u4e00-\\u9fa5]{2,20}$/\n    if (!usernameRegex.test(cleanUsername)) {\n      console.log(`[${requestId}] 验证失败: 用户名格式不正确`)\n      const response = NextResponse.json(\n        { \n          error: '用户名只能包含字母、数字、下划线和中文，长度2-20位',\n          code: 'INVALID_USERNAME',\n          requestId\n        },\n        { status: 400 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    console.log(`[${requestId}] 输入验证通过，开始数据库操作...`)\n\n    // 确保数据库连接\n    try {\n      await prisma.$connect()\n      console.log(`[${requestId}] 数据库连接成功`)\n    } catch (dbConnectError) {\n      console.error(`[${requestId}] 数据库连接失败:`, dbConnectError)\n      const response = NextResponse.json(\n        { \n          error: '数据库连接失败，请稍后重试',\n          code: 'DATABASE_CONNECTION_ERROR',\n          requestId,\n          details: '服务器暂时无法连接到数据库',\n          suggestions: [\n            '稍后重试',\n            '检查网络连接',\n            '如问题持续请联系技术支持'\n          ]\n        },\n        { status: 503 }\n      )\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      return response\n    }\n\n    try {\n      // 检查现有用户\n      const checkUserStart = Date.now()\n      const existingUser = await prisma.user.findFirst({\n        where: {\n          OR: [\n            { email: cleanEmail },\n            { username: cleanUsername }\n          ]\n        }\n      })\n      \n      const checkUserTime = Date.now() - checkUserStart\n      console.log(`[${requestId}] 用户检查完成，耗时: ${checkUserTime}ms`)\n\n      if (existingUser) {\n        const conflictType = existingUser.email === cleanEmail ? 'email' : 'username'\n        console.log(`[${requestId}] 用户已存在: ${conflictType}`)\n        const response = NextResponse.json(\n          { \n            error: conflictType === 'email' ? '邮箱已存在' : '用户名已存在',\n            code: 'USER_EXISTS',\n            conflictType,\n            requestId\n          },\n          { status: 409 }\n        )\n        Object.entries(corsHeaders).forEach(([key, value]) => {\n          response.headers.set(key, value)\n        })\n        return response\n      }\n\n      console.log(`[${requestId}] 开始创建用户...`)\n\n      // 加密密码\n      const hashStart = Date.now()\n      const hashedPassword = await bcrypt.hash(password, 10)\n      const hashTime = Date.now() - hashStart\n      console.log(`[${requestId}] 密码加密完成，耗时: ${hashTime}ms`)\n\n      // 创建用户\n      const createStart = Date.now()\n      const user = await prisma.user.create({\n        data: {\n          email: cleanEmail,\n          username: cleanUsername,\n          password: hashedPassword\n        }\n      })\n      const createTime = Date.now() - createStart\n      console.log(`[${requestId}] 用户创建成功，耗时: ${createTime}ms，ID: ${user.id}`)\n\n      // 验证JWT密钥\n      const jwtSecret = process.env.NEXTAUTH_SECRET\n      if (!jwtSecret || jwtSecret === 'your-secret-key-here' || jwtSecret.length < 32) {\n        console.error(`[${requestId}] JWT密钥配置错误`)\n        const response = NextResponse.json(\n          { \n            error: '系统配置错误，请联系管理员',\n            code: 'JWT_CONFIG_ERROR',\n            requestId,\n            details: 'JWT密钥未正确配置或长度不足'\n          },\n          { status: 500 }\n        )\n        Object.entries(corsHeaders).forEach(([key, value]) => {\n          response.headers.set(key, value)\n        })\n        return response\n      }\n\n      // 生成JWT令牌\n      const jwtStart = Date.now()\n      let token: string\n      try {\n        token = jwt.sign(\n          { userId: user.id, username: user.username },\n          jwtSecret,\n          { expiresIn: '7d' }\n        )\n        const jwtTime = Date.now() - jwtStart\n        console.log(`[${requestId}] JWT令牌生成成功，耗时: ${jwtTime}ms`)\n      } catch (jwtError) {\n        console.error(`[${requestId}] JWT令牌生成失败:`, jwtError)\n        const response = NextResponse.json(\n          { \n            error: '登录令牌生成失败，请稍后重试',\n            code: 'JWT_GENERATION_ERROR',\n            requestId,\n            details: jwtError instanceof Error ? jwtError.message : '未知JWT错误'\n          },\n          { status: 500 }\n        )\n        Object.entries(corsHeaders).forEach(([key, value]) => {\n          response.headers.set(key, value)\n        })\n        return response\n      }\n\n      const totalTime = Date.now() - startTime\n      const responseData = {\n        message: '注册成功',\n        code: 'SUCCESS',\n        requestId,\n        processingTime: totalTime,\n        token,\n        user: {\n          id: user.id,\n          email: user.email,\n          username: user.username,\n          createdAt: user.createdAt\n        },\n        mobileOptimized: isMobile\n      }\n      \n      console.log(`[${requestId}] 注册成功:`, {\n        userId: user.id,\n        email: user.email,\n        username: user.username,\n        tokenGenerated: !!token,\n        processingTime: totalTime,\n        isMobile\n      })\n\n      const response = NextResponse.json(responseData)\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        response.headers.set(key, value)\n      })\n      \n      return response\n\n    } finally {\n      await prisma.$disconnect()\n    }\n\n  } catch (error) {\n    const totalTime = Date.now() - startTime\n    console.error(`[${requestId}] 注册过程中发生错误:`, {\n      error: error instanceof Error ? {\n        name: error.name,\n        message: error.message,\n        stack: error.stack\n      } : error,\n      processingTime: totalTime,\n      userAgent: request.headers.get('user-agent')?.substring(0, 150)\n    })\n    \n    // 针对移动端的错误处理\n    let errorMessage = '注册失败，请稍后重试'\n    let errorCode = 'UNKNOWN_ERROR'\n    let statusCode = 500\n    let suggestions: string[] = []\n\n    if (error instanceof Error) {\n      // 网络相关错误\n      if (error.message.includes('timeout') || error.message.includes('ETIMEDOUT')) {\n        errorMessage = '网络连接超时，请检查网络后重试'\n        errorCode = 'NETWORK_TIMEOUT'\n        statusCode = 408\n        suggestions = [\n          '检查网络连接稳定性',\n          '尝试切换到WiFi环境',\n          '关闭其他占用网络的应用',\n          '稍后重试'\n        ]\n      }\n      // 数据库连接错误\n      else if (error.message.includes('database') || error.message.includes('Database') || error.message.includes('Prisma')) {\n        errorMessage = '数据库服务暂时不可用，请稍后重试'\n        errorCode = 'DATABASE_ERROR'\n        statusCode = 503\n        suggestions = [\n          '服务器负载较高，请稍后重试',\n          '可能是网络延迟导致',\n          '如问题持续，请联系技术支持'\n        ]\n      }\n      // 唯一约束冲突\n      else if (error.message.includes('Unique constraint') || error.message.includes('UNIQUE')) {\n        errorMessage = '用户名或邮箱已存在，请更换后重试'\n        errorCode = 'DUPLICATE_ENTRY'\n        statusCode = 409\n        suggestions = [\n          '检查输入信息是否正确',\n          '尝试使用不同的邮箱或用户名',\n          '可能是网络延迟导致的重复提交'\n        ]\n      }\n    }\n\n    const errorResponse = {\n      error: errorMessage,\n      code: errorCode,\n      requestId,\n      details: error instanceof Error ? error.message : '未知错误',\n      suggestions: suggestions.length > 0 ? suggestions : [\n        '刷新页面重试',\n        '检查网络连接',\n        '稍后再试',\n        '如问题持续，请联系技术支持'\n      ]\n    }\n\n    const response = NextResponse.json(errorResponse, { status: statusCode })\n    Object.entries(corsHeaders).forEach(([key, value]) => {\n      response.headers.set(key, value)\n    })\n    \n    return response\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\auth\\reset-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\debug\\register\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2041,2044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2041,2044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2169,2172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2169,2172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  const debugInfo = {\n    timestamp: new Date().toISOString(),\n    requestId: `debug_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n    environment: process.env.NODE_ENV,\n    serverInfo: {\n      nextVersion: process.env.npm_package_next,\n      nodeVersion: process.version,\n      platform: process.platform\n    },\n    configuration: {\n      databaseUrl: process.env.DATABASE_URL ? 'configured' : 'not configured',\n      jwtSecret: process.env.NEXTAUTH_SECRET ? {\n        configured: true,\n        length: process.env.NEXTAUTH_SECRET.length,\n        isDefault: process.env.NEXTAUTH_SECRET === 'your-secret-key-here'\n      } : {\n        configured: false\n      },\n      nextAuthUrl: process.env.NEXTAUTH_URL || 'not configured'\n    },\n    database: {\n      connected: false,\n      userCount: 0,\n      lastError: null as string | null\n    },\n    request: {\n      method: request.method,\n      url: request.url,\n      userAgent: request.headers.get('user-agent'),\n      ip: request.headers.get('x-forwarded-for') || \n           request.headers.get('x-real-ip') || \n           request.headers.get('cf-connecting-ip') || \n           'unknown'\n    }\n  }\n\n  // 测试数据库连接\n  try {\n    await prisma.$connect()\n    debugInfo.database.connected = true\n    debugInfo.database.userCount = await prisma.user.count()\n  } catch (error) {\n    debugInfo.database.lastError = error instanceof Error ? error.message : 'Unknown error'\n  } finally {\n    await prisma.$disconnect()\n  }\n\n  return NextResponse.json(debugInfo)\n}\n\nexport async function POST(request: NextRequest) {\n  const startTime = Date.now()\n  \n  try {\n    const body = await request.json()\n    const { email, username, password } = body\n    \n    const debugResult = {\n      timestamp: new Date().toISOString(),\n      requestId: `debug_reg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      processingTime: 0,\n      steps: [] as any[],\n      success: false,\n      error: null as string | null,\n      jwtToken: null as string | null,\n      userData: null as any\n    }\n\n    // 步骤1: 输入验证\n    debugResult.steps.push({\n      step: 1,\n      name: '输入验证',\n      status: 'starting',\n      data: { email, username, passwordLength: password?.length }\n    })\n\n    if (!email || !username || !password) {\n      debugResult.steps[0].status = 'failed'\n      debugResult.steps[0].error = '缺少必要字段'\n      debugResult.error = '所有字段都是必需的'\n      return NextResponse.json(debugResult)\n    }\n\n    if (password.length < 6) {\n      debugResult.steps[0].status = 'failed'\n      debugResult.steps[0].error = '密码长度不足'\n      debugResult.error = '密码长度至少6位'\n      return NextResponse.json(debugResult)\n    }\n\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(email.trim())) {\n      debugResult.steps[0].status = 'failed'\n      debugResult.steps[0].error = '邮箱格式错误'\n      debugResult.error = '请输入有效的邮箱地址'\n      return NextResponse.json(debugResult)\n    }\n\n    debugResult.steps[0].status = 'completed'\n\n    // 步骤2: 数据库连接测试\n    debugResult.steps.push({\n      step: 2,\n      name: '数据库连接测试',\n      status: 'starting'\n    })\n\n    try {\n      await prisma.$connect()\n      debugResult.steps[1].status = 'completed'\n    } catch (error) {\n      debugResult.steps[1].status = 'failed'\n      debugResult.steps[1].error = error instanceof Error ? error.message : '数据库连接失败'\n      debugResult.error = '数据库连接失败'\n      return NextResponse.json(debugResult)\n    }\n\n    // 步骤3: 检查现有用户\n    debugResult.steps.push({\n      step: 3,\n      name: '检查现有用户',\n      status: 'starting'\n    })\n\n    try {\n      const existingUser = await prisma.user.findFirst({\n        where: {\n          OR: [\n            { email: email.trim() },\n            { username: username.trim() }\n          ]\n        }\n      })\n\n      if (existingUser) {\n        const conflictType = existingUser.email === email.trim() ? 'email' : 'username'\n        debugResult.steps[2].status = 'failed'\n        debugResult.steps[2].error = `用户已存在 (${conflictType})`\n        debugResult.steps[2].existingUser = {\n          id: existingUser.id,\n          email: existingUser.email,\n          username: existingUser.username\n        }\n        debugResult.error = conflictType === 'email' ? '邮箱已存在' : '用户名已存在'\n        return NextResponse.json(debugResult)\n      }\n\n      debugResult.steps[2].status = 'completed'\n    } catch (error) {\n      debugResult.steps[2].status = 'failed'\n      debugResult.steps[2].error = error instanceof Error ? error.message : '用户检查失败'\n      debugResult.error = '用户检查失败'\n      return NextResponse.json(debugResult)\n    }\n\n    // 步骤4: JWT密钥验证\n    debugResult.steps.push({\n      step: 4,\n      name: 'JWT密钥验证',\n      status: 'starting'\n    })\n\n    const jwtSecret = process.env.NEXTAUTH_SECRET\n    if (!jwtSecret || jwtSecret === 'your-secret-key-here' || jwtSecret.length < 32) {\n      debugResult.steps[3].status = 'failed'\n      debugResult.steps[3].error = 'JWT密钥未正确配置'\n      debugResult.steps[3].secretInfo = {\n        exists: !!jwtSecret,\n        length: jwtSecret?.length || 0,\n        isDefault: jwtSecret === 'your-secret-key-here'\n      }\n      debugResult.error = '系统配置错误：JWT密钥未正确配置'\n      return NextResponse.json(debugResult)\n    }\n\n    debugResult.steps[3].status = 'completed'\n    debugResult.steps[3].secretInfo = {\n      exists: true,\n      length: jwtSecret.length,\n      isDefault: false\n    }\n\n    // 如果所有检查都通过，返回成功状态但不实际创建用户\n    debugResult.steps.push({\n      step: 5,\n      name: '前置验证完成',\n      status: 'completed',\n      message: '所有验证步骤通过，可以进行实际注册'\n    })\n\n    debugResult.success = true\n    debugResult.processingTime = Date.now() - startTime\n\n    return NextResponse.json(debugResult)\n\n  } catch (error) {\n    return NextResponse.json({\n      timestamp: new Date().toISOString(),\n      error: '调试端点异常',\n      details: error instanceof Error ? error.message : '未知错误',\n      stack: error instanceof Error ? error.stack : undefined\n    }, { status: 500 })\n  } finally {\n    await prisma.$disconnect()\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\chapters\\[chapterId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2406,2409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2406,2409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(\n  request: NextRequest,\n  context: { params: Promise<{ id: string, chapterId: string }> }\n) {\n  try {\n    const params = await context.params\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json(\n        { error: '未授权' },\n        { status: 401 }\n      )\n    }\n\n    // 验证小说是否属于当前用户\n    const novel = await prisma.novel.findFirst({\n      where: {\n        id: params.id,\n        userId: user.userId\n      }\n    })\n\n    if (!novel) {\n      return NextResponse.json(\n        { error: '小说不存在' },\n        { status: 404 }\n      )\n    }\n\n    const chapter = await prisma.chapter.findFirst({\n      where: {\n        id: params.chapterId,\n        novelId: params.id\n      }\n    })\n\n    if (!chapter) {\n      return NextResponse.json(\n        { error: '章节不存在' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({ chapter })\n  } catch (error) {\n    console.error('获取章节详情错误:', error)\n    return NextResponse.json(\n      { error: '获取章节详情失败' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  context: { params: Promise<{ id: string, chapterId: string }> }\n) {\n  try {\n    const params = await context.params\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json(\n        { error: '未授权' },\n        { status: 401 }\n      )\n    }\n\n    // 验证小说是否属于当前用户\n    const novel = await prisma.novel.findFirst({\n      where: {\n        id: params.id,\n        userId: user.userId\n      }\n    })\n\n    if (!novel) {\n      return NextResponse.json(\n        { error: '小说不存在' },\n        { status: 404 }\n      )\n    }\n\n    const { title, summary, content, order } = await request.json()\n\n    // 输入验证\n    if (!title || typeof title !== 'string' || title.trim().length === 0) {\n      return NextResponse.json(\n        { error: '章节标题不能为空' },\n        { status: 400 }\n      )\n    }\n\n    if (!summary || typeof summary !== 'string' || summary.trim().length === 0) {\n      return NextResponse.json(\n        { error: '章节简介不能为空' },\n        { status: 400 }\n      )\n    }\n\n    if (summary.length > 500) {\n      return NextResponse.json(\n        { error: '章节简介不能超过500个字符' },\n        { status: 400 }\n      )\n    }\n\n    // 更新章节\n    const updateData: any = {\n      title: title.trim(),\n      summary: summary.trim(),\n      updatedAt: new Date()\n    }\n\n    if (content !== undefined) {\n      updateData.content = content\n    }\n\n    if (order !== undefined && order !== null) {\n      updateData.order = order\n    }\n\n    const chapter = await prisma.chapter.updateMany({\n      where: {\n        id: params.chapterId,\n        novelId: params.id\n      },\n      data: updateData\n    })\n\n    if (chapter.count === 0) {\n      return NextResponse.json(\n        { error: '章节不存在' },\n        { status: 404 }\n      )\n    }\n\n    const updatedChapter = await prisma.chapter.findUnique({\n      where: { id: params.chapterId }\n    })\n\n    return NextResponse.json({\n      message: '章节更新成功',\n      chapter: updatedChapter\n    })\n  } catch (error) {\n    console.error('更新章节错误:', error)\n    return NextResponse.json(\n      { error: '更新章节失败' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  context: { params: Promise<{ id: string, chapterId: string }> }\n) {\n  try {\n    const params = await context.params\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json(\n        { error: '未授权' },\n        { status: 401 }\n      )\n    }\n\n    // 验证小说是否属于当前用户\n    const novel = await prisma.novel.findFirst({\n      where: {\n        id: params.id,\n        userId: user.userId\n      }\n    })\n\n    if (!novel) {\n      return NextResponse.json(\n        { error: '小说不存在' },\n        { status: 404 }\n      )\n    }\n\n    const chapter = await prisma.chapter.deleteMany({\n      where: {\n        id: params.chapterId,\n        novelId: params.id\n      }\n    })\n\n    if (chapter.count === 0) {\n      return NextResponse.json(\n        { error: '章节不存在' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({ message: '章节删除成功' })\n  } catch (error) {\n    console.error('删除章节错误:', error)\n    return NextResponse.json(\n      { error: '删除章节失败' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\chapters\\reorder\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\chapters\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\characters\\[characterId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2798,2801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2798,2801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { PrismaClient } from '@prisma/client'\nimport { verifyToken } from '@/lib/auth'\n\nconst prisma = new PrismaClient()\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; characterId: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    const character = await prisma.character.findFirst({\n      where: {\n        id: resolvedParams.characterId,\n        novelId: resolvedParams.id\n      }\n    })\n\n    if (!character) {\n      return NextResponse.json({ error: '角色不存在' }, { status: 404 })\n    }\n\n    return NextResponse.json({ \n      character: {\n        ...character,\n        traits: character.traits ? JSON.parse(character.traits) : null,\n        relationships: character.relationships ? JSON.parse(character.relationships) : null\n      }\n    })\n  } catch (error) {\n    console.error('获取角色详情失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; characterId: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    const existingCharacter = await prisma.character.findFirst({\n      where: {\n        id: resolvedParams.characterId,\n        novelId: resolvedParams.id\n      }\n    })\n\n    if (!existingCharacter) {\n      return NextResponse.json({ error: '角色不存在' }, { status: 404 })\n    }\n\n    const { name, description, avatarUrl, traits, relationships } = await request.json()\n\n    const updateData: any = {}\n    if (name !== undefined) updateData.name = name\n    if (description !== undefined) updateData.description = description\n    if (avatarUrl !== undefined) updateData.avatarUrl = avatarUrl\n    if (traits !== undefined) updateData.traits = traits ? JSON.stringify(traits) : null\n    if (relationships !== undefined) updateData.relationships = relationships ? JSON.stringify(relationships) : null\n\n    const character = await prisma.character.update({\n      where: { id: resolvedParams.characterId },\n      data: updateData\n    })\n\n    return NextResponse.json({ \n      character: {\n        ...character,\n        traits: character.traits ? JSON.parse(character.traits) : null,\n        relationships: character.relationships ? JSON.parse(character.relationships) : null\n      }\n    })\n  } catch (error) {\n    console.error('更新角色失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; characterId: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    const existingCharacter = await prisma.character.findFirst({\n      where: {\n        id: resolvedParams.characterId,\n        novelId: resolvedParams.id\n      }\n    })\n\n    if (!existingCharacter) {\n      return NextResponse.json({ error: '角色不存在' }, { status: 404 })\n    }\n\n    await prisma.character.delete({\n      where: { id: resolvedParams.characterId }\n    })\n\n    return NextResponse.json({ message: '角色删除成功' })\n  } catch (error) {\n    console.error('删除角色失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\characters\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\stats\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\world-settings\\[settingId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2575,2578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2575,2578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { PrismaClient } from '@prisma/client'\nimport { verifyToken } from '@/lib/auth'\n\nconst prisma = new PrismaClient()\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; settingId: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    const worldSetting = await prisma.worldSetting.findFirst({\n      where: {\n        id: resolvedParams.settingId,\n        novelId: resolvedParams.id\n      }\n    })\n\n    if (!worldSetting) {\n      return NextResponse.json({ error: '世界观设定不存在' }, { status: 404 })\n    }\n\n    return NextResponse.json({ worldSetting })\n  } catch (error) {\n    console.error('获取世界观设定详情失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; settingId: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    const existingSetting = await prisma.worldSetting.findFirst({\n      where: {\n        id: resolvedParams.settingId,\n        novelId: resolvedParams.id\n      }\n    })\n\n    if (!existingSetting) {\n      return NextResponse.json({ error: '世界观设定不存在' }, { status: 404 })\n    }\n\n    const { title, content, category } = await request.json()\n\n    const updateData: any = {}\n    if (title !== undefined) updateData.title = title\n    if (content !== undefined) updateData.content = content\n    if (category !== undefined) updateData.category = category\n\n    const worldSetting = await prisma.worldSetting.update({\n      where: { id: resolvedParams.settingId },\n      data: updateData\n    })\n\n    return NextResponse.json({ worldSetting })\n  } catch (error) {\n    console.error('更新世界观设定失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; settingId: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    const existingSetting = await prisma.worldSetting.findFirst({\n      where: {\n        id: resolvedParams.settingId,\n        novelId: resolvedParams.id\n      }\n    })\n\n    if (!existingSetting) {\n      return NextResponse.json({ error: '世界观设定不存在' }, { status: 404 })\n    }\n\n    await prisma.worldSetting.delete({\n      where: { id: resolvedParams.settingId }\n    })\n\n    return NextResponse.json({ message: '世界观设定删除成功' })\n  } catch (error) {\n    console.error('删除世界观设定失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\[id]\\world-settings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1392,1395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1392,1395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { PrismaClient } from '@prisma/client'\nimport { verifyToken } from '@/lib/auth'\n\nconst prisma = new PrismaClient()\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id },\n      include: {\n        worldSettings: {\n          orderBy: { createdAt: 'asc' }\n        }\n      }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    // 按分类组织世界观设定\n    const categorizedSettings: { [key: string]: typeof novel.worldSettings } = {}\n    \n    // 预定义分类\n    const categories = ['地理', '历史', '文化', '政治', '经济', '科技', '魔法', '种族', '宗教', '其他']\n    \n    categories.forEach(category => {\n      categorizedSettings[category] = []\n    })\n    \n    novel.worldSettings.forEach((setting: any) => {\n      const category = categorizedSettings[setting.category] || categorizedSettings['其他']\n      category.push(setting)\n    })\n\n    return NextResponse.json({ \n      worldSettings: novel.worldSettings,\n      categorizedSettings\n    })\n  } catch (error) {\n    console.error('获取世界观设定失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params\n    const token = request.headers.get('Authorization')?.replace('Bearer ', '')\n    if (!token) {\n      return NextResponse.json({ error: '未提供认证令牌' }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ error: '无效的认证令牌' }, { status: 401 })\n    }\n\n    const novel = await prisma.novel.findUnique({\n      where: { id: resolvedParams.id }\n    })\n\n    if (!novel) {\n      return NextResponse.json({ error: '小说不存在' }, { status: 404 })\n    }\n\n    if (novel.userId !== decoded.userId) {\n      return NextResponse.json({ error: '无权访问此小说' }, { status: 403 })\n    }\n\n    const { title, content, category } = await request.json()\n\n    if (!title || !content || !category) {\n      return NextResponse.json({ error: '标题、内容和分类不能为空' }, { status: 400 })\n    }\n\n    const worldSetting = await prisma.worldSetting.create({\n      data: {\n        novelId: resolvedParams.id,\n        title,\n        content,\n        category\n      }\n    })\n\n    return NextResponse.json({ worldSetting })\n  } catch (error) {\n    console.error('创建世界观设定失败:', error)\n    return NextResponse.json({ error: '服务器错误' }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\novels\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\test-api\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\user\\me\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1811,1814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1811,1814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\n// GET /api/user/me - 获取用户基本信息\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json(\n        { error: '未授权' },\n        { status: 401 }\n      )\n    }\n\n    const userData = await prisma.user.findUnique({\n      where: { id: user.userId },\n      select: {\n        id: true,\n        email: true,\n        username: true,\n        avatar: true,\n        nickname: true,\n        gender: true,\n        birthDate: true,\n        phone: true,\n        membershipLevel: true,\n        createdAt: true\n      }\n    })\n\n    if (!userData) {\n      return NextResponse.json(\n        { error: '用户不存在' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({ user: userData })\n  } catch (error) {\n    console.error('获取用户信息错误:', error)\n    return NextResponse.json(\n      { error: '获取用户信息失败' },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT /api/user/me - 更新用户个人信息\nexport async function PUT(request: NextRequest) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json(\n        { error: '未授权' },\n        { status: 401 }\n      )\n    }\n\n    const data = await request.json()\n    const {\n      avatar,\n      nickname,\n      gender,\n      birthDate,\n      phone\n    } = data\n\n    // 验证数据\n    if (gender && !['male', 'female', 'other'].includes(gender)) {\n      return NextResponse.json(\n        { error: '性别值无效' },\n        { status: 400 }\n      )\n    }\n\n    if (phone && !/^1[3-9]\\d{9}$/.test(phone)) {\n      return NextResponse.json(\n        { error: '手机号格式无效' },\n        { status: 400 }\n      )\n    }\n\n    // 构建更新数据\n    const updateData: any = {}\n    if (avatar !== undefined) updateData.avatar = avatar\n    if (nickname !== undefined) updateData.nickname = nickname\n    if (gender !== undefined) updateData.gender = gender\n    if (birthDate !== undefined) updateData.birthDate = birthDate ? new Date(birthDate) : null\n    if (phone !== undefined) updateData.phone = phone\n\n    // 更新用户信息\n    const updatedUser = await prisma.user.update({\n      where: { id: user.userId },\n      data: updateData,\n      select: {\n        id: true,\n        email: true,\n        username: true,\n        avatar: true,\n        nickname: true,\n        gender: true,\n        birthDate: true,\n        phone: true,\n        membershipLevel: true,\n        updatedAt: true\n      }\n    })\n\n    return NextResponse.json({\n      message: '个人信息更新成功',\n      user: updatedUser\n    })\n  } catch (error) {\n    console.error('更新用户信息错误:', error)\n    return NextResponse.json(\n      { error: '更新用户信息失败' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\user\\profile\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1855,1858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1855,1858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCurrentUser } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\n// GET /api/user/profile - 获取用户个人信息\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json(\n        { error: '未授权' },\n        { status: 401 }\n      )\n    }\n\n    const userProfile = await prisma.user.findUnique({\n      where: { id: user.userId },\n      select: {\n        id: true,\n        email: true,\n        username: true,\n        avatar: true,\n        nickname: true,\n        gender: true,\n        birthDate: true,\n        phone: true,\n        membershipLevel: true,\n        createdAt: true,\n        updatedAt: true\n      }\n    })\n\n    if (!userProfile) {\n      return NextResponse.json(\n        { error: '用户不存在' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({ user: userProfile })\n  } catch (error) {\n    console.error('获取用户信息错误:', error)\n    return NextResponse.json(\n      { error: '获取用户信息失败' },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT /api/user/profile - 更新用户个人信息\nexport async function PUT(request: NextRequest) {\n  try {\n    const user = await getCurrentUser(request)\n    if (!user) {\n      return NextResponse.json(\n        { error: '未授权' },\n        { status: 401 }\n      )\n    }\n\n    const data = await request.json()\n    const {\n      avatar,\n      nickname,\n      gender,\n      birthDate,\n      phone\n    } = data\n\n    // 验证数据\n    if (gender && !['male', 'female', 'other'].includes(gender)) {\n      return NextResponse.json(\n        { error: '性别值无效' },\n        { status: 400 }\n      )\n    }\n\n    if (phone && !/^1[3-9]\\d{9}$/.test(phone)) {\n      return NextResponse.json(\n        { error: '手机号格式无效' },\n        { status: 400 }\n      )\n    }\n\n    // 构建更新数据\n    const updateData: any = {}\n    if (avatar !== undefined) updateData.avatar = avatar\n    if (nickname !== undefined) updateData.nickname = nickname\n    if (gender !== undefined) updateData.gender = gender\n    if (birthDate !== undefined) updateData.birthDate = birthDate ? new Date(birthDate) : null\n    if (phone !== undefined) updateData.phone = phone\n\n    // 更新用户信息\n    const updatedUser = await prisma.user.update({\n      where: { id: user.userId },\n      data: updateData,\n      select: {\n        id: true,\n        email: true,\n        username: true,\n        avatar: true,\n        nickname: true,\n        gender: true,\n        birthDate: true,\n        phone: true,\n        membershipLevel: true,\n        updatedAt: true\n      }\n    })\n\n    return NextResponse.json({\n      message: '个人信息更新成功',\n      user: updatedUser\n    })\n  } catch (error) {\n    console.error('更新用户信息错误:', error)\n    return NextResponse.json(\n      { error: '更新用户信息失败' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\api\\user\\stats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    // 完全移除权限检查，直接返回模拟数据\n    console.log('访问用户统计数据API - 无需验证')\n\n    try {\n      // 尝试获取真实数据\n      const [novelsCount, chaptersCount, recentNovels] = await Promise.all([\n        prisma.novel.count(),\n        prisma.chapter.count(),\n        prisma.novel.findMany({\n          orderBy: { updatedAt: 'desc' },\n          take: 5,\n          select: {\n            id: true,\n            title: true,\n            description: true,\n            updatedAt: true\n          }\n        })\n      ])\n\n      return NextResponse.json({\n        totalNovels: novelsCount,\n        totalChapters: chaptersCount,\n        totalWords: novelsCount * 5000, // 估算\n        todayWords: 1500, // 模拟数据\n        weekWords: 7500, // 模拟数据\n        streakDays: 3, // 模拟数据\n        writingGoals: {\n          daily: 2000,\n          weekly: 10000\n        },\n        recentNovels\n      })\n    } catch (dbError) {\n      console.error('数据库连接错误，返回模拟数据:', dbError)\n      // 返回模拟数据\n      return NextResponse.json({\n        totalNovels: 3,\n        totalChapters: 12,\n        totalWords: 45000,\n        todayWords: 1500,\n        weekWords: 7500,\n        streakDays: 3,\n        writingGoals: {\n          daily: 2000,\n          weekly: 10000\n        },\n        recentNovels: [\n          {\n            id: 1,\n            title: \"示例小说1\",\n            description: \"这是一个示例小说\",\n            updatedAt: new Date().toISOString()\n          }\n        ]\n      })\n    }\n  } catch (error) {\n    console.error('获取统计数据错误:', error)\n    // 返回模拟数据而不是错误\n    return NextResponse.json({\n      totalNovels: 3,\n      totalChapters: 12,\n      totalWords: 45000,\n      todayWords: 1500,\n      weekWords: 7500,\n      streakDays: 3,\n      writingGoals: {\n        daily: 2000,\n        weekly: 10000\n      },\n      recentNovels: []\n    })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\auth\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'from' is assigned a value but never used.","line":10,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":14},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\auth\\page.tsx:16:5\n  14 |     const urlParams = new URLSearchParams(window.location.search)\n  15 |     const fromPath = urlParams.get('from') || '/dashboard'\n> 16 |     setFrom(fromPath)\n     |     ^^^^^^^ Avoid calling setState() directly within an effect\n  17 |     \n  18 |     setIsLoading(false)\n  19 |     if (token) {","line":16,"column":5,"nodeType":null,"endLine":16,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\n\nexport default function AuthPage() {\n  const router = useRouter()\n  const [isLoading, setIsLoading] = useState(true)\n  const [from, setFrom] = useState('')\n\n  useEffect(() => {\n    const token = localStorage.getItem('token')\n    const urlParams = new URLSearchParams(window.location.search)\n    const fromPath = urlParams.get('from') || '/dashboard'\n    setFrom(fromPath)\n    \n    setIsLoading(false)\n    if (token) {\n      router.push(fromPath)\n    }\n  }, [router])\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">验证中...</h1>\n          <p className=\"mt-2 text-gray-600\">正在跳转...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-indigo-50 to-white flex items-center justify-center px-4\">\n      <div className=\"max-w-md w-full\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n            需要登录\n          </h1>\n          <p className=\"text-gray-600\">\n            请登录或注册以继续访问\n          </p>\n        </div>\n\n        <div className=\"bg-white rounded-xl shadow-lg overflow-hidden\">\n          <div className=\"p-8\">\n            <div className=\"space-y-4\">\n              <Link\n                href=\"/login\"\n                className=\"w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors\"\n              >\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\n                </svg>\n                登录账户\n              </Link>\n\n              <Link\n                href=\"/register\"\n                className=\"w-full flex items-center justify-center px-6 py-3 border border-indigo-600 text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-indigo-50 transition-colors\"\n              >\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\" />\n                </svg>\n                创建新账户\n              </Link>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"text-center mt-6\">\n          <Link\n            href=\"/\"\n            className=\"text-sm text-gray-500 hover:text-gray-700\"\n          >\n            返回首页\n          </Link>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[102,130],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[255,258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[255,258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\layout.tsx:31:7\n  29 |         return\n  30 |       }\n> 31 |       setUser(userData)\n     |       ^^^^^^^ Avoid calling setState() directly within an effect\n  32 |     } catch (err) {\n  33 |       router.push('/admin/login')\n  34 |     }","line":31,"column":7,"nodeType":null,"endLine":31,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":32,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":17}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\n\nexport default function AdminLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  const [user, setUser] = useState<any>(null)\n  const router = useRouter()\n\n  useEffect(() => {\n    // 验证admin身份\n    const storedUser = localStorage.getItem('user')\n    const storedToken = localStorage.getItem('token')\n    \n    if (!storedUser || !storedToken) {\n      router.push('/admin/login')\n      return\n    }\n\n    try {\n      const userData = JSON.parse(storedUser)\n      if (userData.role !== 'admin') {\n        router.push('/login')\n        return\n      }\n      setUser(userData)\n    } catch (err) {\n      router.push('/admin/login')\n    }\n  }, [router])\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-400\">加载中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  // 不渲染任何布局，直接返回children\n  // 因为admin页面自己包含完整的布局\n  return <>{children}</>\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AlertCircle"},"fix":{"range":[286,301],"text":""},"desc":"Remove unused variable \"AlertCircle\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1430,1433],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1430,1433],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchAdminData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\page.tsx:111:7\n  109 |   useEffect(() => {\n  110 |     if (user) {\n> 111 |       fetchAdminData()\n      |       ^^^^^^^^^^^^^^ `fetchAdminData` accessed before it is declared\n  112 |     }\n  113 |   }, [user])\n  114 |\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\page.tsx:123:3\n  121 |   }, [activeTab, userPagination.page, novelPagination.page, searchTerm])\n  122 |\n> 123 |   const fetchAdminData = async () => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 124 |     try {\n      | ^^^^^^^^^\n> 125 |       const token = localStorage.getItem('token')\n      …\n      | ^^^^^^^^^\n> 147 |     }\n      | ^^^^^^^^^\n> 148 |   }\n      | ^^^^ `fetchAdminData` is declared here\n  149 |\n  150 |   const fetchUsers = async () => {\n  151 |     try {","line":111,"column":7,"nodeType":null,"endLine":111,"endColumn":21},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchUsers` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\page.tsx:117:7\n  115 |   useEffect(() => {\n  116 |     if (activeTab === 'users') {\n> 117 |       fetchUsers()\n      |       ^^^^^^^^^^ `fetchUsers` accessed before it is declared\n  118 |     } else if (activeTab === 'content') {\n  119 |       fetchNovels()\n  120 |     }\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\page.tsx:150:3\n  148 |   }\n  149 |\n> 150 |   const fetchUsers = async () => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 151 |     try {\n      | ^^^^^^^^^\n> 152 |       const token = localStorage.getItem('token')\n      …\n      | ^^^^^^^^^\n> 173 |     }\n      | ^^^^^^^^^\n> 174 |   }\n      | ^^^^ `fetchUsers` is declared here\n  175 |\n  176 |   const fetchNovels = async () => {\n  177 |     try {","line":117,"column":7,"nodeType":null,"endLine":117,"endColumn":17},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchNovels` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\page.tsx:119:7\n  117 |       fetchUsers()\n  118 |     } else if (activeTab === 'content') {\n> 119 |       fetchNovels()\n      |       ^^^^^^^^^^^ `fetchNovels` accessed before it is declared\n  120 |     }\n  121 |   }, [activeTab, userPagination.page, novelPagination.page, searchTerm])\n  122 |\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\admin\\page.tsx:176:3\n  174 |   }\n  175 |\n> 176 |   const fetchNovels = async () => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 177 |     try {\n      | ^^^^^^^^^\n> 178 |       const token = localStorage.getItem('token')\n      …\n      | ^^^^^^^^^\n> 199 |     }\n      | ^^^^^^^^^\n> 200 |   }\n      | ^^^^ `fetchNovels` is declared here\n  201 |\n  202 |   const handleBackup = async () => {\n  203 |     try {","line":119,"column":7,"nodeType":null,"endLine":119,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchNovels' and 'fetchUsers'. Either include them or remove the dependency array.","line":121,"column":6,"nodeType":"ArrayExpression","endLine":121,"endColumn":72,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, userPagination.page, novelPagination.page, searchTerm, fetchUsers, fetchNovels]","fix":{"range":[2592,2658],"text":"[activeTab, userPagination.page, novelPagination.page, searchTerm, fetchUsers, fetchNovels]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":316,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":316,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7628,7631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7628,7631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8506,8509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8506,8509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1086,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1086,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44940,44943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44940,44943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1211,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1211,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50017,50020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50017,50020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport {\n  Database,\n  Users,\n  FileText,\n  Settings,\n  Download,\n  Upload,\n  RefreshCw,\n  CheckCircle,\n  BarChart3,\n  LogOut,\n  Shield,\n  Menu,\n  X,\n  Edit,\n  Trash2,\n  Plus,\n  Search,\n  AlertCircle\n} from 'lucide-react'\n\n// 用户类型定义\ninterface User {\n  id: string\n  email: string\n  username: string\n  nickname?: string\n  avatar?: string\n  gender?: string\n  birthDate?: string\n  phone?: string\n  membershipLevel: string\n  createdAt: string\n  updatedAt: string\n  _count: {\n    novels: number\n    aiConfigs: number\n    materials: number\n  }\n}\n\n// 小说类型定义\ninterface Novel {\n  id: string\n  title: string\n  description?: string\n  outline?: string\n  worldSetting?: string\n  protagonist?: string\n  createdAt: string\n  updatedAt: string\n  userId: string\n  user: {\n    id: string\n    username: string\n    nickname?: string\n    email: string\n  }\n  _count: {\n    chapters: number\n    characters: number\n    worldSettings: number\n  }\n}\n\nexport default function AdminPage() {\n  const [stats, setStats] = useState({\n    totalUsers: 0,\n    totalNovels: 0,\n    totalChapters: 0,\n    totalWords: 0,\n    databaseSize: '0 MB',\n    lastBackup: '未备份'\n  })\n\n  const [loading, setLoading] = useState(true)\n  const [activeTab, setActiveTab] = useState('overview')\n  const [sidebarOpen, setSidebarOpen] = useState(false)\n  const [user, setUser] = useState<any>(null)\n  const [users, setUsers] = useState<User[]>([])\n  const [novels, setNovels] = useState<Novel[]>([])\n  const [userPagination, setUserPagination] = useState({ page: 1, total: 0, totalPages: 0 })\n  const [novelPagination, setNovelPagination] = useState({ page: 1, total: 0, totalPages: 0 })\n  const [showUserModal, setShowUserModal] = useState(false)\n  const [showNovelModal, setShowNovelModal] = useState(false)\n  const [editingUser, setEditingUser] = useState<User | null>(null)\n  const [editingNovel, setEditingNovel] = useState<Novel | null>(null)\n  const [searchTerm, setSearchTerm] = useState('')\n\n  const router = useRouter()\n\n  // 从localStorage获取已验证的用户信息\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user')\n    if (storedUser) {\n      try {\n        const userData = JSON.parse(storedUser)\n        setUser(userData)\n      } catch (err) {\n        console.error('解析用户数据失败:', err)\n      }\n    }\n  }, [])\n\n  useEffect(() => {\n    if (user) {\n      fetchAdminData()\n    }\n  }, [user])\n\n  useEffect(() => {\n    if (activeTab === 'users') {\n      fetchUsers()\n    } else if (activeTab === 'content') {\n      fetchNovels()\n    }\n  }, [activeTab, userPagination.page, novelPagination.page, searchTerm])\n\n  const fetchAdminData = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/admin/stats', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        setStats({\n          totalUsers: data.totalUsers || 0,\n          totalNovels: data.totalNovels || 0,\n          totalChapters: data.totalChapters || 0,\n          totalWords: data.totalWords || 0,\n          databaseSize: data.databaseSize || '0 MB',\n          lastBackup: data.lastBackup || '未备份'\n        })\n      }\n      setLoading(false)\n    } catch (error) {\n      console.error('获取管理员数据失败:', error)\n      setLoading(false)\n    }\n  }\n\n  const fetchUsers = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(\n        `/api/admin/users?page=${userPagination.page}&limit=10&search=${encodeURIComponent(searchTerm)}`,\n        {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        }\n      )\n\n      if (response.ok) {\n        const data = await response.json()\n        setUsers(data.data)\n        setUserPagination({\n          page: data.pagination.page,\n          total: data.pagination.total,\n          totalPages: data.pagination.totalPages\n        })\n      }\n    } catch (error) {\n      console.error('获取用户列表失败:', error)\n    }\n  }\n\n  const fetchNovels = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(\n        `/api/admin/novels?page=${novelPagination.page}&limit=10&search=${encodeURIComponent(searchTerm)}`,\n        {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        }\n      )\n\n      if (response.ok) {\n        const data = await response.json()\n        setNovels(data.data)\n        setNovelPagination({\n          page: data.pagination.page,\n          total: data.pagination.total,\n          totalPages: data.pagination.totalPages\n        })\n      }\n    } catch (error) {\n      console.error('获取小说列表失败:', error)\n    }\n  }\n\n  const handleBackup = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/admin/backup', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        // 下载文件\n        const blob = await response.blob()\n        const url = window.URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `backup-${new Date().toISOString().split('T')[0]}.json`\n        document.body.appendChild(a)\n        a.click()\n        window.URL.revokeObjectURL(url)\n        document.body.removeChild(a)\n        alert('备份成功！')\n        fetchAdminData()\n      } else {\n        alert('备份失败！')\n      }\n    } catch (error) {\n      console.error('备份失败:', error)\n      alert('备份失败！')\n    }\n  }\n\n  const handleImport = async (file: File) => {\n    try {\n      const token = localStorage.getItem('token')\n      const formData = new FormData()\n      formData.append('file', file)\n\n      const response = await fetch('/api/admin/import', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        },\n        body: formData\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        alert(`导入成功！\\n${JSON.stringify(data.data, null, 2)}`)\n        fetchAdminData()\n      } else {\n        const error = await response.json()\n        alert(`导入失败：${error.error}`)\n      }\n    } catch (error) {\n      console.error('导入失败:', error)\n      alert('导入失败！')\n    }\n  }\n\n  const handleDeleteUser = async (userId: string) => {\n    if (!confirm('确定要删除该用户吗？此操作将级联删除该用户的所有小说和章节。')) {\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/admin/users/${userId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        alert('用户删除成功！')\n        fetchUsers()\n        fetchAdminData()\n      } else {\n        alert('删除失败！')\n      }\n    } catch (error) {\n      console.error('删除用户失败:', error)\n      alert('删除失败！')\n    }\n  }\n\n  const handleDeleteNovel = async (novelId: string) => {\n    if (!confirm('确定要删除该小说吗？此操作将级联删除该小说的所有章节、角色和世界观。')) {\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/admin/novels/${novelId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        alert('小说删除成功！')\n        fetchNovels()\n        fetchAdminData()\n      } else {\n        alert('删除失败！')\n      }\n    } catch (error) {\n      console.error('删除小说失败:', error)\n      alert('删除失败！')\n    }\n  }\n\n  const handleSaveUser = async (userData: any) => {\n    try {\n      const token = localStorage.getItem('token')\n      const url = editingUser\n        ? `/api/admin/users/${editingUser.id}`\n        : '/api/admin/users'\n      const method = editingUser ? 'PUT' : 'POST'\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(userData)\n      })\n\n      if (response.ok) {\n        alert(editingUser ? '用户更新成功！' : '用户创建成功！')\n        setShowUserModal(false)\n        setEditingUser(null)\n        fetchUsers()\n        fetchAdminData()\n      } else {\n        const error = await response.json()\n        alert(`操作失败：${error.error}`)\n      }\n    } catch (error) {\n      console.error('保存用户失败:', error)\n      alert('操作失败！')\n    }\n  }\n\n  const handleSaveNovel = async (novelData: any) => {\n    try {\n      const token = localStorage.getItem('token')\n      const url = editingNovel\n        ? `/api/admin/novels/${editingNovel.id}`\n        : '/api/admin/novels'\n      const method = editingNovel ? 'PUT' : 'POST'\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(novelData)\n      })\n\n      if (response.ok) {\n        alert(editingNovel ? '小说更新成功！' : '小说创建成功！')\n        setShowNovelModal(false)\n        setEditingNovel(null)\n        fetchNovels()\n        fetchAdminData()\n      } else {\n        const error = await response.json()\n        alert(`操作失败：${error.error}`)\n      }\n    } catch (error) {\n      console.error('保存小说失败:', error)\n      alert('操作失败！')\n    }\n  }\n\n  const handleLogout = () => {\n    localStorage.removeItem('token')\n    localStorage.removeItem('user')\n    router.push('/admin/login')\n  }\n\n  const menuItems = [\n    {\n      id: 'overview',\n      label: '系统概览',\n      icon: BarChart3,\n      description: '查看系统统计数据'\n    },\n    {\n      id: 'users',\n      label: '用户管理',\n      icon: Users,\n      description: '管理系统用户'\n    },\n    {\n      id: 'content',\n      label: '小说管理',\n      icon: FileText,\n      description: '管理小说内容'\n    },\n    {\n      id: 'database',\n      label: '数据库管理',\n      icon: Database,\n      description: '数据库操作与备份'\n    },\n    {\n      id: 'settings',\n      label: '系统设置',\n      icon: Settings,\n      description: '系统配置'\n    }\n  ]\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-400\">加载中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 flex\">\n      {/* 移动端侧边栏遮罩 */}\n      {sidebarOpen && (\n        <div\n          className=\"fixed inset-0 z-40 lg:hidden bg-gray-600 bg-opacity-75\"\n          onClick={() => setSidebarOpen(false)}\n        />\n      )}\n\n      {/* 后台管理侧边栏 */}\n      <div className={`\n        fixed inset-y-0 left-0 z-50 w-72 bg-gray-800 transform transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0 lg:flex-shrink-0 border-r border-gray-700\n        ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n      `}>\n        {/* Logo区域 */}\n        <div className=\"flex items-center justify-between h-16 px-6 border-b border-gray-700 bg-gray-900\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-gradient-to-br from-red-500 to-orange-600 rounded-lg flex items-center justify-center\">\n              <Shield className=\"h-5 w-5 text-white\" />\n            </div>\n            <div>\n              <span className=\"text-lg font-bold text-white\">管理控制台</span>\n              <span className=\"block text-xs text-gray-400\">Admin Panel</span>\n            </div>\n          </div>\n          <button\n            onClick={() => setSidebarOpen(false)}\n            className=\"lg:hidden\"\n          >\n            <X className=\"h-6 w-6 text-gray-400\" />\n          </button>\n        </div>\n\n        {/* 导航菜单 */}\n        <nav className=\"mt-6 px-3\">\n          <div className=\"space-y-1\">\n            {menuItems.map((item) => {\n              const Icon = item.icon\n              const isActive = activeTab === item.id\n\n              return (\n                <button\n                  key={item.id}\n                  onClick={() => setActiveTab(item.id)}\n                  className={`\n                    group w-full flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all duration-200\n                    ${isActive\n                      ? 'bg-gradient-to-r from-red-600 to-orange-600 text-white shadow-lg'\n                      : 'text-gray-300 hover:bg-gray-700 hover:text-white'\n                    }\n                  `}\n                >\n                  <Icon className={`mr-3 h-5 w-5 ${isActive ? 'text-white' : 'text-gray-400'}`} />\n                  <div className=\"flex-1 text-left\">\n                    <div className={isActive ? 'text-white' : 'text-gray-300'}>{item.label}</div>\n                    <div className={`text-xs mt-0.5 ${isActive ? 'text-orange-100' : 'text-gray-500'}`}>{item.description}</div>\n                  </div>\n                </button>\n              )\n            })}\n          </div>\n        </nav>\n\n        {/* 用户信息 */}\n        <div className=\"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700 bg-gray-900\">\n          <div className=\"flex items-center mb-3\">\n            <div className=\"relative\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-red-500 to-orange-600 rounded-full flex items-center justify-center shadow-sm\">\n                <Shield className=\"h-5 w-5 text-white\" />\n              </div>\n              <div className=\"absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-gray-900\"></div>\n            </div>\n            <div className=\"ml-3 flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-white truncate\">{user.username}</p>\n              <p className=\"text-xs text-gray-400 truncate\">{user.email}</p>\n            </div>\n          </div>\n          <button\n            onClick={handleLogout}\n            className=\"flex items-center justify-center w-full px-3 py-2 text-sm font-medium text-gray-300 bg-gray-800 rounded-lg hover:bg-gray-700 hover:text-white transition-colors border border-gray-700\"\n          >\n            <LogOut className=\"mr-2 h-4 w-4\" />\n            退出登录\n          </button>\n        </div>\n      </div>\n\n      {/* 主内容区域 */}\n      <div className=\"flex-1 flex flex-col min-w-0 bg-gray-900\">\n        {/* 顶部操作栏 */}\n        <div className=\"sticky top-0 z-10 bg-gray-800 border-b border-gray-700\">\n          <div className=\"flex items-center justify-between h-16 px-4 sm:px-6 lg:px-8\">\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={() => setSidebarOpen(true)}\n                className=\"lg:hidden\"\n              >\n                <Menu className=\"h-6 w-6 text-gray-400\" />\n              </button>\n\n              <div className=\"flex items-center space-x-2\">\n                <Shield className=\"h-5 w-5 text-red-500\" />\n                <span className=\"text-sm font-medium text-gray-300\">后台管理系统</span>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"hidden sm:flex items-center space-x-2 text-sm bg-red-900/30 px-3 py-1 rounded-full border border-red-800\">\n                <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n                <span className=\"text-gray-300 font-medium\">系统运行正常</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* 页面内容 */}\n        <main className=\"flex-1 p-4 sm:p-6 lg:p-8 overflow-auto\">\n          {loading ? (\n            <div className=\"space-y-6\">\n              <div className=\"animate-pulse\">\n                <div className=\"h-8 bg-gray-700 rounded w-1/3 mb-4\"></div>\n                <div className=\"h-4 bg-gray-700 rounded w-2/3\"></div>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n                {[1, 2, 3, 4].map(i => (\n                  <div key={i} className=\"bg-gray-800 p-6 rounded-lg animate-pulse\">\n                    <div className=\"h-4 bg-gray-700 rounded w-1/2 mb-2\"></div>\n                    <div className=\"h-8 bg-gray-700 rounded w-3/4\"></div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          ) : (\n            <div className=\"space-y-6\">\n              {activeTab === 'overview' && (\n                <>\n                  <div>\n                    <h1 className=\"text-2xl font-bold text-white\">系统概览</h1>\n                    <p className=\"mt-1 text-gray-400\">查看系统运行状态和关键指标</p>\n                  </div>\n\n                  {/* 统计卡片 */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <div className=\"flex items-center\">\n                        <div className=\"flex-shrink-0 bg-blue-900/50 rounded-lg p-3\">\n                          <Users className=\"h-6 w-6 text-blue-400\" />\n                        </div>\n                        <div className=\"ml-4\">\n                          <p className=\"text-sm font-medium text-gray-400\">注册用户</p>\n                          <p className=\"text-2xl font-semibold text-white\">{stats.totalUsers}</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <div className=\"flex items-center\">\n                        <div className=\"flex-shrink-0 bg-green-900/50 rounded-lg p-3\">\n                          <FileText className=\"h-6 w-6 text-green-400\" />\n                        </div>\n                        <div className=\"ml-4\">\n                          <p className=\"text-sm font-medium text-gray-400\">小说总数</p>\n                          <p className=\"text-2xl font-semibold text-white\">{stats.totalNovels}</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <div className=\"flex items-center\">\n                        <div className=\"flex-shrink-0 bg-purple-900/50 rounded-lg p-3\">\n                          <Database className=\"h-6 w-6 text-purple-400\" />\n                        </div>\n                        <div className=\"ml-4\">\n                          <p className=\"text-sm font-medium text-gray-400\">章节总数</p>\n                          <p className=\"text-2xl font-semibold text-white\">{stats.totalChapters}</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <div className=\"flex items-center\">\n                        <div className=\"flex-shrink-0 bg-orange-900/50 rounded-lg p-3\">\n                          <BarChart3 className=\"h-6 w-6 text-orange-400\" />\n                        </div>\n                        <div className=\"ml-4\">\n                          <p className=\"text-sm font-medium text-gray-400\">总字数</p>\n                          <p className=\"text-2xl font-semibold text-white\">{stats.totalWords.toLocaleString()}</p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* 系统状态 */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <h3 className=\"text-lg font-medium text-white mb-4\">数据库信息</h3>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-400\">数据库大小</span>\n                          <span className=\"font-medium text-white\">{stats.databaseSize}</span>\n                        </div>\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-400\">最后备份</span>\n                          <span className=\"font-medium text-white\">{stats.lastBackup}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <h3 className=\"text-lg font-medium text-white mb-4\">系统状态</h3>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center text-sm\">\n                          <CheckCircle className=\"h-4 w-4 text-green-400 mr-2\" />\n                          <span className=\"text-gray-300\">服务运行正常</span>\n                        </div>\n                        <div className=\"flex items-center text-sm\">\n                          <CheckCircle className=\"h-4 w-4 text-green-400 mr-2\" />\n                          <span className=\"text-gray-300\">数据库连接正常</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* 操作按钮 */}\n                  <div className=\"flex space-x-4\">\n                    <button\n                      onClick={handleBackup}\n                      className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n                    >\n                      <Download className=\"h-4 w-4 mr-2\" />\n                      备份数据库\n                    </button>\n                  </div>\n                </>\n              )}\n\n              {activeTab === 'users' && (\n                <>\n                  <div>\n                    <h1 className=\"text-2xl font-bold text-white\">用户管理</h1>\n                    <p className=\"mt-1 text-gray-400\">管理系统用户账号</p>\n                  </div>\n\n                  <div className=\"bg-gray-800 rounded-lg border border-gray-700\">\n                    <div className=\"p-4 border-b border-gray-700 flex items-center justify-between flex-wrap gap-4\">\n                      <div className=\"flex items-center space-x-2 flex-1\">\n                        <div className=\"relative\">\n                          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                          <input\n                            type=\"text\"\n                            placeholder=\"搜索用户...\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                            className=\"pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:border-gray-500 w-full sm:w-64\"\n                          />\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => {\n                          setEditingUser(null)\n                          setShowUserModal(true)\n                        }}\n                        className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700\"\n                      >\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        添加用户\n                      </button>\n                    </div>\n                    <div className=\"overflow-x-auto\">\n                      <table className=\"min-w-full divide-y divide-gray-700\">\n                        <thead className=\"bg-gray-900/50\">\n                          <tr>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">用户</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">邮箱</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">会员等级</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">小说数</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">注册时间</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">操作</th>\n                          </tr>\n                        </thead>\n                        <tbody className=\"bg-gray-800 divide-y divide-gray-700\">\n                          {users.map((u) => (\n                            <tr key={u.id}>\n                              <td className=\"px-6 py-4 whitespace-nowrap\">\n                                <div className=\"flex items-center\">\n                                  <div className=\"h-10 w-10 bg-indigo-900/50 rounded-full flex items-center justify-center\">\n                                    <span className=\"text-indigo-400 font-medium\">{u.nickname?.[0] || u.username[0]}</span>\n                                  </div>\n                                  <div className=\"ml-4\">\n                                    <div className=\"text-sm font-medium text-white\">{u.nickname || u.username}</div>\n                                    <div className=\"text-xs text-gray-500\">@{u.username}</div>\n                                  </div>\n                                </div>\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-400\">{u.email}</td>\n                              <td className=\"px-6 py-4 whitespace-nowrap\">\n                                <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\n                                  u.membershipLevel === 'vip' ? 'bg-purple-900/50 text-purple-300' :\n                                  u.membershipLevel === 'premium' ? 'bg-yellow-900/50 text-yellow-300' :\n                                  'bg-gray-700 text-gray-300'\n                                }`}>\n                                  {u.membershipLevel.toUpperCase()}\n                                </span>\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-400\">{u._count.novels}</td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-400\">\n                                {new Date(u.createdAt).toLocaleDateString()}\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                                <button\n                                  onClick={() => {\n                                    setEditingUser(u)\n                                    setShowUserModal(true)\n                                  }}\n                                  className=\"text-indigo-400 hover:text-indigo-300 mr-3\"\n                                >\n                                  <Edit className=\"h-4 w-4\" />\n                                </button>\n                                <button\n                                  onClick={() => handleDeleteUser(u.id)}\n                                  className=\"text-red-400 hover:text-red-300\"\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </button>\n                              </td>\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n                    </div>\n                    {/* 分页 */}\n                    {userPagination.totalPages > 1 && (\n                      <div className=\"px-6 py-4 border-t border-gray-700 flex items-center justify-between\">\n                        <div className=\"text-sm text-gray-400\">\n                          共 {userPagination.total} 条记录，第 {userPagination.page} / {userPagination.totalPages} 页\n                        </div>\n                        <div className=\"flex space-x-2\">\n                          <button\n                            onClick={() => setUserPagination({ ...userPagination, page: userPagination.page - 1 })}\n                            disabled={userPagination.page === 1}\n                            className=\"px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n                          >\n                            上一页\n                          </button>\n                          <button\n                            onClick={() => setUserPagination({ ...userPagination, page: userPagination.page + 1 })}\n                            disabled={userPagination.page === userPagination.totalPages}\n                            className=\"px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n                          >\n                            下一页\n                          </button>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </>\n              )}\n\n              {activeTab === 'content' && (\n                <>\n                  <div>\n                    <h1 className=\"text-2xl font-bold text-white\">小说管理</h1>\n                    <p className=\"mt-1 text-gray-400\">管理平台上的小说内容</p>\n                  </div>\n\n                  <div className=\"bg-gray-800 rounded-lg border border-gray-700\">\n                    <div className=\"p-4 border-b border-gray-700 flex items-center justify-between flex-wrap gap-4\">\n                      <div className=\"flex items-center space-x-2 flex-1\">\n                        <div className=\"relative\">\n                          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                          <input\n                            type=\"text\"\n                            placeholder=\"搜索小说...\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                            className=\"pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:border-gray-500 w-full sm:w-64\"\n                          />\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => {\n                          setEditingNovel(null)\n                          setShowNovelModal(true)\n                        }}\n                        className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700\"\n                      >\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        添加小说\n                      </button>\n                    </div>\n                    <div className=\"divide-y divide-gray-700\">\n                      {novels.map((novel) => (\n                        <div key={novel.id} className=\"p-4 hover:bg-gray-700/50 transition-colors\">\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center space-x-2 mb-2\">\n                                <h4 className=\"font-medium text-white\">{novel.title}</h4>\n                                <span className=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-900/50 text-green-300\">已发布</span>\n                              </div>\n                              <p className=\"text-sm text-gray-400 mb-2 line-clamp-2\">{novel.description || '暂无描述'}</p>\n                              <div className=\"flex items-center space-x-4 text-xs text-gray-500 flex-wrap\">\n                                <span>{novel._count.chapters} 章节</span>\n                                <span>{novel._count.characters} 角色</span>\n                                <span>作者：{novel.user.nickname || novel.user.username}</span>\n                                <span>最后更新：{new Date(novel.updatedAt).toLocaleDateString()}</span>\n                              </div>\n                            </div>\n                            <div className=\"flex items-center space-x-2 ml-4\">\n                              <button\n                                onClick={() => {\n                                  setEditingNovel(novel)\n                                  setShowNovelModal(true)\n                                }}\n                                className=\"text-indigo-400 hover:text-indigo-300 text-sm\"\n                              >\n                                <Edit className=\"h-4 w-4\" />\n                              </button>\n                              <button\n                                onClick={() => handleDeleteNovel(novel.id)}\n                                className=\"text-red-400 hover:text-red-300 text-sm\"\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </button>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                    {/* 分页 */}\n                    {novelPagination.totalPages > 1 && (\n                      <div className=\"px-6 py-4 border-t border-gray-700 flex items-center justify-between\">\n                        <div className=\"text-sm text-gray-400\">\n                          共 {novelPagination.total} 条记录，第 {novelPagination.page} / {novelPagination.totalPages} 页\n                        </div>\n                        <div className=\"flex space-x-2\">\n                          <button\n                            onClick={() => setNovelPagination({ ...novelPagination, page: novelPagination.page - 1 })}\n                            disabled={novelPagination.page === 1}\n                            className=\"px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n                          >\n                            上一页\n                          </button>\n                          <button\n                            onClick={() => setNovelPagination({ ...novelPagination, page: novelPagination.page + 1 })}\n                            disabled={novelPagination.page === novelPagination.totalPages}\n                            className=\"px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n                          >\n                            下一页\n                          </button>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </>\n              )}\n\n              {activeTab === 'database' && (\n                <>\n                  <div>\n                    <h1 className=\"text-2xl font-bold text-white\">数据库管理</h1>\n                    <p className=\"mt-1 text-gray-400\">数据库操作与维护</p>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <h3 className=\"text-lg font-medium text-white mb-4\">数据库操作</h3>\n                      <div className=\"space-y-3\">\n                        <button\n                          onClick={handleBackup}\n                          className=\"w-full text-left px-4 py-3 text-sm border border-gray-600 rounded-lg hover:bg-gray-700 hover:border-gray-500 flex items-center transition-colors\"\n                        >\n                          <Download className=\"h-4 w-4 mr-3 text-gray-400\" />\n                          <span className=\"text-gray-300\">导出数据</span>\n                        </button>\n                        <label className=\"w-full text-left px-4 py-3 text-sm border border-gray-600 rounded-lg hover:bg-gray-700 hover:border-gray-500 flex items-center transition-colors cursor-pointer\">\n                          <Upload className=\"h-4 w-4 mr-3 text-gray-400\" />\n                          <span className=\"text-gray-300\">导入数据</span>\n                          <input\n                            type=\"file\"\n                            accept=\".json\"\n                            onChange={(e) => {\n                              const file = e.target.files?.[0]\n                              if (file) {\n                                handleImport(file)\n                              }\n                            }}\n                            className=\"hidden\"\n                          />\n                        </label>\n                        <button\n                          onClick={() => {\n                            if (confirm('确定要刷新统计数据吗？')) {\n                              fetchAdminData()\n                              alert('统计数据已刷新！')\n                            }\n                          }}\n                          className=\"w-full text-left px-4 py-3 text-sm border border-gray-600 rounded-lg hover:bg-gray-700 hover:border-gray-500 flex items-center transition-colors\"\n                        >\n                          <RefreshCw className=\"h-4 w-4 mr-3 text-gray-400\" />\n                          <span className=\"text-gray-300\">刷新统计</span>\n                        </button>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n                      <h3 className=\"text-lg font-medium text-white mb-4\">数据统计</h3>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-400\">用户表记录</span>\n                          <span className=\"font-medium text-white\">{stats.totalUsers}</span>\n                        </div>\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-400\">小说表记录</span>\n                          <span className=\"font-medium text-white\">{stats.totalNovels}</span>\n                        </div>\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-400\">章节表记录</span>\n                          <span className=\"font-medium text-white\">{stats.totalChapters}</span>\n                        </div>\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-400\">总字数</span>\n                          <span className=\"font-medium text-white\">{stats.totalWords.toLocaleString()}</span>\n                        </div>\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-400\">数据库大小</span>\n                          <span className=\"font-medium text-white\">{stats.databaseSize}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </>\n              )}\n\n              {activeTab === 'settings' && (\n                <>\n                  <div>\n                    <h1 className=\"text-2xl font-bold text-white\">系统设置</h1>\n                    <p className=\"mt-1 text-gray-400\">系统配置与管理</p>\n                  </div>\n\n                  <div className=\"bg-gray-800 rounded-lg border border-gray-700\">\n                    <div className=\"p-6 border-b border-gray-700\">\n                      <h3 className=\"text-lg font-medium text-white mb-4\">系统配置</h3>\n                      <div className=\"space-y-6\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <div className=\"text-sm font-medium text-white\">维护模式</div>\n                            <div className=\"text-xs text-gray-400\">开启后普通用户无法访问</div>\n                          </div>\n                          <button className=\"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none bg-gray-600\">\n                            <span className=\"sr-only\">Use setting</span>\n                            <span className=\"translate-x-0 pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out\"></span>\n                          </button>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <div className=\"text-sm font-medium text-white\">用户注册</div>\n                            <div className=\"text-xs text-gray-400\">是否允许新用户注册</div>\n                          </div>\n                          <button className=\"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none bg-green-600\">\n                            <span className=\"sr-only\">Use setting</span>\n                            <span className=\"translate-x-5 pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out\"></span>\n                          </button>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <div className=\"text-sm font-medium text-white\">AI 生成功能</div>\n                            <div className=\"text-xs text-gray-400\">启用或禁用AI内容生成</div>\n                          </div>\n                          <button className=\"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none bg-green-600\">\n                            <span className=\"sr-only\">Use setting</span>\n                            <span className=\"translate-x-5 pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out\"></span>\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </>\n              )}\n            </div>\n          )}\n        </main>\n      </div>\n\n      {/* 用户编辑/创建弹窗 */}\n      {showUserModal && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\" style={{ backgroundColor: \"rgba(0,0,0,0.5)\" }}>\n          <div className=\"bg-gray-800 rounded-lg border border-gray-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-700 flex items-center justify-between\">\n              <h2 className=\"text-xl font-bold text-white\">\n                {editingUser ? '编辑用户' : '添加用户'}\n              </h2>\n              <button\n                onClick={() => {\n                  setShowUserModal(false)\n                  setEditingUser(null)\n                }}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                <X className=\"h-6 w-6\" />\n              </button>\n            </div>\n            <div className=\"p-6\">\n              <UserForm\n                user={editingUser}\n                onSave={handleSaveUser}\n                onCancel={() => {\n                  setShowUserModal(false)\n                  setEditingUser(null)\n                }}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* 小说编辑/创建弹窗 */}\n      {showNovelModal && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\" style={{ backgroundColor: \"rgba(0,0,0,0.5)\" }}>\n          <div className=\"bg-gray-800 rounded-lg border border-gray-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-700 flex items-center justify-between\">\n              <h2 className=\"text-xl font-bold text-white\">\n                {editingNovel ? '编辑小说' : '添加小说'}\n              </h2>\n              <button\n                onClick={() => {\n                  setShowNovelModal(false)\n                  setEditingNovel(null)\n                }}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                <X className=\"h-6 w-6\" />\n              </button>\n            </div>\n            <div className=\"p-6\">\n              <NovelForm\n                novel={editingNovel}\n                users={users}\n                onSave={handleSaveNovel}\n                onCancel={() => {\n                  setShowNovelModal(false)\n                  setEditingNovel(null)\n                }}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// 用户表单组件\nfunction UserForm({ user, onSave, onCancel }: { user: User | null; onSave: (data: any) => void; onCancel: () => void }) {\n  const [formData, setFormData] = useState({\n    email: user?.email || '',\n    username: user?.username || '',\n    password: '',\n    nickname: user?.nickname || '',\n    gender: user?.gender || '',\n    birthDate: user?.birthDate?.split('T')[0] || '',\n    phone: user?.phone || '',\n    membershipLevel: user?.membershipLevel || 'free'\n  })\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    onSave(formData)\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">邮箱 *</label>\n          <input\n            type=\"email\"\n            required\n            value={formData.email}\n            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">用户名 *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.username}\n            onChange={(e) => setFormData({ ...formData, username: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n            密码 {user ? '（留空不修改）' : '*'}\n          </label>\n          <input\n            type=\"password\"\n            required={!user}\n            value={formData.password}\n            onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">昵称</label>\n          <input\n            type=\"text\"\n            value={formData.nickname}\n            onChange={(e) => setFormData({ ...formData, nickname: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">性别</label>\n          <select\n            value={formData.gender}\n            onChange={(e) => setFormData({ ...formData, gender: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          >\n            <option value=\"\">请选择</option>\n            <option value=\"male\">男</option>\n            <option value=\"female\">女</option>\n            <option value=\"other\">其他</option>\n          </select>\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">出生日期</label>\n          <input\n            type=\"date\"\n            value={formData.birthDate}\n            onChange={(e) => setFormData({ ...formData, birthDate: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">手机号</label>\n          <input\n            type=\"tel\"\n            value={formData.phone}\n            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">会员等级</label>\n          <select\n            value={formData.membershipLevel}\n            onChange={(e) => setFormData({ ...formData, membershipLevel: e.target.value })}\n            className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n          >\n            <option value=\"free\">免费用户</option>\n            <option value=\"vip\">VIP会员</option>\n            <option value=\"premium\">高级会员</option>\n          </select>\n        </div>\n      </div>\n      <div className=\"flex justify-end space-x-4 pt-4\">\n        <button\n          type=\"button\"\n          onClick={onCancel}\n          className=\"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600\"\n        >\n          取消\n        </button>\n        <button\n          type=\"submit\"\n          className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n        >\n          保存\n        </button>\n      </div>\n    </form>\n  )\n}\n\n// 小说表单组件\nfunction NovelForm({ novel, users, onSave, onCancel }: { novel: Novel | null; users: User[]; onSave: (data: any) => void; onCancel: () => void }) {\n  const [formData, setFormData] = useState({\n    title: novel?.title || '',\n    description: novel?.description || '',\n    outline: novel?.outline || '',\n    worldSetting: novel?.worldSetting || '',\n    protagonist: novel?.protagonist || '',\n    userId: novel?.userId || (users[0]?.id || '')\n  })\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    onSave(formData)\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div>\n        <label className=\"block text-sm font-medium text-gray-300 mb-2\">小说标题 *</label>\n        <input\n          type=\"text\"\n          required\n          value={formData.title}\n          onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n          className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n        />\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-gray-300 mb-2\">所属用户 *</label>\n        <select\n          required\n          value={formData.userId}\n          onChange={(e) => setFormData({ ...formData, userId: e.target.value })}\n          className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n        >\n          {users.map((u) => (\n            <option key={u.id} value={u.id}>\n              {u.nickname || u.username} ({u.email})\n            </option>\n          ))}\n        </select>\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-gray-300 mb-2\">小说简介</label>\n        <textarea\n          rows={3}\n          value={formData.description}\n          onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n          className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n        />\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-gray-300 mb-2\">小说大纲</label>\n        <textarea\n          rows={4}\n          value={formData.outline}\n          onChange={(e) => setFormData({ ...formData, outline: e.target.value })}\n          className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n        />\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-gray-300 mb-2\">世界观设定</label>\n        <textarea\n          rows={3}\n          value={formData.worldSetting}\n          onChange={(e) => setFormData({ ...formData, worldSetting: e.target.value })}\n          className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n        />\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-gray-300 mb-2\">主角设定</label>\n        <input\n          type=\"text\"\n          value={formData.protagonist}\n          onChange={(e) => setFormData({ ...formData, protagonist: e.target.value })}\n          className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-gray-500\"\n        />\n      </div>\n      <div className=\"flex justify-end space-x-4 pt-4\">\n        <button\n          type=\"button\"\n          onClick={onCancel}\n          className=\"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600\"\n        >\n          取消\n        </button>\n        <button\n          type=\"submit\"\n          className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n        >\n          保存\n        </button>\n      </div>\n    </form>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\ai-workshop\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":4,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[85,95],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":55,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":82,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":107,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":107,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":130,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":151,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":151,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":172,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":172,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":652,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":652,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Plus, Edit, Trash2, Settings, CheckCircle, Circle, Bot, TestTube, Save, Eye } from 'lucide-react'\n\ninterface AIModel {\n  id: string\n  name: string\n  apiKey: string\n  baseUrl?: string\n  model: string\n  role: string\n  systemPrompt: string\n  temperature: number\n  maxTokens: number\n  contextWindow: number\n  topP: number\n  topN?: number\n  frequencyPenalty: number\n  presencePenalty: number\n  isActive: boolean\n  isDefault: boolean\n  createdAt: string\n  updatedAt: string\n}\n\nexport default function AIWorkshopPage() {\n  const [models, setModels] = useState<AIModel[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showCreateModal, setShowCreateModal] = useState(false)\n  const [editingModel, setEditingModel] = useState<AIModel | null>(null)\n  const [showTestModal, setShowTestModal] = useState(false)\n  const [testingModel, setTestingModel] = useState<AIModel | null>(null)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    fetchModels()\n  }, [])\n\n  const fetchModels = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/ai-models', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setModels(data.models || [])\n      } else {\n        setError('获取AI模型失败')\n      }\n    } catch (error) {\n      setError('网络错误')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleCreate = async (formData: Partial<AIModel>) => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/ai-models', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(formData)\n      })\n\n      if (response.ok) {\n        setShowCreateModal(false)\n        fetchModels()\n        alert('模型创建成功')\n      } else {\n        const data = await response.json()\n        alert(data.error || '创建失败')\n      }\n    } catch (error) {\n      alert('创建失败')\n    }\n  }\n\n  const handleUpdate = async (id: string, formData: Partial<AIModel>) => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/ai-models/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(formData)\n      })\n\n      if (response.ok) {\n        setEditingModel(null)\n        fetchModels()\n        alert('更新成功')\n      } else {\n        const data = await response.json()\n        alert(data.error || '更新失败')\n      }\n    } catch (error) {\n      alert('更新失败')\n    }\n  }\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('确定要删除这个AI模型吗？')) return\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/ai-models/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        fetchModels()\n        alert('删除成功')\n      } else {\n        alert('删除失败')\n      }\n    } catch (error) {\n      alert('删除失败')\n    }\n  }\n\n  const handleSetActive = async (id: string) => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/ai-models/${id}/activate`, {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        fetchModels()\n        alert('已设置为激活模型')\n      } else {\n        alert('设置失败')\n      }\n    } catch (error) {\n      alert('设置失败')\n    }\n  }\n\n  const handleSetDefault = async (id: string) => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/ai-models/${id}/default`, {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        fetchModels()\n        alert('已设置为默认模型')\n      } else {\n        alert('设置失败')\n      }\n    } catch (error) {\n      alert('设置失败')\n    }\n  }\n\n  const handleTest = (model: AIModel) => {\n    setTestingModel(model)\n    setShowTestModal(true)\n  }\n\n  if (loading) {\n    return <div className=\"flex justify-center items-center h-64\">加载中...</div>\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 页面标题 */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">AI模型工坊</h1>\n          <p className=\"mt-1 text-sm text-gray-600\">管理你的AI模型API配置、角色设定和生成参数</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n        >\n          <Plus className=\"mr-2 h-4 w-4\" />\n          添加模型\n        </button>\n      </div>\n\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded\">\n          {error}\n        </div>\n      )}\n\n      {/* 模型列表 */}\n      {models.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <Bot className=\"mx-auto h-12 w-12 text-gray-400\" />\n          <h3 className=\"mt-2 text-sm font-medium text-gray-900\">还没有AI模型</h3>\n          <p className=\"mt-1 text-sm text-gray-500\">添加你的第一个AI模型配置</p>\n          <div className=\"mt-6\">\n            <button\n              onClick={() => setShowCreateModal(true)}\n              className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n            >\n              <Plus className=\"mr-2 h-4 w-4\" />\n              添加模型\n            </button>\n          </div>\n        </div>\n      ) : (\n        <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n          <ul className=\"divide-y divide-gray-200\">\n            {models.map((model) => (\n              <li key={model.id}>\n                <div className=\"px-4 py-4 sm:px-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center flex-1\">\n                      <div className=\"flex items-center mr-4\">\n                        <button\n                          onClick={() => handleSetActive(model.id)}\n                          className=\"mr-2\"\n                          title={model.isActive ? \"已激活\" : \"点击激活\"}\n                        >\n                          {model.isActive ? (\n                            <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                          ) : (\n                            <Circle className=\"h-5 w-5 text-gray-400 hover:text-green-500\" />\n                          )}\n                        </button>\n                        {model.isDefault && (\n                          <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800\">\n                            默认\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-lg font-medium text-gray-900\">\n                          {model.name}\n                          {model.isActive && (\n                            <span className=\"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800\">\n                              激活中\n                            </span>\n                          )}\n                        </h3>\n                        <p className=\"mt-1 text-sm text-gray-500\">\n                          模型: {model.model} • \n                          温度: {model.temperature} • \n                          最大令牌: {model.maxTokens}\n                          {model.baseUrl && ` • 自定义API`}\n                        </p>\n                        {model.role && (\n                          <p className=\"mt-1 text-sm text-gray-600\">\n                            <span className=\"font-medium\">角色:</span> {model.role}\n                          </p>\n                        )}\n                        <p className=\"mt-1 text-xs text-gray-400\">\n                          创建于 {new Date(model.createdAt).toLocaleDateString()}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex space-x-2 ml-4\">\n                      <button\n                        onClick={() => handleTest(model)}\n                        className=\"text-gray-400 hover:text-purple-600\"\n                        title=\"测试模型\"\n                      >\n                        <TestTube className=\"h-5 w-5\" />\n                      </button>\n                      <button\n                        onClick={() => setEditingModel(model)}\n                        className=\"text-gray-400 hover:text-indigo-600\"\n                        title=\"编辑模型\"\n                      >\n                        <Edit className=\"h-5 w-5\" />\n                      </button>\n                      {!model.isDefault && (\n                        <button\n                          onClick={() => handleSetDefault(model.id)}\n                          className=\"text-gray-400 hover:text-blue-600\"\n                          title=\"设为默认\"\n                        >\n                          <Save className=\"h-5 w-5\" />\n                        </button>\n                      )}\n                      <button\n                        onClick={() => handleDelete(model.id)}\n                        className=\"text-gray-400 hover:text-red-600\"\n                        title=\"删除模型\"\n                      >\n                        <Trash2 className=\"h-5 w-5\" />\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </li>\n            ))}\n          </ul>\n        </div>\n      )}\n\n      {/* 创建模型模态框 */}\n      {showCreateModal && (\n        <ModelModal\n          title=\"添加AI模型\"\n          model={null}\n          onSave={handleCreate}\n          onCancel={() => setShowCreateModal(false)}\n        />\n      )}\n\n      {/* 编辑模型模态框 */}\n      {editingModel && (\n        <ModelModal\n          title=\"编辑AI模型\"\n          model={editingModel}\n          onSave={(data) => handleUpdate(editingModel.id, data)}\n          onCancel={() => setEditingModel(null)}\n        />\n      )}\n\n      {/* 测试模型模态框 */}\n      {showTestModal && testingModel && (\n        <TestModal\n          model={testingModel}\n          onClose={() => setShowTestModal(false)}\n        />\n      )}\n    </div>\n  )\n}\n\ninterface ModelModalProps {\n  title: string\n  model: AIModel | null\n  onSave: (data: Partial<AIModel>) => void\n  onCancel: () => void\n}\n\nfunction ModelModal({ title, model, onSave, onCancel }: ModelModalProps) {\n  const [formData, setFormData] = useState({\n    name: model?.name || '',\n    apiKey: model?.apiKey || '',\n    baseUrl: model?.baseUrl || '',\n    model: model?.model || 'gpt-3.5-turbo',\n    role: model?.role || '',\n    systemPrompt: model?.systemPrompt || '',\n    temperature: model?.temperature || 0.7,\n    maxTokens: model?.maxTokens || 2000,\n    contextWindow: model?.contextWindow || 4096,\n    topP: model?.topP || 1,\n    topN: model?.topN || 0,\n    frequencyPenalty: model?.frequencyPenalty || 0,\n    presencePenalty: model?.presencePenalty || 0\n  })\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    onSave(formData)\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n      <div className=\"relative top-10 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto\">\n        <h3 className=\"text-lg font-medium text-gray-900 mb-4\">{title}</h3>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              模型名称 *\n            </label>\n            <input\n              type=\"text\"\n              required\n              value={formData.name}\n              onChange={(e) => setFormData({...formData, name: e.target.value})}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              API密钥 *\n            </label>\n            <input\n              type=\"password\"\n              required\n              value={formData.apiKey}\n              onChange={(e) => setFormData({...formData, apiKey: e.target.value})}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              API基础地址（可选）\n            </label>\n            <input\n              type=\"url\"\n              value={formData.baseUrl}\n              onChange={(e) => setFormData({...formData, baseUrl: e.target.value})}\n              placeholder=\"例如: https://api.openai.com/v1\"\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              模型名称 *\n            </label>\n            <input\n              type=\"text\"\n              required\n              value={formData.model}\n              onChange={(e) => setFormData({...formData, model: e.target.value})}\n              placeholder=\"例如: gpt-3.5-turbo, gpt-4, claude-3-sonnet\"\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              角色设定 *\n            </label>\n            <textarea\n              required\n              value={formData.role}\n              onChange={(e) => setFormData({...formData, role: e.target.value})}\n              rows={2}\n              placeholder=\"例如: 你是一个专业的小说家，擅长创作科幻小说\"\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              系统提示词\n            </label>\n            <textarea\n              value={formData.systemPrompt}\n              onChange={(e) => setFormData({...formData, systemPrompt: e.target.value})}\n              rows={3}\n              placeholder=\"更详细的系统指导，定义AI的写作风格和规范\"\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n\n          {/* 高级参数 */}\n          <div className=\"border-t pt-4\">\n            <h4 className=\"text-sm font-medium text-gray-900 mb-4\">高级参数</h4>\n            \n            <div className=\"space-y-4\">\n              {/* 上下文窗口 */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  上下文窗口 (Token数)\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"128000\"\n                  step=\"1\"\n                  value={formData.contextWindow}\n                  onChange={(e) => setFormData({...formData, contextWindow: parseInt(e.target.value)})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  模型在生成响应时要考虑的文本数量。例如设置为4096表示只考虑最后4096个token\n                </p>\n              </div>\n\n              {/* 最大令牌 */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  最大令牌数\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"8000\"\n                  value={formData.maxTokens}\n                  onChange={(e) => setFormData({...formData, maxTokens: parseInt(e.target.value)})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  定义生成的响应中令牌的最大数量，控制输出长度\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                {/* 温度 */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    温度 (0-2)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    min=\"0\"\n                    max=\"2\"\n                    value={formData.temperature}\n                    onChange={(e) => setFormData({...formData, temperature: parseFloat(e.target.value)})}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                  <p className=\"mt-1 text-xs text-gray-500\">\n                    控制生成输出的随机性，越高越随机\n                  </p>\n                </div>\n                \n                {/* Top P */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Top P (0-1)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    min=\"0\"\n                    max=\"1\"\n                    value={formData.topP}\n                    onChange={(e) => setFormData({...formData, topP: parseFloat(e.target.value)})}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                  <p className=\"mt-1 text-xs text-gray-500\">\n                    核采样，控制输出的多样性\n                  </p>\n                </div>\n\n                {/* Top N */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Top N (0为禁用)\n                  </label>\n                  <input\n                    type=\"number\"\n                    min=\"0\"\n                    max=\"100\"\n                    value={formData.topN}\n                    onChange={(e) => setFormData({...formData, topN: parseInt(e.target.value)})}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                  <p className=\"mt-1 text-xs text-gray-500\">\n                    每步采样时考虑前N个最可能的标记，0表示禁用\n                  </p>\n                </div>\n\n                {/* 频率惩罚 */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    频率惩罚 (-2到2)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    min=\"-2\"\n                    max=\"2\"\n                    value={formData.frequencyPenalty}\n                    onChange={(e) => setFormData({...formData, frequencyPenalty: parseFloat(e.target.value)})}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                  <p className=\"mt-1 text-xs text-gray-500\">\n                    减少重复单词或短语的出现\n                  </p>\n                </div>\n              </div>\n\n              {/* 存在惩罚 */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  存在惩罚 (-2到2)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  min=\"-2\"\n                  max=\"2\"\n                  value={formData.presencePenalty}\n                  onChange={(e) => setFormData({...formData, presencePenalty: parseFloat(e.target.value)})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n                />\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  阻止模型提到特定单词或短语，增加话题多样性\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex justify-end space-x-3 pt-4\">\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\"\n            >\n              取消\n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700\"\n            >\n              保存\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}\n\ninterface TestModalProps {\n  model: AIModel\n  onClose: () => void\n}\n\nfunction TestModal({ model, onClose }: TestModalProps) {\n  const [prompt, setPrompt] = useState('请写一段关于未来世界的描述，约100字')\n  const [response, setResponse] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const handleTest = async () => {\n    if (!prompt.trim()) return\n\n    setLoading(true)\n    try {\n      const token = localStorage.getItem('token')\n      const testResponse = await fetch('/api/ai-models/test', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          modelId: model.id,\n          prompt: prompt\n        })\n      })\n\n      if (testResponse.ok) {\n        const data = await testResponse.json()\n        setResponse(data.response)\n      } else {\n        const errorData = await testResponse.json()\n        setResponse(`错误: ${errorData.error || '测试失败'}`)\n      }\n    } catch (error) {\n      setResponse('网络错误')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n      <div className=\"relative top-10 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-medium text-gray-900\">测试模型: {model.name}</h3>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600\"\n          >\n            <Eye className=\"h-5 w-5\" />\n          </button>\n        </div>\n        \n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              测试提示\n            </label>\n            <textarea\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              rows={3}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n          \n          <button\n            onClick={handleTest}\n            disabled={loading || !prompt.trim()}\n            className=\"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-300\"\n          >\n            {loading ? '测试中...' : '开始测试'}\n          </button>\n          \n          {response && (\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                模型回复\n              </label>\n              <div className=\"p-3 bg-gray-50 border border-gray-200 rounded-md\">\n                <pre className=\"whitespace-pre-wrap text-sm text-gray-800\">{response}</pre>\n              </div>\n            </div>\n          )}\n        </div>\n        \n        <div className=\"flex justify-end mt-4\">\n          <button\n            onClick={onClose}\n            className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\"\n          >\n            关闭\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BookOpen' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BookOpen"},"fix":{"range":[188,197],"text":""},"desc":"Remove unused variable \"BookOpen\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Home' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Home"},"fix":{"range":[251,259],"text":""},"desc":"Remove unused variable \"Home\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Database' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Database"},"fix":{"range":[278,290],"text":""},"desc":"Remove unused variable \"Database\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\layout.tsx:37:5\n  35 |       email: 'demo@example.com'\n  36 |     }\n> 37 |     setUser(virtualUser)\n     |     ^^^^^^^ Avoid calling setState() directly within an effect\n  38 |     \n  39 |     // 同时设置到localStorage以便其他组件使用\n  40 |     localStorage.setItem('user', JSON.stringify(virtualUser))","line":37,"column":5,"nodeType":null,"endLine":37,"endColumn":12}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport {\n  BookOpen,\n  PenTool,\n  Settings,\n  Brain,\n  LogOut,\n  Menu,\n  X,\n  Home,\n  LayoutDashboard,\n  Database\n} from 'lucide-react'\n\nexport default function DashboardLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  const [user, setUser] = useState<any>(null)\n  const [sidebarOpen, setSidebarOpen] = useState(false)\n  const router = useRouter()\n  const pathname = usePathname()\n\n  useEffect(() => {\n    // 移除登录验证，直接设置一个虚拟用户\n    const virtualUser = {\n      id: 'demo-user-id',\n      username: 'demo',\n      email: 'demo@example.com'\n    }\n    setUser(virtualUser)\n    \n    // 同时设置到localStorage以便其他组件使用\n    localStorage.setItem('user', JSON.stringify(virtualUser))\n    localStorage.setItem('token', 'demo-token')\n  }, [])\n\n  const handleLogout = () => {\n    localStorage.removeItem('token')\n    localStorage.removeItem('user')\n    router.push('/')\n  }\n\n  const menuItems = [\n    {\n      label: '工作台',\n      icon: LayoutDashboard,\n      href: '/dashboard/workspace'\n    },\n    {\n      label: '创作中心',\n      icon: PenTool,\n      href: '/dashboard/novels'\n    },\n    {\n      label: 'AI模型工坊',\n      icon: Brain,\n      href: '/dashboard/ai-workshop'\n    },\n    {\n      label: '设置',\n      icon: Settings,\n      href: '/dashboard/settings'\n    }\n  ]\n\n  // 检查是否是后台管理页面，如果是则不渲染Dashboard的导航栏\n  if (pathname.startsWith('/dashboard/admin')) {\n    return <>{children}</>\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex\">\n      {/* 移动端侧边栏遮罩 */}\n      {sidebarOpen && (\n        <div\n          className=\"fixed inset-0 z-40 lg:hidden bg-gray-600 bg-opacity-75\"\n          onClick={() => setSidebarOpen(false)}\n        />\n      )}\n\n      {/* 侧边栏 - 仅用于前端创作平台 */}\n      <div className={`\n        fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0 lg:flex-shrink-0\n        ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n      `}>\n        <div className=\"flex items-center justify-between h-16 px-6 border-b border-gray-200\">\n          <Link href=\"/dashboard/workspace\" className=\"text-xl font-semibold text-gray-900\">\n            小说创作平台\n          </Link>\n          <button\n            onClick={() => setSidebarOpen(false)}\n            className=\"lg:hidden\"\n          >\n            <X className=\"h-6 w-6 text-gray-500\" />\n          </button>\n        </div>\n\n        <nav className=\"mt-6 px-3\">\n          <div className=\"space-y-1\">\n            {menuItems.map((item) => {\n              const Icon = item.icon\n              const isActive = pathname === item.href\n              \n              return (\n                <Link\n                  key={item.href}\n                  href={item.href}\n                  className={`\n                    group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors\n                    ${isActive\n                      ? 'bg-indigo-50 text-indigo-700 border-r-2 border-indigo-700'\n                      : 'text-gray-700 hover:bg-gray-50 hover:text-gray-900'\n                    }\n                  `}\n                  onClick={() => setSidebarOpen(false)}\n                >\n                  <Icon className=\"mr-3 h-5 w-5\" />\n                  {item.label}\n                </Link>\n              )\n            })}\n          </div>\n        </nav>\n\n        <div className=\"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200\">\n          {user && (\n            <>\n              <div className=\"flex items-center mb-3\">\n                <div className=\"relative\">\n                  <div className=\"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center shadow-sm\">\n                    <span className=\"text-sm font-medium text-white\">\n                      {user.username.charAt(0).toUpperCase()}\n                    </span>\n                  </div>\n                  <div className=\"absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-white\"></div>\n                </div>\n                <div className=\"ml-3 flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-gray-900 truncate\">{user.username}</p>\n                  <p className=\"text-xs text-gray-500 truncate\">{user.email}</p>\n                </div>\n              </div>\n              <button\n                onClick={handleLogout}\n                className=\"flex items-center w-full px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-50 hover:text-gray-900 transition-colors\"\n              >\n                <LogOut className=\"mr-3 h-4 w-4\" />\n                退出登录\n              </button>\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* 主内容区域 */}\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        {/* 顶部导航栏 - 仅用于前端创作平台 */}\n        <div className=\"sticky top-0 z-10 bg-white shadow-sm border-b border-gray-200\">\n          <div className=\"flex items-center justify-between h-16 px-4 sm:px-6 lg:px-8\">\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={() => setSidebarOpen(true)}\n                className=\"lg:hidden\"\n              >\n                <Menu className=\"h-6 w-6 text-gray-500\" />\n              </button>\n              \n              {/* 面包屑导航 - 不包含后台管理 */}\n              <nav className=\"hidden md:flex items-center space-x-2 text-sm\">\n                <span className=\"text-gray-500\">创作平台</span>\n                <svg className=\"h-4 w-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n                <span className=\"text-gray-900 font-medium\">\n                  {pathname === '/dashboard/workspace' && '工作台'}\n                  {pathname === '/dashboard/novels' && '创作中心'}\n                  {pathname === '/dashboard/ai-workshop' && 'AI模型工坊'}\n                  {pathname === '/dashboard/settings' && '设置'}\n                  {pathname.startsWith('/dashboard/novels/') && '小说详情'}\n                </span>\n              </nav>\n            </div>\n            \n            <div className=\"flex items-center space-x-4\">\n              {user && (\n                <div className=\"hidden sm:flex items-center space-x-2 text-sm\">\n                  <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n                  <span className=\"text-gray-600\">在线</span>\n                  <span className=\"text-gray-500\">|</span>\n                  <span className=\"text-gray-900 font-medium\">{user.username}</span>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* 页面内容 */}\n        <main className=\"flex-1 p-4 sm:p-6 lg:p-8 overflow-auto\">\n          {children}\n        </main>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\chapters\\[chapterId]\\detail\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[316,319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[316,319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[364,367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[364,367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchChapter'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [params.id, params.chapterId, fetchChapter]","fix":{"range":[702,731],"text":"[params.id, params.chapterId, fetchChapter]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":57,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { ArrowLeft, Save, Settings } from 'lucide-react'\n\nexport default function ChapterDetailPage() {\n  const params = useParams()\n  const router = useRouter()\n  const [chapter, setChapter] = useState<any>(null)\n  const [novel, setNovel] = useState<any>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [error, setError] = useState('')\n  \n  // 表单状态\n  const [title, setTitle] = useState('')\n  const [summary, setSummary] = useState('')\n\n  useEffect(() => {\n    if (params.id && params.chapterId) {\n      fetchChapter()\n    }\n  }, [params.id, params.chapterId])\n\n  const fetchChapter = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      \n      // 获取章节信息\n      const chapterResponse = await fetch(`/api/novels/${params.id}/chapters/${params.chapterId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (chapterResponse.ok) {\n        const chapterData = await chapterResponse.json()\n        setChapter(chapterData.chapter)\n        setTitle(chapterData.chapter.title)\n        setSummary(chapterData.chapter.summary || '')\n        \n        // 获取小说信息用于显示上下文\n        const novelResponse = await fetch(`/api/novels/${params.id}`, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        })\n        \n        if (novelResponse.ok) {\n          const novelData = await novelResponse.json()\n          setNovel(novelData.novel)\n        }\n      } else {\n        setError('获取章节信息失败')\n      }\n    } catch (error) {\n      setError('网络错误')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSave = async () => {\n    if (!title.trim()) {\n      alert('章节标题不能为空')\n      return\n    }\n    if (!summary.trim()) {\n      alert('章节简介不能为空')\n      return\n    }\n    if (summary.length > 500) {\n      alert('章节简介不能超过500个字符')\n      return\n    }\n\n    setSaving(true)\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/chapters/${params.chapterId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: title.trim(),\n          summary: summary.trim(),\n          content: chapter.content,\n          order: chapter.order\n        })\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setChapter(data.chapter)\n        alert('章节详情保存成功')\n      } else {\n        const errorData = await response.json()\n        alert(`保存失败：${errorData.error || '未知错误'}`)\n      }\n    } catch (error) {\n      console.error('保存章节详情失败:', error)\n      alert('保存失败，请检查网络连接')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto\"></div>\n          <p className=\"mt-2 text-gray-600\">加载中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (error || !chapter) {\n    return (\n      <div className=\"text-center text-red-600 p-8\">\n        <h2 className=\"text-xl font-medium mb-2\">加载失败</h2>\n        <p className=\"text-gray-600\">{error || '章节不存在'}</p>\n        <button\n          onClick={() => router.back()}\n          className=\"mt-4 px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700\"\n        >\n          返回上一页\n        </button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col\">\n      {/* 顶部导航 */}\n      <div className=\"bg-white border-b border-gray-200 px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center\">\n            <button\n              onClick={() => router.back()}\n              className=\"mr-4 text-gray-500 hover:text-gray-700\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </button>\n            <div>\n              <h1 className=\"text-xl font-semibold text-gray-900 flex items-center\">\n                <Settings className=\"mr-2 h-5 w-5 text-indigo-600\" />\n                章节详情设置\n              </h1>\n              <p className=\"text-sm text-gray-500 mt-1\">\n                {novel?.title} - 第{chapter.order}章\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={() => router.push(`/dashboard/novels/${params.id}/chapters/${params.chapterId}`)}\n              className=\"px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm\"\n            >\n              编辑内容\n            </button>\n            <button\n              onClick={handleSave}\n              disabled={saving}\n              className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <Save className=\"mr-2 h-4 w-4\" />\n              {saving ? '保存中...' : '保存详情'}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* 主要内容区域 */}\n      <div className=\"flex-1 overflow-hidden\">\n        <div className=\"h-full overflow-y-auto\">\n          <div className=\"max-w-4xl mx-auto p-6\">\n            {/* 页面说明 */}\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n              <h3 className=\"text-sm font-medium text-blue-900 mb-2\">📝 章节详情说明</h3>\n              <p className=\"text-sm text-blue-700\">\n                在这里编辑章节的标题和简介。这些信息用于：\n              </p>\n              <ul className=\"text-sm text-blue-700 mt-2 ml-4 list-disc\">\n                <li>章节管理和组织</li>\n                <li>AI生成章节内容的基础信息</li>\n                <li>帮助读者了解章节内容概要</li>\n              </ul>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              {/* 左侧：编辑区域 */}\n              <div className=\"lg:col-span-2 space-y-6\">\n                {/* 章节基本信息 */}\n                <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-4\">基本信息</h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        章节标题 <span className=\"text-red-500\">*</span>\n                      </label>\n                      <input\n                        type=\"text\"\n                        id=\"title\"\n                        value={title}\n                        onChange={(e) => setTitle(e.target.value)}\n                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                        placeholder=\"输入章节标题，如：初入江湖\"\n                      />\n                      <p className=\"mt-1 text-xs text-gray-500\">\n                        清晰的标题有助于读者理解章节内容\n                      </p>\n                    </div>\n                    \n                    <div>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <label htmlFor=\"summary\" className=\"block text-sm font-medium text-gray-700\">\n                          章节简介 <span className=\"text-red-500\">*</span>\n                        </label>\n                        <span className=\"text-xs text-gray-500\">{summary.length}/500</span>\n                      </div>\n                      <textarea\n                        id=\"summary\"\n                        value={summary}\n                        onChange={(e) => setSummary(e.target.value)}\n                        rows={8}\n                        maxLength={500}\n                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n                        placeholder=\"简要描述这个章节的主要内容：\n\n• 主要情节和事件\n• 关键人物的行动和决策\n• 场景和氛围描述\n• 章节要达到的目标和效果\n\n好的简介能让AI生成更贴合你想法的章节内容。\"\n                      />\n                      <p className=\"mt-1 text-xs text-gray-500\">\n                        简介越详细，AI生成的内容越贴合你的预期\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* 章节预览 */}\n                <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-4\">章节预览</h3>\n                  <div className=\"border border-gray-200 rounded-lg p-4 bg-gray-50\">\n                    <div className=\"flex items-center mb-3\">\n                      <span className=\"text-sm font-medium text-gray-500 mr-3\">\n                        第{chapter.order}章\n                      </span>\n                      <h4 className=\"text-base font-medium text-gray-900\">\n                        {title || '未设置标题'}\n                      </h4>\n                    </div>\n                    <p className=\"text-sm text-gray-600 whitespace-pre-wrap\">\n                      {summary || '未设置简介'}\n                    </p>\n                    <div className=\"mt-3 text-xs text-gray-400\">\n                      最后更新：{new Date(chapter.updatedAt).toLocaleString()}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* 右侧：帮助信息 */}\n              <div className=\"space-y-6\">\n                <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-4\">📝 写作建议</h3>\n                  <div className=\"space-y-4 text-sm\">\n                    <div>\n                      <h4 className=\"font-medium text-gray-900 mb-2\">标题写作</h4>\n                      <ul className=\"text-gray-600 space-y-1\">\n                        <li>• 简洁明了，突出章节重点</li>\n                        <li>• 使用动词或关键事件命名</li>\n                        <li>• 保持风格统一</li>\n                        <li>• 避免剧透重要情节</li>\n                      </ul>\n                    </div>\n                    \n                    <div>\n                      <h4 className=\"font-medium text-gray-900 mb-2\">简介写作</h4>\n                      <ul className=\"text-gray-600 space-y-1\">\n                        <li>• 包含关键情节和转折点</li>\n                        <li>• 说明主要人物的心理状态</li>\n                        <li>• 描述重要的场景和氛围</li>\n                        <li>• 控制在200-500字之间</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-6\">\n                  <h3 className=\"text-lg font-medium text-amber-900 mb-4\">⚠️ 注意事项</h3>\n                  <ul className=\"text-sm text-amber-700 space-y-2\">\n                    <li>• 章节标题和简介都是必填项</li>\n                    <li>• 简介最多500个字符</li>\n                    <li>• 修改后需要点击保存才能生效</li>\n                    <li>• 保存成功后可以使用AI生成功能</li>\n                  </ul>\n                </div>\n\n                <div className=\"bg-green-50 border border-green-200 rounded-lg p-6\">\n                  <h3 className=\"text-lg font-medium text-green-900 mb-4\">💡 AI生成提示</h3>\n                  <p className=\"text-sm text-green-700\">\n                    保存章节简介后，你可以在章节列表页面使用AI生成功能，根据这个简介自动创作章节内容。\n                  </p>\n                  <button\n                    onClick={() => router.push(`/dashboard/novels/${params.id}`)}\n                    className=\"mt-3 w-full px-3 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700\"\n                  >\n                    返回章节列表\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\chapters\\[chapterId]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\chapters\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[312,315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[312,315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNovel'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNovel, params.id]","fix":{"range":[654,665],"text":"[fetchNovel, params.id]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":42,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":87,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":87,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":128,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":128,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { ArrowLeft, Save, Sparkles } from 'lucide-react'\n\nexport default function CreateChapterPage() {\n  const params = useParams()\n  const router = useRouter()\n  const [novel, setNovel] = useState<any>(null)\n  const [formData, setFormData] = useState({\n    title: '',\n    summary: '',\n    content: '',\n    useAI: false\n  })\n  const [loading, setLoading] = useState(false)\n  const [generating, setGenerating] = useState(false)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    if (params.id) {\n      fetchNovel()\n    }\n  }, [params.id])\n\n  const fetchNovel = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovel(data.novel)\n      } else {\n        setError('获取小说信息失败')\n      }\n    } catch (error) {\n      setError('网络错误')\n    }\n  }\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    })\n  }\n\n  const handleAIGenerate = async () => {\n    if (!formData.summary.trim()) {\n      setError('请先填写章节简介')\n      return\n    }\n\n    setGenerating(true)\n    setError('')\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/ai/generate-chapter', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          novelId: params.id,\n          chapterSummary: formData.summary\n        })\n      })\n\n      const data = await response.json()\n\n      if (response.ok) {\n        setFormData(prev => ({\n          ...prev,\n          content: data.content\n        }))\n      } else {\n        setError(data.error || 'AI生成失败')\n      }\n    } catch (error) {\n      setError('AI生成失败，请检查网络连接')\n    } finally {\n      setGenerating(false)\n    }\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setError('')\n\n    if (!formData.title.trim()) {\n      setError('章节标题是必需的')\n      setLoading(false)\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/chapters`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: formData.title,\n          summary: formData.summary,\n          content: formData.content,\n          isAIGenerated: formData.useAI\n        })\n      })\n\n      const data = await response.json()\n\n      if (response.ok) {\n        router.push(`/dashboard/novels/${params.id}`)\n      } else {\n        setError(data.error || '创建失败')\n      }\n    } catch (error) {\n      setError('网络错误，请重试')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (!novel) {\n    return <div className=\"flex justify-center items-center h-64\">加载中...</div>\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      {/* 返回按钮 */}\n      <div className=\"mb-6\">\n        <button\n          onClick={() => router.back()}\n          className=\"flex items-center text-sm text-gray-500 hover:text-gray-700\"\n        >\n          <ArrowLeft className=\"mr-2 h-4 w-4\" />\n          返回\n        </button>\n      </div>\n\n      {/* 页面标题 */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold text-gray-900\">创建新章节</h1>\n        <p className=\"mt-1 text-sm text-gray-600\">\n          小说：{novel.title}\n        </p>\n      </div>\n\n      {/* 小说信息预览 */}\n      <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n        <h3 className=\"text-sm font-medium text-blue-900 mb-2\">小说设定参考</h3>\n        {novel.outline && (\n          <div className=\"mb-2\">\n            <span className=\"text-xs font-medium text-blue-700\">故事大纲：</span>\n            <p className=\"text-xs text-blue-600 mt-1\">{novel.outline}</p>\n          </div>\n        )}\n        {novel.worldSetting && (\n          <div className=\"mb-2\">\n            <span className=\"text-xs font-medium text-blue-700\">世界观：</span>\n            <p className=\"text-xs text-blue-600 mt-1\">{novel.worldSetting}</p>\n          </div>\n        )}\n        {novel.protagonist && (\n          <div>\n            <span className=\"text-xs font-medium text-blue-700\">主角设定：</span>\n            <p className=\"text-xs text-blue-600 mt-1\">{novel.protagonist}</p>\n          </div>\n        )}\n      </div>\n\n      {/* 表单 */}\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"bg-white shadow rounded-lg p-6\">\n          <div className=\"grid grid-cols-1 gap-6\">\n            <div>\n              <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700\">\n                章节标题 *\n              </label>\n              <input\n                type=\"text\"\n                id=\"title\"\n                name=\"title\"\n                required\n                value={formData.title}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"输入章节标题\"\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"summary\" className=\"block text-sm font-medium text-gray-700\">\n                章节简介\n              </label>\n              <textarea\n                id=\"summary\"\n                name=\"summary\"\n                rows={3}\n                value={formData.summary}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"简要描述这个章节的主要内容，AI生成时会基于此内容创作\"\n              />\n            </div>\n\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <label htmlFor=\"content\" className=\"block text-sm font-medium text-gray-700\">\n                  章节内容\n                </label>\n                <button\n                  type=\"button\"\n                  onClick={handleAIGenerate}\n                  disabled={generating || !formData.summary.trim()}\n                  className=\"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-white bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n                >\n                  <Sparkles className=\"mr-1 h-3 w-3\" />\n                  {generating ? 'AI生成中...' : 'AI生成内容'}\n                </button>\n              </div>\n              <textarea\n                id=\"content\"\n                name=\"content\"\n                rows={12}\n                value={formData.content}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"在这里编写章节内容，或者使用AI生成功能...\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex justify-end space-x-3\">\n          <button\n            type=\"button\"\n            onClick={() => router.back()}\n            className=\"px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n          >\n            取消\n          </button>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n          >\n            <Save className=\"mr-2 h-4 w-4\" />\n            {loading ? '创建中...' : '创建章节'}\n          </button>\n        </div>\n      </form>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\characters\\[characterId]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowLeft' is defined but never used.","line":6,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ArrowLeft"},"fix":{"range":[144,155],"text":""},"desc":"Remove unused variable \"ArrowLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'novelTitle' is assigned a value but never used.","line":25,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchCharacter' and 'fetchNovelInfo'. Either include them or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCharacter, fetchNovelInfo]","fix":{"range":[948,950],"text":"[fetchCharacter, fetchNovelInfo]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { Save, ArrowLeft, User, Tag, Heart, Trash2 } from 'lucide-react'\n\ninterface CharacterData {\n  name: string\n  description: string\n  avatarUrl: string\n  traits: {\n    [key: string]: string\n  }\n  relationships: {\n    [key: string]: string\n  }\n}\n\nexport default function EditCharacterPage({ params }: { params: { id: string; characterId: string } }) {\n  const router = useRouter()\n  const [loading, setLoading] = useState(false)\n  const [fetchLoading, setFetchLoading] = useState(true)\n  const [error, setError] = useState('')\n  const [novelTitle, setNovelTitle] = useState('')\n  const [characterData, setCharacterData] = useState<CharacterData>({\n    name: '',\n    description: '',\n    avatarUrl: '',\n    traits: {},\n    relationships: {}\n  })\n\n  useEffect(() => {\n    fetchCharacter()\n    fetchNovelInfo()\n  }, [])\n\n  const fetchCharacter = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/characters/${params.characterId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setCharacterData({\n          name: data.character.name,\n          description: data.character.description || '',\n          avatarUrl: data.character.avatarUrl || '',\n          traits: data.character.traits || {},\n          relationships: data.character.relationships || {}\n        })\n      } else {\n        setError('获取角色信息失败')\n      }\n    } catch (error) {\n      console.error('获取角色信息失败:', error)\n      setError('获取角色信息失败')\n    } finally {\n      setFetchLoading(false)\n    }\n  }\n\n  const fetchNovelInfo = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovelTitle(data.novel.title)\n      }\n    } catch (error) {\n      console.error('获取小说信息失败:', error)\n    }\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (!characterData.name.trim()) {\n      setError('角色名称不能为空')\n      return\n    }\n\n    setLoading(true)\n    setError('')\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/characters/${params.characterId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(characterData)\n      })\n\n      if (response.ok) {\n        router.push(`/dashboard/novels/${params.id}/characters`)\n      } else {\n        const data = await response.json()\n        setError(data.error || '更新角色失败')\n      }\n    } catch (error) {\n      console.error('更新角色失败:', error)\n      setError('更新角色失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const deleteCharacter = async () => {\n    if (!confirm('确定要删除这个角色吗？此操作不可恢复。')) {\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/characters/${params.characterId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        router.push(`/dashboard/novels/${params.id}/characters`)\n      } else {\n        setError('删除角色失败')\n      }\n    } catch (error) {\n      console.error('删除角色失败:', error)\n      setError('删除角色失败')\n    }\n  }\n\n  const updateTrait = (trait: string, value: string) => {\n    setCharacterData(prev => ({\n      ...prev,\n      traits: {\n        ...prev.traits,\n        [trait]: value\n      }\n    }))\n  }\n\n  const addTrait = () => {\n    const key = prompt('特征名称（如：性格、年龄、外貌等）：')\n    if (key) {\n      setCharacterData(prev => ({\n        ...prev,\n        traits: {\n          ...prev.traits,\n          [key]: ''\n        }\n      }))\n    }\n  }\n\n  const removeTrait = (key: string) => {\n    setCharacterData(prev => {\n      const newTraits = { ...prev.traits }\n      delete newTraits[key]\n      return {\n        ...prev,\n        traits: newTraits\n      }\n    })\n  }\n\n  const addRelationship = () => {\n    const key = prompt('关系名称（如：朋友、敌人、家人等）：')\n    if (key) {\n      setCharacterData(prev => ({\n        ...prev,\n        relationships: {\n          ...prev.relationships,\n          [key]: ''\n        }\n      }))\n    }\n  }\n\n  const updateRelationship = (key: string, value: string) => {\n    setCharacterData(prev => ({\n      ...prev,\n      relationships: {\n        ...prev.relationships,\n        [key]: value\n      }\n    }))\n  }\n\n  const removeRelationship = (key: string) => {\n    setCharacterData(prev => {\n      const newRelationships = { ...prev.relationships }\n      delete newRelationships[key]\n      return {\n        ...prev,\n        relationships: newRelationships\n      }\n    })\n  }\n\n  if (fetchLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">加载中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* 顶部导航 */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-4\">\n              <Link \n                href={`/dashboard/novels/${params.id}/characters`}\n                className=\"text-gray-600 hover:text-gray-900\"\n              >\n                ← 返回角色列表\n              </Link>\n              <h1 className=\"text-xl font-semibold text-gray-900\">\n                编辑角色: {characterData.name}\n              </h1>\n            </div>\n            <button\n              onClick={deleteCharacter}\n              className=\"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\"\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              删除角色\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* 主要内容 */}\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\n            <p className=\"text-red-800\">{error}</p>\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\n          {/* 基本信息 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center space-x-2 mb-6\">\n              <User className=\"h-5 w-5 text-blue-600\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">基本信息</h2>\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  角色名称 <span className=\"text-red-500\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={characterData.name}\n                  onChange={(e) => setCharacterData(prev => ({ ...prev, name: e.target.value }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"请输入角色名称\"\n                  required\n                />\n              </div>\n              \n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  头像链接\n                </label>\n                <input\n                  type=\"url\"\n                  value={characterData.avatarUrl}\n                  onChange={(e) => setCharacterData(prev => ({ ...prev, avatarUrl: e.target.value }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"https://example.com/avatar.jpg\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"mt-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                角色描述\n              </label>\n              <textarea\n                value={characterData.description}\n                onChange={(e) => setCharacterData(prev => ({ ...prev, description: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                rows={4}\n                placeholder=\"请描述角色的基本信息、背景故事等...\"\n              />\n            </div>\n          </div>\n\n          {/* 角色特征 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div className=\"flex items-center space-x-2\">\n                <Tag className=\"h-5 w-5 text-blue-600\" />\n                <h2 className=\"text-lg font-semibold text-gray-900\">角色特征</h2>\n              </div>\n              <button\n                type=\"button\"\n                onClick={addTrait}\n                className=\"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n              >\n                添加特征\n              </button>\n            </div>\n            \n            <div className=\"space-y-4\">\n              {Object.entries(characterData.traits).map(([trait, value]) => (\n                <div key={trait} className=\"flex items-center space-x-3\">\n                  <div className=\"flex-1\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {trait}\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={value}\n                      onChange={(e) => updateTrait(trait, e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      placeholder={`请输入${trait}信息`}\n                    />\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => removeTrait(trait)}\n                    className=\"mt-6 text-red-600 hover:text-red-800\"\n                  >\n                    删除\n                  </button>\n                </div>\n              ))}\n              \n              {Object.keys(characterData.traits).length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  还没有添加角色特征，点击上方按钮开始添加\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* 角色关系 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div className=\"flex items-center space-x-2\">\n                <Heart className=\"h-5 w-5 text-blue-600\" />\n                <h2 className=\"text-lg font-semibold text-gray-900\">角色关系</h2>\n              </div>\n              <button\n                type=\"button\"\n                onClick={addRelationship}\n                className=\"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n              >\n                添加关系\n              </button>\n            </div>\n            \n            <div className=\"space-y-4\">\n              {Object.entries(characterData.relationships).map(([key, value]) => (\n                <div key={key} className=\"flex items-center space-x-3\">\n                  <div className=\"flex-1\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {key}\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={value}\n                      onChange={(e) => updateRelationship(key, e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      placeholder={`请输入${key}的详细信息`}\n                    />\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => removeRelationship(key)}\n                    className=\"mt-6 text-red-600 hover:text-red-800\"\n                  >\n                    删除\n                  </button>\n                </div>\n              ))}\n              \n              {Object.keys(characterData.relationships).length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  还没有添加角色关系，点击上方按钮开始添加\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* 提交按钮 */}\n          <div className=\"flex justify-end space-x-4\">\n            <Link\n              href={`/dashboard/novels/${params.id}/characters`}\n              className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              取消\n            </Link>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"inline-flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n            >\n              {loading ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  保存中...\n                </>\n              ) : (\n                <>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  保存更改\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\characters\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowLeft' is defined but never used.","line":6,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ArrowLeft"},"fix":{"range":[144,155],"text":""},"desc":"Remove unused variable \"ArrowLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":6,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":51,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapPin"},"fix":{"range":[173,181],"text":""},"desc":"Remove unused variable \"MapPin\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'novelTitle' is assigned a value but never used.","line":29,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNovelInfo'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNovelInfo]","fix":{"range":[1009,1011],"text":"[fetchNovelInfo]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { Save, ArrowLeft, User, Tag, Heart, MapPin } from 'lucide-react'\n\ninterface CharacterData {\n  name: string\n  description: string\n  avatarUrl: string\n  traits: {\n    性格?: string\n    年龄?: string\n    外貌?: string\n    背景?: string\n    技能?: string\n    目标?: string\n  }\n  relationships: {\n    [key: string]: string\n  }\n}\n\nexport default function CreateCharacterPage({ params }: { params: { id: string } }) {\n  const router = useRouter()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n  const [novelTitle, setNovelTitle] = useState('')\n  const [characterData, setCharacterData] = useState<CharacterData>({\n    name: '',\n    description: '',\n    avatarUrl: '',\n    traits: {\n      性格: '',\n      年龄: '',\n      外貌: '',\n      背景: '',\n      技能: '',\n      目标: ''\n    },\n    relationships: {}\n  })\n\n  useEffect(() => {\n    fetchNovelInfo()\n  }, [])\n\n  const fetchNovelInfo = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovelTitle(data.novel.title)\n      }\n    } catch (error) {\n      console.error('获取小说信息失败:', error)\n    }\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (!characterData.name.trim()) {\n      setError('角色名称不能为空')\n      return\n    }\n\n    setLoading(true)\n    setError('')\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/characters`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          name: characterData.name,\n          description: characterData.description,\n          avatarUrl: characterData.avatarUrl,\n          traits: characterData.traits,\n          relationships: characterData.relationships\n        })\n      })\n\n      if (response.ok) {\n        router.push(`/dashboard/novels/${params.id}/characters`)\n      } else {\n        const data = await response.json()\n        setError(data.error || '创建角色失败')\n      }\n    } catch (error) {\n      console.error('创建角色失败:', error)\n      setError('创建角色失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const updateTrait = (trait: string, value: string) => {\n    setCharacterData(prev => ({\n      ...prev,\n      traits: {\n        ...prev.traits,\n        [trait]: value\n      }\n    }))\n  }\n\n  const addRelationship = () => {\n    const key = prompt('关系名称（如：朋友、敌人、家人等）：')\n    if (key) {\n      setCharacterData(prev => ({\n        ...prev,\n        relationships: {\n          ...prev.relationships,\n          [key]: ''\n        }\n      }))\n    }\n  }\n\n  const updateRelationship = (key: string, value: string) => {\n    setCharacterData(prev => ({\n      ...prev,\n      relationships: {\n        ...prev.relationships,\n        [key]: value\n      }\n    }))\n  }\n\n  const removeRelationship = (key: string) => {\n    setCharacterData(prev => {\n      const newRelationships = { ...prev.relationships }\n      delete newRelationships[key]\n      return {\n        ...prev,\n        relationships: newRelationships\n      }\n    })\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* 顶部导航 */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-4\">\n              <Link \n                href={`/dashboard/novels/${params.id}/characters`}\n                className=\"text-gray-600 hover:text-gray-900\"\n              >\n                ← 返回角色列表\n              </Link>\n              <h1 className=\"text-xl font-semibold text-gray-900\">\n                创建新角色\n              </h1>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 主要内容 */}\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\n            <p className=\"text-red-800\">{error}</p>\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\n          {/* 基本信息 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center space-x-2 mb-6\">\n              <User className=\"h-5 w-5 text-blue-600\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">基本信息</h2>\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  角色名称 <span className=\"text-red-500\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={characterData.name}\n                  onChange={(e) => setCharacterData(prev => ({ ...prev, name: e.target.value }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"请输入角色名称\"\n                  required\n                />\n              </div>\n              \n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  头像链接\n                </label>\n                <input\n                  type=\"url\"\n                  value={characterData.avatarUrl}\n                  onChange={(e) => setCharacterData(prev => ({ ...prev, avatarUrl: e.target.value }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"https://example.com/avatar.jpg\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"mt-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                角色描述\n              </label>\n              <textarea\n                value={characterData.description}\n                onChange={(e) => setCharacterData(prev => ({ ...prev, description: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                rows={4}\n                placeholder=\"请描述角色的基本信息、背景故事等...\"\n              />\n            </div>\n          </div>\n\n          {/* 角色特征 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center space-x-2 mb-6\">\n              <Tag className=\"h-5 w-5 text-blue-600\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">角色特征</h2>\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {Object.entries(characterData.traits).map(([trait, value]) => (\n                <div key={trait}>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    {trait}\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={value}\n                    onChange={(e) => updateTrait(trait, e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    placeholder={`请输入${trait}信息`}\n                  />\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* 角色关系 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div className=\"flex items-center space-x-2\">\n                <Heart className=\"h-5 w-5 text-blue-600\" />\n                <h2 className=\"text-lg font-semibold text-gray-900\">角色关系</h2>\n              </div>\n              <button\n                type=\"button\"\n                onClick={addRelationship}\n                className=\"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n              >\n                添加关系\n              </button>\n            </div>\n            \n            <div className=\"space-y-4\">\n              {Object.entries(characterData.relationships).map(([key, value]) => (\n                <div key={key} className=\"flex items-center space-x-3\">\n                  <div className=\"flex-1\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {key}\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={value}\n                      onChange={(e) => updateRelationship(key, e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      placeholder={`请输入${key}的详细信息`}\n                    />\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => removeRelationship(key)}\n                    className=\"mt-6 text-red-600 hover:text-red-800\"\n                  >\n                    删除\n                  </button>\n                </div>\n              ))}\n              \n              {Object.keys(characterData.relationships).length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  还没有添加角色关系，点击上方按钮开始添加\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* 提交按钮 */}\n          <div className=\"flex justify-end space-x-4\">\n            <Link\n              href={`/dashboard/novels/${params.id}/characters`}\n              className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              取消\n            </Link>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"inline-flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n            >\n              {loading ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  创建中...\n                </>\n              ) : (\n                <>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  创建角色\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\characters\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[300,303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[300,303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[322,325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[322,325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":20,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchCharacters' and 'fetchNovelInfo'. Either include them or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCharacters, fetchNovelInfo]","fix":{"range":[751,753],"text":"[fetchCharacters, fetchNovelInfo]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":182,"column":23,"nodeType":"JSXOpeningElement","endLine":186,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { Plus, Users, Edit, Trash2, User } from 'lucide-react'\n\ninterface Character {\n  id: string\n  name: string\n  description?: string\n  avatarUrl?: string\n  traits?: any\n  relationships?: any\n  createdAt: string\n  updatedAt: string\n}\n\nexport default function CharactersPage({ params }: { params: { id: string } }) {\n  const router = useRouter()\n  const [characters, setCharacters] = useState<Character[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n  const [novelTitle, setNovelTitle] = useState('')\n\n  useEffect(() => {\n    fetchCharacters()\n    fetchNovelInfo()\n  }, [])\n\n  const fetchCharacters = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/characters`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setCharacters(data.characters.map((char: Character) => ({\n          ...char,\n          traits: char.traits ? JSON.parse(char.traits) : null,\n          relationships: char.relationships ? JSON.parse(char.relationships) : null\n        })))\n      } else {\n        setError('获取角色列表失败')\n      }\n    } catch (error) {\n      console.error('获取角色列表失败:', error)\n      setError('获取角色列表失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const fetchNovelInfo = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovelTitle(data.novel.title)\n      }\n    } catch (error) {\n      console.error('获取小说信息失败:', error)\n    }\n  }\n\n  const deleteCharacter = async (characterId: string) => {\n    if (!confirm('确定要删除这个角色吗？')) {\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/characters/${characterId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        fetchCharacters()\n      } else {\n        setError('删除角色失败')\n      }\n    } catch (error) {\n      console.error('删除角色失败:', error)\n      setError('删除角色失败')\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">加载中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* 顶部导航 */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-4\">\n              <Link \n                href={`/dashboard/novels/${params.id}`}\n                className=\"text-gray-600 hover:text-gray-900\"\n              >\n                ← 返回小说\n              </Link>\n              <h1 className=\"text-xl font-semibold text-gray-900\">\n                {novelTitle} - 角色管理\n              </h1>\n            </div>\n            <Link\n              href={`/dashboard/novels/${params.id}/characters/create`}\n              className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              创建角色\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* 主要内容 */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\n            <p className=\"text-red-800\">{error}</p>\n          </div>\n        )}\n\n        {/* 角色统计 */}\n        <div className=\"mb-8 bg-white rounded-lg shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <Users className=\"h-8 w-8 text-blue-600\" />\n              <div>\n                <h2 className=\"text-lg font-semibold text-gray-900\">角色统计</h2>\n                <p className=\"text-gray-600\">共 {characters.length} 个角色</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* 角色列表 */}\n        {characters.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <Users className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">还没有角色</h3>\n            <p className=\"text-gray-600 mb-6\">开始创建你的第一个角色吧</p>\n            <Link\n              href={`/dashboard/novels/${params.id}/characters/create`}\n              className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              创建第一个角色\n            </Link>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {characters.map((character) => (\n              <div key={character.id} className=\"bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6\">\n                <div className=\"flex items-start justify-between mb-4\">\n                  <div className=\"flex items-center space-x-3\">\n                    {character.avatarUrl ? (\n                      <img \n                        src={character.avatarUrl} \n                        alt={character.name}\n                        className=\"h-12 w-12 rounded-full object-cover\"\n                      />\n                    ) : (\n                      <div className=\"h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center\">\n                        <User className=\"h-6 w-6 text-gray-500\" />\n                      </div>\n                    )}\n                    <div>\n                      <h3 className=\"text-lg font-medium text-gray-900\">{character.name}</h3>\n                      <p className=\"text-sm text-gray-500\">角色</p>\n                    </div>\n                  </div>\n                  <div className=\"flex space-x-2\">\n                    <Link\n                      href={`/dashboard/novels/${params.id}/characters/${character.id}/edit`}\n                      className=\"text-blue-600 hover:text-blue-800\"\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Link>\n                    <button\n                      onClick={() => deleteCharacter(character.id)}\n                      className=\"text-red-600 hover:text-red-800\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n                \n                {character.description && (\n                  <p className=\"text-gray-600 text-sm mb-4 line-clamp-3\">\n                    {character.description}\n                  </p>\n                )}\n                \n                {character.traits && Object.keys(character.traits).length > 0 && (\n                  <div className=\"mb-4\">\n                    <h4 className=\"text-sm font-medium text-gray-900 mb-2\">特征</h4>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {Object.entries(character.traits).map(([key, value]) => (\n                        <span \n                          key={key}\n                          className=\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full\"\n                        >\n                          {key}: {String(value)}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                \n                <div className=\"text-xs text-gray-500\">\n                  创建于 {new Date(character.createdAt).toLocaleDateString()}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[605,608],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[605,608],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[673,676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[673,676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNovel'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNovel, novelId]","fix":{"range":[1051,1060],"text":"[fetchNovel, novelId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":47,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2244,2247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2244,2247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2313,2316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2313,2316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleOpenImmersiveEditor' is assigned a value but never used.","line":88,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2533,2536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2533,2536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3020,3023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3020,3023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3382,3385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3382,3385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3458,3461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3458,3461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":126,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":126,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5880,5883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5880,5883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { \n  BookOpen, \n  ArrowLeft\n} from 'lucide-react'\nimport WritingWorkspace from '@/components/WritingWorkspace'\nimport ChapterDetailModal from '@/components/ChapterDetailModal'\nimport ImmersiveEditor from '@/components/ImmersiveEditor'\n\nexport default function NovelDetailPage() {\n  const params = useParams()\n  const router = useRouter()\n  const novelId = typeof params.id === 'string' ? params.id : Array.isArray(params.id) ? params.id[0] : ''\n  \n  const [novel, setNovel] = useState<any>(null)\n  const [selectedChapter, setSelectedChapter] = useState<any>(null)\n  const [showDetailModal, setShowDetailModal] = useState(false)\n  const [showImmersiveEditor, setShowImmersiveEditor] = useState(false)\n  const [currentChapterContent, setCurrentChapterContent] = useState('')\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    if (novelId) {\n      fetchNovel()\n    }\n  }, [novelId])\n\n  const fetchNovel = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovel(data.novel)\n      } else {\n        setError('获取小说信息失败')\n      }\n    } catch (error) {\n      setError('网络错误')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSaveChapter = async (chapterId: string, content: string) => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}/chapters/${chapterId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: selectedChapter?.title,\n          summary: selectedChapter?.summary,\n          content: content,\n          order: selectedChapter?.order\n        })\n      })\n      \n      if (!response.ok) {\n        throw new Error('保存失败')\n      }\n      \n      // 更新本地状态\n      setNovel((prev: any) => ({\n        ...prev,\n        chapters: prev.chapters.map((ch: any) => \n          ch.id === chapterId ? { ...ch, content } : ch\n        )\n      }))\n    } catch (error) {\n      console.error('保存章节失败:', error)\n      throw error\n    }\n  }\n\n  const handleOpenImmersiveEditor = (chapter: any) => {\n    setSelectedChapter(chapter)\n    setCurrentChapterContent(chapter.content || '')\n    setShowImmersiveEditor(true)\n  }\n\n  const handleCloseImmersiveEditor = () => {\n    setShowImmersiveEditor(false)\n    setSelectedChapter(null)\n    setCurrentChapterContent('')\n  }\n\n  const handleSaveImmersiveContent = async (content: string) => {\n    if (selectedChapter) {\n      await handleSaveChapter(selectedChapter.id, content)\n    }\n  }\n\n  const handleDeleteChapter = async (chapter: any) => {\n    if (!confirm('确定要删除这个章节吗？')) return\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}/chapters/${chapter.id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        setNovel((prev: any) => ({\n          ...prev,\n          chapters: prev.chapters.filter((ch: any) => ch.id !== chapter.id)\n        }))\n      } else {\n        alert('删除失败')\n      }\n    } catch (error) {\n      alert('删除失败')\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">正在加载创作中心...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (error || !novel) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <BookOpen className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">无法加载小说</h2>\n          <p className=\"text-gray-600 mb-4\">{error || '小说不存在'}</p>\n          <button \n            onClick={() => router.back()}\n            className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            返回上页\n          </button>\n        </div>\n      </div>\n    )\n  }\n\n  // 沉浸式编辑器模式\n  if (showImmersiveEditor && selectedChapter) {\n    return (\n      <ImmersiveEditor\n        initialContent={currentChapterContent}\n        onSave={handleSaveImmersiveContent}\n        onExit={handleCloseImmersiveEditor}\n        writingGoal={1000}\n        focusTime={25}\n        enableTypingSound={false}\n      />\n    )\n  }\n\n  return (\n    <>\n      <WritingWorkspace\n        novel={novel}\n        onChapterSelect={(chapter) => {\n          setSelectedChapter(chapter)\n          setShowDetailModal(true)\n        }}\n        onChapterEdit={(chapter) => {\n          router.push(`/dashboard/novels/${novelId}/chapters/${chapter.id}`)\n        }}\n        onChapterDelete={handleDeleteChapter}\n        onChapterReorder={async (chapters) => {\n          try {\n            const token = localStorage.getItem('token')\n            await fetch(`/api/novels/${novelId}/chapters/reorder`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${token}`\n              },\n              body: JSON.stringify({\n                chapters: chapters.map(ch => ({ id: ch.id, order: ch.order }))\n              })\n            })\n            setNovel((prev: any) => ({ ...prev, chapters }))\n          } catch (error) {\n            console.error('重新排序失败:', error)\n            alert('重新排序失败')\n          }\n        }}\n        generatingChapter={null}\n      />\n\n      {/* 章节详情模态框 */}\n      {showDetailModal && selectedChapter && (\n        <ChapterDetailModal\n          chapter={selectedChapter}\n          isOpen={showDetailModal}\n          onClose={() => {\n            setShowDetailModal(false)\n            setSelectedChapter(null)\n          }}\n          onEdit={() => {\n            setShowDetailModal(false)\n            router.push(`/dashboard/novels/${novelId}/chapters/${selectedChapter.id}`)\n          }}\n        />\n      )}\n    </>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[544,547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[544,547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNovel'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNovel, novelId]","fix":{"range":[813,822],"text":"[fetchNovel, novelId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":41,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":75,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2205,2208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2205,2208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { ArrowLeft, Save, BookOpen, Globe, Users, Target, Settings } from 'lucide-react'\nimport ResponsiveLayout from '@/components/ResponsiveLayout'\n\nexport default function NovelSettingsPage() {\n  const params = useParams()\n  const router = useRouter()\n  const novelId = typeof params.id === 'string' ? params.id : Array.isArray(params.id) ? params.id[0] : ''\n  \n  const [novel, setNovel] = useState<any>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [hasChanges, setHasChanges] = useState(false)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    if (novelId) {\n      fetchNovel()\n    }\n  }, [novelId])\n\n  const fetchNovel = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovel(data.novel)\n      } else {\n        setError('获取小说信息失败')\n      }\n    } catch (error) {\n      setError('网络错误')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSave = async () => {\n    if (!novel) return\n\n    setSaving(true)\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: novel.title,\n          description: novel.description,\n          outline: novel.outline,\n          worldSetting: novel.worldSetting,\n          protagonist: novel.protagonist\n        })\n      })\n      \n      if (response.ok) {\n        setHasChanges(false)\n        alert('保存成功')\n      } else {\n        alert('保存失败')\n      }\n    } catch (error) {\n      alert('保存失败')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleChange = (field: string, value: string) => {\n    setNovel((prev: any) => prev ? { ...prev, [field]: value } : null)\n    setHasChanges(true)\n  }\n\n  if (loading) {\n    return (\n      <ResponsiveLayout title=\"加载中...\">\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n        </div>\n      </ResponsiveLayout>\n    )\n  }\n\n  if (error || !novel) {\n    return (\n      <ResponsiveLayout title=\"错误\">\n        <div className=\"text-center py-12\">\n          <Settings className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">无法加载设置</h2>\n          <p className=\"text-gray-600 mb-4\">{error || '小说不存在'}</p>\n          <button \n            onClick={() => router.back()}\n            className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            返回上页\n          </button>\n        </div>\n      </ResponsiveLayout>\n    )\n  }\n\n  return (\n    <ResponsiveLayout\n      title=\"小说设置\"\n      showBreadcrumb={true}\n      breadcrumbItems={[\n        { label: '创作中心', href: '/dashboard' },\n        { label: '我的小说', href: '/dashboard/novels' },\n        { label: novel.title, href: `/dashboard/novels/${novelId}` },\n        { label: '设置' }\n      ]}\n    >\n      <div className=\"max-w-4xl mx-auto\">\n        {/* 基本信息 */}\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6 mb-6\">\n          <div className=\"flex items-center mb-6\">\n            <BookOpen className=\"h-5 w-5 text-indigo-600 mr-2\" />\n            <h2 className=\"text-xl font-semibold text-gray-900\">基本信息</h2>\n          </div>\n\n          <div className=\"space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                小说标题\n              </label>\n              <input\n                type=\"text\"\n                value={novel.title || ''}\n                onChange={(e) => handleChange('title', e.target.value)}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                placeholder=\"请输入小说标题\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                小说简介\n              </label>\n              <textarea\n                value={novel.description || ''}\n                onChange={(e) => handleChange('description', e.target.value)}\n                rows={4}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                placeholder=\"请输入小说简介，让读者了解你的故事...\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* 故事设定 */}\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6 mb-6\">\n          <div className=\"flex items-center mb-6\">\n            <Target className=\"h-5 w-5 text-indigo-600 mr-2\" />\n            <h2 className=\"text-xl font-semibold text-gray-900\">故事设定</h2>\n          </div>\n\n          <div className=\"space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                故事大纲\n              </label>\n              <textarea\n                value={novel.outline || ''}\n                onChange={(e) => handleChange('outline', e.target.value)}\n                rows={8}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                placeholder=\"描述故事的总体大纲和情节走向...\"\n              />\n              <p className=\"text-sm text-gray-500 mt-2\">\n                详细的 story outline 有助于你更好地组织故事结构和节奏\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* 世界观设定 */}\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6 mb-6\">\n          <div className=\"flex items-center mb-6\">\n            <Globe className=\"h-5 w-5 text-indigo-600 mr-2\" />\n            <h2 className=\"text-xl font-semibold text-gray-900\">世界观设定</h2>\n          </div>\n\n          <div className=\"space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                世界观描述\n              </label>\n              <textarea\n                value={novel.worldSetting || ''}\n                onChange={(e) => handleChange('worldSetting', e.target.value)}\n                rows={6}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                placeholder=\"描述故事发生的时代背景、地理环境、社会结构等...\"\n              />\n              <p className=\"text-sm text-gray-500 mt-2\">\n                丰富的世界观设定能让读者更好地沉浸在故事中\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* 主角设定 */}\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6 mb-6\">\n          <div className=\"flex items-center mb-6\">\n            <Users className=\"h-5 w-5 text-indigo-600 mr-2\" />\n            <h2 className=\"text-xl font-semibold text-gray-900\">主角设定</h2>\n          </div>\n\n          <div className=\"space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                主角描述\n              </label>\n              <textarea\n                value={novel.protagonist || ''}\n                onChange={(e) => handleChange('protagonist', e.target.value)}\n                rows={6}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                placeholder=\"描述主角的性格特点、背景故事、目标动机等...\"\n              />\n              <p className=\"text-sm text-gray-500 mt-2\">\n                丰满的主角形象是故事成功的关键\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* 快速导航 */}\n        <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6 mb-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">快速导航</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Link\n              href={`/dashboard/novels/${novelId}/characters`}\n              className=\"flex items-center p-4 bg-white rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors\"\n            >\n              <Users className=\"h-5 w-5 text-blue-600 mr-3\" />\n              <div>\n                <div className=\"font-medium text-gray-900\">角色管理</div>\n                <div className=\"text-sm text-gray-600\">创建和管理故事角色</div>\n              </div>\n            </Link>\n            \n            <Link\n              href={`/dashboard/novels/${novelId}/world-settings`}\n              className=\"flex items-center p-4 bg-white rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors\"\n            >\n              <Globe className=\"h-5 w-5 text-green-600 mr-3\" />\n              <div>\n                <div className=\"font-medium text-gray-900\">世界观管理</div>\n                <div className=\"text-sm text-gray-600\">完善世界观设定</div>\n              </div>\n            </Link>\n            \n            <Link\n              href={`/dashboard/novels/${novelId}/statistics`}\n              className=\"flex items-center p-4 bg-white rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors\"\n            >\n              <Settings className=\"h-5 w-5 text-purple-600 mr-3\" />\n              <div>\n                <div className=\"font-medium text-gray-900\">数据统计</div>\n                <div className=\"text-sm text-gray-600\">查看写作数据分析</div>\n              </div>\n            </Link>\n          </div>\n        </div>\n\n        {/* 保存按钮 */}\n        <div className=\"flex items-center justify-between\">\n          <button\n            onClick={() => router.back()}\n            className=\"flex items-center px-6 py-3 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            返回\n          </button>\n          \n          {hasChanges && (\n            <div className=\"flex items-center space-x-3\">\n              <span className=\"text-sm text-gray-600\">有未保存的更改</span>\n              <button\n                onClick={handleSave}\n                disabled={saving}\n                className=\"flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors\"\n              >\n                <Save className=\"h-4 w-4 mr-2\" />\n                {saving ? '保存中...' : '保存更改'}\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </ResponsiveLayout>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\statistics\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[113,141],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Target"},"fix":{"range":[201,212],"text":""},"desc":"Remove unused variable \"Target\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[212,225],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PieChart' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"PieChart"},"fix":{"range":[238,250],"text":""},"desc":"Remove unused variable \"PieChart\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Activity' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Activity"},"fix":{"range":[250,262],"text":""},"desc":"Remove unused variable \"Activity\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[274,283],"text":""},"desc":"Remove unused variable \"Users\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Globe' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Globe"},"fix":{"range":[283,292],"text":""},"desc":"Remove unused variable \"Globe\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Eye"},"fix":{"range":[292,299],"text":""},"desc":"Remove unused variable \"Eye\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1211,1214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1211,1214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, novelId]","fix":{"range":[1644,1653],"text":"[fetchData, novelId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2401,2404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2401,2404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":109,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":109,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6432,6435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6432,6435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { \n  ArrowLeft, \n  TrendingUp, \n  FileText, \n  Clock, \n  Target, \n  Calendar,\n  BarChart3,\n  PieChart,\n  Activity,\n  BookOpen,\n  Users,\n  Globe,\n  Eye,\n  Download,\n  RefreshCw\n} from 'lucide-react'\nimport ResponsiveLayout from '@/components/ResponsiveLayout'\n\ninterface NovelStats {\n  totalWords: number\n  totalChapters: number\n  publishedChapters: number\n  draftChapters: number\n  archivedChapters: number\n  averageWordsPerChapter: number\n  totalReadingTime: number\n  wordsToday: number\n  lastUpdated: string\n  recentActivity: Array<{\n    date: string\n    wordsWritten: number\n    chaptersCreated: number\n  }>\n}\n\ninterface ChapterAnalytics {\n  id: string\n  title: string\n  wordCount: number\n  readingTime: number\n  status: string\n  createdAt: string\n  updatedAt: string\n  views?: number\n  rating?: number\n}\n\nexport default function NovelStatisticsPage() {\n  const params = useParams()\n  const router = useRouter()\n  const novelId = typeof params.id === 'string' ? params.id : Array.isArray(params.id) ? params.id[0] : ''\n  \n  const [novel, setNovel] = useState<any>(null)\n  const [stats, setStats] = useState<NovelStats | null>(null)\n  const [chapters, setChapters] = useState<ChapterAnalytics[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n  const [timeRange, setTimeRange] = useState<'7d' | '30d' | '90d' | 'all'>('30d')\n  const [refreshing, setRefreshing] = useState(false)\n\n  useEffect(() => {\n    if (novelId) {\n      fetchData()\n    }\n  }, [novelId])\n\n  const fetchData = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const [novelResponse, statsResponse] = await Promise.all([\n        fetch(`/api/novels/${novelId}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        }),\n        fetch(`/api/novels/${novelId}/stats`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        })\n      ])\n      \n      if (novelResponse.ok) {\n        const novelData = await novelResponse.json()\n        setNovel(novelData.novel)\n      }\n      \n      if (statsResponse.ok) {\n        const statsData = await statsResponse.json()\n        setStats(statsData.stats)\n        \n        // 生成章节分析数据（模拟）\n        const chaptersData = novel.chapters?.map((chapter: any) => ({\n          id: chapter.id,\n          title: chapter.title,\n          wordCount: chapter.wordCount || 0,\n          readingTime: Math.ceil((chapter.wordCount || 0) / 200),\n          status: chapter.status,\n          createdAt: chapter.createdAt,\n          updatedAt: chapter.updatedAt,\n          views: Math.floor(Math.random() * 1000),\n          rating: (Math.random() * 5).toFixed(1)\n        })) || []\n        \n        setChapters(chaptersData)\n      }\n    } catch (error) {\n      setError('获取数据失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRefresh = async () => {\n    setRefreshing(true)\n    await fetchData()\n    setRefreshing(false)\n  }\n\n  const handleExportData = () => {\n    if (!stats || !chapters.length) return\n\n    const csvContent = [\n      ['章节标题', '字数', '阅读时间', '状态', '创建时间', '更新时间', '浏览量', '评分'],\n      ...chapters.map(ch => [\n        ch.title,\n        ch.wordCount,\n        ch.readingTime,\n        ch.status,\n        new Date(ch.createdAt).toLocaleDateString(),\n        new Date(ch.updatedAt).toLocaleDateString(),\n        ch.views || 0,\n        ch.rating || 0\n      ])\n    ].map(row => row.join(',')).join('\\n')\n\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' })\n    const link = document.createElement('a')\n    link.href = URL.createObjectURL(blob)\n    link.download = `novel-stats-${new Date().toISOString().split('T')[0]}.csv`\n    link.click()\n  }\n\n  if (loading) {\n    return (\n      <ResponsiveLayout title=\"加载中...\">\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n        </div>\n      </ResponsiveLayout>\n    )\n  }\n\n  if (error || !novel || !stats) {\n    return (\n      <ResponsiveLayout title=\"错误\">\n        <div className=\"text-center py-12\">\n          <BarChart3 className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">无法加载统计数据</h2>\n          <p className=\"text-gray-600 mb-4\">{error || '数据不存在'}</p>\n          <button \n            onClick={() => router.back()}\n            className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            返回上页\n          </button>\n        </div>\n      </ResponsiveLayout>\n    )\n  }\n\n  const completionRate = stats.totalChapters > 0 ? (stats.publishedChapters / stats.totalChapters) * 100 : 0\n\n  return (\n    <ResponsiveLayout\n      title=\"数据统计\"\n      showBreadcrumb={true}\n      breadcrumbItems={[\n        { label: '创作中心', href: '/dashboard' },\n        { label: '我的小说', href: '/dashboard/novels' },\n        { label: novel.title, href: `/dashboard/novels/${novelId}` },\n        { label: '数据统计' }\n      ]}\n    >\n      {/* 操作栏 */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center space-x-4\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">{novel.title} - 数据统计</h1>\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={handleRefresh}\n              disabled={refreshing}\n              className=\"flex items-center px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition-colors\"\n            >\n              <RefreshCw className={`h-4 w-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />\n              刷新\n            </button>\n            <button\n              onClick={handleExportData}\n              className=\"flex items-center px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              导出数据\n            </button>\n          </div>\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-sm text-gray-600\">时间范围:</span>\n          <select\n            value={timeRange}\n            onChange={(e) => setTimeRange(e.target.value as any)}\n            className=\"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n          >\n            <option value=\"7d\">最近7天</option>\n            <option value=\"30d\">最近30天</option>\n            <option value=\"90d\">最近90天</option>\n            <option value=\"all\">全部时间</option>\n          </select>\n        </div>\n      </div>\n\n      {/* 核心统计卡片 */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 mb-8\">\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <FileText className=\"h-8 w-8 text-blue-500\" />\n            <span className=\"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded\">总字数</span>\n          </div>\n          <h3 className=\"text-2xl font-bold text-gray-900\">{stats.totalWords.toLocaleString()}</h3>\n          <p className=\"text-sm text-gray-600 mt-2\">平均每章 {stats.averageWordsPerChapter.toLocaleString()} 字</p>\n        </div>\n\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <BookOpen className=\"h-8 w-8 text-green-500\" />\n            <span className=\"text-xs text-green-600 bg-green-100 px-2 py-1 rounded\">章节数</span>\n          </div>\n          <h3 className=\"text-2xl font-bold text-gray-900\">{stats.totalChapters}</h3>\n          <p className=\"text-sm text-gray-600 mt-2\">已发布 {stats.publishedChapters} 章</p>\n        </div>\n\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <Clock className=\"h-8 w-8 text-purple-500\" />\n            <span className=\"text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded\">阅读时长</span>\n          </div>\n          <h3 className=\"text-2xl font-bold text-gray-900\">{stats.totalReadingTime} 分钟</h3>\n          <p className=\"text-sm text-gray-600 mt-2\">约 {Math.ceil(stats.totalReadingTime / 60)} 小时</p>\n        </div>\n\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <TrendingUp className=\"h-8 w-8 text-orange-500\" />\n            <span className=\"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded\">今日进度</span>\n          </div>\n          <h3 className=\"text-2xl font-bold text-gray-900\">{stats.wordsToday.toLocaleString()}</h3>\n          <p className=\"text-sm text-gray-600 mt-2\">今日写作字数</p>\n        </div>\n      </div>\n\n      {/* 状态分布 */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">章节状态分布</h3>\n          <div className=\"space-y-4\">\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm font-medium text-gray-700\">已发布</span>\n                <span className=\"text-sm text-gray-600\">{stats.publishedChapters} 章</span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-green-500 h-2 rounded-full\"\n                  style={{ width: `${(stats.publishedChapters / stats.totalChapters) * 100}%` }}\n                />\n              </div>\n            </div>\n\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm font-medium text-gray-700\">草稿</span>\n                <span className=\"text-sm text-gray-600\">{stats.draftChapters} 章</span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-yellow-500 h-2 rounded-full\"\n                  style={{ width: `${(stats.draftChapters / stats.totalChapters) * 100}%` }}\n                />\n              </div>\n            </div>\n\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm font-medium text-gray-700\">已归档</span>\n                <span className=\"text-sm text-gray-600\">{stats.archivedChapters} 章</span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-gray-500 h-2 rounded-full\"\n                  style={{ width: `${(stats.archivedChapters / stats.totalChapters) * 100}%` }}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">完成度</h3>\n          <div className=\"flex items-center justify-center\">\n            <div className=\"relative\">\n              <div className=\"w-32 h-32 rounded-full border-8 border-gray-200\"></div>\n              <div \n                className=\"absolute top-0 left-0 w-32 h-32 rounded-full border-8 border-indigo-600 border-t-transparent border-r-transparent transform rotate-45\"\n                style={{ \n                  transform: `rotate(${(completionRate / 100) * 360}deg)`,\n                  transition: 'transform 0.5s ease-in-out'\n                }}\n              ></div>\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-gray-900\">{Math.round(completionRate)}%</div>\n                  <div className=\"text-sm text-gray-600\">已完成</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 章节详细分析 */}\n      <div className=\"bg-white border border-gray-200 rounded-lg\">\n        <div className=\"p-6 border-b border-gray-200\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">章节详细分析</h3>\n        </div>\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  章节标题\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  字数\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  阅读时间\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  状态\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  浏览量\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  评分\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  更新时间\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {chapters.map((chapter) => (\n                <tr key={chapter.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"flex items-center\">\n                      <div>\n                        <div className=\"text-sm font-medium text-gray-900\">{chapter.title}</div>\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{chapter.wordCount.toLocaleString()}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{chapter.readingTime} 分钟</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${\n                      chapter.status === 'published' ? 'bg-green-100 text-green-800' :\n                      chapter.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :\n                      'bg-gray-100 text-gray-800'\n                    }`}>\n                      {chapter.status === 'published' ? '已发布' :\n                       chapter.status === 'draft' ? '草稿' : '已归档'}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{chapter.views?.toLocaleString() || 0}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"flex items-center\">\n                      <span className=\"text-sm text-gray-900 mr-1\">{chapter.rating || '0'}</span>\n                      <span className=\"text-yellow-400\">★</span>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    {new Date(chapter.updatedAt).toLocaleDateString()}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </ResponsiveLayout>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\test-buttons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\test\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\world-settings\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowLeft' is defined but never used.","line":6,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ArrowLeft"},"fix":{"range":[144,155],"text":""},"desc":"Remove unused variable \"ArrowLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'novelTitle' is assigned a value but never used.","line":25,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNovelInfo'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNovelInfo]","fix":{"range":[1514,1516],"text":"[fetchNovelInfo]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { Save, ArrowLeft, Globe, MapPin, Clock, BookOpen, Users, Zap, Coins, Crown, Sparkles } from 'lucide-react'\n\nconst categories = [\n  { value: '地理', label: '地理', icon: MapPin, description: '地形地貌、气候环境、地理位置等' },\n  { value: '历史', label: '历史', icon: Clock, description: '历史事件、时间线、重要时代等' },\n  { value: '文化', label: '文化', icon: BookOpen, description: '文化习俗、语言文字、艺术音乐等' },\n  { value: '政治', label: '政治', icon: Users, description: '政治制度、政权结构、法律体系等' },\n  { value: '经济', label: '经济', icon: Coins, description: '经济体系、货币贸易、资源分配等' },\n  { value: '科技', label: '科技', icon: Zap, description: '科技水平、发明创造、工业技术等' },\n  { value: '魔法', label: '魔法', icon: Sparkles, description: '魔法体系、咒语法术、神秘力量等' },\n  { value: '种族', label: '种族', icon: Crown, description: '种族特征、种族关系、种族分布等' },\n  { value: '宗教', label: '宗教', icon: Globe, description: '宗教信仰、神灵体系、宗教组织等' },\n  { value: '其他', label: '其他', icon: Sparkles, description: '其他未分类的世界观设定' }\n]\n\nexport default function CreateWorldSettingPage({ params }: { params: { id: string } }) {\n  const router = useRouter()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n  const [novelTitle, setNovelTitle] = useState('')\n  const [selectedCategory, setSelectedCategory] = useState('地理')\n  const [formData, setFormData] = useState({\n    title: '',\n    content: '',\n    category: '地理'\n  })\n\n  useEffect(() => {\n    fetchNovelInfo()\n  }, [])\n\n  const fetchNovelInfo = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovelTitle(data.novel.title)\n      }\n    } catch (error) {\n      console.error('获取小说信息失败:', error)\n    }\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (!formData.title.trim() || !formData.content.trim()) {\n      setError('标题和内容不能为空')\n      return\n    }\n\n    setLoading(true)\n    setError('')\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/world-settings`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(formData)\n      })\n\n      if (response.ok) {\n        router.push(`/dashboard/novels/${params.id}/world-settings`)\n      } else {\n        const data = await response.json()\n        setError(data.error || '创建世界观设定失败')\n      }\n    } catch (error) {\n      console.error('创建世界观设定失败:', error)\n      setError('创建世界观设定失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleCategorySelect = (category: string) => {\n    setSelectedCategory(category)\n    setFormData(prev => ({ ...prev, category }))\n  }\n\n  const selectedCategoryInfo = categories.find(cat => cat.value === selectedCategory)\n  const Icon = selectedCategoryInfo?.icon || Sparkles\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* 顶部导航 */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-4\">\n              <Link \n                href={`/dashboard/novels/${params.id}/world-settings`}\n                className=\"text-gray-600 hover:text-gray-900\"\n              >\n                ← 返回世界观设定\n              </Link>\n              <h1 className=\"text-xl font-semibold text-gray-900\">\n                创建世界观设定\n              </h1>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 主要内容 */}\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\n            <p className=\"text-red-800\">{error}</p>\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\n          {/* 分类选择 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center space-x-2 mb-6\">\n              <Globe className=\"h-5 w-5 text-blue-600\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">选择分类</h2>\n            </div>\n            \n            <div className=\"mb-4\">\n              <div className=\"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg\">\n                <Icon className=\"h-6 w-6 text-blue-600\" />\n                <div>\n                  <h3 className=\"font-medium text-blue-900\">{selectedCategory}</h3>\n                  <p className=\"text-sm text-blue-700\">{selectedCategoryInfo?.description}</p>\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3\">\n              {categories.map((category) => {\n                const CategoryIcon = category.icon\n                return (\n                  <button\n                    key={category.value}\n                    type=\"button\"\n                    onClick={() => handleCategorySelect(category.value)}\n                    className={`p-3 rounded-lg border-2 transition-all ${\n                      selectedCategory === category.value\n                        ? 'border-blue-500 bg-blue-50'\n                        : 'border-gray-200 hover:border-gray-300'\n                    }`}\n                  >\n                    <CategoryIcon className={`h-5 w-5 mx-auto mb-1 ${\n                      selectedCategory === category.value ? 'text-blue-600' : 'text-gray-500'\n                    }`} />\n                    <div className={`text-xs font-medium ${\n                      selectedCategory === category.value ? 'text-blue-900' : 'text-gray-700'\n                    }`}>\n                      {category.label}\n                    </div>\n                  </button>\n                )\n              })}\n            </div>\n          </div>\n\n          {/* 基本信息 */}\n          <div className=\"bg-white rounded-lg shadow-sm p-6\">\n            <div className=\"flex items-center space-x-2 mb-6\">\n              <Icon className=\"h-5 w-5 text-blue-600\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">基本信息</h2>\n            </div>\n            \n            <div className=\"mb-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                设定标题 <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                value={formData.title}\n                onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                placeholder=\"请输入世界观设定的标题\"\n                required\n              />\n            </div>\n            \n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                设定内容 <span className=\"text-red-500\">*</span>\n              </label>\n              <textarea\n                value={formData.content}\n                onChange={(e) => setFormData(prev => ({ ...prev, content: e.target.value }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                rows={12}\n                placeholder=\"请详细描述这个世界观设定的具体内容...\"\n                required\n              />\n              <div className=\"mt-2 text-sm text-gray-500\">\n                {formData.content.length} 个字符\n              </div>\n            </div>\n          </div>\n\n          {/* 提交按钮 */}\n          <div className=\"flex justify-end space-x-4\">\n            <Link\n              href={`/dashboard/novels/${params.id}/world-settings`}\n              className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              取消\n            </Link>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"inline-flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n            >\n              {loading ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  创建中...\n                </>\n              ) : (\n                <>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  创建设定\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\[id]\\world-settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[494,497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[494,497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":48,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchNovelInfo' and 'fetchWorldSettings'. Either include them or remove the dependency array.","line":59,"column":6,"nodeType":"ArrayExpression","endLine":59,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNovelInfo, fetchWorldSettings]","fix":{"range":[1446,1448],"text":"[fetchNovelInfo, fetchWorldSettings]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { Plus, Globe, Edit, Trash2, MapPin, Clock, BookOpen, Users, Zap, Coins, Crown, Sparkles } from 'lucide-react'\n\ninterface WorldSetting {\n  id: string\n  title: string\n  content: string\n  category: string\n  createdAt: string\n  updatedAt: string\n}\n\ninterface CategorizedSettings {\n  [category: string]: WorldSetting[]\n}\n\nconst categoryIcons: { [key: string]: any } = {\n  '地理': MapPin,\n  '历史': Clock,\n  '文化': BookOpen,\n  '政治': Users,\n  '经济': Coins,\n  '科技': Zap,\n  '魔法': Sparkles,\n  '种族': Crown,\n  '宗教': Globe,\n  '其他': Sparkles\n}\n\nconst categoryColors: { [key: string]: string } = {\n  '地理': 'green',\n  '历史': 'yellow',\n  '文化': 'blue',\n  '政治': 'red',\n  '经济': 'purple',\n  '科技': 'indigo',\n  '魔法': 'pink',\n  '种族': 'orange',\n  '宗教': 'cyan',\n  '其他': 'gray'\n}\n\nexport default function WorldSettingsPage({ params }: { params: { id: string } }) {\n  const router = useRouter()\n  const [worldSettings, setWorldSettings] = useState<WorldSetting[]>([])\n  const [categorizedSettings, setCategorizedSettings] = useState<CategorizedSettings>({})\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n  const [novelTitle, setNovelTitle] = useState('')\n  const [selectedCategory, setSelectedCategory] = useState<string>('全部')\n\n  useEffect(() => {\n    fetchWorldSettings()\n    fetchNovelInfo()\n  }, [])\n\n  const fetchWorldSettings = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/world-settings`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setWorldSettings(data.worldSettings)\n        setCategorizedSettings(data.categorizedSettings)\n      } else {\n        setError('获取世界观设定失败')\n      }\n    } catch (error) {\n      console.error('获取世界观设定失败:', error)\n      setError('获取世界观设定失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const fetchNovelInfo = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNovelTitle(data.novel.title)\n      }\n    } catch (error) {\n      console.error('获取小说信息失败:', error)\n    }\n  }\n\n  const deleteSetting = async (settingId: string) => {\n    if (!confirm('确定要删除这个世界观设定吗？')) {\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${params.id}/world-settings/${settingId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        fetchWorldSettings()\n      } else {\n        setError('删除世界观设定失败')\n      }\n    } catch (error) {\n      console.error('删除世界观设定失败:', error)\n      setError('删除世界观设定失败')\n    }\n  }\n\n  const getFilteredSettings = () => {\n    if (selectedCategory === '全部') {\n      return Object.entries(categorizedSettings).map(([category, settings]) => ({\n        category,\n        settings\n      }))\n    }\n    \n    const settings = categorizedSettings[selectedCategory] || []\n    return [{ category: selectedCategory, settings }]\n  }\n\n  const getCategoryStats = () => {\n    const stats: { [key: string]: number } = {}\n    Object.entries(categorizedSettings).forEach(([category, settings]) => {\n      stats[category] = settings.length\n    })\n    return stats\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">加载中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  const categoryStats = getCategoryStats()\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* 顶部导航 */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-4\">\n              <Link \n                href={`/dashboard/novels/${params.id}`}\n                className=\"text-gray-600 hover:text-gray-900\"\n              >\n                ← 返回小说\n              </Link>\n              <h1 className=\"text-xl font-semibold text-gray-900\">\n                {novelTitle} - 世界观设定\n              </h1>\n            </div>\n            <Link\n              href={`/dashboard/novels/${params.id}/world-settings/create`}\n              className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              创建设定\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* 主要内容 */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\n            <p className=\"text-red-800\">{error}</p>\n          </div>\n        )}\n\n        {/* 分类筛选 */}\n        <div className=\"mb-8 bg-white rounded-lg shadow-sm p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Globe className=\"h-6 w-6 text-blue-600\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">世界观分类</h2>\n            </div>\n            <div className=\"text-sm text-gray-600\">\n              共 {worldSettings.length} 条设定\n            </div>\n          </div>\n          \n          <div className=\"flex flex-wrap gap-3 mb-6\">\n            <button\n              onClick={() => setSelectedCategory('全部')}\n              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n                selectedCategory === '全部'\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n              }`}\n            >\n              全部 ({worldSettings.length})\n            </button>\n            {Object.entries(categoryStats).map(([category, count]) => {\n              const Icon = categoryIcons[category] || Sparkles\n              return (\n                <button\n                  key={category}\n                  onClick={() => setSelectedCategory(category)}\n                  className={`inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n                    selectedCategory === category\n                      ? 'bg-blue-600 text-white'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  <Icon className=\"h-4 w-4 mr-2\" />\n                  {category} ({count})\n                </button>\n              )\n            })}\n          </div>\n        </div>\n\n        {/* 设定列表 */}\n        {worldSettings.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <Globe className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">还没有世界观设定</h3>\n            <p className=\"text-gray-600 mb-6\">开始构建你的小说世界观吧</p>\n            <Link\n              href={`/dashboard/novels/${params.id}/world-settings/create`}\n              className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              创建第一个设定\n            </Link>\n          </div>\n        ) : (\n          <div className=\"space-y-8\">\n            {getFilteredSettings().map(({ category, settings }) => {\n              const Icon = categoryIcons[category] || Sparkles\n              const colorClass = categoryColors[category] || 'gray'\n              \n              if (settings.length === 0) return null\n              \n              return (\n                <div key={category} className=\"bg-white rounded-lg shadow-sm p-6\">\n                  <div className=\"flex items-center space-x-2 mb-4\">\n                    <div className={`p-2 bg-${colorClass}-100 rounded-lg`}>\n                      <Icon className={`h-5 w-5 text-${colorClass}-600`} />\n                    </div>\n                    <h3 className=\"text-lg font-semibold text-gray-900\">{category}</h3>\n                    <span className=\"text-sm text-gray-500\">({settings.length})</span>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {settings.map((setting) => (\n                      <div \n                        key={setting.id} \n                        className=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\"\n                      >\n                        <div className=\"flex items-start justify-between mb-3\">\n                          <h4 className=\"font-medium text-gray-900 flex-1 mr-2\">\n                            {setting.title}\n                          </h4>\n                          <div className=\"flex space-x-2\">\n                            <Link\n                              href={`/dashboard/novels/${params.id}/world-settings/${setting.id}/edit`}\n                              className={`text-${colorClass}-600 hover:text-${colorClass}-800`}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Link>\n                            <button\n                              onClick={() => deleteSetting(setting.id)}\n                              className=\"text-red-600 hover:text-red-800\"\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </button>\n                          </div>\n                        </div>\n                        \n                        <p className=\"text-gray-600 text-sm line-clamp-3 mb-3\">\n                          {setting.content}\n                        </p>\n                        \n                        <div className=\"text-xs text-gray-500\">\n                          创建于 {new Date(setting.createdAt).toLocaleDateString()}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\create\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":49,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { ArrowLeft, Save } from 'lucide-react'\n\nexport default function CreateNovelPage() {\n  const [formData, setFormData] = useState({\n    title: '',\n    description: '',\n    outline: '',\n    worldSetting: '',\n    protagonist: ''\n  })\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n  const router = useRouter()\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    })\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setError('')\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/novels', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(formData)\n      })\n\n      const data = await response.json()\n\n      if (response.ok) {\n        router.push(`/dashboard/novels/${data.novel.id}`)\n      } else {\n        setError(data.error || '创建失败')\n      }\n    } catch (error) {\n      setError('网络错误，请重试')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      {/* 返回按钮 */}\n      <div className=\"mb-6\">\n        <button\n          onClick={() => router.back()}\n          className=\"flex items-center text-sm text-gray-500 hover:text-gray-700\"\n        >\n          <ArrowLeft className=\"mr-2 h-4 w-4\" />\n          返回\n        </button>\n      </div>\n\n      {/* 页面标题 */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold text-gray-900\">创建新小说</h1>\n        <p className=\"mt-1 text-sm text-gray-600\">填写小说的基本信息</p>\n      </div>\n\n      {/* 表单 */}\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"bg-white shadow rounded-lg p-6\">\n          <h2 className=\"text-lg font-medium text-gray-900 mb-4\">基本信息</h2>\n          \n          <div className=\"grid grid-cols-1 gap-6\">\n            <div>\n              <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700\">\n                小说标题 *\n              </label>\n              <input\n                type=\"text\"\n                id=\"title\"\n                name=\"title\"\n                required\n                value={formData.title}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"输入小说标题\"\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700\">\n                小说简介\n              </label>\n              <textarea\n                id=\"description\"\n                name=\"description\"\n                rows={3}\n                value={formData.description}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"简要描述你的小说\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white shadow rounded-lg p-6\">\n          <h2 className=\"text-lg font-medium text-gray-900 mb-4\">世界观与人物</h2>\n          \n          <div className=\"grid grid-cols-1 gap-6\">\n            <div>\n              <label htmlFor=\"outline\" className=\"block text-sm font-medium text-gray-700\">\n                故事大纲\n              </label>\n              <textarea\n                id=\"outline\"\n                name=\"outline\"\n                rows={4}\n                value={formData.outline}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"描述故事的总体大纲和情节走向\"\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"worldSetting\" className=\"block text-sm font-medium text-gray-700\">\n                世界观设定\n              </label>\n              <textarea\n                id=\"worldSetting\"\n                name=\"worldSetting\"\n                rows={4}\n                value={formData.worldSetting}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"描述小说的世界观、背景设定等\"\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"protagonist\" className=\"block text-sm font-medium text-gray-700\">\n                主角设定\n              </label>\n              <textarea\n                id=\"protagonist\"\n                name=\"protagonist\"\n                rows={4}\n                value={formData.protagonist}\n                onChange={handleChange}\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                placeholder=\"描述主角的性格、背景、能力等设定\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex justify-end\">\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n          >\n            <Save className=\"mr-2 h-4 w-4\" />\n            {loading ? '创建中...' : '创建小说'}\n          </button>\n        </div>\n      </form>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\novels\\statistics\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":7,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[94,107],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[142,151],"text":""},"desc":"Remove unused variable \"Users\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { \n  BarChart3, \n  TrendingUp, \n  Calendar, \n  FileText, \n  Clock,\n  BookOpen,\n  Users,\n  Target,\n  Award,\n  Activity\n} from 'lucide-react'\n\nexport default function NovelsStatisticsPage() {\n  const [stats, setStats] = useState<{\n    totalNovels: number\n    totalChapters: number\n    totalWords: number\n    publishedNovels: number\n    draftNovels: number\n    todayWords: number\n    weekWords: number\n    monthWords: number\n    readingTime: number\n    genres: Array<{ name: string; count: number; words: number }>\n    recentActivity: Array<{ action: string; target: string; time: string }>\n  }>({\n    totalNovels: 0,\n    totalChapters: 0,\n    totalWords: 0,\n    publishedNovels: 0,\n    draftNovels: 0,\n    todayWords: 0,\n    weekWords: 0,\n    monthWords: 0,\n    readingTime: 0,\n    genres: [],\n    recentActivity: []\n  })\n\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchStatistics()\n  }, [])\n\n  const fetchStatistics = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      \n      // 获取统计数据\n      const response = await fetch('/api/user/stats', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        // 添加模拟的统计数据\n        setStats({\n          totalNovels: data.totalNovels || 0,\n          totalChapters: data.totalChapters || 0,\n          totalWords: data.totalWords || 0,\n          publishedNovels: Math.floor((data.totalNovels || 0) * 0.7),\n          draftNovels: Math.floor((data.totalNovels || 0) * 0.3),\n          todayWords: 2500,\n          weekWords: 15000,\n          monthWords: 60000,\n          readingTime: Math.floor((data.totalWords || 0) / 200), // 假设每分钟200字\n          genres: [\n            { name: '玄幻', count: 5, words: 120000 },\n            { name: '都市', count: 3, words: 80000 },\n            { name: '科幻', count: 2, words: 60000 },\n            { name: '言情', count: 4, words: 90000 }\n          ],\n          recentActivity: [\n            { action: '创建了新章节', target: '第一章：开始', time: '2小时前' },\n            { action: '发布了小说', target: '都市传说', time: '1天前' },\n            { action: '编辑了内容', target: '第二章：冲突', time: '2天前' },\n            { action: '添加了角色', target: '张三', time: '3天前' }\n          ]\n        })\n      }\n    } catch (error) {\n      console.error('获取统计数据失败:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 页面标题 */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">创作统计</h1>\n        <p className=\"mt-2 text-gray-600\">\n          查看你的创作数据、写作进度和成就统计\n        </p>\n      </div>\n\n      {/* 总览统计 */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6\">\n          <div className=\"flex items-center\">\n            <BookOpen className=\"h-8 w-8 opacity-80\" />\n            <div className=\"ml-4\">\n              <p className=\"text-blue-100 text-sm\">总作品数</p>\n              <p className=\"text-2xl font-bold\">{stats.totalNovels}</p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6\">\n          <div className=\"flex items-center\">\n            <FileText className=\"h-8 w-8 opacity-80\" />\n            <div className=\"ml-4\">\n              <p className=\"text-green-100 text-sm\">总章节数</p>\n              <p className=\"text-2xl font-bold\">{stats.totalChapters}</p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6\">\n          <div className=\"flex items-center\">\n            <TrendingUp className=\"h-8 w-8 opacity-80\" />\n            <div className=\"ml-4\">\n              <p className=\"text-purple-100 text-sm\">总字数</p>\n              <p className=\"text-2xl font-bold\">{stats.totalWords.toLocaleString()}</p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-xl p-6\">\n          <div className=\"flex items-center\">\n            <Clock className=\"h-8 w-8 opacity-80\" />\n            <div className=\"ml-4\">\n              <p className=\"text-orange-100 text-sm\">阅读时长</p>\n              <p className=\"text-2xl font-bold\">{stats.readingTime}分钟</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* 写作进度 */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n            <Target className=\"h-5 w-5 mr-2 text-indigo-600\" />\n            写作进度\n          </h3>\n          <div className=\"space-y-4\">\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-sm font-medium text-gray-700\">今日目标</span>\n                <span className=\"text-sm text-gray-500\">{stats.todayWords} / 3000字</span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                  style={{ width: `${Math.min((stats.todayWords / 3000) * 100, 100)}%` }}\n                ></div>\n              </div>\n            </div>\n            \n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-sm font-medium text-gray-700\">本周目标</span>\n                <span className=\"text-sm text-gray-500\">{stats.weekWords} / 15000字</span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-green-600 h-2 rounded-full transition-all duration-300\"\n                  style={{ width: `${Math.min((stats.weekWords / 15000) * 100, 100)}%` }}\n                ></div>\n              </div>\n            </div>\n\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-sm font-medium text-gray-700\">本月目标</span>\n                <span className=\"text-sm text-gray-500\">{stats.monthWords} / 60000字</span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-purple-600 h-2 rounded-full transition-all duration-300\"\n                  style={{ width: `${Math.min((stats.monthWords / 60000) * 100, 100)}%` }}\n                ></div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* 作品状态分布 */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n            <BarChart3 className=\"h-5 w-5 mr-2 text-indigo-600\" />\n            作品状态\n          </h3>\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\">\n              <div className=\"flex items-center\">\n                <div className=\"w-3 h-3 bg-green-500 rounded-full\"></div>\n                <span className=\"ml-3 text-sm font-medium text-gray-700\">已发布</span>\n              </div>\n              <span className=\"text-lg font-semibold text-green-600\">{stats.publishedNovels}</span>\n            </div>\n            \n            <div className=\"flex items-center justify-between p-3 bg-yellow-50 rounded-lg\">\n              <div className=\"flex items-center\">\n                <div className=\"w-3 h-3 bg-yellow-500 rounded-full\"></div>\n                <span className=\"ml-3 text-sm font-medium text-gray-700\">草稿</span>\n              </div>\n              <span className=\"text-lg font-semibold text-yellow-600\">{stats.draftNovels}</span>\n            </div>\n\n            <div className=\"pt-3 border-t border-gray-200\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm font-medium text-gray-700\">完成率</span>\n                <span className=\"text-lg font-semibold text-indigo-600\">\n                  {stats.totalNovels > 0 ? Math.round((stats.publishedNovels / stats.totalNovels) * 100) : 0}%\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* 类型分布 */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n            <Award className=\"h-5 w-5 mr-2 text-indigo-600\" />\n            类型分布\n          </h3>\n          <div className=\"space-y-3\">\n            {stats.genres.map((genre, index) => (\n              <div key={index} className=\"flex items-center justify-between\">\n                <div className=\"flex items-center flex-1\">\n                  <div \n                    className=\"w-3 h-3 rounded-full mr-3\"\n                    style={{ \n                      backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444'][index % 4] \n                    }}\n                  ></div>\n                  <span className=\"text-sm font-medium text-gray-700\">{genre.name}</span>\n                </div>\n                <div className=\"flex items-center space-x-4\">\n                  <span className=\"text-sm text-gray-500\">{genre.count}部</span>\n                  <span className=\"text-sm font-medium text-gray-900\">{genre.words.toLocaleString()}字</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* 最近活动 */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n            <Activity className=\"h-5 w-5 mr-2 text-indigo-600\" />\n            最近活动\n          </h3>\n          <div className=\"space-y-3\">\n            {stats.recentActivity.map((activity, index) => (\n              <div key={index} className=\"flex items-start space-x-3\">\n                <div className=\"flex-shrink-0 w-2 h-2 bg-indigo-400 rounded-full mt-2\"></div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm text-gray-900\">\n                    <span className=\"font-medium\">{activity.action}</span>\n                    <span className=\"text-gray-600 ml-1\">{activity.target}</span>\n                  </p>\n                  <p className=\"text-xs text-gray-500 mt-1\">{activity.time}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* 成就徽章 */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n          <Award className=\"h-5 w-5 mr-2 text-indigo-600\" />\n          写作成就\n        </h3>\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"text-center p-4 border border-gray-200 rounded-lg\">\n            <div className=\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n              <BookOpen className=\"h-6 w-6 text-yellow-600\" />\n            </div>\n            <p className=\"text-sm font-medium text-gray-900\">初出茅庐</p>\n            <p className=\"text-xs text-gray-500\">创作第一部小说</p>\n          </div>\n          \n          <div className=\"text-center p-4 border border-gray-200 rounded-lg\">\n            <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n              <FileText className=\"h-6 w-6 text-blue-600\" />\n            </div>\n            <p className=\"text-sm font-medium text-gray-900\">勤奋写作</p>\n            <p className=\"text-xs text-gray-500\">累计10万字</p>\n          </div>\n          \n          <div className=\"text-center p-4 border border-gray-200 rounded-lg\">\n            <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n              <Target className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <p className=\"text-sm font-medium text-gray-900\">日更达人</p>\n            <p className=\"text-xs text-gray-500\">连续更新30天</p>\n          </div>\n          \n          <div className=\"text-center p-4 border border-gray-200 rounded-lg opacity-50\">\n            <div className=\"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n              <Award className=\"h-6 w-6 text-gray-400\" />\n            </div>\n            <p className=\"text-sm font-medium text-gray-500\">人气作家</p>\n            <p className=\"text-xs text-gray-500\">获得1000个赞</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Camera' is defined but never used.","line":5,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":40,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Camera"},"fix":{"range":[118,126],"text":""},"desc":"Remove unused variable \"Camera\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[235,238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[235,238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[287,290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[287,290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserData'. Either include it or remove the dependency array.","line":41,"column":6,"nodeType":"ArrayExpression","endLine":41,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadUserData]","fix":{"range":[1029,1031],"text":"[loadUserData]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":198,"column":21,"nodeType":"JSXOpeningElement","endLine":202,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":306,"column":23,"nodeType":"JSXOpeningElement","endLine":313,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { User, Settings, LogOut, Camera, Save, X } from 'lucide-react'\n\nexport default function SettingsPage() {\n  const [user, setUser] = useState<any>(null)\n  const [profile, setProfile] = useState<any>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null)\n\n  // 编辑表单状态\n  const [isEditing, setIsEditing] = useState(false)\n  const [formData, setFormData] = useState({\n    avatar: '',\n    nickname: '',\n    gender: '',\n    birthDate: '',\n    phone: ''\n  })\n\n  // 会员等级标签映射\n  const membershipLabels: Record<string, string> = {\n    free: '免费会员',\n    basic: '基础会员',\n    premium: '高级会员',\n    vip: 'VIP会员'\n  }\n\n  // 性别选项\n  const genderOptions = [\n    { value: 'male', label: '男' },\n    { value: 'female', label: '女' },\n    { value: 'other', label: '其他' }\n  ]\n\n  useEffect(() => {\n    loadUserData()\n  }, [])\n\n  const loadUserData = async () => {\n    try {\n      // 从localStorage获取基本信息\n      const userData = localStorage.getItem('user')\n      if (userData) {\n        setUser(JSON.parse(userData))\n      }\n\n      // 从API获取完整个人信息\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/user/me', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        setProfile(data.user)\n        setFormData({\n          avatar: data.user.avatar || '',\n          nickname: data.user.nickname || '',\n          gender: data.user.gender || '',\n          birthDate: data.user.birthDate ? data.user.birthDate.split('T')[0] : '',\n          phone: data.user.phone || ''\n        })\n      }\n    } catch (error) {\n      console.error('加载用户数据失败:', error)\n      showMessage('error', '加载用户数据失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const showMessage = (type: 'success' | 'error', text: string) => {\n    setMessage({ type, text })\n    setTimeout(() => setMessage(null), 3000)\n  }\n\n  const handleEdit = () => {\n    setIsEditing(true)\n    setFormData({\n      avatar: profile?.avatar || '',\n      nickname: profile?.nickname || '',\n      gender: profile?.gender || '',\n      birthDate: profile?.birthDate ? profile.birthDate.split('T')[0] : '',\n      phone: profile?.phone || ''\n    })\n  }\n\n  const handleCancel = () => {\n    setIsEditing(false)\n  }\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    })\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setSaving(true)\n    setMessage(null)\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/user/me', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(formData)\n      })\n\n      const data = await response.json()\n\n      if (response.ok) {\n        setProfile(data.user)\n        setIsEditing(false)\n        showMessage('success', '个人信息更新成功')\n      } else {\n        showMessage('error', data.error || '更新失败')\n      }\n    } catch (error) {\n      console.error('更新失败:', error)\n      showMessage('error', '网络错误，请重试')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleLogout = () => {\n    localStorage.removeItem('token')\n    localStorage.removeItem('user')\n    window.location.href = '/login'\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"text-gray-500\">加载中...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 页面标题 */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-gray-900\">设置</h1>\n        <p className=\"mt-1 text-sm text-gray-600\">管理你的账户和偏好设置</p>\n      </div>\n\n      {/* 消息提示 */}\n      {message && (\n        <div className={`${\n          message.type === 'success' ? 'bg-green-50 border-green-200 text-green-600' : 'bg-red-50 border-red-200 text-red-600'\n        } border px-4 py-3 rounded`}>\n          {message.text}\n        </div>\n      )}\n\n      {/* 个人信息卡片 */}\n      <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n        <div className=\"px-4 py-5 sm:px-6 flex justify-between items-center\">\n          <div>\n            <h3 className=\"text-lg leading-6 font-medium text-gray-900\">个人信息</h3>\n            <p className=\"mt-1 max-w-2xl text-sm text-gray-500\">\n              管理你的个人资料信息\n            </p>\n          </div>\n          {!isEditing && (\n            <button\n              onClick={handleEdit}\n              className=\"inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded text-gray-700 bg-white hover:bg-gray-50\"\n            >\n              <Settings className=\"mr-1.5 h-4 w-4\" />\n              编辑\n            </button>\n          )}\n        </div>\n\n        {/* 查看模式 */}\n        {!isEditing && profile && (\n          <div className=\"border-t border-gray-200 px-4 py-5 sm:p-0\">\n            <dl className=\"sm:divide-y sm:divide-gray-200\">\n              {/* 头像 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">头像</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {profile.avatar ? (\n                    <img\n                      src={profile.avatar}\n                      alt=\"头像\"\n                      className=\"h-16 w-16 rounded-full object-cover\"\n                    />\n                  ) : (\n                    <div className=\"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center\">\n                      <User className=\"h-8 w-8 text-gray-400\" />\n                    </div>\n                  )}\n                </dd>\n              </div>\n\n              {/* 用户名 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">用户名</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {profile.username}\n                </dd>\n              </div>\n\n              {/* 邮箱地址 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">邮箱地址</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {profile.email}\n                </dd>\n              </div>\n\n              {/* 昵称 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">昵称</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {profile.nickname || '-'}\n                </dd>\n              </div>\n\n              {/* 性别 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">性别</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {profile.gender ? genderOptions.find(g => g.value === profile.gender)?.label : '-'}\n                </dd>\n              </div>\n\n              {/* 出生日期 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">出生年月日</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {profile.birthDate ? new Date(profile.birthDate).toLocaleDateString('zh-CN') : '-'}\n                </dd>\n              </div>\n\n              {/* 手机号 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">手机号</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {profile.phone || '-'}\n                </dd>\n              </div>\n\n              {/* 会员等级 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">会员等级</dt>\n                <dd className=\"mt-1 sm:mt-0 sm:col-span-2\">\n                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                    profile.membershipLevel === 'vip' ? 'bg-purple-100 text-purple-800' :\n                    profile.membershipLevel === 'premium' ? 'bg-yellow-100 text-yellow-800' :\n                    profile.membershipLevel === 'basic' ? 'bg-blue-100 text-blue-800' :\n                    'bg-gray-100 text-gray-800'\n                  }`}>\n                    {membershipLabels[profile.membershipLevel] || '免费会员'}\n                  </span>\n                </dd>\n              </div>\n\n              {/* 注册时间 */}\n              <div className=\"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">注册时间</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2\">\n                  {new Date(profile.createdAt).toLocaleDateString('zh-CN')}\n                </dd>\n              </div>\n            </dl>\n          </div>\n        )}\n\n        {/* 编辑模式 */}\n        {isEditing && (\n          <form onSubmit={handleSubmit} className=\"border-t border-gray-200 px-4 py-5 sm:p-6\">\n            <div className=\"space-y-6\">\n              {/* 头像URL */}\n              <div>\n                <label htmlFor=\"avatar\" className=\"block text-sm font-medium text-gray-700\">\n                  头像URL\n                </label>\n                <div className=\"mt-1 flex rounded-md shadow-sm\">\n                  <input\n                    type=\"text\"\n                    id=\"avatar\"\n                    name=\"avatar\"\n                    value={formData.avatar}\n                    onChange={handleChange}\n                    className=\"flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-l-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                    placeholder=\"https://example.com/avatar.jpg\"\n                  />\n                  <div className=\"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm\">\n                    {formData.avatar && (\n                      <img\n                        src={formData.avatar}\n                        alt=\"预览\"\n                        className=\"h-8 w-8 rounded-full object-cover\"\n                        onError={(e) => {\n                          e.currentTarget.style.display = 'none'\n                        }}\n                      />\n                    )}\n                  </div>\n                </div>\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  输入图片URL作为头像（可选）\n                </p>\n              </div>\n\n              {/* 昵称 */}\n              <div>\n                <label htmlFor=\"nickname\" className=\"block text-sm font-medium text-gray-700\">\n                  昵称\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"nickname\"\n                  name=\"nickname\"\n                  value={formData.nickname}\n                  onChange={handleChange}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                  placeholder=\"输入你的昵称\"\n                />\n              </div>\n\n              {/* 性别 */}\n              <div>\n                <label htmlFor=\"gender\" className=\"block text-sm font-medium text-gray-700\">\n                  性别\n                </label>\n                <select\n                  id=\"gender\"\n                  name=\"gender\"\n                  value={formData.gender}\n                  onChange={handleChange}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                >\n                  <option value=\"\">请选择</option>\n                  {genderOptions.map(option => (\n                    <option key={option.value} value={option.value}>\n                      {option.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {/* 出生日期 */}\n              <div>\n                <label htmlFor=\"birthDate\" className=\"block text-sm font-medium text-gray-700\">\n                  出生年月日\n                </label>\n                <input\n                  type=\"date\"\n                  id=\"birthDate\"\n                  name=\"birthDate\"\n                  value={formData.birthDate}\n                  onChange={handleChange}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                />\n              </div>\n\n              {/* 手机号 */}\n              <div>\n                <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700\">\n                  手机号\n                </label>\n                <input\n                  type=\"tel\"\n                  id=\"phone\"\n                  name=\"phone\"\n                  value={formData.phone}\n                  onChange={handleChange}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                  placeholder=\"请输入11位手机号\"\n                />\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  请输入有效的中国手机号码\n                </p>\n              </div>\n            </div>\n\n            {/* 操作按钮 */}\n            <div className=\"mt-6 flex justify-end space-x-3\">\n              <button\n                type=\"button\"\n                onClick={handleCancel}\n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n              >\n                <X className=\"mr-2 h-4 w-4\" />\n                取消\n              </button>\n              <button\n                type=\"submit\"\n                disabled={saving}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <Save className=\"mr-2 h-4 w-4\" />\n                {saving ? '保存中...' : '保存'}\n              </button>\n            </div>\n          </form>\n        )}\n      </div>\n\n      {/* 快捷链接 */}\n      <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n        <div className=\"px-4 py-5 sm:px-6\">\n          <h3 className=\"text-lg leading-6 font-medium text-gray-900\">快捷操作</h3>\n        </div>\n        <div className=\"border-t border-gray-200\">\n          <nav className=\"px-4 py-3 space-y-1\">\n            <Link\n              href=\"/dashboard/ai-workshop\"\n              className=\"flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-50\"\n            >\n              <Settings className=\"mr-3 h-5 w-5 text-gray-400\" />\n              AI模型工坊\n            </Link>\n            <button\n              onClick={handleLogout}\n              className=\"w-full flex items-center px-3 py-2 text-sm font-medium text-red-700 rounded-md hover:bg-red-50\"\n            >\n              <LogOut className=\"mr-3 h-5 w-5\" />\n              退出登录\n            </button>\n          </nav>\n        </div>\n      </div>\n\n      {/* 关于 */}\n      <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n        <div className=\"px-4 py-5 sm:px-6\">\n          <h3 className=\"text-lg leading-6 font-medium text-gray-900\">关于</h3>\n        </div>\n        <div className=\"border-t border-gray-200 px-4 py-5 sm:p-6\">\n          <div className=\"text-sm text-gray-600\">\n            <p className=\"mb-2\">\n              <strong>小说创作平台</strong>\n            </p>\n            <p className=\"mb-2\">\n              一个专为作家设计的智能小说创作平台，支持：\n            </p>\n            <ul className=\"list-disc list-inside space-y-1 mb-4\">\n              <li>小说信息管理</li>\n              <li>章节创作与编辑</li>\n              <li>AI辅助内容生成</li>\n              <li>多模型配置管理</li>\n            </ul>\n            <p className=\"text-xs text-gray-500\">\n              版本 1.0.0\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\dashboard\\workspace\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":46,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\n\nexport default function LoginPage() {\n  const [formData, setFormData] = useState({\n    email: '',\n    password: ''\n  })\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n  const router = useRouter()\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    })\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setError('')\n\n    try {\n      const response = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(formData)\n      })\n\n      const data = await response.json()\n\n      if (response.ok) {\n        localStorage.setItem('token', data.token)\n        localStorage.setItem('user', JSON.stringify(data.user))\n        router.push('/dashboard')\n      } else {\n        setError(data.error || '登录失败')\n      }\n    } catch (error) {\n      setError('网络错误，请重试')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-indigo-50 to-white flex items-center justify-center px-4\">\n      <div className=\"max-w-6xl w-full grid md:grid-cols-2 gap-8 items-center\">\n        {/* 左侧：品牌介绍 */}\n        <div className=\"text-center md:text-left\">\n          <Link href=\"/\" className=\"inline-block mb-8\">\n            <h1 className=\"text-4xl font-bold text-gray-900\">\n              小说创作平台\n            </h1>\n          </Link>\n          \n          <div className=\"mb-8\">\n            <p className=\"text-xl text-gray-600 mb-6\">\n              AI辅助创作，激发无限灵感\n            </p>\n            <div className=\"w-20 h-1 bg-indigo-600 mx-auto md:mx-0\"></div>\n          </div>\n\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <svg className=\"w-6 h-6 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 mb-1\">智能创作</h3>\n                <p className=\"text-sm text-gray-600\">AI辅助生成章节内容</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 mb-1\">作品管理</h3>\n                <p className=\"text-sm text-gray-600\">高效管理你的小说创作</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <svg className=\"w-6 h-6 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 mb-1\">多模型支持</h3>\n                <p className=\"text-sm text-gray-600\">灵活配置多种AI模型</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* 右侧：登录表单 */}\n        <div className=\"bg-white p-8 rounded-xl shadow-lg\">\n          <div className=\"text-center mb-8\">\n            <div className=\"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <svg className=\"w-8 h-8 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\n              </svg>\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n              用户登录\n            </h2>\n            <p className=\"text-gray-600\">\n              欢迎回来，开始你的创作之旅\n            </p>\n          </div>\n\n          <form className=\"space-y-6\" onSubmit={handleSubmit}>\n            {error && (\n              <div className=\"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg\">\n                {error}\n              </div>\n            )}\n\n            <div className=\"space-y-4\">\n              <div>\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  邮箱\n                </label>\n                <input\n                  id=\"email\"\n                  name=\"email\"\n                  type=\"email\"\n                  required\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none transition-colors\"\n                  placeholder=\"请输入邮箱\"\n                  value={formData.email}\n                  onChange={handleChange}\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  密码\n                </label>\n                <input\n                  id=\"password\"\n                  name=\"password\"\n                  type=\"password\"\n                  required\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none transition-colors\"\n                  placeholder=\"请输入密码\"\n                  value={formData.password}\n                  onChange={handleChange}\n                />\n              </div>\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 transition-colors\"\n            >\n              {loading ? (\n                <>\n                  <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                  </svg>\n                  登录中...\n                </>\n              ) : (\n                '登录'\n              )}\n            </button>\n          </form>\n\n          <div className=\"mt-6 text-center space-y-2\">\n            <div className=\"text-xs\">\n              <Link href=\"/\" className=\"text-gray-500 hover:text-gray-700\">\n                ← 返回首页\n              </Link>\n            </div>\n            <div className=\"text-xs\">\n              <Link href=\"/admin/login\" className=\"text-gray-400 hover:text-gray-600\">\n                管理员入口\n              </Link>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\mobile-help\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1373,1376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1373,1376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":58,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":66,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\n\ninterface SystemInfo {\n  userAgent: string\n  isMobile: boolean\n  screenWidth: number\n  screenHeight: number\n  networkStatus: string\n  connectionType: string\n  localStorage: boolean\n  sessionStorage: boolean\n  cookies: boolean\n  javascript: boolean\n}\n\ninterface TestResult {\n  name: string\n  status: 'pending' | 'success' | 'error'\n  message: string\n  details?: string\n}\n\nexport default function MobileHelpPage() {\n  const [systemInfo, setSystemInfo] = useState<SystemInfo | null>(null)\n  const [testResults, setTestResults] = useState<TestResult[]>([])\n  const [isRunningTests, setIsRunningTests] = useState(false)\n\n  useEffect(() => {\n    // 收集系统信息\n    const collectSystemInfo = () => {\n      const info: SystemInfo = {\n        userAgent: navigator.userAgent,\n        isMobile: /Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),\n        screenWidth: window.innerWidth,\n        screenHeight: window.innerHeight,\n        networkStatus: navigator.onLine ? 'online' : 'offline',\n        connectionType: 'unknown',\n        localStorage: false,\n        sessionStorage: false,\n        cookies: navigator.cookieEnabled,\n        javascript: true\n      }\n\n      // 检测连接类型\n      if ('connection' in navigator) {\n        const connection = (navigator as any).connection\n        info.connectionType = connection.effectiveType || connection.type || 'unknown'\n      }\n\n      // 测试存储功能\n      try {\n        localStorage.setItem('test', 'test')\n        localStorage.removeItem('test')\n        info.localStorage = true\n      } catch (e) {\n        info.localStorage = false\n      }\n\n      try {\n        sessionStorage.setItem('test', 'test')\n        sessionStorage.removeItem('test')\n        info.sessionStorage = true\n      } catch (e) {\n        info.sessionStorage = false\n      }\n\n      setSystemInfo(info)\n    }\n\n    collectSystemInfo()\n  }, [])\n\n  const runTests = async () => {\n    setIsRunningTests(true)\n    const results: TestResult[] = []\n\n    // 测试1: 网络连接\n    results.push({\n      name: '网络连接测试',\n      status: 'pending',\n      message: '正在测试...'\n    })\n\n    try {\n      const response = await fetch('/api/debug/register', {\n        method: 'GET',\n        headers: {\n          'User-Agent': navigator.userAgent\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        results[0] = {\n          name: '网络连接测试',\n          status: 'success',\n          message: '服务器连接正常',\n          details: `响应时间: ${Date.now() - Date.now()}ms, 用户数: ${data.database?.userCount || 0}`\n        }\n      } else {\n        results[0] = {\n          name: '网络连接测试',\n          status: 'error',\n          message: `服务器响应错误: ${response.status}`,\n          details: response.statusText\n        }\n      }\n    } catch (error) {\n      results[0] = {\n        name: '网络连接测试',\n        status: 'error',\n        message: '网络连接失败',\n        details: error instanceof Error ? error.message : '未知错误'\n      }\n    }\n\n    // 测试2: API调试端点\n    results.push({\n      name: '注册API测试',\n      status: 'pending',\n      message: '正在测试...'\n    })\n\n    try {\n      const response = await fetch('/api/debug/register', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email: `test${Date.now()}@example.com`,\n          username: `test${Date.now()}`,\n          password: 'testpass123'\n        })\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        if (data.success) {\n          results[1] = {\n            name: '注册API测试',\n            status: 'success',\n            message: 'API功能正常',\n            details: `处理时间: ${data.processingTime}ms, 所有步骤通过`\n          }\n        } else {\n          results[1] = {\n            name: '注册API测试',\n            status: 'error',\n            message: 'API验证失败',\n            details: data.error || '未知错误'\n          }\n        }\n      } else {\n        results[1] = {\n          name: '注册API测试',\n          status: 'error',\n          message: `API错误: ${response.status}`,\n          details: response.statusText\n        }\n      }\n    } catch (error) {\n      results[1] = {\n        name: '注册API测试',\n        status: 'error',\n        message: 'API测试失败',\n        details: error instanceof Error ? error.message : '未知错误'\n      }\n    }\n\n    // 测试3: 本地存储\n    results.push({\n      name: '本地存储测试',\n      status: 'pending',\n      message: '正在测试...'\n    })\n\n    try {\n      const testData = { token: 'test-token', user: { id: 'test', email: 'test@example.com' } }\n      \n      localStorage.setItem('test-token', testData.token)\n      localStorage.setItem('test-user', JSON.stringify(testData.user))\n      \n      const retrievedToken = localStorage.getItem('test-token')\n      const retrievedUser = JSON.parse(localStorage.getItem('test-user') || '{}')\n      \n      localStorage.removeItem('test-token')\n      localStorage.removeItem('test-user')\n      \n      if (retrievedToken === testData.token && retrievedUser.id === testData.user.id) {\n        results[2] = {\n          name: '本地存储测试',\n          status: 'success',\n          message: 'localStorage工作正常',\n          details: '可以正常存储和读取数据'\n        }\n      } else {\n        results[2] = {\n          name: '本地存储测试',\n          status: 'error',\n          message: 'localStorage数据不一致',\n          details: '存储和读取的数据不匹配'\n        }\n      }\n    } catch (error) {\n      results[2] = {\n        name: '本地存储测试',\n        status: 'error',\n        message: 'localStorage测试失败',\n        details: error instanceof Error ? error.message : '未知错误'\n      }\n    }\n\n    // 测试4: JSON处理\n    results.push({\n      name: 'JSON处理测试',\n      status: 'pending',\n      message: '正在测试...'\n    })\n\n    try {\n      const testData = { email: 'test@example.com', username: 'testuser', password: 'testpass123' }\n      const jsonString = JSON.stringify(testData)\n      const parsedData = JSON.parse(jsonString)\n      \n      if (parsedData.email === testData.email && parsedData.username === testData.username) {\n        results[3] = {\n          name: 'JSON处理测试',\n          status: 'success',\n          message: 'JSON处理正常',\n          details: '序列化和反序列化正常'\n        }\n      } else {\n        results[3] = {\n          name: 'JSON处理测试',\n          status: 'error',\n          message: 'JSON数据不一致',\n          details: '序列化和反序列化结果不匹配'\n        }\n      }\n    } catch (error) {\n      results[3] = {\n        name: 'JSON处理测试',\n        status: 'error',\n        message: 'JSON处理失败',\n        details: error instanceof Error ? error.message : '未知错误'\n      }\n    }\n\n    setTestResults(results)\n    setIsRunningTests(false)\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'success': return 'text-green-600 bg-green-50 border-green-200'\n      case 'error': return 'text-red-600 bg-red-50 border-red-200'\n      case 'pending': return 'text-yellow-600 bg-yellow-50 border-yellow-200'\n      default: return 'text-gray-600 bg-gray-50 border-gray-200'\n    }\n  }\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'success': return '✅'\n      case 'error': return '❌'\n      case 'pending': return '⏳'\n      default: return '❓'\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8 px-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">📱 移动端注册帮助</h1>\n          <p className=\"text-gray-600\">诊断和解决移动端注册问题</p>\n        </div>\n\n        {/* 系统信息 */}\n        {systemInfo && (\n          <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n            <h2 className=\"text-xl font-semibold mb-4 text-gray-800\">🔍 系统信息</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <span className=\"font-medium text-gray-700\">设备类型:</span>\n                <span className=\"ml-2 text-gray-600\">{systemInfo.isMobile ? '📱 移动设备' : '💻 桌面设备'}</span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">屏幕尺寸:</span>\n                <span className=\"ml-2 text-gray-600\">{systemInfo.screenWidth} × {systemInfo.screenHeight}</span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">网络状态:</span>\n                <span className={`ml-2 px-2 py-1 rounded text-xs font-medium ${\n                  systemInfo.networkStatus === 'online' \n                    ? 'bg-green-100 text-green-800' \n                    : 'bg-red-100 text-red-800'\n                }`}>\n                  {systemInfo.networkStatus === 'online' ? '🌐 在线' : '📵 离线'}\n                </span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">连接类型:</span>\n                <span className=\"ml-2 text-gray-600\">{systemInfo.connectionType}</span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">LocalStorage:</span>\n                <span className={`ml-2 ${systemInfo.localStorage ? 'text-green-600' : 'text-red-600'}`}>\n                  {systemInfo.localStorage ? '✅ 支持' : '❌ 不支持'}\n                </span>\n              </div>\n              <div>\n                <span className=\"font-medium text-gray-700\">Cookies:</span>\n                <span className={`ml-2 ${systemInfo.cookies ? 'text-green-600' : 'text-red-600'}`}>\n                  {systemInfo.cookies ? '✅ 启用' : '❌ 禁用'}\n                </span>\n              </div>\n            </div>\n            <div className=\"mt-4 p-3 bg-gray-50 rounded\">\n              <p className=\"text-sm text-gray-600 font-medium mb-1\">User Agent:</p>\n              <p className=\"text-xs text-gray-500 break-all\">{systemInfo.userAgent}</p>\n            </div>\n          </div>\n        )}\n\n        {/* 测试按钮 */}\n        <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n          <h2 className=\"text-xl font-semibold mb-4 text-gray-800\">🧪 系统测试</h2>\n          <button\n            onClick={runTests}\n            disabled={isRunningTests}\n            className=\"w-full md:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\"\n          >\n            {isRunningTests ? '🔄 正在测试...' : '🚀 开始测试'}\n          </button>\n        </div>\n\n        {/* 测试结果 */}\n        {testResults.length > 0 && (\n          <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n            <h2 className=\"text-xl font-semibold mb-4 text-gray-800\">📊 测试结果</h2>\n            <div className=\"space-y-3\">\n              {testResults.map((result, index) => (\n                <div key={index} className={`p-4 border rounded-lg ${getStatusColor(result.status)}`}>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center\">\n                      <span className=\"text-xl mr-3\">{getStatusIcon(result.status)}</span>\n                      <div>\n                        <h3 className=\"font-medium\">{result.name}</h3>\n                        <p className=\"text-sm mt-1\">{result.message}</p>\n                        {result.details && (\n                          <p className=\"text-xs mt-2 opacity-75\">{result.details}</p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* 解决方案建议 */}\n        <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n          <h2 className=\"text-xl font-semibold mb-4 text-gray-800\">💡 常见问题解决方案</h2>\n          <div className=\"space-y-4\">\n            <div className=\"border-l-4 border-blue-500 pl-4\">\n              <h3 className=\"font-medium text-gray-800 mb-1\">网络连接问题</h3>\n              <ul className=\"text-sm text-gray-600 space-y-1\">\n                <li>• 检查WiFi或移动数据连接</li>\n                <li>• 尝试切换网络环境</li>\n                <li>• 重启路由器或切换网络</li>\n                <li>• 确认网络信号强度</li>\n              </ul>\n            </div>\n            <div className=\"border-l-4 border-green-500 pl-4\">\n              <h3 className=\"font-medium text-gray-800 mb-1\">浏览器设置</h3>\n              <ul className=\"text-sm text-gray-600 space-y-1\">\n                <li>• 清除浏览器缓存和Cookie</li>\n                <li>• 确保JavaScript已启用</li>\n                <li>• 检查localStorage权限</li>\n                <li>• 尝试使用无痕模式</li>\n              </ul>\n            </div>\n            <div className=\"border-l-4 border-yellow-500 pl-4\">\n              <h3 className=\"font-medium text-gray-800 mb-1\">输入验证</h3>\n              <ul className=\"text-sm text-gray-600 space-y-1\">\n                <li>• 确保邮箱格式正确 (example@domain.com)</li>\n                <li>• 用户名长度2-20位，支持中英文</li>\n                <li>• 密码至少6位字符</li>\n                <li>• 确认密码与密码一致</li>\n              </ul>\n            </div>\n            <div className=\"border-l-4 border-purple-500 pl-4\">\n              <h3 className=\"font-medium text-gray-800 mb-1\">企业网络</h3>\n              <ul className=\"text-sm text-gray-600 space-y-1\">\n                <li>• 检查防火墙设置</li>\n                <li>• 确认代理配置</li>\n                <li>• 联系IT部门协助</li>\n                <li>• 尝试使用移动数据网络</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n\n        {/* 快速链接 */}\n        <div className=\"bg-white rounded-lg shadow-md p-6\">\n          <h2 className=\"text-xl font-semibold mb-4 text-gray-800\">🔗 快速链接</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <Link\n              href=\"/register\"\n              className=\"block p-4 border rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              <div className=\"text-blue-600 font-medium\">📝 注册页面</div>\n              <div className=\"text-sm text-gray-600 mt-1\">返回注册页面</div>\n            </Link>\n            <Link\n              href=\"/login\"\n              className=\"block p-4 border rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              <div className=\"text-green-600 font-medium\">🔐 登录页面</div>\n              <div className=\"text-sm text-gray-600 mt-1\">已有账户？立即登录</div>\n            </Link>\n            <Link\n              href=\"/\"\n              className=\"block p-4 border rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              <div className=\"text-purple-600 font-medium\">🏠 返回首页</div>\n              <div className=\"text-sm text-gray-600 mt-1\">回到平台首页</div>\n            </Link>\n            <a\n              href=\"/mobile-register-test.html\"\n              className=\"block p-4 border rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              <div className=\"text-orange-600 font-medium\">🧪 测试工具</div>\n              <div className=\"text-sm text-gray-600 mt-1\">移动端注册测试工具</div>\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\register\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1765,1768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1765,1768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'storageData' is assigned a value but never used.","line":148,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":148,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'responseStatus' is defined but never used.","line":194,"column":65,"nodeType":"Identifier","messageId":"unusedVar","endLine":194,"endColumn":79}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\n\ninterface RegisterResponse {\n  message: string\n  code: string\n  requestId: string\n  processingTime?: number\n  token?: string\n  user?: {\n    id: string\n    email: string\n    username: string\n    createdAt?: string\n  }\n  mobileOptimized?: boolean\n  details?: string\n  suggestions?: string[]\n}\n\ninterface ErrorResponse {\n  error: string\n  code: string\n  requestId: string\n  details?: string\n  suggestions?: string[]\n  conflictType?: string\n}\n\nexport default function RegisterPage() {\n  const [formData, setFormData] = useState({\n    email: '',\n    username: '',\n    password: '',\n    confirmPassword: ''\n  })\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n  const [errorDetails, setErrorDetails] = useState('')\n  const [requestId, setRequestId] = useState('')\n  const [suggestions, setSuggestions] = useState<string[]>([])\n  const [isMobile, setIsMobile] = useState(false)\n  const [networkStatus, setNetworkStatus] = useState('unknown')\n  const [screenWidth, setScreenWidth] = useState(0)\n  const router = useRouter()\n\n  // 检测移动设备和网络状态\n  useEffect(() => {\n    const checkDevice = () => {\n      const userAgent = navigator.userAgent.toLowerCase()\n      const isMobileDevice = /mobile|android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent)\n      setIsMobile(isMobileDevice)\n      console.log('设备检测:', { isMobileDevice, userAgent: userAgent.substring(0, 100) })\n    }\n\n    const checkScreenSize = () => {\n      setScreenWidth(window.innerWidth)\n    }\n\n    const checkNetwork = () => {\n      if ('connection' in navigator) {\n        const connection = (navigator as any).connection\n        setNetworkStatus(connection.effectiveType || 'unknown')\n      }\n      setNetworkStatus(navigator.onLine ? 'online' : 'offline')\n    }\n\n    checkDevice()\n    checkScreenSize()\n    checkNetwork()\n\n    // 监听屏幕尺寸变化\n    window.addEventListener('resize', checkScreenSize)\n    \n    // 监听网络状态变化\n    const handleOnline = () => setNetworkStatus('online')\n    const handleOffline = () => setNetworkStatus('offline')\n    \n    window.addEventListener('online', handleOnline)\n    window.addEventListener('offline', handleOffline)\n    \n    return () => {\n      window.removeEventListener('resize', checkScreenSize)\n      window.removeEventListener('online', handleOnline)\n      window.removeEventListener('offline', handleOffline)\n    }\n  }, [])\n\n  const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }))\n    \n    // 清除错误信息\n    if (error) {\n      setError('')\n      setErrorDetails('')\n      setSuggestions([])\n    }\n  }, [error])\n\n  const validateForm = useCallback(() => {\n    // 基本验证\n    if (!formData.email || !formData.username || !formData.password) {\n      setError('请填写所有必填字段')\n      return false\n    }\n\n    if (formData.password.length < 6) {\n      setError('密码长度至少6位')\n      return false\n    }\n\n    if (formData.password !== formData.confirmPassword) {\n      setError('两次输入的密码不一致')\n      return false\n    }\n\n    // 邮箱格式验证\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(formData.email.trim())) {\n      setError('请输入有效的邮箱地址')\n      return false\n    }\n\n    // 用户名格式验证\n    const usernameRegex = /^[\\w\\u4e00-\\u9fa5]{2,20}$/\n    if (!usernameRegex.test(formData.username.trim())) {\n      setError('用户名只能包含字母、数字、下划线和中文，长度2-20位')\n      return false\n    }\n\n    return true\n  }, [formData])\n\n  const saveUserData = useCallback(async (data: RegisterResponse) => {\n    if (!data.token || !data.user) {\n      throw new Error('响应数据不完整')\n    }\n\n    try {\n      // 移动端优先使用 sessionStorage 作为备份\n      const storageData = {\n        token: data.token,\n        user: data.user,\n        timestamp: Date.now()\n      }\n\n      // 尝试 localStorage\n      localStorage.setItem('token', data.token)\n      localStorage.setItem('user', JSON.stringify(data.user))\n      localStorage.setItem('loginTime', Date.now().toString())\n\n      // 移动端备份到 sessionStorage\n      if (isMobile) {\n        sessionStorage.setItem('token', data.token)\n        sessionStorage.setItem('user', JSON.stringify(data.user))\n        sessionStorage.setItem('loginTime', Date.now().toString())\n      }\n\n      console.log('用户数据保存成功')\n      return true\n    } catch (storageError) {\n      console.error('保存数据失败:', storageError)\n      \n      // 移动端存储失败的处理\n      if (isMobile) {\n        // 尝试清除一些存储空间\n        try {\n          const keys = Object.keys(localStorage)\n          for (const key of keys) {\n            if (key.startsWith('temp_') || key.startsWith('cache_')) {\n              localStorage.removeItem(key)\n            }\n          }\n          // 重试保存\n          localStorage.setItem('token', data.token)\n          localStorage.setItem('user', JSON.stringify(data.user))\n          return true\n        } catch (retryError) {\n          console.error('重试保存失败:', retryError)\n        }\n      }\n      \n      throw new Error('保存登录信息失败，请检查浏览器存储设置')\n    }\n  }, [isMobile])\n\n  const handleRegisterError = useCallback((data: ErrorResponse, responseStatus: number) => {\n    console.error('注册失败:', data)\n    \n    const errorMessage = data.error || '注册失败'\n    const details = data.details || ''\n    const requestId = data.requestId || ''\n    const suggestions = data.suggestions || []\n\n    setError(errorMessage)\n    setErrorDetails(details)\n    setRequestId(requestId)\n    setSuggestions(suggestions)\n\n    // 移动端特殊错误处理\n    if (isMobile) {\n      switch (data.code) {\n        case 'NETWORK_TIMEOUT':\n          setError('网络连接超时')\n          setSuggestions([\n            '请检查手机网络连接',\n            '尝试切换到更稳定的网络（WiFi）',\n            '关闭后台其他应用释放网络资源',\n            '稍后重试或重启浏览器'\n          ])\n          break\n        case 'DATABASE_ERROR':\n          setError('服务器暂时繁忙')\n          setSuggestions([\n            '服务器负载较高，请稍后重试',\n            '可能是网络延迟导致，建议切换网络',\n            '如问题持续，请联系技术支持'\n          ])\n          break\n        case 'INVALID_DATA_FORMAT':\n          setError('数据传输异常')\n          setSuggestions([\n            '请刷新页面后重试',\n            '检查网络连接是否稳定',\n            '尝试重新输入注册信息'\n          ])\n          break\n      }\n    }\n  }, [isMobile])\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    // 网络状态检查\n    if (networkStatus === 'offline') {\n      setError('网络连接已断开，请检查网络后重试')\n      setSuggestions(['检查WiFi或移动数据连接', '尝试切换网络环境', '确认网络信号强度'])\n      return\n    }\n\n    if (!validateForm()) {\n      return\n    }\n\n    setLoading(true)\n    setError('')\n    setErrorDetails('')\n    setRequestId('')\n    setSuggestions([])\n\n    try {\n      const requestData = {\n        email: formData.email.trim(),\n        username: formData.username.trim(),\n        password: formData.password\n      }\n\n      console.log('发送注册请求:', {\n        email: requestData.email,\n        username: requestData.username,\n        passwordLength: requestData.password.length,\n        isMobile,\n        networkStatus,\n        requestUrl: '/api/auth/register',\n        method: 'POST',\n        timestamp: new Date().toISOString()\n      })\n\n      // 移动端增加请求超时时间\n      const controller = new AbortController()\n      const timeoutId = setTimeout(() => controller.abort(), isMobile ? 45000 : 30000)\n\n      let fetchUrl = '/api/auth/register'\n      \n      // 在移动端或开发环境下，确保使用完整的URL\n      if (isMobile || window.location.hostname === 'localhost') {\n        fetchUrl = `${window.location.origin}/api/auth/register`\n      }\n\n      console.log('发送注册请求到:', fetchUrl)\n\n      const response = await fetch(fetchUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Mobile-Optimized': isMobile ? 'true' : 'false',\n          'Accept': 'application/json',\n          'Cache-Control': 'no-cache',\n          'X-Client-Info': JSON.stringify({\n            userAgent: navigator.userAgent.substring(0, 200),\n            isMobile,\n            networkStatus,\n            timestamp: Date.now(),\n            screenWidth: window.innerWidth,\n            screenHeight: window.innerHeight\n          })\n        },\n        body: JSON.stringify(requestData),\n        signal: controller.signal,\n        credentials: 'same-origin' // 确保包含cookies\n      })\n\n      clearTimeout(timeoutId)\n\n      console.log('注册响应状态:', response.status, response.statusText)\n\n      let data: RegisterResponse | ErrorResponse\n      try {\n        const responseText = await response.text()\n        console.log('响应原文:', responseText.substring(0, 500))\n        \n        data = JSON.parse(responseText)\n      } catch (parseError) {\n        console.error('解析响应JSON失败:', parseError)\n        setError('服务器返回格式错误，请刷新页面后重试')\n        setSuggestions(['刷新页面重试', '检查网络连接', '稍后再试'])\n        return\n      }\n\n      if (response.ok && 'token' in data) {\n        console.log('注册成功，开始保存用户数据')\n        \n        try {\n          await saveUserData(data as RegisterResponse)\n          console.log('用户数据已保存，跳转到dashboard')\n          router.push('/dashboard')\n        } catch (saveError) {\n          console.error('保存数据失败:', saveError)\n          setError('保存登录信息失败')\n          setErrorDetails(saveError instanceof Error ? saveError.message : '未知错误')\n          setSuggestions([\n            '检查浏览器存储权限',\n            '尝试清理浏览器缓存',\n            '使用其他浏览器重试',\n            '联系技术支持'\n          ])\n        }\n      } else {\n        handleRegisterError(data as ErrorResponse, response.status)\n      }\n    } catch (error) {\n      console.error('注册请求异常:', error)\n      \n      // 移动端网络错误特殊处理\n      if (error instanceof Error) {\n        if (error.name === 'AbortError') {\n          setError('请求超时，请检查网络后重试')\n          setSuggestions([\n            '检查网络连接稳定性',\n            '尝试切换到WiFi环境',\n            '关闭其他占用网络的应用',\n            '稍后重试或重启浏览器'\n          ])\n        } else if (error.message.includes('fetch') || error.message.includes('network') || error.message.includes('Failed to fetch')) {\n          setError('网络连接失败，无法连接到服务器')\n          setSuggestions([\n            '检查手机网络连接（WiFi/移动数据）',\n            '尝试切换网络环境',\n            '确认网络信号强度',\n            '重启网络服务或路由器',\n            '稍后重试',\n            '如果是企业网络，可能需要配置代理'\n          ])\n        } else if (error.message.includes('CORS') || error.message.includes('Cross-Origin')) {\n          setError('跨域请求被阻止，请联系技术支持')\n          setSuggestions([\n            '刷新页面重试',\n            '清除浏览器缓存',\n            '使用不同浏览器尝试',\n            '联系技术支持获取帮助'\n          ])\n        } else {\n          setError('注册过程中发生错误')\n          setSuggestions([\n            '刷新页面重试',\n            '检查网络连接',\n            '确认所有必填项已填写',\n            '稍后再试'\n          ])\n        }\n      } else {\n        setError('注册过程中发生未知错误')\n        setSuggestions([\n          '刷新页面重试',\n          '检查网络连接',\n          '稍后再试'\n        ])\n      }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-white flex items-start justify-center px-3 sm:px-4 py-4 sm:py-8\">\n      <div className=\"max-w-6xl w-full grid lg:grid-cols-2 gap-6 lg:gap-8 items-start\">\n        {/* 左侧：品牌介绍 - 移动端隐藏或简化 */}\n        <div className={`${isMobile ? 'hidden' : 'block'} text-center lg:text-left order-2 lg:order-1`}>\n          <Link href=\"/\" className=\"inline-block mb-8\">\n            <h1 className=\"text-3xl lg:text-4xl font-bold text-gray-900\">\n              小说创作平台\n            </h1>\n          </Link>\n          \n          <div className=\"mb-8\">\n            <p className=\"text-xl text-gray-600 mb-6\">\n              加入我们，开启您的AI辅助创作之旅\n            </p>\n            <div className=\"w-20 h-1 bg-green-600 mx-auto lg:mx-0\"></div>\n          </div>\n\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 mb-1\">免费使用</h3>\n                <p className=\"text-sm text-gray-600\">完全免费，无任何隐藏费用</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 mb-1\">安全可靠</h3>\n                <p className=\"text-sm text-gray-600\">您的创作内容安全保密</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 mb-1\">快速上手</h3>\n                <p className=\"text-sm text-gray-600\">简单易用，即学即会</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* 右侧：注册表单 */}\n        <div className=\"bg-white p-4 sm:p-6 lg:p-8 rounded-xl shadow-lg w-full max-w-md mx-auto lg:max-w-none lg:mx-0 order-1 lg:order-2\">\n          {/* 移动端标题 */}\n          {isMobile && (\n            <div className=\"text-center mb-6\">\n              <Link href=\"/\" className=\"inline-block mb-4\">\n                <h1 className=\"text-2xl font-bold text-gray-900\">\n                  小说创作平台\n                </h1>\n              </Link>\n            </div>\n          )}\n\n          <div className=\"text-center mb-6 lg:mb-8\">\n            <div className=\"w-14 h-14 sm:w-16 sm:h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <svg className=\"w-7 h-7 sm:w-8 sm:h-8 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\" />\n              </svg>\n            </div>\n            <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">\n              创建新账户\n            </h2>\n            <p className=\"text-gray-600 text-sm sm:text-base\">\n              加入我们，开始您的创作之旅\n            </p>\n            \n            {/* 移动端设备状态显示 */}\n            {isMobile && (\n              <div className=\"mt-4 text-xs text-gray-500\">\n                <div className=\"flex items-center justify-center space-x-2\">\n                  <span>移动端优化</span>\n                  <span>•</span>\n                  <span>网络: {networkStatus === 'online' ? '在线' : '离线'}</span>\n                  {screenWidth > 0 && (\n                    <>\n                      <span>•</span>\n                      <span>{screenWidth}px</span>\n                    </>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n\n          <form className=\"space-y-4 sm:space-y-5 lg:space-y-6\" onSubmit={handleSubmit}>\n            {error && (\n              <div className=\"bg-red-50 border border-red-200 text-red-600 px-3 sm:px-4 py-3 rounded-lg\">\n                <div className=\"flex items-start\">\n                  <svg className=\"w-5 h-5 sm:w-6 sm:h-6 mr-2 mt-0.5 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\n                  </svg>\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium text-sm sm:text-base\">{error}</p>\n                    {errorDetails && (\n                      <p className=\"text-sm text-red-500 mt-1\">{errorDetails}</p>\n                    )}\n                    {requestId && (\n                      <p className=\"text-xs text-red-400 mt-1\">请求ID: {requestId}</p>\n                    )}\n                  </div>\n                </div>\n                \n                {/* 移动端建议显示 */}\n                {suggestions.length > 0 && (\n                  <div className=\"mt-3 pt-3 border-t border-red-200\">\n                    <p className=\"text-sm font-medium text-red-700 mb-2\">建议解决方案:</p>\n                    <ul className=\"text-sm text-red-600 space-y-1\">\n                      {suggestions.map((suggestion, index) => (\n                        <li key={index} className=\"flex items-start\">\n                          <span className=\"mr-2\">•</span>\n                          <span>{suggestion}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            )}\n\n            <div className=\"space-y-3 sm:space-y-4 lg:space-y-4\">\n              <div>\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1 sm:mb-2\">\n                  邮箱地址\n                </label>\n                <input\n                  id=\"email\"\n                  name=\"email\"\n                  type=\"email\"\n                  required\n                  autoComplete=\"email\"\n                  className=\"w-full px-3 sm:px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 focus:outline-none transition-colors text-base sm:text-lg\"\n                  placeholder=\"请输入邮箱地址\"\n                  value={formData.email}\n                  onChange={handleChange}\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"username\" className=\"block text-sm font-medium text-gray-700 mb-1 sm:mb-2\">\n                  用户名\n                </label>\n                <input\n                  id=\"username\"\n                  name=\"username\"\n                  type=\"text\"\n                  required\n                  autoComplete=\"username\"\n                  className=\"w-full px-3 sm:px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 focus:outline-none transition-colors text-base sm:text-lg\"\n                  placeholder=\"请输入用户名（2-20位）\"\n                  value={formData.username}\n                  onChange={handleChange}\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-1 sm:mb-2\">\n                  密码\n                </label>\n                <input\n                  id=\"password\"\n                  name=\"password\"\n                  type=\"password\"\n                  required\n                  autoComplete=\"new-password\"\n                  className=\"w-full px-3 sm:px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 focus:outline-none transition-colors text-base sm:text-lg\"\n                  placeholder=\"请输入密码（至少6位）\"\n                  value={formData.password}\n                  onChange={handleChange}\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-gray-700 mb-1 sm:mb-2\">\n                  确认密码\n                </label>\n                <input\n                  id=\"confirmPassword\"\n                  name=\"confirmPassword\"\n                  type=\"password\"\n                  required\n                  autoComplete=\"new-password\"\n                  className=\"w-full px-3 sm:px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 focus:outline-none transition-colors text-base sm:text-lg\"\n                  placeholder=\"请再次输入密码\"\n                  value={formData.confirmPassword}\n                  onChange={handleChange}\n                />\n              </div>\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading || networkStatus === 'offline'}\n              className=\"w-full flex items-center justify-center px-4 py-4 border border-transparent text-base sm:text-lg font-medium rounded-lg text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {loading ? (\n                <>\n                  <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                  </svg>\n                  注册中...\n                </>\n              ) : (\n                <>\n                  <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\" />\n                  </svg>\n                  免费注册\n                </>\n              )}\n            </button>\n          </form>\n\n          <div className=\"mt-4 sm:mt-6 text-center space-y-3\">\n            <div className=\"text-sm text-gray-600\">\n              已有账户？{' '}\n              <Link\n                href=\"/login\"\n                className=\"font-medium text-indigo-600 hover:text-indigo-500 inline-flex items-center\"\n              >\n                <svg className=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\n                </svg>\n                立即登录\n              </Link>\n            </div>\n            <div className=\"text-xs\">\n              <Link href=\"/\" className=\"text-gray-500 hover:text-gray-700\">\n                ← 返回首页\n              </Link>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\app\\test-register\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\AIAssistant.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BookOpen' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BookOpen"},"fix":{"range":[127,140],"text":""},"desc":"Remove unused variable \"BookOpen\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[160,173],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Zap"},"fix":{"range":[173,180],"text":""},"desc":"Remove unused variable \"Zap\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Hash' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Hash"},"fix":{"range":[235,243],"text":""},"desc":"Remove unused variable \"Hash\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[426,429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[426,429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":191,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4293,4296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4293,4296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { \n  Sparkles, \n  Send, \n  MessageSquare, \n  Lightbulb, \n  BookOpen, \n  Users, \n  Globe, \n  Settings,\n  Zap,\n  RefreshCw,\n  Copy,\n  ThumbsUp,\n  ThumbsDown,\n  Plus,\n  Hash,\n  Target\n} from 'lucide-react'\n\ninterface Novel {\n  id: string\n  title: string\n  description?: string\n  outline?: string\n  worldSetting?: string\n  protagonist?: string\n  chapters?: any[]\n}\n\ninterface AIAssistantProps {\n  novel: Novel\n}\n\ninterface Message {\n  id: string\n  role: 'user' | 'assistant'\n  content: string\n  timestamp: Date\n  suggestions?: string[]\n}\n\nexport default function AIAssistant({ novel }: AIAssistantProps) {\n  const [messages, setMessages] = useState<Message[]>([])\n  const [inputMessage, setInputMessage] = useState('')\n  const [isTyping, setIsTyping] = useState(false)\n  const [activeTab, setActiveTab] = useState<'chat' | 'tools' | 'suggestions'>('chat')\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages])\n\n  const quickActions = [\n    { \n      icon: Sparkles, \n      label: '生成章节', \n      description: '基于大纲生成新章节',\n      action: 'generate_chapter'\n    },\n    { \n      icon: Users, \n      label: '角色设定', \n      description: '创建角色背景故事',\n      action: 'create_character'\n    },\n    { \n      icon: Lightbulb, \n      label: '情节建议', \n      description: '获取剧情发展建议',\n      action: 'plot_suggestions'\n    },\n    { \n      icon: Globe, \n      label: '世界观', \n      description: '完善世界设定',\n      action: 'worldbuilding'\n    },\n    { \n      icon: RefreshCw, \n      label: '改写优化', \n      description: '优化文本表达',\n      action: 'rewrite'\n    },\n    { \n      icon: Target, \n      label: '目标设定', \n      description: '设定写作目标',\n      action: 'set_goals'\n    }\n  ]\n\n  const writingSuggestions = [\n    '考虑添加更多感官描写，让读者身临其境',\n    '这个场景可以加入一些内心独白来展现角色性格',\n    '对话可以更自然一些，避免过于书面化',\n    '可以适当放慢节奏，给读者更多思考空间',\n    '这段描写很有画面感，继续保持这种风格'\n  ]\n\n  const handleSendMessage = async () => {\n    if (!inputMessage.trim()) return\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: inputMessage,\n      timestamp: new Date()\n    }\n\n    setMessages(prev => [...prev, userMessage])\n    setInputMessage('')\n    setIsTyping(true)\n\n    // 模拟AI回复\n    setTimeout(() => {\n      const aiResponse: Message = {\n        id: (Date.now() + 1).toString(),\n        role: 'assistant',\n        content: `我理解你的想法。基于你的小说《${novel.title}》，我建议你可以从以下几个方面来发展：\\n\\n1. **深化角色情感**: 通过内心独白展现角色的复杂情感\\n2. **加强场景描写**: 运用五感描写让场景更加生动\\n3. **优化对话节奏**: 让对话更贴近自然交流\\n\\n需要我为你提供更具体的建议吗？`,\n        timestamp: new Date(),\n        suggestions: [\n          '帮我生成一个新章节大纲',\n          '优化这段对话',\n          '给我一些情节发展的建议'\n        ]\n      }\n      \n      setMessages(prev => [...prev, aiResponse])\n      setIsTyping(false)\n    }, 1500)\n  }\n\n  const handleQuickAction = (action: string) => {\n    let prompt = ''\n    \n    switch (action) {\n      case 'generate_chapter':\n        prompt = `请为我的小说《${novel.title}》生成一个新的章节大纲`\n        break\n      case 'create_character':\n        prompt = '帮我创建一个新的角色，包括背景故事和性格特点'\n        break\n      case 'plot_suggestions':\n        prompt = '我需要一些情节发展的建议，当前剧情有些平淡'\n        break\n      case 'worldbuilding':\n        prompt = '帮我完善小说的世界观设定'\n        break\n      case 'rewrite':\n        prompt = '帮我优化一段文字的表达方式'\n        break\n      case 'set_goals':\n        prompt = '帮我设定合理的写作目标和计划'\n        break\n    }\n    \n    setInputMessage(prompt)\n    setActiveTab('chat')\n  }\n\n  const handleCopyMessage = (content: string) => {\n    navigator.clipboard.writeText(content)\n      .then(() => {\n        // 可以添加复制成功的提示\n      })\n      .catch(err => {\n        console.error('复制失败:', err)\n      })\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* 标签页 */}\n      <div className=\"flex border-b border-gray-200\">\n        {[\n          { id: 'chat', label: '对话', icon: MessageSquare },\n          { id: 'tools', label: '工具', icon: Sparkles },\n          { id: 'suggestions', label: '建议', icon: Lightbulb }\n        ].map((tab) => {\n          const Icon = tab.icon\n          return (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id as any)}\n              className={`flex-1 flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium transition-colors tab-button ${\n                activeTab === tab.id\n                  ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50'\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\n              }`}\n            >\n              <Icon className=\"h-4 w-4\" />\n              {tab.label}\n            </button>\n          )\n        })}\n      </div>\n\n      {/* 内容区域 */}\n      <div className=\"flex-1 overflow-hidden\">\n        {activeTab === 'chat' && (\n          <div className=\"h-full flex flex-col\">\n            {/* 消息列表 */}\n            <div className=\"flex-1 overflow-auto p-4 space-y-4\">\n              {messages.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <Sparkles className=\"h-12 w-12 text-purple-400 mx-auto mb-3\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">AI写作助手</h3>\n                  <p className=\"text-sm text-gray-600 mb-4\">\n                    我是你的专属写作助手，可以帮你生成内容、优化文本、提供创作建议\n                  </p>\n                  <div className=\"space-y-2\">\n                    {[\n                      '帮我生成一个新的章节',\n                      '优化这段对话的表达',\n                      '给我一些情节发展的建议'\n                    ].map((suggestion, index) => (\n                      <button\n                        key={index}\n                        onClick={() => setInputMessage(suggestion)}\n                        className=\"block w-full text-left px-3 py-2 text-sm bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors\"\n                      >\n                        {suggestion}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                messages.map((message) => (\n                  <div\n                    key={message.id}\n                    className={`flex gap-3 ${\n                      message.role === 'user' ? 'flex-row-reverse' : ''\n                    }`}\n                  >\n                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                      message.role === 'user' \n                        ? 'bg-indigo-600 text-white' \n                        : 'bg-purple-100 text-purple-600'\n                    }`}>\n                      {message.role === 'user' ? (\n                        <span className=\"text-sm font-medium\">你</span>\n                      ) : (\n                        <Sparkles className=\"h-4 w-4\" />\n                      )}\n                    </div>\n                    \n                    <div className={`max-w-[80%] ${\n                      message.role === 'user' \n                        ? 'text-right' \n                        : ''\n                    }`}>\n                      <div className={`inline-block px-4 py-2 rounded-lg ${\n                        message.role === 'user'\n                          ? 'bg-indigo-600 text-white'\n                          : 'bg-gray-100 text-gray-900'\n                      }`}>\n                        <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n                      </div>\n                      \n                      {/* 操作按钮 */}\n                      <div className=\"flex items-center gap-2 mt-1\">\n                        <span className=\"text-xs text-gray-500\">\n                          {message.timestamp.toLocaleTimeString()}\n                        </span>\n                        {message.role === 'assistant' && (\n                          <>\n                            <button\n                              onClick={() => handleCopyMessage(message.content)}\n                              className=\"p-1 hover:bg-gray-100 rounded transition-colors\"\n                              title=\"复制\"\n                            >\n                              <Copy className=\"h-3 w-3 text-gray-400\" />\n                            </button>\n                            <button\n                              className=\"p-1 hover:bg-gray-100 rounded transition-colors\"\n                              title=\"点赞\"\n                            >\n                              <ThumbsUp className=\"h-3 w-3 text-gray-400\" />\n                            </button>\n                            <button\n                              className=\"p-1 hover:bg-gray-100 rounded transition-colors\"\n                              title=\"踩\"\n                            >\n                              <ThumbsDown className=\"h-3 w-3 text-gray-400\" />\n                            </button>\n                          </>\n                        )}\n                      </div>\n                      \n                      {/* AI建议 */}\n                      {message.suggestions && (\n                        <div className=\"mt-2 space-y-1\">\n                          {message.suggestions.map((suggestion, index) => (\n                            <button\n                              key={index}\n                              onClick={() => setInputMessage(suggestion)}\n                              className=\"block w-full text-left px-3 py-1 text-xs bg-purple-50 hover:bg-purple-100 text-purple-700 rounded transition-colors\"\n                            >\n                              {suggestion}\n                            </button>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))\n              )}\n              \n              {isTyping && (\n                <div className=\"flex gap-3\">\n                  <div className=\"w-8 h-8 rounded-full flex items-center justify-center bg-purple-100 text-purple-600\">\n                    <Sparkles className=\"h-4 w-4 animate-spin\" />\n                  </div>\n                  <div className=\"bg-gray-100 px-4 py-2 rounded-lg\">\n                    <div className=\"flex gap-1\">\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                    </div>\n                  </div>\n                </div>\n              )}\n              \n              <div ref={messagesEndRef} />\n            </div>\n\n            {/* 输入区域 */}\n            <div className=\"border-t border-gray-200 p-4\">\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  value={inputMessage}\n                  onChange={(e) => setInputMessage(e.target.value)}\n                  onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n                  placeholder=\"向AI助手提问...\"\n                  className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm\"\n                />\n                <button\n                  onClick={handleSendMessage}\n                  disabled={!inputMessage.trim() || isTyping}\n                  className=\"px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'tools' && (\n          <div className=\"p-4 space-y-3\">\n            <h3 className=\"font-medium text-gray-900 mb-3\">快速工具</h3>\n            {quickActions.map((action, index) => {\n              const Icon = action.icon\n              return (\n                <button\n                  key={index}\n                  onClick={() => handleQuickAction(action.action)}\n                  className=\"w-full text-left p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-indigo-300 transition-all group\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-indigo-50 text-indigo-600 rounded-lg group-hover:bg-indigo-100\">\n                      <Icon className=\"h-5 w-5\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-medium text-gray-900\">{action.label}</h4>\n                      <p className=\"text-xs text-gray-600\">{action.description}</p>\n                    </div>\n                    <Plus className=\"h-4 w-4 text-gray-400 group-hover:text-indigo-600\" />\n                  </div>\n                </button>\n              )\n            })}\n          </div>\n        )}\n\n        {activeTab === 'suggestions' && (\n          <div className=\"p-4\">\n            <h3 className=\"font-medium text-gray-900 mb-3\">写作建议</h3>\n            <div className=\"space-y-3\">\n              {writingSuggestions.map((suggestion, index) => (\n                <div\n                  key={index}\n                  className=\"p-3 bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-lg\"\n                >\n                  <div className=\"flex items-start gap-2\">\n                    <Lightbulb className=\"h-4 w-4 text-purple-600 mt-0.5 flex-shrink-0\" />\n                    <p className=\"text-sm text-gray-700\">{suggestion}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\AuthGuard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":35,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\n\ninterface AuthGuardProps {\n  children: React.ReactNode\n  redirectTo?: string\n}\n\nexport default function AuthGuard({ children, redirectTo }: AuthGuardProps) {\n  const router = useRouter()\n  const [isAuthenticated, setIsAuthenticated] = useState(false)\n  const [isLoading, setIsLoading] = useState(true)\n\n  useEffect(() => {\n    const checkAuth = () => {\n      const token = localStorage.getItem('token')\n      const user = localStorage.getItem('user')\n      \n      if (!token || !user) {\n        const currentPath = window.location.pathname\n        const authUrl = redirectTo ? `${redirectTo}?from=${encodeURIComponent(currentPath)}` : '/auth'\n        router.push(authUrl)\n        return\n      }\n      \n      // 验证token格式（简单检查）\n      try {\n        const parsedUser = JSON.parse(user)\n        if (!parsedUser.id || !parsedUser.username) {\n          throw new Error('Invalid user data')\n        }\n        setIsAuthenticated(true)\n      } catch (error) {\n        localStorage.removeItem('token')\n        localStorage.removeItem('user')\n        const currentPath = window.location.pathname\n        const authUrl = redirectTo ? `${redirectTo}?from=${encodeURIComponent(currentPath)}` : '/auth'\n        router.push(authUrl)\n      }\n      \n      setIsLoading(false)\n    }\n\n    checkAuth()\n  }, [router, redirectTo])\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">正在验证身份...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!isAuthenticated) {\n    return null // Will redirect\n  }\n\n  return <>{children}</>\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\AutoSaveIndicator.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\AutoSaveIndicator.tsx:115:19\n  113 |   const StatusIcon = config.icon\n  114 |   const timeSinceLastSave = lastSavedTime \n> 115 |     ? Math.floor((Date.now() - lastSavedTime.getTime()) / 1000)\n      |                   ^^^^^^^^^^ Cannot call impure function\n  116 |     : 0\n  117 |\n  118 |   return (","line":115,"column":19,"nodeType":null,"endLine":115,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { \n  Check, \n  Clock, \n  X, \n  Save, \n  RotateCcw \n} from 'lucide-react'\n\ntype SavingStatus = 'idle' | 'saving' | 'saved' | 'error'\n\ninterface AutoSaveIndicatorProps {\n  status: SavingStatus\n  lastSavedTime?: Date\n  hasUnsavedChanges?: boolean\n  onManualSave?: () => void\n  showManualSave?: boolean\n}\n\nexport default function AutoSaveIndicator({\n  status,\n  lastSavedTime,\n  hasUnsavedChanges = false,\n  onManualSave,\n  showManualSave = true\n}: AutoSaveIndicatorProps) {\n  const [visible, setVisible] = useState(false)\n  const [countdown, setCountdown] = useState(0)\n\n  // 当状态改变时显示指示器\n  useEffect(() => {\n    if (status !== 'idle') {\n      setVisible(true)\n      \n      if (status === 'saving') {\n        setCountdown(30) // 最多显示30秒\n        const interval = setInterval(() => {\n          setCountdown(prev => {\n            if (prev <= 1) {\n              setVisible(false)\n              return 0\n            }\n            return prev - 1\n          })\n        }, 1000)\n        \n        return () => clearInterval(interval)\n      } else {\n        // 非保存状态3秒后隐藏\n        const timer = setTimeout(() => {\n          setVisible(false)\n        }, 3000)\n        \n        return () => clearTimeout(timer)\n      }\n    }\n  }, [status])\n\n  // 手动保存按钮点击处理\n  const handleManualSave = async () => {\n    if (onManualSave) {\n      await onManualSave()\n    }\n  }\n\n  const getStatusConfig = () => {\n    switch (status) {\n      case 'saving':\n        return {\n          icon: Clock,\n          color: 'text-yellow-600',\n          bgColor: 'bg-yellow-50',\n          borderColor: 'border-yellow-200',\n          text: '保存中...',\n          showProgress: true\n        }\n      case 'saved':\n        return {\n          icon: Check,\n          color: 'text-green-600',\n          bgColor: 'bg-green-50',\n          borderColor: 'border-green-200',\n          text: '已保存',\n          showProgress: false\n        }\n      case 'error':\n        return {\n          icon: X,\n          color: 'text-red-600',\n          bgColor: 'bg-red-50',\n          borderColor: 'border-red-200',\n          text: '保存失败',\n          showProgress: false,\n          showRetry: true\n        }\n      default:\n        return {\n          icon: Save,\n          color: 'text-gray-600',\n          bgColor: 'bg-gray-50',\n          borderColor: 'border-gray-200',\n          text: '就绪',\n          showProgress: false\n        }\n    }\n  }\n\n  if (!visible) return null\n\n  const config = getStatusConfig()\n  const StatusIcon = config.icon\n  const timeSinceLastSave = lastSavedTime \n    ? Math.floor((Date.now() - lastSavedTime.getTime()) / 1000)\n    : 0\n\n  return (\n    <div className={`fixed top-4 right-4 z-50 animate-in slide-in-from-top-2 duration-200`}>\n      <div className={`flex items-center gap-3 px-4 py-2 rounded-lg border ${config.bgColor} ${config.borderColor} shadow-lg max-w-sm`}>\n        <div className=\"flex items-center gap-2\">\n          <StatusIcon className={`h-4 w-4 ${config.color} ${status === 'saving' ? 'animate-spin' : ''}`} />\n          <span className={`text-sm font-medium ${config.color}`}>\n            {config.text}\n          </span>\n          \n          {hasUnsavedChanges && status === 'idle' && (\n            <span className=\"text-xs text-gray-500 ml-1\">\n              (有未保存的更改)\n            </span>\n          )}\n        </div>\n\n        {/* 保存进度条 */}\n        {config.showProgress && countdown > 0 && (\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-16 h-1.5 bg-gray-200 rounded-full overflow-hidden\">\n              <div \n                className=\"h-full bg-yellow-500 transition-all duration-1000\"\n                style={{ width: `${(countdown / 30) * 100}%` }}\n              ></div>\n            </div>\n            <span className=\"text-xs text-gray-500\">{countdown}s</span>\n          </div>\n        )}\n\n        {/* 操作按钮 */}\n        <div className=\"flex items-center gap-1 ml-2\">\n          {config.showRetry && onManualSave && (\n            <button\n              onClick={handleManualSave}\n              className=\"p-1 rounded hover:bg-white/50 transition-colors\"\n              title=\"重试保存\"\n            >\n              <RotateCcw className=\"h-3 w-3 text-gray-600\" />\n            </button>\n          )}\n          \n          {showManualSave && hasUnsavedChanges && onManualSave && status !== 'saving' && (\n            <button\n              onClick={handleManualSave}\n              className=\"p-1 rounded hover:bg-white/50 transition-colors\"\n              title=\"手动保存\"\n            >\n              <Save className=\"h-3 w-3 text-gray-600\" />\n            </button>\n          )}\n        </div>\n\n        {/* 关闭按钮 */}\n        <button\n          onClick={() => setVisible(false)}\n          className=\"p-1 rounded hover:bg-white/50 transition-colors ml-1\"\n          title=\"关闭\"\n        >\n          <X className=\"h-3 w-3 text-gray-400\" />\n        </button>\n      </div>\n\n      {/* 保存时间提示 */}\n      {status === 'saved' && lastSavedTime && timeSinceLastSave < 60 && (\n        <div className={`text-xs text-gray-500 mt-1 text-center ${config.bgColor} px-2 py-1 rounded-b-lg`}>\n          {timeSinceLastSave === 0 ? '刚刚保存' : `${timeSinceLastSave}秒前保存`}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// 紧凑版指示器（用于工具栏）\nexport function CompactAutoSaveIndicator({\n  status,\n  onClick\n}: {\n  status: SavingStatus\n  onClick?: () => void\n}) {\n  const getStatusConfig = () => {\n    switch (status) {\n      case 'saving':\n        return {\n          icon: Clock,\n          color: 'text-yellow-600',\n          tooltip: '正在保存...'\n        }\n      case 'saved':\n        return {\n          icon: Check,\n          color: 'text-green-600',\n          tooltip: '已保存'\n        }\n      case 'error':\n        return {\n          icon: X,\n          color: 'text-red-600',\n          tooltip: '保存失败'\n        }\n      default:\n        return {\n          icon: Save,\n          color: 'text-gray-600',\n          tooltip: '就绪'\n        }\n    }\n  }\n\n  const config = getStatusConfig()\n  const StatusIcon = config.icon\n\n  return (\n    <button\n      onClick={onClick}\n      className={`p-2 rounded-lg hover:bg-gray-100 transition-colors group relative`}\n      title={config.tooltip}\n    >\n      <StatusIcon className={`h-4 w-4 ${config.color} ${status === 'saving' ? 'animate-spin' : ''}`} />\n      \n      {/* 状态指示点 */}\n      {status === 'saved' && (\n        <div className=\"absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full\"></div>\n      )}\n      {status === 'error' && (\n        <div className=\"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse\"></div>\n      )}\n    </button>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\ChapterDetailModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[31,42],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'darkMode' is assigned a value but never used.","line":25,"column":80,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":88}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { X, FileText, Sparkles, Clock, Target, BookOpen } from 'lucide-react'\n\ninterface Chapter {\n  id: string\n  title: string\n  summary?: string\n  content?: string\n  isAIGenerated: boolean\n  order: number\n  createdAt: string\n  updatedAt: string\n}\n\ninterface ChapterDetailModalProps {\n  chapter: Chapter | null\n  isOpen: boolean\n  onClose: () => void\n  onEdit?: (chapter: Chapter) => void\n  darkMode?: boolean\n}\n\nexport default function ChapterDetailModal({ chapter, isOpen, onClose, onEdit, darkMode = false }: ChapterDetailModalProps) {\n  const [activeTab, setActiveTab] = useState<'info' | 'content'>('info')\n\n  if (!isOpen || !chapter) return null\n\n  const calculateReadingTime = (content: string) => {\n    if (!content) return '0'\n    const wordCount = content.replace(/\\s/g, '').length\n    const readingTime = Math.ceil(wordCount / 300) // 假设每分钟读300字\n    return `${readingTime} 分钟`\n  }\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleString('zh-CN', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    })\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl\">\n        {/* 头部 */}\n        <div className=\"bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-3 mb-2\">\n                <span className=\"bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm\">\n                  第 {chapter.order} 章\n                </span>\n                {chapter.isAIGenerated && (\n                  <span className=\"bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm flex items-center gap-1\">\n                    <Sparkles className=\"h-3 w-3\" />\n                    AI生成\n                  </span>\n                )}\n              </div>\n              <h2 className=\"text-2xl font-bold\">{chapter.title}</h2>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors\"\n            >\n              <X className=\"h-5 w-5\" />\n            </button>\n          </div>\n        </div>\n\n        {/* 标签页 */}\n        <div className=\"border-b border-gray-200\">\n          <div className=\"flex\">\n            <button\n              onClick={() => setActiveTab('info')}\n              className={`flex-1 px-6 py-4 text-sm font-medium transition-colors ${\n                activeTab === 'info'\n                  ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'\n                  : 'text-gray-600 hover:text-gray-900'\n              }`}\n            >\n              <div className=\"flex items-center justify-center gap-2\">\n                <BookOpen className=\"h-4 w-4\" />\n                章节信息\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('content')}\n              className={`flex-1 px-6 py-4 text-sm font-medium transition-colors ${\n                activeTab === 'content'\n                  ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'\n                  : 'text-gray-600 hover:text-gray-900'\n              }`}\n            >\n              <div className=\"flex items-center justify-center gap-2\">\n                <FileText className=\"h-4 w-4\" />\n                章节内容\n              </div>\n            </button>\n          </div>\n        </div>\n\n        {/* 内容区域 */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {activeTab === 'info' && (\n            <div className=\"p-6 space-y-6\">\n              {/* 章节简介 */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">章节简介</h3>\n                <div className=\"bg-gray-50 rounded-lg p-4\">\n                  {chapter.summary ? (\n                    <p className=\"text-gray-700 leading-relaxed\">{chapter.summary}</p>\n                  ) : (\n                    <p className=\"text-gray-400 italic\">暂无简介</p>\n                  )}\n                </div>\n              </div>\n\n              {/* 统计信息 */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">统计信息</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div className=\"bg-blue-50 rounded-lg p-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"p-2 bg-blue-100 rounded-lg\">\n                        <FileText className=\"h-5 w-5 text-blue-600\" />\n                      </div>\n                      <div>\n                        <div className=\"text-2xl font-bold text-gray-900\">\n                          {chapter.content ? chapter.content.replace(/\\s/g, '').length : 0}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">字数</div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"bg-green-50 rounded-lg p-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"p-2 bg-green-100 rounded-lg\">\n                        <Clock className=\"h-5 w-5 text-green-600\" />\n                      </div>\n                      <div>\n                        <div className=\"text-2xl font-bold text-gray-900\">\n                          {calculateReadingTime(chapter.content || '')}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">预计阅读</div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"bg-purple-50 rounded-lg p-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"p-2 bg-purple-100 rounded-lg\">\n                        <Target className=\"h-5 w-5 text-purple-600\" />\n                      </div>\n                      <div>\n                        <div className=\"text-2xl font-bold text-gray-900\">\n                          {chapter.content ? Math.round((chapter.content.replace(/\\s/g, '').length / 1000)) : 0}k\n                        </div>\n                        <div className=\"text-sm text-gray-600\">千字</div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* 时间信息 */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">时间信息</h3>\n                <div className=\"bg-gray-50 rounded-lg p-4 space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">创建时间</span>\n                    <span className=\"text-gray-900\">{formatDate(chapter.createdAt)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">最后更新</span>\n                    <span className=\"text-gray-900\">{formatDate(chapter.updatedAt)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {activeTab === 'content' && (\n            <div className=\"p-6\">\n              {chapter.content ? (\n                <div className=\"prose max-w-none\">\n                  <div className=\"bg-white border border-gray-200 rounded-lg p-6 leading-relaxed text-gray-800 whitespace-pre-wrap\">\n                    {chapter.content}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-center py-12\">\n                  <FileText className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">暂无内容</h3>\n                  <p className=\"text-gray-600 mb-6\">点击下方按钮开始创作章节内容</p>\n                  <button\n                    onClick={() => onEdit?.(chapter)}\n                    className=\"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n                  >\n                    <Sparkles className=\"h-4 w-4 mr-2\" />\n                    AI生成内容\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* 底部操作 */}\n        <div className=\"border-t border-gray-200 p-6 bg-gray-50\">\n          <div className=\"flex justify-between\">\n            <button\n              onClick={onClose}\n              className=\"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              关闭\n            </button>\n            <button\n              onClick={() => onEdit?.(chapter)}\n              className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              编辑章节\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\ChapterList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MoreVertical"},"fix":{"range":[114,131],"text":""},"desc":"Remove unused variable \"MoreVertical\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'novelId' is defined but never used.","line":52,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":105,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { \n  FileText, \n  Settings, \n  Trash2, \n  Sparkles, \n  Clock, \n  MoreVertical,\n  GripVertical,\n  Edit3,\n  Eye,\n  Copy\n} from 'lucide-react'\nimport { useDragAndDrop } from '@/hooks/useDragAndDrop'\n\ninterface Chapter {\n  id: string\n  title: string\n  summary?: string\n  content?: string\n  isAIGenerated?: boolean\n  order: number\n  createdAt: string\n  updatedAt: string\n  wordCount?: number\n  status?: string\n}\n\ninterface ChapterListProps {\n  chapters: Chapter[]\n  onEditSummary: (chapter: Chapter) => void\n  onEditContent: (chapter: Chapter) => void\n  onAIGenerate: (chapter: Chapter) => void\n  onDelete: (chapter: Chapter) => void\n  onView: (chapter: Chapter) => void\n  onReorder?: (chapters: Chapter[]) => void\n  generatingChapter?: string | null\n  novelId: string\n}\n\nexport default function ChapterList({\n  chapters,\n  onEditSummary,\n  onEditContent,\n  onAIGenerate,\n  onDelete,\n  onView,\n  onReorder,\n  generatingChapter,\n  novelId\n}: ChapterListProps) {\n  const [showActions, setShowActions] = useState<string | null>(null)\n  \n  const {\n    draggedItem,\n    dragOverIndex,\n    handleDragStart,\n    handleDragOver,\n    handleDragLeave,\n    handleDrop,\n    handleDragEnd\n  } = useDragAndDrop(chapters, (reorderedChapters) => {\n    if (onReorder) {\n      onReorder(reorderedChapters)\n    }\n  })\n\n  const calculateWordCount = (content?: string) => {\n    if (!content) return 0\n    return content.replace(/\\s/g, '').length\n  }\n\n  const getChapterStatus = (chapter: Chapter) => {\n    if (!chapter.summary) {\n      return { text: '未设置简介', color: 'gray', icon: Settings }\n    } else if (!chapter.content) {\n      return { text: '待生成内容', color: 'yellow', icon: Sparkles }\n    } else if (chapter.isAIGenerated) {\n      return { text: 'AI生成', color: 'blue', icon: Sparkles }\n    } else {\n      return { text: '已编辑', color: 'green', icon: Edit3 }\n    }\n  }\n\n  const getStatusColor = (color: string) => {\n    const colors = {\n      gray: 'bg-gray-100 text-gray-800 border-gray-200',\n      yellow: 'bg-yellow-100 text-yellow-800 border-yellow-200',\n      blue: 'bg-blue-100 text-blue-800 border-blue-200',\n      green: 'bg-green-100 text-green-800 border-green-200'\n    }\n    return colors[color as keyof typeof colors] || colors.gray\n  }\n\n  const copyChapterContent = async (chapter: Chapter) => {\n    try {\n      if (chapter.content) {\n        await navigator.clipboard.writeText(chapter.content)\n        alert('章节内容已复制到剪贴板')\n      } else {\n        alert('该章节暂无内容可复制')\n      }\n    } catch (error) {\n      alert('复制失败，请手动复制')\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* 章节统计卡片 */}\n      <div className=\"bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 text-white\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"text-lg font-semibold mb-2\">章节统计</h3>\n            <div className=\"grid grid-cols-3 gap-6\">\n              <div>\n                <div className=\"text-2xl font-bold\">{chapters.length}</div>\n                <div className=\"text-blue-100 text-sm\">总章节数</div>\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold\">\n                  {chapters.reduce((sum, chapter) => sum + calculateWordCount(chapter.content), 0)}\n                </div>\n                <div className=\"text-blue-100 text-sm\">总字数</div>\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold\">\n                  {chapters.filter(chapter => chapter.content).length}\n                </div>\n                <div className=\"text-blue-100 text-sm\">已完成</div>\n              </div>\n            </div>\n          </div>\n          <div className=\"text-6xl opacity-20\">\n            <FileText />\n          </div>\n        </div>\n      </div>\n\n      {/* 章节列表 */}\n      <div className=\"space-y-3\">\n        {chapters.map((chapter, index) => {\n          const status = getChapterStatus(chapter)\n          const StatusIcon = status.icon\n          const wordCount = calculateWordCount(chapter.content)\n          const isDragging = draggedItem?.id === chapter.id\n          const isDragOver = dragOverIndex === index\n          \n          return (\n            <div\n              key={chapter.id}\n              draggable={true}\n              onDragStart={(e) => handleDragStart(e, chapter, index)}\n              onDragOver={(e) => handleDragOver(e, index)}\n              onDragLeave={handleDragLeave}\n              onDrop={(e) => handleDrop(e, index)}\n              onDragEnd={handleDragEnd}\n              className={`bg-white rounded-xl border transition-all duration-200 overflow-hidden group ${\n                isDragging \n                  ? 'opacity-50 border-blue-400 shadow-lg' \n                  : isDragOver \n                    ? 'border-blue-400 border-t-4 shadow-lg'\n                    : 'border-gray-200 hover:border-blue-300 hover:shadow-lg'\n              }`}\n              onMouseEnter={() => setShowActions(chapter.id)}\n              onMouseLeave={() => setShowActions(null)}\n            >\n              <div className=\"p-6\">\n                <div className=\"flex items-start gap-4\">\n                  {/* 拖拽手柄 */}\n                  <div className=\"flex items-center justify-center mt-1\">\n                    <GripVertical className={`h-5 w-5 cursor-move transition-colors ${\n                      isDragging ? 'text-blue-600' : 'text-gray-400 hover:text-gray-600'\n                    }`} />\n                  </div>\n\n                  {/* 章节信息 */}\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-3 mb-2\">\n                      <span className=\"text-sm font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded\">\n                        第 {chapter.order} 章\n                      </span>\n                      <h3 className=\"text-lg font-semibold text-gray-900 truncate\">\n                        {chapter.title}\n                      </h3>\n                      <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${getStatusColor(status.color)}`}>\n                        <StatusIcon className=\"h-3 w-3\" />\n                        {status.text}\n                      </span>\n                    </div>\n\n                    {/* 章节简介 */}\n                    {chapter.summary ? (\n                      <p className=\"text-gray-600 text-sm mb-3 line-clamp-2 leading-relaxed\">\n                        {chapter.summary}\n                      </p>\n                    ) : (\n                      <div className=\"text-gray-400 text-sm mb-3 italic\">\n                        点击设置按钮添加章节简介，便于AI生成内容\n                      </div>\n                    )}\n\n                    {/* 章节信息标签 */}\n                    <div className=\"flex items-center gap-4 text-xs text-gray-500\">\n                      <span className=\"flex items-center gap-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        {new Date(chapter.updatedAt).toLocaleDateString()}\n                      </span>\n                      <span>\n                        {wordCount} 字\n                      </span>\n                      {chapter.isAIGenerated && (\n                        <span className=\"flex items-center gap-1 text-blue-600\">\n                          <Sparkles className=\"h-3 w-3\" />\n                          AI生成\n                        </span>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* 操作按钮 */}\n                  <div className={`flex items-center gap-2 transition-opacity duration-200 ${\n                    showActions === chapter.id ? 'opacity-100' : 'opacity-0'\n                  } group-hover:opacity-100`}>\n                    <button\n                      onClick={() => onView(chapter)}\n                      className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\n                      title=\"查看章节\"\n                    >\n                      <Eye className=\"h-4 w-4\" />\n                    </button>\n                    <button\n                      onClick={() => onEditSummary(chapter)}\n                      className=\"p-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors\"\n                      title=\"编辑章节信息\"\n                    >\n                      <Settings className=\"h-4 w-4\" />\n                    </button>\n                    <button\n                      onClick={() => onEditContent(chapter)}\n                      className=\"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors\"\n                      title=\"编辑内容\"\n                    >\n                      <FileText className=\"h-4 w-4\" />\n                    </button>\n                    <button\n                      onClick={() => onAIGenerate(chapter)}\n                      disabled={!chapter.summary?.trim() || generatingChapter === chapter.id}\n                      className={`p-2 rounded-lg transition-colors ${\n                        chapter.summary?.trim() && generatingChapter !== chapter.id\n                          ? 'text-purple-600 hover:bg-purple-50'\n                          : 'text-gray-300 cursor-not-allowed'\n                      }`}\n                      title=\"AI生成内容\"\n                    >\n                      {generatingChapter === chapter.id ? (\n                        <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-purple-600 border-t-transparent\" />\n                      ) : (\n                        <Sparkles className=\"h-4 w-4\" />\n                      )}\n                    </button>\n                    <button\n                      onClick={() => copyChapterContent(chapter)}\n                      className=\"p-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors\"\n                      title=\"复制内容\"\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </button>\n                    <button\n                      onClick={() => onDelete(chapter)}\n                      className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\n                      title=\"删除章节\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              {/* 进度条 */}\n              {chapter.content && (\n                <div className=\"h-1 bg-gray-100\">\n                  <div \n                    className=\"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500\"\n                    style={{ \n                      width: `${Math.min((wordCount / 2000) * 100, 100)}%` \n                    }}\n                  />\n                </div>\n              )}\n            </div>\n          )\n        })}\n      </div>\n\n      {/* 空状态 */}\n      {chapters.length === 0 && (\n        <div className=\"text-center py-12\">\n          <div className=\"text-6xl text-gray-300 mb-4\">\n            <FileText />\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">还没有章节</h3>\n          <p className=\"text-gray-600 mb-6\">开始创建你的第一个章节吧</p>\n        </div>\n      )}\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\ChapterListEnhanced.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[108,121],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Sparkles"},"fix":{"range":[121,134],"text":""},"desc":"Remove unused variable \"Sparkles\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EyeOff' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"EyeOff"},"fix":{"range":[201,211],"text":""},"desc":"Remove unused variable \"EyeOff\"."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`calculateStats` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\ChapterListEnhanced.tsx:79:5\n  77 |\n  78 |   useEffect(() => {\n> 79 |     calculateStats()\n     |     ^^^^^^^^^^^^^^ `calculateStats` accessed before it is declared\n  80 |   }, [chapters])\n  81 |\n  82 |   const calculateStats = () => {\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\ChapterListEnhanced.tsx:82:3\n   80 |   }, [chapters])\n   81 |\n>  82 |   const calculateStats = () => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  83 |     if (!chapters.length) return\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  84 |\n      …\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 107 |     })\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 108 |   }\n      | ^^^^ `calculateStats` is declared here\n  109 |\n  110 |   const filteredAndSortedChapters = chapters\n  111 |     .filter(chapter => {","line":79,"column":5,"nodeType":null,"endLine":79,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'calculateStats'. Either include it or remove the dependency array.","line":80,"column":6,"nodeType":"ArrayExpression","endLine":80,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [calculateStats, chapters]","fix":{"range":[1804,1814],"text":"[calculateStats, chapters]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":190,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":190,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":210,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":210,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":274,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8270,8273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8270,8273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":285,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8746,8749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8746,8749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":375,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[12717,12729],"text":"点击&quot;新建章节\"开始创作"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[12717,12729],"text":"点击&ldquo;新建章节\"开始创作"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[12717,12729],"text":"点击&#34;新建章节\"开始创作"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[12717,12729],"text":"点击&rdquo;新建章节\"开始创作"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":375,"column":48,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[12717,12729],"text":"点击\"新建章节&quot;开始创作"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[12717,12729],"text":"点击\"新建章节&ldquo;开始创作"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[12717,12729],"text":"点击\"新建章节&#34;开始创作"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[12717,12729],"text":"点击\"新建章节&rdquo;开始创作"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { \n  Plus, \n  Edit3, \n  Trash2, \n  FileText, \n  Settings, \n  Sparkles, \n  Clock,\n  TrendingUp,\n  Filter,\n  Search,\n  MoreVertical,\n  Eye,\n  EyeOff,\n  Copy,\n  Download,\n  ChevronDown,\n  ChevronUp,\n  Zap,\n  Target,\n  Calendar\n} from 'lucide-react'\n\ninterface Chapter {\n  id: string\n  title: string\n  summary?: string\n  content?: string\n  order: number\n  wordCount?: number\n  status: string\n  isAIGenerated?: boolean\n  createdAt: string\n  updatedAt: string\n  readingTime?: number\n}\n\ninterface ChapterStats {\n  totalWords: number\n  averageWords: number\n  longestChapter: number\n  shortestChapter: number\n  totalReadingTime: number\n  recentActivity: Array<{\n    date: string\n    wordsWritten: number\n    chaptersCreated: number\n  }>\n}\n\ninterface ChapterListEnhancedProps {\n  novelId: string\n  chapters: Chapter[]\n  onChapterReorder: (chapters: Chapter[]) => void\n  onChapterSelect: (chapter: Chapter) => void\n  onShowDetail: (chapter: Chapter) => void\n}\n\nexport default function ChapterListEnhanced({\n  novelId,\n  chapters,\n  onChapterReorder,\n  onChapterSelect,\n  onShowDetail\n}: ChapterListEnhancedProps) {\n  const [searchQuery, setSearchQuery] = useState('')\n  const [statusFilter, setStatusFilter] = useState<'all' | 'draft' | 'published' | 'archived'>('all')\n  const [sortBy, setSortBy] = useState<'order' | 'title' | 'wordCount' | 'updatedAt'>('order')\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc')\n  const [selectedChapters, setSelectedChapters] = useState<string[]>([])\n  const [draggedChapter, setDraggedChapter] = useState<Chapter | null>(null)\n  const [stats, setStats] = useState<ChapterStats | null>(null)\n  const [showFilters, setShowFilters] = useState(false)\n\n  useEffect(() => {\n    calculateStats()\n  }, [chapters])\n\n  const calculateStats = () => {\n    if (!chapters.length) return\n\n    const totalWords = chapters.reduce((sum, ch) => sum + (ch.wordCount || 0), 0)\n    const averageWords = Math.round(totalWords / chapters.length)\n    const wordCounts = chapters.map(ch => ch.wordCount || 0)\n    const longestChapter = Math.max(...wordCounts)\n    const shortestChapter = Math.min(...wordCounts)\n    const totalReadingTime = Math.round(totalWords / 200) // 假设每分钟阅读200字\n\n    // 最近活动（模拟数据）\n    const recentActivity = [\n      { date: '2024-01-15', wordsWritten: 2500, chaptersCreated: 2 },\n      { date: '2024-01-14', wordsWritten: 1800, chaptersCreated: 1 },\n      { date: '2024-01-13', wordsWritten: 3200, chaptersCreated: 3 },\n      { date: '2024-01-12', wordsWritten: 900, chaptersCreated: 0 },\n    ]\n\n    setStats({\n      totalWords,\n      averageWords,\n      longestChapter,\n      shortestChapter,\n      totalReadingTime,\n      recentActivity\n    })\n  }\n\n  const filteredAndSortedChapters = chapters\n    .filter(chapter => {\n      const matchesSearch = chapter.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n                           (chapter.summary && chapter.summary.toLowerCase().includes(searchQuery.toLowerCase()))\n      const matchesStatus = statusFilter === 'all' || chapter.status === statusFilter\n      return matchesSearch && matchesStatus\n    })\n    .sort((a, b) => {\n      let compareValue = 0\n      \n      switch (sortBy) {\n        case 'title':\n          compareValue = a.title.localeCompare(b.title)\n          break\n        case 'wordCount':\n          compareValue = (a.wordCount || 0) - (b.wordCount || 0)\n          break\n        case 'updatedAt':\n          compareValue = new Date(a.updatedAt).getTime() - new Date(b.updatedAt).getTime()\n          break\n        case 'order':\n        default:\n          compareValue = a.order - b.order\n          break\n      }\n      \n      return sortOrder === 'asc' ? compareValue : -compareValue\n    })\n\n  const handleDragStart = (e: React.DragEvent, chapter: Chapter) => {\n    setDraggedChapter(chapter)\n    e.dataTransfer.effectAllowed = 'move'\n  }\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault()\n    e.dataTransfer.dropEffect = 'move'\n  }\n\n  const handleDrop = (e: React.DragEvent, targetChapter: Chapter) => {\n    e.preventDefault()\n    if (!draggedChapter || draggedChapter.id === targetChapter.id) return\n\n    const newChapters = [...chapters]\n    const draggedIndex = newChapters.findIndex(ch => ch.id === draggedChapter.id)\n    const targetIndex = newChapters.findIndex(ch => ch.id === targetChapter.id)\n\n    newChapters.splice(draggedIndex, 1)\n    newChapters.splice(targetIndex, 0, draggedChapter)\n\n    // 重新排序\n    newChapters.forEach((chapter, index) => {\n      chapter.order = index + 1\n    })\n\n    onChapterReorder(newChapters)\n    setDraggedChapter(null)\n  }\n\n  const handleCreateChapter = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}/chapters`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: `第${chapters.length + 1}章`,\n          content: '',\n          order: chapters.length + 1\n        })\n      })\n\n      if (response.ok) {\n        window.location.reload()\n      } else {\n        alert('创建章节失败')\n      }\n    } catch (error) {\n      alert('创建章节失败')\n    }\n  }\n\n  const handleBatchDelete = async () => {\n    if (!confirm(`确定要删除选中的 ${selectedChapters.length} 个章节吗？`)) return\n\n    try {\n      const token = localStorage.getItem('token')\n      await Promise.all(\n        selectedChapters.map(chapterId =>\n          fetch(`/api/novels/${novelId}/chapters/${chapterId}`, {\n            method: 'DELETE',\n            headers: { 'Authorization': `Bearer ${token}` }\n          })\n        )\n      )\n      \n      window.location.reload()\n    } catch (error) {\n      alert('批量删除失败')\n    }\n  }\n\n  const getStatusColor = (status: Chapter['status']) => {\n    switch (status) {\n      case 'published': return 'bg-green-100 text-green-800'\n      case 'draft': return 'bg-yellow-100 text-yellow-800'\n      case 'archived': return 'bg-gray-100 text-gray-800'\n      default: return 'bg-gray-100 text-gray-800'\n    }\n  }\n\n  const getStatusText = (status: Chapter['status']) => {\n    switch (status) {\n      case 'published': return '已发布'\n      case 'draft': return '草稿'\n      case 'archived': return '已归档'\n      default: return '未知'\n    }\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-white\">\n      {/* 顶部工具栏 */}\n      <div className=\"border-b border-gray-200 p-4\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">章节管理</h2>\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setShowFilters(!showFilters)}\n              className=\"flex items-center px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors\"\n            >\n              <Filter className=\"h-4 w-4 mr-2\" />\n              筛选\n              {showFilters ? <ChevronUp className=\"h-4 w-4 ml-2\" /> : <ChevronDown className=\"h-4 w-4 ml-2\" />}\n            </button>\n            <button\n              onClick={handleCreateChapter}\n              className=\"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              新建章节\n            </button>\n          </div>\n        </div>\n\n        {/* 搜索和筛选栏 */}\n        <div className={`${showFilters ? 'block' : 'hidden'} space-y-3 mb-4`}>\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"flex-1 relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"搜索章节标题或简介...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n              />\n            </div>\n            \n            <select\n              value={statusFilter}\n              onChange={(e) => setStatusFilter(e.target.value as any)}\n              className=\"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            >\n              <option value=\"all\">全部状态</option>\n              <option value=\"draft\">草稿</option>\n              <option value=\"published\">已发布</option>\n              <option value=\"archived\">已归档</option>\n            </select>\n\n            <select\n              value={sortBy}\n              onChange={(e) => setSortBy(e.target.value as any)}\n              className=\"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            >\n              <option value=\"order\">按顺序</option>\n              <option value=\"title\">按标题</option>\n              <option value=\"wordCount\">按字数</option>\n              <option value=\"updatedAt\">按更新时间</option>\n            </select>\n\n            <button\n              onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}\n              className=\"p-2 border border-gray-300 rounded-lg hover:bg-gray-50\"\n            >\n              {sortOrder === 'asc' ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n            </button>\n          </div>\n        </div>\n\n        {/* 统计信息卡片 */}\n        {stats && (\n          <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-4\">\n            <div className=\"bg-blue-50 p-3 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <FileText className=\"h-4 w-4 text-blue-600\" />\n                <span className=\"text-xs text-blue-600\">总字数</span>\n              </div>\n              <p className=\"text-lg font-semibold text-blue-900 mt-1\">\n                {stats.totalWords.toLocaleString()}\n              </p>\n            </div>\n            \n            <div className=\"bg-green-50 p-3 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <TrendingUp className=\"h-4 w-4 text-green-600\" />\n                <span className=\"text-xs text-green-600\">平均字数</span>\n              </div>\n              <p className=\"text-lg font-semibold text-green-900 mt-1\">\n                {stats.averageWords.toLocaleString()}\n              </p>\n            </div>\n            \n            <div className=\"bg-purple-50 p-3 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <Target className=\"h-4 w-4 text-purple-600\" />\n                <span className=\"text-xs text-purple-600\">最长章节</span>\n              </div>\n              <p className=\"text-lg font-semibold text-purple-900 mt-1\">\n                {stats.longestChapter.toLocaleString()}\n              </p>\n            </div>\n            \n            <div className=\"bg-yellow-50 p-3 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <Clock className=\"h-4 w-4 text-yellow-600\" />\n                <span className=\"text-xs text-yellow-600\">阅读时间</span>\n              </div>\n              <p className=\"text-lg font-semibold text-yellow-900 mt-1\">\n                {stats.totalReadingTime}分钟\n              </p>\n            </div>\n            \n            <div className=\"bg-indigo-50 p-3 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <Calendar className=\"h-4 w-4 text-indigo-600\" />\n                <span className=\"text-xs text-indigo-600\">今日写作</span>\n              </div>\n              <p className=\"text-lg font-semibold text-indigo-900 mt-1\">\n                {stats.recentActivity[0]?.wordsWritten || 0}\n              </p>\n            </div>\n            \n            <div className=\"bg-red-50 p-3 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <Zap className=\"h-4 w-4 text-red-600\" />\n                <span className=\"text-xs text-red-600\">活跃天数</span>\n              </div>\n              <p className=\"text-lg font-semibold text-red-900 mt-1\">\n                {stats.recentActivity.length}\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* 章节列表 */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {filteredAndSortedChapters.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-500\">\n            <FileText className=\"h-16 w-16 mb-4 text-gray-300\" />\n            <p className=\"text-lg font-medium mb-2\">暂无章节</p>\n            <p className=\"text-sm mb-4\">点击\"新建章节\"开始创作</p>\n            <button\n              onClick={handleCreateChapter}\n              className=\"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              创建第一个章节\n            </button>\n          </div>\n        ) : (\n          <div className=\"p-4 space-y-3\">\n            {/* 批量操作栏 */}\n            {selectedChapters.length > 0 && (\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center justify-between\">\n                <span className=\"text-sm text-blue-800\">\n                  已选择 {selectedChapters.length} 个章节\n                </span>\n                <div className=\"flex items-center space-x-2\">\n                  <button className=\"text-sm text-blue-600 hover:text-blue-800\">\n                    <Copy className=\"h-4 w-4\" />\n                  </button>\n                  <button className=\"text-sm text-blue-600 hover:text-blue-800\">\n                    <Download className=\"h-4 w-4\" />\n                  </button>\n                  <button\n                    onClick={handleBatchDelete}\n                    className=\"text-sm text-red-600 hover:text-red-800\"\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* 章节卡片 */}\n            {filteredAndSortedChapters.map((chapter) => (\n              <div\n                key={chapter.id}\n                draggable\n                onDragStart={(e) => handleDragStart(e, chapter)}\n                onDragOver={handleDragOver}\n                onDrop={(e) => handleDrop(e, chapter)}\n                className={`bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-move ${\n                  draggedChapter?.id === chapter.id ? 'opacity-50' : ''\n                }`}\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-3 mb-2\">\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedChapters.includes(chapter.id)}\n                        onChange={(e) => {\n                          if (e.target.checked) {\n                            setSelectedChapters([...selectedChapters, chapter.id])\n                          } else {\n                            setSelectedChapters(selectedChapters.filter(id => id !== chapter.id))\n                          }\n                        }}\n                        className=\"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                      />\n                      <h3 className=\"text-lg font-medium text-gray-900\">\n                        {chapter.title}\n                      </h3>\n                      <span className={`px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(chapter.status)}`}>\n                        {getStatusText(chapter.status)}\n                      </span>\n                      {chapter.isAIGenerated && (\n                        <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800\">\n                          AI生成\n                        </span>\n                      )}\n                    </div>\n                    \n                    {chapter.summary && (\n                      <p className=\"text-sm text-gray-600 mb-3 line-clamp-2\">\n                        {chapter.summary}\n                      </p>\n                    )}\n                    \n                    <div className=\"flex items-center space-x-4 text-xs text-gray-500\">\n                      <div className=\"flex items-center\">\n                        <FileText className=\"h-3 w-3 mr-1\" />\n                        {chapter.wordCount || 0} 字\n                      </div>\n                      <div className=\"flex items-center\">\n                        <Clock className=\"h-3 w-3 mr-1\" />\n                        {chapter.readingTime || Math.ceil((chapter.wordCount || 0) / 200)} 分钟\n                      </div>\n                      <div className=\"flex items-center\">\n                        <Calendar className=\"h-3 w-3 mr-1\" />\n                        {new Date(chapter.updatedAt).toLocaleDateString()}\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-1 ml-4\">\n                    <button\n                      onClick={() => onChapterSelect(chapter)}\n                      className=\"p-2 text-gray-400 hover:text-indigo-600 transition-colors\"\n                    >\n                      <Edit3 className=\"h-4 w-4\" />\n                    </button>\n                    <button\n                      onClick={() => onShowDetail(chapter)}\n                      className=\"p-2 text-gray-400 hover:text-blue-600 transition-colors\"\n                    >\n                      <Eye className=\"h-4 w-4\" />\n                    </button>\n                    <button className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors\">\n                      <MoreVertical className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\DashboardHome.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[116,131],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[215,224],"text":""},"desc":"Remove unused variable \"Users\"."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchDashboardData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\DashboardHome.tsx:40:5\n  38 |\n  39 |   useEffect(() => {\n> 40 |     fetchDashboardData()\n     |     ^^^^^^^^^^^^^^^^^^ `fetchDashboardData` accessed before it is declared\n  41 |   }, [])\n  42 |\n  43 |   const fetchDashboardData = async () => {\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\DashboardHome.tsx:43:3\n  41 |   }, [])\n  42 |\n> 43 |   const fetchDashboardData = async () => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |     try {\n     | ^^^^^^^^^\n> 45 |       const token = localStorage.getItem('token')\n     …\n     | ^^^^^^^^^\n> 75 |     }\n     | ^^^^^^^^^\n> 76 |   }\n     | ^^^^ `fetchDashboardData` is declared here\n  77 |\n  78 |   const getProgressPercentage = (current: number, goal: number) => {\n  79 |     return Math.min((current / goal) * 100, 100)","line":40,"column":5,"nodeType":null,"endLine":40,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":298,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11113,11116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11113,11116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { \n  BookOpen, \n  Plus, \n  TrendingUp, \n  Clock, \n  Target, \n  Zap, \n  FileText,\n  Edit3,\n  BarChart3,\n  Star,\n  Calendar,\n  Users,\n  Brain\n} from 'lucide-react'\n\nexport default function DashboardHome() {\n  const [stats, setStats] = useState({\n    totalNovels: 0,\n    totalChapters: 0,\n    totalWords: 0,\n    recentNovels: [],\n    todayWords: 0,\n    weekWords: 0,\n    streakDays: 0,\n    writingGoals: {\n      daily: 2000,\n      weekly: 10000\n    }\n  })\n\n  const [loading, setLoading] = useState(true)\n  const [aiTips, setAiTips] = useState<string[]>([])\n\n  useEffect(() => {\n    fetchDashboardData()\n  }, [])\n\n  const fetchDashboardData = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      \n      // 获取基础统计数据\n      const statsResponse = await fetch('/api/user/stats', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (statsResponse.ok) {\n        const data = await statsResponse.json()\n        setStats(prev => ({\n          ...prev,\n          ...data\n        }))\n      }\n\n      // 生成AI写作建议\n      setAiTips([\n        \"尝试设定固定的写作时间，养成创作习惯\",\n        \"大纲是小说的骨架，先构建好框架再填充细节\",\n        \"人物塑造要立体，给角色设定明确的动机和目标\",\n        \"多读优秀作品，学习他人的写作技巧和结构安排\",\n        \"每天坚持写作，即使只是几百字也很重要\"\n      ])\n\n      setLoading(false)\n    } catch (error) {\n      console.error('获取数据失败:', error)\n      setLoading(false)\n    }\n  }\n\n  const getProgressPercentage = (current: number, goal: number) => {\n    return Math.min((current / goal) * 100, 100)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-gray-200 rounded w-2/3\"></div>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {[1, 2, 3].map(i => (\n            <div key={i} className=\"bg-white p-6 rounded-lg shadow animate-pulse\">\n              <div className=\"h-4 bg-gray-200 rounded w-1/2 mb-2\"></div>\n              <div className=\"h-8 bg-gray-200 rounded w-3/4\"></div>\n            </div>\n          ))}\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 欢迎横幅 */}\n      <div className=\"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\">欢迎回到创作中心</h1>\n            <p className=\"text-indigo-100\">\n              今天又是充满灵感的一天，让我们一起创作精彩的故事\n            </p>\n          </div>\n          <div className=\"hidden md:flex items-center space-x-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\">{stats.todayWords.toLocaleString()}</div>\n              <div className=\"text-sm text-indigo-100\">今日字数</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\">{stats.streakDays}</div>\n              <div className=\"text-sm text-indigo-100\">连续天数</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 核心统计数据 */}\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4\">\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0 bg-blue-100 rounded-lg p-3\">\n                <BookOpen className=\"h-6 w-6 text-blue-600\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-500\">作品数量</p>\n                <p className=\"text-2xl font-semibold text-gray-900\">{stats.totalNovels}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0 bg-green-100 rounded-lg p-3\">\n                <FileText className=\"h-6 w-6 text-green-600\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-500\">章节总数</p>\n                <p className=\"text-2xl font-semibold text-gray-900\">{stats.totalChapters}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0 bg-purple-100 rounded-lg p-3\">\n                <Edit3 className=\"h-6 w-6 text-purple-600\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-500\">总字数</p>\n                <p className=\"text-2xl font-semibold text-gray-900\">{stats.totalWords.toLocaleString()}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0 bg-orange-100 rounded-lg p-3\">\n                <Target className=\"h-6 w-6 text-orange-600\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm font-medium text-gray-500\">本周字数</p>\n                <p className=\"text-2xl font-semibold text-gray-900\">{stats.weekWords.toLocaleString()}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* 快速操作面板 */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* 写作目标进度 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Target className=\"h-5 w-5 mr-2 text-indigo-600\" />\n              写作目标\n            </h3>\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span className=\"text-gray-600\">今日目标</span>\n                  <span className=\"font-medium\">{stats.todayWords} / {stats.writingGoals.daily}</span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                  <div \n                    className=\"bg-indigo-600 h-2 rounded-full transition-all duration-300\"\n                    style={{ width: `${getProgressPercentage(stats.todayWords, stats.writingGoals.daily)}%` }}\n                  ></div>\n                </div>\n              </div>\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span className=\"text-gray-600\">本周目标</span>\n                  <span className=\"font-medium\">{stats.weekWords} / {stats.writingGoals.weekly}</span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                  <div \n                    className=\"bg-green-600 h-2 rounded-full transition-all duration-300\"\n                    style={{ width: `${getProgressPercentage(stats.weekWords, stats.writingGoals.weekly)}%` }}\n                  ></div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* 快速操作 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Zap className=\"h-5 w-5 mr-2 text-yellow-500\" />\n              快速操作\n            </h3>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n              <Link\n                href=\"/dashboard/novels/create\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-indigo-100 rounded-lg p-2 group-hover:bg-indigo-200\">\n                  <Plus className=\"h-6 w-6 text-indigo-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"font-medium text-gray-900\">创建新小说</p>\n                  <p className=\"text-sm text-gray-500\">开始新的创作之旅</p>\n                </div>\n              </Link>\n\n              <Link\n                href=\"/dashboard/novels\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-green-100 rounded-lg p-2 group-hover:bg-green-200\">\n                  <BookOpen className=\"h-6 w-6 text-green-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"font-medium text-gray-900\">我的作品</p>\n                  <p className=\"text-sm text-gray-500\">管理和编辑小说</p>\n                </div>\n              </Link>\n\n              <Link\n                href=\"/dashboard/ai-workshop\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-purple-100 rounded-lg p-2 group-hover:bg-purple-200\">\n                  <Brain className=\"h-6 w-6 text-purple-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"font-medium text-gray-900\">AI助手</p>\n                  <p className=\"text-sm text-gray-500\">获取创作灵感</p>\n                </div>\n              </Link>\n\n              <Link\n                href=\"/dashboard/settings\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-orange-100 rounded-lg p-2 group-hover:bg-orange-200\">\n                  <BarChart3 className=\"h-6 w-6 text-orange-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"font-medium text-gray-900\">数据分析</p>\n                  <p className=\"text-sm text-gray-500\">查看创作统计</p>\n                </div>\n              </Link>\n            </div>\n          </div>\n\n          {/* 最近作品 */}\n          {stats.recentNovels && stats.recentNovels.length > 0 && (\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-semibold text-gray-900 flex items-center\">\n                  <Clock className=\"h-5 w-5 mr-2 text-blue-600\" />\n                  最近编辑\n                </h3>\n                <Link\n                  href=\"/dashboard/novels\"\n                  className=\"text-sm text-indigo-600 hover:text-indigo-800\"\n                >\n                  查看全部\n                </Link>\n              </div>\n              <div className=\"space-y-3\">\n                {stats.recentNovels.slice(0, 3).map((novel: any) => (\n                  <Link\n                    key={novel.id}\n                    href={`/dashboard/novels/${novel.id}`}\n                    className=\"block p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\"\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-base font-medium text-gray-900 truncate\">{novel.title}</p>\n                        <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\n                          {novel.description || '暂无描述'}\n                        </p>\n                      </div>\n                      <div className=\"ml-4 flex-shrink-0 text-right\">\n                        <p className=\"text-sm text-gray-500\">\n                          {new Date(novel.updatedAt).toLocaleDateString()}\n                        </p>\n                        <div className=\"flex items-center mt-1\">\n                          <Star className=\"h-4 w-4 text-yellow-400 fill-current\" />\n                          <span className=\"text-xs text-gray-500 ml-1\">进行中</span>\n                        </div>\n                      </div>\n                    </div>\n                  </Link>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* 右侧面板 */}\n        <div className=\"space-y-6\">\n          {/* AI写作建议 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Brain className=\"h-5 w-5 mr-2 text-purple-600\" />\n              AI写作建议\n            </h3>\n            <div className=\"space-y-3\">\n              {aiTips.map((tip, index) => (\n                <div key={index} className=\"flex items-start\">\n                  <div className=\"flex-shrink-0 w-2 h-2 bg-purple-400 rounded-full mt-2\"></div>\n                  <p className=\"ml-3 text-sm text-gray-600 leading-relaxed\">{tip}</p>\n                </div>\n              ))}\n            </div>\n            <div className=\"mt-4 pt-4 border-t border-gray-200\">\n              <Link\n                href=\"/dashboard/ai-workshop\"\n                className=\"flex items-center text-sm text-purple-600 hover:text-purple-800 font-medium\"\n              >\n                获取更多灵感\n                <svg className=\"ml-1 h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </Link>\n            </div>\n          </div>\n\n          {/* 创作日历 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Calendar className=\"h-5 w-5 mr-2 text-indigo-600\" />\n              创作记录\n            </h3>\n            <div className=\"text-center py-4\">\n              <div className=\"text-3xl font-bold text-indigo-600\">{stats.streakDays}</div>\n              <p className=\"text-sm text-gray-500 mt-1\">连续创作天数</p>\n              <div className=\"mt-4 flex justify-center\">\n                <div className=\"flex space-x-1\">\n                  {[1, 2, 3, 4, 5, 6, 7].map((day) => (\n                    <div\n                      key={day}\n                      className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium ${\n                        day <= 3 \n                          ? 'bg-green-100 text-green-800' \n                          : 'bg-gray-100 text-gray-500'\n                      }`}\n                    >\n                      {day <= 3 ? '✓' : day}\n                    </div>\n                  ))}\n                </div>\n              </div>\n              <p className=\"text-xs text-gray-400 mt-3\">最近7天创作情况</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\EnhancedChapterWorkspace.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useCallback"},"fix":{"range":[50,63],"text":""},"desc":"Remove unused variable \"useCallback\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BookOpen' is defined but never used.","line":5,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BookOpen"},"fix":{"range":[91,100],"text":""},"desc":"Remove unused variable \"BookOpen\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used.","line":7,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Save"},"fix":{"range":[113,122],"text":""},"desc":"Remove unused variable \"Save\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EyeOff' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"EyeOff"},"fix":{"range":[144,155],"text":""},"desc":"Remove unused variable \"EyeOff\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[155,167],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":31,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Target"},"fix":{"range":[361,371],"text":""},"desc":"Remove unused variable \"Target\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":32,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Zap"},"fix":{"range":[371,378],"text":""},"desc":"Remove unused variable \"Zap\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used.","line":34,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MessageSquare"},"fix":{"range":[391,408],"text":""},"desc":"Remove unused variable \"MessageSquare\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Maximize2' is defined but never used.","line":37,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Maximize2"},"fix":{"range":[433,446],"text":""},"desc":"Remove unused variable \"Maximize2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Minimize2' is defined but never used.","line":38,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Minimize2"},"fix":{"range":[446,459],"text":""},"desc":"Remove unused variable \"Minimize2\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1260,1263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1260,1263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":81,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":81,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":113,"column":6,"nodeType":"ArrayExpression","endLine":113,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [novelId, chapterId, loadData]","fix":{"range":[2845,2865],"text":"[novelId, chapterId, loadData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleSave' and 'saving'. Either include them or remove the dependency array.","line":199,"column":6,"nodeType":"ArrayExpression","endLine":199,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [hasChanges, content, saving, handleSave]","fix":{"range":[5306,5327],"text":"[hasChanges, content, saving, handleSave]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSave'. Either include it or remove the dependency array.","line":214,"column":6,"nodeType":"ArrayExpression","endLine":214,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [handleSave, showChapterSettings]","fix":{"range":[5757,5778],"text":"[handleSave, showChapterSettings]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":414,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":414,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":479,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":479,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef, useCallback } from 'react'\nimport { \n  BookOpen, \n  ArrowLeft, \n  Save, \n  RefreshCw, \n  Eye, \n  EyeOff,\n  Settings,\n  X,\n  ChevronRight,\n  ChevronDown,\n  Type,\n  Clock,\n  Sparkles,\n  FileText,\n  Layers,\n  Users,\n  Globe,\n  Menu,\n  Plus,\n  Edit3,\n  Trash2,\n  Copy,\n  MoveUp,\n  MoveDown,\n  GripVertical,\n  Hash,\n  Target,\n  Zap,\n  Lightbulb,\n  MessageSquare,\n  MoreVertical,\n  Check,\n  Maximize2,\n  Minimize2,\n  Quote\n} from 'lucide-react'\nimport { useParams, useRouter } from 'next/navigation'\n\ninterface Chapter {\n  id: string\n  title: string\n  summary?: string\n  content?: string\n  isAIGenerated?: boolean\n  order: number\n  createdAt: string\n  updatedAt: string\n  wordCount?: number\n  status?: string\n}\n\ninterface Character {\n  id: string\n  name: string\n  description?: string\n}\n\ninterface WorldSetting {\n  id: string\n  name: string\n  description?: string\n}\n\nexport default function EnhancedChapterWorkspace() {\n  const params = useParams()\n  const router = useRouter()\n  const novelId = typeof params.id === 'string' ? params.id : Array.isArray(params.id) ? params.id[0] : ''\n  const chapterId = typeof params.chapterId === 'string' ? params.chapterId : ''\n\n  // 核心状态\n  const [novel, setNovel] = useState<any>(null)\n  const [chapters, setChapters] = useState<Chapter[]>([])\n  const [currentChapter, setCurrentChapter] = useState<Chapter | null>(null)\n  const [characters, setCharacters] = useState<Character[]>([])\n  const [worldSettings, setWorldSettings] = useState<WorldSetting[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n\n  // 编辑器状态\n  const [content, setContent] = useState('')\n  const [hasChanges, setHasChanges] = useState(false)\n  const [saving, setSaving] = useState(false)\n  const [lastSaved, setLastSaved] = useState<Date | null>(null)\n  const [wordCount, setWordCount] = useState(0)\n  const [viewMode, setViewMode] = useState<'edit' | 'preview'>('edit')\n\n  // UI状态\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false)\n  const [rightPanelCollapsed, setRightPanelCollapsed] = useState(false)\n  const [rightPanelTab, setRightPanelTab] = useState<'outline' | 'characters' | 'world' | 'ai'>('ai')\n  const [showChapterSettings, setShowChapterSettings] = useState<string | null>(null)\n\n  // AI生成状态\n  const [generating, setGenerating] = useState(false)\n  const [aiPrompt, setAiPrompt] = useState('')\n\n  // 编辑状态\n  const [editingChapterId, setEditingChapterId] = useState<string | null>(null)\n  const [editTitle, setEditTitle] = useState('')\n  const [editSummary, setEditSummary] = useState('')\n  const [showEditModal, setShowEditModal] = useState(false)\n  \n  const autoSaveTimer = useRef<NodeJS.Timeout | null>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n\n  // 加载数据\n  useEffect(() => {\n    loadData()\n  }, [novelId, chapterId])\n\n  // 加载所有数据\n  const loadData = async () => {\n    setLoading(true)\n    try {\n      const token = localStorage.getItem('token')\n      \n      // 并行加载小说和章节\n      const [novelRes, chaptersRes, charactersRes, worldRes] = await Promise.all([\n        fetch(`/api/novels/${novelId}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        }),\n        fetch(`/api/novels/${novelId}/chapters`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        }),\n        fetch(`/api/novels/${novelId}/characters`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        }).catch(() => ({ ok: true, json: async () => ({ characters: [] }) })),\n        fetch(`/api/novels/${novelId}/world-settings`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        }).catch(() => ({ ok: true, json: async () => ({ settings: [] }) }))\n      ])\n\n      if (novelRes.ok) {\n        const novelData = await novelRes.json()\n        setNovel(novelData.novel)\n      }\n\n      if (chaptersRes.ok) {\n        const chaptersData = await chaptersRes.json()\n        setChapters(chaptersData.chapters || [])\n      }\n\n      if (charactersRes.ok) {\n        const charsData = await charactersRes.json()\n        setCharacters(charsData.characters || [])\n      }\n\n      if (worldRes.ok) {\n        const worldData = await worldRes.json()\n        setWorldSettings(worldData.settings || [])\n      }\n\n      // 加载当前章节\n      if (chapterId) {\n        const chapterRes = await fetch(`/api/novels/${novelId}/chapters/${chapterId}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        })\n        if (chapterRes.ok) {\n          const chapterData = await chapterRes.json()\n          setCurrentChapter(chapterData.chapter)\n          setContent(chapterData.chapter.content || '')\n          setWordCount(chapterData.chapter.content?.length || 0)\n        }\n      }\n    } catch (err) {\n      setError('加载数据失败')\n      console.error(err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // 字数统计\n  useEffect(() => {\n    setWordCount(content.replace(/\\s/g, '').length)\n  }, [content])\n\n  // 自动保存\n  useEffect(() => {\n    if (autoSaveTimer.current) {\n      clearTimeout(autoSaveTimer.current)\n    }\n    \n    if (hasChanges && !saving) {\n      autoSaveTimer.current = setTimeout(() => {\n        handleSave()\n      }, 3000)\n    }\n\n    return () => {\n      if (autoSaveTimer.current) {\n        clearTimeout(autoSaveTimer.current)\n      }\n    }\n  }, [hasChanges, content])\n\n  // 键盘快捷键\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n        e.preventDefault()\n        handleSave()\n      }\n      if (e.key === 'Escape' && showChapterSettings) {\n        setShowChapterSettings(null)\n      }\n    }\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [showChapterSettings])\n\n  const handleSave = async () => {\n    if (!currentChapter || saving) return\n    \n    setSaving(true)\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}/chapters/${currentChapter.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: currentChapter.title,\n          summary: currentChapter.summary,\n          content: content\n        })\n      })\n\n      if (response.ok) {\n        setHasChanges(false)\n        setLastSaved(new Date())\n        // 更新章节列表中的字数\n        setChapters(prev => prev.map(ch => \n          ch.id === currentChapter.id \n            ? { ...ch, content, wordCount: content.length }\n            : ch\n        ))\n      }\n    } catch (err) {\n      console.error('保存失败:', err)\n      alert('保存失败，请重试')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleContentChange = (value: string) => {\n    setContent(value)\n    setHasChanges(true)\n  }\n\n  const handleSelectChapter = (chapter: Chapter) => {\n    router.push(`/dashboard/novels/${novelId}/chapters/${chapter.id}`)\n  }\n\n  const handleAIGenerate = async () => {\n    if (!currentChapter?.summary?.trim()) {\n      alert('请先设置章节简介，以便AI生成内容')\n      return\n    }\n\n    if (content && content.trim() && !confirm('当前章节已有内容，AI生成将覆盖。是否继续？')) {\n      return\n    }\n\n    setGenerating(true)\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/ai/generate-chapter', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          novelId,\n          chapterId: currentChapter.id,\n          prompt: aiPrompt || currentChapter.summary\n        })\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        setContent(data.content)\n        setHasChanges(true)\n      } else {\n        const errorData = await response.json()\n        alert(errorData.error || 'AI生成失败')\n      }\n    } catch (err) {\n      console.error('AI生成失败:', err)\n      alert('AI生成失败，请重试')\n    } finally {\n      setGenerating(false)\n    }\n  }\n\n  const handleCreateChapter = async () => {\n    if (!novelId) {\n      alert('小说ID无效，无法创建章节')\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      if (!token) {\n        alert('请先登录')\n        return\n      }\n\n      const newChapterData = {\n        title: `第 ${chapters.length + 1} 章`,\n        summary: '',\n        order: chapters.length + 1\n      }\n\n      console.log('Creating chapter with data:', newChapterData)\n      \n      const response = await fetch(`/api/novels/${novelId}/chapters`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(newChapterData)\n      })\n\n      const responseData = await response.json()\n      console.log('Create chapter response:', responseData)\n\n      if (response.ok) {\n        const newChapter = responseData.chapter\n        setChapters(prev => [...prev, newChapter])\n        \n        // 更新当前章节\n        setCurrentChapter(newChapter)\n        setContent('')\n        setHasChanges(false)\n        \n        // 切换到新章节的编辑页面\n        router.push(`/dashboard/novels/${novelId}/chapters/${newChapter.id}`)\n        \n        alert('章节创建成功！')\n      } else {\n        console.error('Create chapter failed:', responseData)\n        alert(responseData.error || '创建章节失败')\n      }\n    } catch (err) {\n      console.error('创建章节异常:', err)\n      alert('创建章节失败，请重试')\n    }\n  }\n\n  const handleDeleteChapter = async (chapter: Chapter) => {\n    if (!confirm(`确定要删除\"${chapter.title}\"吗？删除后无法恢复！`)) return\n    \n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}/chapters/${chapter.id}`, {\n        method: 'DELETE',\n        headers: { 'Authorization': `Bearer ${token}` }\n      })\n\n      if (response.ok) {\n        setChapters(prev => prev.filter(ch => ch.id !== chapter.id))\n        if (currentChapter?.id === chapter.id) {\n          setCurrentChapter(null)\n          setContent('')\n          router.push(`/dashboard/novels/${novelId}`)\n        }\n        alert('章节已删除')\n      } else {\n        const errorData = await response.json()\n        alert(errorData.error || '删除失败')\n      }\n    } catch (err) {\n      console.error('删除章节失败:', err)\n      alert('删除失败，请重试')\n    }\n  }\n\n  const handleEditChapter = (chapter: Chapter) => {\n    setEditingChapterId(chapter.id)\n    setEditTitle(chapter.title)\n    setEditSummary(chapter.summary || '')\n    setShowEditModal(true)\n  }\n\n  const handleSaveChapterInfo = async () => {\n    if (!editingChapterId) return\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}/chapters/${editingChapterId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: editTitle,\n          summary: editSummary,\n          content: chapters.find(ch => ch.id === editingChapterId)?.content\n        })\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        setChapters(prev => prev.map(ch => \n          ch.id === editingChapterId \n            ? { ...ch, title: editTitle, summary: editSummary }\n            : ch\n        ))\n        if (currentChapter?.id === editingChapterId) {\n          setCurrentChapter(prev => prev ? { ...prev, title: editTitle, summary: editSummary } : null)\n        }\n        setShowEditModal(false)\n        setEditingChapterId(null)\n        alert('章节信息已更新')\n      } else {\n        const errorData = await response.json()\n        alert(errorData.error || '更新失败')\n      }\n    } catch (err) {\n      console.error('更新章节失败:', err)\n      alert('更新失败，请重试')\n    }\n  }\n\n  const handleMoveChapter = async (chapter: Chapter, direction: 'up' | 'down') => {\n    const currentIndex = chapters.findIndex(ch => ch.id === chapter.id)\n    if (currentIndex === -1) return\n\n    const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1\n    if (newIndex < 0 || newIndex >= chapters.length) return\n\n    try {\n      const token = localStorage.getItem('token')\n      const reorderedChapters = [...chapters]\n      const [movedChapter] = reorderedChapters.splice(currentIndex, 1)\n      reorderedChapters.splice(newIndex, 0, movedChapter)\n\n      // 更新所有章节的顺序\n      const chaptersWithNewOrder = reorderedChapters.map((ch, index) => ({\n        id: ch.id,\n        order: index + 1\n      }))\n\n      const response = await fetch(`/api/novels/${novelId}/chapters/reorder`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ chapters: chaptersWithNewOrder })\n      })\n\n      if (response.ok) {\n        setChapters(reorderedChapters.map((ch, index) => ({ ...ch, order: index + 1 })))\n      } else {\n        alert('排序失败')\n      }\n    } catch (err) {\n      console.error('章节排序失败:', err)\n      alert('排序失败，请重试')\n    }\n  }\n\n  const handleCopyChapter = async (chapter: Chapter) => {\n    try {\n      await navigator.clipboard.writeText(chapter.content || '')\n      alert('内容已复制到剪贴板')\n    } catch (err) {\n      alert('复制失败')\n    }\n  }\n\n  const insertFormatting = (before: string, after: string = '') => {\n    const textarea = textareaRef.current\n    if (!textarea) return\n\n    const start = textarea.selectionStart\n    const end = textarea.selectionEnd\n    const selectedText = textarea.value.substring(start, end)\n    const newText = before + selectedText + after\n\n    const newContent = \n      textarea.value.substring(0, start) + \n      newText + \n      textarea.value.substring(end)\n\n    handleContentChange(newContent)\n\n    setTimeout(() => {\n      textarea.focus()\n      textarea.setSelectionRange(\n        start + before.length,\n        start + before.length + selectedText.length\n      )\n    }, 0)\n  }\n\n  const insertChapterTitle = (level: 1 | 2 | 3) => {\n    const prefix = '#'.repeat(level)\n    insertFormatting(`\\n${prefix} `, '\\n')\n  }\n\n  const insertSeparator = () => {\n    insertFormatting('\\n\\n---\\n\\n', '')\n  }\n\n  const clearContent = () => {\n    if (content && confirm('确定要清空所有内容吗？此操作无法撤销。')) {\n      handleContentChange('')\n    }\n  }\n\n  const renderMarkdown = (text: string) => {\n    if (!text) return ''\n    \n    const html = text\n      .replace(/\\*\\*(.*?)\\*\\*/g, '<strong class=\"font-bold\">$1</strong>')\n      .replace(/\\*(.*?)\\*/g, '<em class=\"italic\">$1</em>')\n      .replace(/\\n\\n/g, '</p><p class=\"mb-4\">')\n      .replace(/\\n/g, '<br>')\n      .replace(/^> (.*?)$/gm, '<blockquote class=\"border-l-4 border-gray-300 pl-4 italic my-4\">$1</blockquote>')\n      .replace(/^- (.*?)$/gm, '<li class=\"ml-4\">• $1</li>')\n      .replace(/^\\d+\\. (.*?)$/gm, '<li class=\"ml-4 list-decimal\">$1</li>')\n\n    return `<p class=\"mb-4\">${html}</p>`\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">正在加载...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col bg-gray-50\">\n      {/* 顶部工具栏 */}\n      <header className=\"bg-white border-b border-gray-200 px-6 py-3 flex items-center justify-between shadow-sm\">\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={() => router.back()}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors group\"\n            title=\"返回\"\n          >\n            <ArrowLeft className=\"h-5 w-5 text-gray-500 group-hover:text-gray-700 transition-colors\" />\n          </button>\n          <div className=\"h-6 w-px bg-gray-200\"></div>\n          <div>\n            <h1 className=\"text-lg font-semibold text-gray-900\">{novel?.title || '小说'}</h1>\n            {currentChapter ? (\n              <div className=\"flex items-center gap-2\">\n                <p className=\"text-sm text-gray-500\">{currentChapter.title}</p>\n                <span className=\"w-1 h-1 bg-gray-300 rounded-full\"></span>\n                <span className=\"text-xs text-gray-400\">第{currentChapter.order}章</span>\n              </div>\n            ) : (\n              <p className=\"text-sm text-gray-400\">未选择章节</p>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          {/* 编辑模式切换 */}\n          <div className=\"flex items-center bg-gray-100 rounded-lg p-0.5 shadow-inner\">\n            <button\n              onClick={() => setViewMode('edit')}\n              className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${\n                viewMode === 'edit' \n                  ? 'bg-white text-gray-900 shadow-sm' \n                  : 'text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <Edit3 className=\"h-4 w-4 mr-1.5 inline\" />\n              编辑\n            </button>\n            <button\n              onClick={() => setViewMode('preview')}\n              className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${\n                viewMode === 'preview' \n                  ? 'bg-white text-gray-900 shadow-sm' \n                  : 'text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <Eye className=\"h-4 w-4 mr-1.5 inline\" />\n              预览\n            </button>\n          </div>\n\n          <div className=\"h-6 w-px bg-gray-200\"></div>\n\n          {/* 字数统计 */}\n          <div className=\"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 rounded-lg border border-blue-100\">\n            <Type className=\"h-4 w-4\" />\n            <span className=\"text-sm font-semibold\">{wordCount.toLocaleString()}</span>\n            <span className=\"text-xs text-blue-500\">字</span>\n          </div>\n\n          {/* 保存状态 */}\n          <div className={`flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all ${\n            saving \n              ? 'bg-yellow-50 border-yellow-200 text-yellow-700'\n              : hasChanges\n                ? 'bg-orange-50 border-orange-200 text-orange-700'\n                : 'bg-green-50 border-green-200 text-green-700'\n          }`}>\n            {saving ? (\n              <>\n                <RefreshCw className=\"h-4 w-4 animate-spin\" />\n                <span className=\"text-sm font-medium\">保存中...</span>\n              </>\n            ) : hasChanges ? (\n              <>\n                <Clock className=\"h-4 w-4\" />\n                <span className=\"text-sm font-medium\">未保存</span>\n              </>\n            ) : (\n              <>\n                <Check className=\"h-4 w-4\" />\n                <span className=\"text-sm font-medium\">已保存</span>\n              </>\n            )}\n          </div>\n\n          {/* 保存按钮 */}\n          <button\n            onClick={handleSave}\n            disabled={!hasChanges || saving}\n            className={`px-5 py-2 rounded-lg font-medium transition-all shadow-sm ${\n              hasChanges && !saving\n                ? 'bg-gradient-to-r from-indigo-600 to-indigo-700 text-white hover:from-indigo-700 hover:to-indigo-800 hover:shadow-md'\n                : 'bg-gray-100 text-gray-400 cursor-not-allowed'\n            }`}\n          >\n            {saving ? '保存中...' : '保存'}\n          </button>\n        </div>\n      </header>\n\n      {/* 主内容区 */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* 左侧章节列表 */}\n        <div className={`${sidebarCollapsed ? 'w-16' : 'w-72'} bg-gradient-to-b from-white to-gray-50 border-r border-gray-200 flex flex-col transition-all duration-300`}>\n          {/* 侧边栏头部 */}\n          <div className=\"p-4 border-b border-gray-200 flex items-center justify-between bg-white\">\n            {!sidebarCollapsed && (\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center\">\n                  <FileText className=\"h-4 w-4 text-indigo-600\" />\n                </div>\n                <div>\n                  <h2 className=\"font-semibold text-gray-900 text-sm\">章节列表</h2>\n                  <p className=\"text-xs text-gray-500\">共 {chapters.length} 章</p>\n                </div>\n              </div>\n            )}\n            <button\n              onClick={() => setSidebarCollapsed(!sidebarCollapsed)}\n              className=\"p-1.5 hover:bg-gray-100 rounded-lg transition-colors\"\n              title={sidebarCollapsed ? '展开' : '折叠'}\n            >\n              {sidebarCollapsed ? <ChevronRight className=\"h-4 w-4 text-gray-500\" /> : <Menu className=\"h-4 w-4 text-gray-500\" />}\n            </button>\n          </div>\n\n          {/* 章节统计 */}\n          {!sidebarCollapsed && (\n            <div className=\"p-4 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50\">\n              <div className=\"grid grid-cols-3 gap-2\">\n                <div className=\"bg-white rounded-lg p-2.5 text-center shadow-sm\">\n                  <div className=\"text-xl font-bold text-indigo-600\">{chapters.length}</div>\n                  <div className=\"text-xs text-gray-500 mt-0.5\">章节</div>\n                </div>\n                <div className=\"bg-white rounded-lg p-2.5 text-center shadow-sm\">\n                  <div className=\"text-xl font-bold text-purple-600\">\n                    {chapters.filter(ch => ch.content).length}\n                  </div>\n                  <div className=\"text-xs text-gray-500 mt-0.5\">已完成</div>\n                </div>\n                <div className=\"bg-white rounded-lg p-2.5 text-center shadow-sm\">\n                  <div className=\"text-xl font-bold text-blue-600\">\n                    {(chapters.reduce((sum, ch) => sum + (ch.wordCount || 0), 0) / 1000).toFixed(1)}k\n                  </div>\n                  <div className=\"text-xs text-gray-500 mt-0.5\">字数</div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* 章节列表 */}\n          <div className=\"flex-1 overflow-y-auto p-3\">\n            {chapters.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center h-full text-gray-400 py-8\">\n                <FileText className=\"h-12 w-12 mb-3 opacity-30\" />\n                <p className=\"text-sm\">暂无章节</p>\n                <p className=\"text-xs mt-1\">点击下方按钮创建新章节</p>\n              </div>\n            ) : (\n              <div className=\"space-y-1\">\n                {chapters.map((chapter) => {\n                  const isActive = currentChapter?.id === chapter.id\n                  const hasContent = !!chapter.content\n                  const wordCount = chapter.wordCount || 0\n                  \n                  return (\n                    <div\n                      key={chapter.id}\n                      onClick={() => handleSelectChapter(chapter)}\n                      className={`group relative p-3 rounded-lg border transition-all cursor-pointer overflow-hidden ${\n                        isActive \n                          ? 'border-indigo-500 bg-gradient-to-r from-indigo-50 to-white shadow-sm' \n                          : 'border-gray-100 hover:border-indigo-200 hover:bg-gray-50'\n                      }`}\n                    >\n                      {/* 激活状态左侧标记 */}\n                      {isActive && (\n                        <div className=\"absolute left-0 top-0 bottom-0 w-1 bg-indigo-500 rounded-l-lg\"></div>\n                      )}\n                      \n                      <div className=\"flex items-start gap-3 pl-1\">\n                        {/* 拖拽手柄 */}\n                        <div className=\"flex items-center justify-center mt-1 cursor-move\">\n                          <GripVertical className=\"h-4 w-4 text-gray-300 group-hover:text-gray-400 transition-colors\" />\n                        </div>\n\n                        {/* 章节序号和图标 */}\n                        <div className=\"flex items-center justify-center w-8 h-8 mt-0.5 flex-shrink-0\">\n                          {hasContent ? (\n                            <div className=\"w-7 h-7 bg-green-50 rounded-lg flex items-center justify-center\">\n                              <Check className=\"h-3.5 w-3.5 text-green-500\" />\n                            </div>\n                          ) : (\n                            <div className=\"w-7 h-7 bg-gray-100 rounded-lg flex items-center justify-center\">\n                              <FileText className=\"h-3.5 w-3.5 text-gray-400\" />\n                            </div>\n                          )}\n                        </div>\n\n                        {/* 章节信息 */}\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <span className=\"text-xs font-medium text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded\">\n                              {chapter.order}\n                            </span>\n                            <h3 className={`text-sm font-medium truncate ${\n                              isActive ? 'text-indigo-700' : 'text-gray-900'\n                            }`}>\n                              {chapter.title}\n                            </h3>\n                          </div>\n                          \n                          {/* 章节统计 */}\n                          <div className=\"flex items-center gap-3 text-xs text-gray-400\">\n                            <span className=\"flex items-center gap-1\">\n                              <Type className=\"h-3 w-3\" />\n                              {wordCount}字\n                            </span>\n                            {chapter.summary && (\n                              <span className=\"flex items-center gap-1\">\n                                <Hash className=\"h-3 w-3\" />\n                                有简介\n                              </span>\n                            )}\n                          </div>\n                        </div>\n\n                        {/* 操作按钮 */}\n                        {!sidebarCollapsed && (\n                          <div className=\"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation()\n                                setShowChapterSettings(showChapterSettings === chapter.id ? null : chapter.id)\n                              }}\n                              className=\"p-1.5 hover:bg-gray-200 rounded-lg transition-colors\"\n                              title=\"更多操作\"\n                            >\n                              <MoreVertical className=\"h-4 w-4 text-gray-400\" />\n                            </button>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* 操作菜单 */}\n                      {showChapterSettings === chapter.id && !sidebarCollapsed && (\n                        <div \n                          className=\"absolute right-2 top-12 bg-white rounded-xl shadow-xl border border-gray-200 py-1.5 z-20 min-w-[140px]\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              handleEditChapter(chapter)\n                              setShowChapterSettings(null)\n                            }}\n                            className=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2 transition-colors\"\n                          >\n                            <Edit3 className=\"h-4 w-4 text-gray-500\" />\n                            编辑信息\n                          </button>\n                          <div className=\"border-t border-gray-100 my-1\"></div>\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              handleMoveChapter(chapter, 'up')\n                              setShowChapterSettings(null)\n                            }}\n                            disabled={chapter.order === 1}\n                            className=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2 transition-colors disabled:opacity-30 disabled:cursor-not-allowed\"\n                          >\n                            <MoveUp className=\"h-4 w-4 text-gray-500\" />\n                            上移\n                          </button>\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              handleMoveChapter(chapter, 'down')\n                              setShowChapterSettings(null)\n                            }}\n                            disabled={chapter.order === chapters.length}\n                            className=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2 transition-colors disabled:opacity-30 disabled:cursor-not-allowed\"\n                          >\n                            <MoveDown className=\"h-4 w-4 text-gray-500\" />\n                            下移\n                          </button>\n                          <div className=\"border-t border-gray-100 my-1\"></div>\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              handleCopyChapter(chapter)\n                              setShowChapterSettings(null)\n                            }}\n                            className=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2 transition-colors\"\n                          >\n                            <Copy className=\"h-4 w-4 text-gray-500\" />\n                            复制内容\n                          </button>\n                          <div className=\"border-t border-gray-100 my-1\"></div>\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              handleDeleteChapter(chapter)\n                              setShowChapterSettings(null)\n                            }}\n                            className=\"w-full px-3 py-2 text-left text-sm hover:bg-red-50 text-red-600 flex items-center gap-2 transition-colors\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                            删除章节\n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  )\n                })}\n              </div>\n            )}\n          </div>\n\n          {/* 新建章节按钮 */}\n          {!sidebarCollapsed && (\n            <div className=\"p-3 border-t border-gray-200 bg-white\">\n              <button\n                onClick={handleCreateChapter}\n                className=\"w-full px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white rounded-lg hover:from-indigo-700 hover:to-indigo-800 transition-all shadow-sm hover:shadow flex items-center justify-center gap-2 font-medium text-sm\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                新建章节\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* 中间编辑区 */}\n        <div className=\"flex-1 flex flex-col bg-gradient-to-b from-white to-gray-50\">\n          {/* 编辑器工具栏 */}\n          {viewMode === 'edit' && (\n            <div className=\"px-6 py-2.5 border-b border-gray-200 bg-white flex items-center gap-1.5 flex-wrap\">\n              {/* 文本格式 */}\n              <div className=\"flex items-center gap-0.5 bg-gray-100 rounded-lg p-0.5\">\n                <button\n                  onClick={() => insertFormatting('**', '**')}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm font-bold text-gray-700\"\n                  title=\"粗体\"\n                >\n                  B\n                </button>\n                <button\n                  onClick={() => insertFormatting('*', '*')}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm italic text-gray-700\"\n                  title=\"斜体\"\n                >\n                  I\n                </button>\n                <button\n                  onClick={() => insertFormatting('~~', '~~')}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm line-through text-gray-700\"\n                  title=\"删除线\"\n                >\n                  S\n                </button>\n              </div>\n\n              <div className=\"w-px h-6 bg-gray-200 mx-1\"></div>\n\n              {/* 标题 */}\n              <div className=\"flex items-center gap-0.5 bg-gray-100 rounded-lg p-0.5\">\n                <button\n                  onClick={() => insertChapterTitle(1)}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm font-bold text-gray-700\"\n                  title=\"一级标题\"\n                >\n                  H1\n                </button>\n                <button\n                  onClick={() => insertChapterTitle(2)}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm font-bold text-gray-700\"\n                  title=\"二级标题\"\n                >\n                  H2\n                </button>\n                <button\n                  onClick={() => insertChapterTitle(3)}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm font-bold text-gray-700\"\n                  title=\"三级标题\"\n                >\n                  H3\n                </button>\n              </div>\n\n              <div className=\"w-px h-6 bg-gray-200 mx-1\"></div>\n\n              {/* 列表 */}\n              <div className=\"flex items-center gap-0.5 bg-gray-100 rounded-lg p-0.5\">\n                <button\n                  onClick={() => insertFormatting('\\n- ', '')}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm text-gray-700\"\n                  title=\"无序列表\"\n                >\n                  • 列表\n                </button>\n                <button\n                  onClick={() => insertFormatting('\\n1. ', '')}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm text-gray-700\"\n                  title=\"有序列表\"\n                >\n                  1. 列表\n                </button>\n              </div>\n\n              <div className=\"w-px h-6 bg-gray-200 mx-1\"></div>\n\n              {/* 其他格式 */}\n              <div className=\"flex items-center gap-0.5 bg-gray-100 rounded-lg p-0.5\">\n                <button\n                  onClick={() => insertFormatting('\\n> ', '')}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm text-gray-700\"\n                  title=\"引用\"\n                >\n                  <Quote className=\"h-4 w-4\" />\n                </button>\n                <button\n                  onClick={() => insertFormatting('`', '`')}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm font-mono text-gray-700\"\n                  title=\"行内代码\"\n                >\n                  &lt;/&gt;\n                </button>\n                <button\n                  onClick={() => insertSeparator()}\n                  className=\"px-3 py-1.5 hover:bg-white hover:shadow-sm rounded-md transition-all text-sm text-gray-700\"\n                  title=\"分隔线\"\n                >\n                  —\n                </button>\n              </div>\n\n              <div className=\"flex-1\"></div>\n\n              {/* 右侧按钮 */}\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={clearContent}\n                  className=\"px-3 py-1.5 hover:bg-red-50 text-gray-600 hover:text-red-600 rounded-lg transition-all text-sm\"\n                  title=\"清空内容\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </button>\n                \n                <div className=\"text-xs text-gray-400 flex items-center gap-1 px-2\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded text-gray-500\">Ctrl</kbd>\n                  <span>+</span>\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded text-gray-500\">S</kbd>\n                </div>\n                \n                <button\n                  onClick={() => {\n                    setRightPanelTab('ai')\n                    setRightPanelCollapsed(false)\n                  }}\n                  className=\"px-4 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all shadow-sm hover:shadow flex items-center gap-2 text-sm font-medium\"\n                >\n                  <Sparkles className=\"h-4 w-4\" />\n                  AI辅助\n                </button>\n              </div>\n            </div>\n          )}\n\n          {/* 编辑区 */}\n          <div className=\"flex-1 overflow-y-auto\">\n            {viewMode === 'edit' ? (\n              <div className=\"px-8 py-6 max-w-4xl mx-auto\">\n                <textarea\n                  ref={textareaRef}\n                  value={content}\n                  onChange={(e) => handleContentChange(e.target.value)}\n                  placeholder={currentChapter?.summary \n                    ? `基于简介创作：${currentChapter.summary}\\n\\n开始写作...` \n                    : '开始写作...\\n\\n提示：可以在右侧设置章节简介后，使用AI辅助生成内容'\n                  }\n                  className=\"w-full min-h-[calc(100vh-320px)] text-base leading-relaxed resize-none outline-none text-gray-800 placeholder-gray-400\"\n                  style={{ fontSize: '16px', lineHeight: '1.8' }}\n                />\n              </div>\n            ) : (\n              <div className=\"px-8 py-6 max-w-4xl mx-auto\">\n                <div\n                  className=\"prose prose-lg max-w-none prose-headings:font-semibold prose-p:text-gray-700 leading-relaxed\"\n                  dangerouslySetInnerHTML={{ __html: renderMarkdown(content) }}\n                />\n              </div>\n            )}\n          </div>\n\n          {/* 底部状态栏 */}\n          <div className=\"px-6 py-2 bg-white border-t border-gray-200 flex items-center justify-between text-xs\">\n            <div className=\"flex items-center gap-4 text-gray-500\">\n              <span className=\"flex items-center gap-1\">\n                <Type className=\"h-3.5 w-3.5\" />\n                <span className=\"font-medium\">{wordCount.toLocaleString()}</span>\n                <span>字</span>\n              </span>\n              <span className=\"w-px h-3.5 bg-gray-200\"></span>\n              <span className=\"flex items-center gap-1\">\n                <span>段落:</span>\n                <span className=\"font-medium\">{content.split('\\n\\n').filter(p => p.trim()).length}</span>\n              </span>\n              <span className=\"w-px h-3.5 bg-gray-200\"></span>\n              <span className=\"flex items-center gap-1\">\n                <span>行数:</span>\n                <span className=\"font-medium\">{content.split('\\n').length}</span>\n              </span>\n            </div>\n            {lastSaved && (\n              <div className=\"flex items-center gap-1 text-gray-400\">\n                <Check className=\"h-3.5 w-3.5 text-green-500\" />\n                <span>最后保存: {lastSaved.toLocaleTimeString()}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* 右侧辅助工具栏 */}\n        <div className={`${rightPanelCollapsed ? 'w-0' : 'w-80'} bg-white border-l border-gray-200 flex flex-col transition-all duration-300`}>\n          {/* 折叠按钮 */}\n          <button\n            onClick={() => setRightPanelCollapsed(!rightPanelCollapsed)}\n            className=\"absolute -left-8 top-1/2 -translate-y-1/2 bg-white border border-gray-200 rounded-l-lg p-2 hover:bg-gray-50 transition-colors\"\n          >\n            {rightPanelCollapsed ? <ChevronRight className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n          </button>\n\n          {!rightPanelCollapsed && (\n            <>\n              {/* Tab切换 */}\n              <div className=\"flex border-b border-gray-200\">\n                {[\n                  { id: 'ai' as const, label: 'AI助手', icon: Sparkles },\n                  { id: 'outline' as const, label: '大纲', icon: Layers },\n                  { id: 'characters' as const, label: '角色', icon: Users },\n                  { id: 'world' as const, label: '世界观', icon: Globe },\n                ].map((tab) => {\n                  const Icon = tab.icon\n                  return (\n                    <button\n                      key={tab.id}\n                      onClick={() => setRightPanelTab(tab.id)}\n                      className={`flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-1.5 ${\n                        rightPanelTab === tab.id\n                          ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50'\n                          : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\n                      }`}\n                    >\n                      <Icon className=\"h-4 w-4\" />\n                      {tab.label}\n                    </button>\n                  )\n                })}\n              </div>\n\n              {/* Tab内容 */}\n              <div className=\"flex-1 overflow-y-auto p-4\">\n                {/* AI助手 */}\n                {rightPanelTab === 'ai' && (\n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        AI生成提示\n                      </label>\n                      <textarea\n                        value={aiPrompt}\n                        onChange={(e) => setAiPrompt(e.target.value)}\n                        placeholder=\"输入提示词，或留空使用章节简介生成...\"\n                        className=\"w-full h-24 px-3 py-2 border border-gray-200 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                      />\n                    </div>\n\n                    <button\n                      onClick={handleAIGenerate}\n                      disabled={generating || !currentChapter?.summary}\n                      className={`w-full px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${\n                        generating || !currentChapter?.summary\n                          ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\n                          : 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700'\n                      }`}\n                    >\n                      {generating ? (\n                        <>\n                          <RefreshCw className=\"h-4 w-4 animate-spin\" />\n                          生成中...\n                        </>\n                      ) : (\n                        <>\n                          <Sparkles className=\"h-4 w-4\" />\n                          生成章节内容\n                        </>\n                      )}\n                    </button>\n\n                    <div className=\"bg-blue-50 rounded-lg p-4\">\n                      <h4 className=\"text-sm font-medium text-blue-900 mb-2 flex items-center gap-2\">\n                        <Lightbulb className=\"h-4 w-4\" />\n                        使用提示\n                      </h4>\n                      <ul className=\"text-xs text-blue-800 space-y-1.5\">\n                        <li>• 章节简介是AI生成的基础</li>\n                        <li>• 可以在提示框中添加额外要求</li>\n                        <li>• 生成后可以手动编辑修改</li>\n                        <li>• 支持多种写作风格和体裁</li>\n                      </ul>\n                    </div>\n                  </div>\n                )}\n\n                {/* 大纲 */}\n                {rightPanelTab === 'outline' && (\n                  <div>\n                    <h3 className=\"font-medium text-gray-900 mb-3\">小说大纲</h3>\n                    <div className=\"prose prose-sm max-w-none\">\n                      <p className=\"text-gray-600 text-sm whitespace-pre-wrap\">\n                        {novel?.outline || '暂无大纲'}\n                      </p>\n                    </div>\n                  </div>\n                )}\n\n                {/* 角色 */}\n                {rightPanelTab === 'characters' && (\n                  <div>\n                    <h3 className=\"font-medium text-gray-900 mb-3\">角色列表</h3>\n                    <div className=\"space-y-3\">\n                      {characters.length === 0 ? (\n                        <p className=\"text-sm text-gray-500\">暂无角色</p>\n                      ) : (\n                        characters.map((char) => (\n                          <div key={char.id} className=\"p-3 bg-gray-50 rounded-lg\">\n                            <h4 className=\"font-medium text-gray-900 text-sm\">{char.name}</h4>\n                            {char.description && (\n                              <p className=\"text-xs text-gray-600 mt-1\">{char.description}</p>\n                            )}\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {/* 世界观 */}\n                {rightPanelTab === 'world' && (\n                  <div>\n                    <h3 className=\"font-medium text-gray-900 mb-3\">世界观设定</h3>\n                    <div className=\"space-y-3\">\n                      {worldSettings.length === 0 ? (\n                        <p className=\"text-sm text-gray-500\">暂无设定</p>\n                      ) : (\n                        worldSettings.map((setting) => (\n                          <div key={setting.id} className=\"p-3 bg-gray-50 rounded-lg\">\n                            <h4 className=\"font-medium text-gray-900 text-sm\">{setting.name}</h4>\n                            {setting.description && (\n                              <p className=\"text-xs text-gray-600 mt-1\">{setting.description}</p>\n                            )}\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* 编辑章节信息模态框 */}\n      {showEditModal && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\" style={{ backgroundColor: \"rgba(0,0,0,0.5)\" }}>\n          <div className=\"bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h3 className=\"text-xl font-semibold text-gray-900\">编辑章节信息</h3>\n              <button\n                onClick={() => setShowEditModal(false)}\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <X className=\"h-5 w-5 text-gray-500\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  章节标题\n                </label>\n                <input\n                  type=\"text\"\n                  value={editTitle}\n                  onChange={(e) => setEditTitle(e.target.value)}\n                  className=\"w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                  placeholder=\"输入章节标题\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  章节简介\n                </label>\n                <textarea\n                  value={editSummary}\n                  onChange={(e) => setEditSummary(e.target.value)}\n                  className=\"w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none\"\n                  rows={4}\n                  placeholder=\"输入章节简介，用于AI生成内容参考...\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  简介会作为AI生成章节内容的重要参考\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200\">\n              <button\n                onClick={() => setShowEditModal(false)}\n                className=\"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors font-medium\"\n              >\n                取消\n              </button>\n              <button\n                onClick={handleSaveChapterInfo}\n                className=\"px-6 py-2 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white rounded-lg hover:from-indigo-700 hover:to-indigo-800 transition-colors font-medium\"\n              >\n                保存\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\EnhancedNovelsList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[211,223],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreHorizontal' is defined but never used.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MoreHorizontal"},"fix":{"range":[256,274],"text":""},"desc":"Remove unused variable \"MoreHorizontal\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Check"},"fix":{"range":[289,298],"text":""},"desc":"Remove unused variable \"Check\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":24,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":4,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[298,303],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showBulkActions' is assigned a value but never used.","line":52,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1711,1714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1711,1714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleBulkDelete' is assigned a value but never used.","line":111,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSelectNovel' is assigned a value but never used.","line":137,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":137,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { \n  Plus, \n  Edit, \n  Trash2, \n  BookOpen, \n  Grid3x3, \n  List, \n  LayoutGrid,\n  Search,\n  Filter,\n  Download,\n  Eye,\n  Calendar,\n  FileText,\n  BarChart3,\n  Star,\n  MoreHorizontal,\n  ChevronDown,\n  Check,\n  X\n} from 'lucide-react'\n\ninterface Novel {\n  id: string\n  title: string\n  description: string\n  status: string\n  genre: string\n  createdAt: string\n  updatedAt: string\n  _count: {\n    chapters: number\n  }\n}\n\ntype ViewMode = 'grid' | 'list' | 'card'\ntype SortOption = 'title' | 'updatedAt' | 'chapters' | 'status'\ntype FilterStatus = 'all' | 'draft' | 'published' | 'archived'\n\nexport default function EnhancedNovelsList() {\n  const [novels, setNovels] = useState<Novel[]>([])\n  const [loading, setLoading] = useState(true)\n  const [viewMode, setViewMode] = useState<ViewMode>('grid')\n  const [searchQuery, setSearchQuery] = useState('')\n  const [sortBy, setSortBy] = useState<SortOption>('updatedAt')\n  const [filterStatus, setFilterStatus] = useState<FilterStatus>('all')\n  const [selectedNovels, setSelectedNovels] = useState<string[]>([])\n  const [showBulkActions, setShowBulkActions] = useState(false)\n  const [showFilterDropdown, setShowFilterDropdown] = useState(false)\n\n  useEffect(() => {\n    fetchNovels()\n  }, [])\n\n  const fetchNovels = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch('/api/novels', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        // 添加模拟的状态和类型字段\n        const enhancedNovels = data.novels.map((novel: any) => ({\n          ...novel,\n          status: Math.random() > 0.5 ? 'published' : 'draft',\n          genre: ['玄幻', '都市', '科幻', '言情', '武侠'][Math.floor(Math.random() * 5)]\n        }))\n        setNovels(enhancedNovels)\n      }\n    } catch (error) {\n      console.error('获取小说列表失败:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('确定要删除这部小说吗？此操作不可恢复。')) {\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        setNovels(novels.filter(novel => novel.id !== id))\n        setSelectedNovels(selectedNovels.filter(novelId => novelId !== id))\n      } else {\n        alert('删除失败')\n      }\n    } catch (error) {\n      console.error('删除小说失败:', error)\n      alert('删除失败')\n    }\n  }\n\n  const handleBulkDelete = async () => {\n    if (!confirm(`确定要删除选中的 ${selectedNovels.length} 部小说吗？此操作不可恢复。`)) {\n      return\n    }\n\n    try {\n      const token = localStorage.getItem('token')\n      const deletePromises = selectedNovels.map(id => \n        fetch(`/api/novels/${id}`, {\n          method: 'DELETE',\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        })\n      )\n\n      await Promise.all(deletePromises)\n      setNovels(novels.filter(novel => !selectedNovels.includes(novel.id)))\n      setSelectedNovels([])\n      setShowBulkActions(false)\n    } catch (error) {\n      console.error('批量删除失败:', error)\n      alert('批量删除失败')\n    }\n  }\n\n  const handleSelectNovel = (id: string) => {\n    setSelectedNovels(prev => \n      prev.includes(id) \n        ? prev.filter(novelId => novelId !== id)\n        : [...prev, id]\n    )\n  }\n\n  const handleSelectAll = () => {\n    if (selectedNovels.length === filteredNovels.length) {\n      setSelectedNovels([])\n    } else {\n      setSelectedNovels(filteredNovels.map(novel => novel.id))\n    }\n  }\n\n  const filteredNovels = novels.filter(novel => {\n    const matchesSearch = novel.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n                         novel.description?.toLowerCase().includes(searchQuery.toLowerCase())\n    const matchesStatus = filterStatus === 'all' || novel.status === filterStatus\n    return matchesSearch && matchesStatus\n  }).sort((a, b) => {\n    switch (sortBy) {\n      case 'title':\n        return a.title.localeCompare(b.title)\n      case 'updatedAt':\n        return new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n      case 'chapters':\n        return b._count.chapters - a._count.chapters\n      case 'status':\n        return a.status.localeCompare(b.status)\n      default:\n        return 0\n    }\n  })\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'published':\n        return 'bg-green-100 text-green-800'\n      case 'draft':\n        return 'bg-yellow-100 text-yellow-800'\n      case 'archived':\n        return 'bg-gray-100 text-gray-800'\n      default:\n        return 'bg-gray-100 text-gray-800'\n    }\n  }\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'published':\n        return '已发布'\n      case 'draft':\n        return '草稿'\n      case 'archived':\n        return '已归档'\n      default:\n        return '未知'\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 工具栏 */}\n      <div className=\"flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:space-x-4 sm:items-center sm:justify-between\">\n        {/* 左侧工具 */}\n        <div className=\"flex items-center space-x-4\">\n          {/* 搜索框 */}\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"搜索小说...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n            />\n          </div>\n\n          {/* 筛选器 */}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowFilterDropdown(!showFilterDropdown)}\n              className=\"flex items-center px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50\"\n            >\n              <Filter className=\"h-4 w-4 mr-2\" />\n              筛选\n              <ChevronDown className=\"h-4 w-4 ml-2\" />\n            </button>\n            \n            {showFilterDropdown && (\n              <div className=\"absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10\">\n                <div className=\"p-2\">\n                  <button\n                    onClick={() => { setFilterStatus('all'); setShowFilterDropdown(false) }}\n                    className=\"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 rounded\"\n                  >\n                    全部状态\n                  </button>\n                  <button\n                    onClick={() => { setFilterStatus('draft'); setShowFilterDropdown(false) }}\n                    className=\"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 rounded\"\n                  >\n                    草稿\n                  </button>\n                  <button\n                    onClick={() => { setFilterStatus('published'); setShowFilterDropdown(false) }}\n                    className=\"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 rounded\"\n                  >\n                    已发布\n                  </button>\n                  <button\n                    onClick={() => { setFilterStatus('archived'); setShowFilterDropdown(false) }}\n                    className=\"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 rounded\"\n                  >\n                    已归档\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* 排序 */}\n          <select\n            value={sortBy}\n            onChange={(e) => setSortBy(e.target.value as SortOption)}\n            className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\n          >\n            <option value=\"updatedAt\">最近更新</option>\n            <option value=\"title\">标题</option>\n            <option value=\"chapters\">章节数</option>\n            <option value=\"status\">状态</option>\n          </select>\n        </div>\n\n        {/* 右侧工具 */}\n        <div className=\"flex items-center space-x-2\">\n          {/* 视图模式切换 */}\n          <div className=\"flex items-center border border-gray-300 rounded-lg\">\n            <button\n              onClick={() => setViewMode('grid')}\n              className={`p-2 ${viewMode === 'grid' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-500 hover:bg-gray-50'}`}\n            >\n              <Grid3x3 className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => setViewMode('list')}\n              className={`p-2 ${viewMode === 'list' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-500 hover:bg-gray-50'}`}\n            >\n              <List className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => setViewMode('card')}\n              className={`p-2 ${viewMode === 'card' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-500 hover:bg-gray-50'}`}\n            >\n              <LayoutGrid className=\"h-4 w-4\" />\n            </button>\n          </div>\n\n          {/* 创建按钮 */}\n          <Link\n            href=\"/dashboard/novels/create\"\n            className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            创建新小说\n          </Link>\n        </div>\n      </div>\n\n      {/* 批量操作栏 */}\n      {selectedNovels.length > 0 && (\n        <div className=\"bg-indigo-50 border border-indigo-200 rounded-lg p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={selectedNovels.length === filteredNovels.length}\n                onChange={handleSelectAll}\n                className=\"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500\"\n              />\n              <span className=\"ml-3 text-sm text-indigo-800\">\n                已选择 {selectedNovels.length} 项\n              </span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <button className=\"inline-flex items-center px-3 py-1.5 text-sm text-indigo-600 hover:text-indigo-800\">\n                <Download className=\"h-4 w-4 mr-1\" />\n                导出\n              </button>\n              <button className=\"inline-flex items-center px-3 py-1.5 text-sm text-red-600 hover:text-red-800\">\n                <Trash2 className=\"h-4 w-4 mr-1\" />\n                删除\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* 统计信息 */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <div className=\"bg-white p-4 rounded-lg border border-gray-200\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <BookOpen className=\"h-5 w-5 text-blue-600\" />\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-gray-500\">全部小说</p>\n              <p className=\"text-lg font-semibold text-gray-900\">{novels.length}</p>\n            </div>\n          </div>\n        </div>\n        <div className=\"bg-white p-4 rounded-lg border border-gray-200\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 bg-green-100 rounded-lg\">\n              <FileText className=\"h-5 w-5 text-green-600\" />\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-gray-500\">总章节</p>\n              <p className=\"text-lg font-semibold text-gray-900\">\n                {novels.reduce((sum, novel) => sum + novel._count.chapters, 0)}\n              </p>\n            </div>\n          </div>\n        </div>\n        <div className=\"bg-white p-4 rounded-lg border border-gray-200\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 bg-yellow-100 rounded-lg\">\n              <Star className=\"h-5 w-5 text-yellow-600\" />\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-gray-500\">已发布</p>\n              <p className=\"text-lg font-semibold text-gray-900\">\n                {novels.filter(novel => novel.status === 'published').length}\n              </p>\n            </div>\n          </div>\n        </div>\n        <div className=\"bg-white p-4 rounded-lg border border-gray-200\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 bg-purple-100 rounded-lg\">\n              <BarChart3 className=\"h-5 w-5 text-purple-600\" />\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-gray-500\">草稿</p>\n              <p className=\"text-lg font-semibold text-gray-900\">\n                {novels.filter(novel => novel.status === 'draft').length}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 小说列表 */}\n      {filteredNovels.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <BookOpen className=\"mx-auto h-12 w-12 text-gray-400\" />\n          <h3 className=\"mt-2 text-sm font-medium text-gray-900\">没有找到小说</h3>\n          <p className=\"mt-1 text-sm text-gray-500\">\n            {searchQuery || filterStatus !== 'all' ? '尝试调整搜索条件或筛选器' : '开始创建你的第一部小说吧'}\n          </p>\n          <div className=\"mt-6\">\n            <Link\n              href=\"/dashboard/novels/create\"\n              className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n            >\n              <Plus className=\"mr-2 h-4 w-4\" />\n              创建新小说\n            </Link>\n          </div>\n        </div>\n      ) : (\n        <>\n          {/* 网格视图 */}\n          {viewMode === 'grid' && (\n            <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n              {filteredNovels.map((novel) => (\n                <div key={novel.id} className=\"bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow\">\n                  <div className=\"p-6\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-lg font-medium text-gray-900 truncate\">\n                          {novel.title}\n                        </h3>\n                        <p className=\"mt-1 text-sm text-gray-500 line-clamp-2\">\n                          {novel.description || '暂无描述'}\n                        </p>\n                      </div>\n                      <div className=\"ml-2\">\n                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(novel.status)}`}>\n                          {getStatusText(novel.status)}\n                        </span>\n                      </div>\n                    </div>\n                    \n                    <div className=\"mt-4 space-y-2\">\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-500\">类型</span>\n                        <span className=\"font-medium text-gray-900\">{novel.genre}</span>\n                      </div>\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-500\">章节</span>\n                        <span className=\"font-medium text-gray-900\">{novel._count.chapters}</span>\n                      </div>\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-500\">更新</span>\n                        <span className=\"font-medium text-gray-900\">\n                          {new Date(novel.updatedAt).toLocaleDateString()}\n                        </span>\n                      </div>\n                    </div>\n\n                    <div className=\"mt-4 flex justify-between\">\n                      <Link\n                        href={`/dashboard/novels/${novel.id}`}\n                        className=\"inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-600 hover:text-indigo-800\"\n                      >\n                        <Eye className=\"h-3 w-3 mr-1\" />\n                        查看\n                      </Link>\n                      <div className=\"flex items-center space-x-1\">\n                        <Link\n                          href={`/dashboard/novels/${novel.id}`}\n                          className=\"p-1.5 text-gray-400 hover:text-gray-600\"\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Link>\n                        <button\n                          onClick={() => handleDelete(novel.id)}\n                          className=\"p-1.5 text-gray-400 hover:text-red-600\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* 列表视图 */}\n          {viewMode === 'list' && (\n            <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      小说信息\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      类型\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      章节\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      状态\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      更新时间\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      操作\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {filteredNovels.map((novel) => (\n                    <tr key={novel.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div>\n                          <div className=\"text-sm font-medium text-gray-900\">{novel.title}</div>\n                          <div className=\"text-sm text-gray-500 truncate max-w-xs\">\n                            {novel.description || '暂无描述'}\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className=\"text-sm text-gray-900\">{novel.genre}</span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className=\"text-sm text-gray-900\">{novel._count.chapters}</span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(novel.status)}`}>\n                          {getStatusText(novel.status)}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                        {new Date(novel.updatedAt).toLocaleDateString()}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Link\n                            href={`/dashboard/novels/${novel.id}`}\n                            className=\"text-indigo-600 hover:text-indigo-900\"\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Link>\n                          <Link\n                            href={`/dashboard/novels/${novel.id}`}\n                            className=\"text-indigo-600 hover:text-indigo-900\"\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Link>\n                          <button\n                            onClick={() => handleDelete(novel.id)}\n                            className=\"text-red-600 hover:text-red-900\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n\n          {/* 卡片视图 */}\n          {viewMode === 'card' && (\n            <div className=\"grid grid-cols-1 gap-6\">\n              {filteredNovels.map((novel) => (\n                <div key={novel.id} className=\"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center\">\n                        <h3 className=\"text-lg font-medium text-gray-900\">{novel.title}</h3>\n                        <span className={`ml-3 inline-flex px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(novel.status)}`}>\n                          {getStatusText(novel.status)}\n                        </span>\n                      </div>\n                      <p className=\"mt-2 text-gray-600\">\n                        {novel.description || '暂无描述'}\n                      </p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"mt-4 flex items-center space-x-6 text-sm text-gray-500\">\n                    <span>类型: <span className=\"font-medium text-gray-900\">{novel.genre}</span></span>\n                    <span>章节: <span className=\"font-medium text-gray-900\">{novel._count.chapters}</span></span>\n                    <span>更新: <span className=\"font-medium text-gray-900\">{new Date(novel.updatedAt).toLocaleDateString()}</span></span>\n                  </div>\n\n                  <div className=\"mt-4 flex justify-between\">\n                    <Link\n                      href={`/dashboard/novels/${novel.id}`}\n                      className=\"inline-flex items-center px-4 py-2 text-sm font-medium text-indigo-600 hover:text-indigo-800 border border-indigo-300 rounded-lg hover:bg-indigo-50\"\n                    >\n                      <Eye className=\"h-4 w-4 mr-2\" />\n                      查看详情\n                    </Link>\n                    <div className=\"flex items-center space-x-2\">\n                      <Link\n                        href={`/dashboard/novels/${novel.id}`}\n                        className=\"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg\"\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Link>\n                      <button\n                        onClick={() => handleDelete(novel.id)}\n                        className=\"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\ImmersiveEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Monitor' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Monitor"},"fix":{"range":[156,167],"text":""},"desc":"Remove unused variable \"Monitor\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[301,313],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HelpCircle' is defined but never used.","line":27,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"HelpCircle"},"fix":{"range":[313,327],"text":""},"desc":"Remove unused variable \"HelpCircle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronUp' is defined but never used.","line":29,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronUp"},"fix":{"range":[332,345],"text":""},"desc":"Remove unused variable \"ChevronUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used.","line":30,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronDown"},"fix":{"range":[345,360],"text":""},"desc":"Remove unused variable \"ChevronDown\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'wordCount' is assigned a value but never used.","line":61,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":61,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showSettings' is assigned a value but never used.","line":70,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowSettings' is assigned a value but never used.","line":70,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setAutoSaveEnabled' is assigned a value but never used.","line":71,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setFontSize' is assigned a value but never used.","line":73,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setLineHeight' is assigned a value but never used.","line":74,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'progress' is assigned a value but never used.","line":89,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'writingGoalState'. Either include it or remove the dependency array.","line":98,"column":6,"nodeType":"ArrayExpression","endLine":98,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [content, sessionTime, writingGoalState]","fix":{"range":[2735,2770],"text":"[content, sessionTime, writingGoalState]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleAutoSave'. Either include it or remove the dependency array.","line":156,"column":6,"nodeType":"ArrayExpression","endLine":156,"endColumn":48,"suggestions":[{"desc":"Update the dependencies array to be: [content, autoSaveEnabled, initialContent, handleAutoSave]","fix":{"range":[4092,4134],"text":"[content, autoSaveEnabled, initialContent, handleAutoSave]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":225,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5573,5576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5573,5576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":241,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6078,6081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6078,6081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef, useCallback } from 'react'\nimport { \n  Maximize2, \n  Minimize2, \n  Save, \n  RefreshCw, \n  Eye, \n  EyeOff,\n  Monitor,\n  Moon,\n  Sun,\n  Volume2,\n  VolumeX,\n  Timer,\n  Target,\n  TrendingUp,\n  Pause,\n  Play,\n  RotateCcw,\n  Coffee,\n  Brain,\n  Zap,\n  Wind,\n  Settings,\n  HelpCircle,\n  X,\n  ChevronUp,\n  ChevronDown,\n  Type,\n  Clock\n} from 'lucide-react'\n\ninterface ImmersiveEditorProps {\n  initialContent: string\n  onSave: (content: string) => Promise<void>\n  onExit: () => void\n  writingGoal?: number\n  focusTime?: number // 专注时间（分钟）\n  enableTypingSound?: boolean\n}\n\ninterface WritingStats {\n  wordsWritten: number\n  timeSpent: number\n  wordsPerMinute: number\n  sessionsCompleted: number\n  currentStreak: number\n}\n\nexport default function ImmersiveEditor({\n  initialContent,\n  onSave,\n  onExit,\n  writingGoal = 1000,\n  focusTime = 25,\n  enableTypingSound = false\n}: ImmersiveEditorProps) {\n  const [content, setContent] = useState(initialContent)\n  const [wordCount, setWordCount] = useState(0)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [isDarkMode, setIsDarkMode] = useState(false)\n  const [isFocusMode, setIsFocusMode] = useState(true)\n  const [isWriting, setIsWriting] = useState(false)\n  const [isTimerRunning, setIsTimerRunning] = useState(false)\n  const [timeRemaining, setTimeRemaining] = useState(focusTime * 60)\n  const [sessionTime, setSessionTime] = useState(0)\n  const [showStats, setShowStats] = useState(false)\n  const [showSettings, setShowSettings] = useState(false)\n  const [autoSaveEnabled, setAutoSaveEnabled] = useState(true)\n  const [soundEnabled, setSoundEnabled] = useState(enableTypingSound)\n  const [fontSize, setFontSize] = useState(18)\n  const [lineHeight, setLineHeight] = useState(1.6)\n  const [saving, setSaving] = useState(false)\n  const [lastSaved, setLastSaved] = useState<Date | null>(null)\n  const [writingGoalState, setWritingGoalState] = useState(writingGoal)\n  const [focusTimeState, setFocusTimeState] = useState(focusTime)\n  \n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const timerRef = useRef<NodeJS.Timeout | null>(null)\n  const sessionTimerRef = useRef<NodeJS.Timeout | null>(null)\n  const autoSaveRef = useRef<NodeJS.Timeout | null>(null)\n\n  // 计算写作统计\n  const calculateStats = useCallback((): WritingStats => {\n    const words = content.trim().split(/\\s+/).filter(word => word.length > 0).length\n    const wpm = sessionTime > 0 ? Math.round((words / sessionTime) * 60) : 0\n    const progress = Math.min((words / writingGoalState) * 100, 100)\n    \n    return {\n      wordsWritten: words,\n      timeSpent: sessionTime,\n      wordsPerMinute: wpm,\n      sessionsCompleted: 1,\n      currentStreak: 1\n    }\n  }, [content, sessionTime, writingGoal])\n\n  useEffect(() => {\n    setWordCount(calculateStats().wordsWritten)\n  }, [content, calculateStats])\n\n  useEffect(() => {\n    // 专注模式计时器\n    if (isTimerRunning && timeRemaining > 0) {\n      timerRef.current = setTimeout(() => {\n        setTimeRemaining(prev => prev - 1)\n      }, 1000)\n    } else if (timeRemaining === 0 && isTimerRunning) {\n      // 时间到了，播放提示音\n      playNotificationSound()\n      setIsTimerRunning(false)\n      alert('专注时间结束！休息一下吧 😊')\n    }\n\n    return () => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current)\n      }\n    }\n  }, [isTimerRunning, timeRemaining])\n\n  useEffect(() => {\n    // 会话计时器\n    if (isWriting) {\n      sessionTimerRef.current = setInterval(() => {\n        setSessionTime(prev => prev + 1)\n      }, 1000)\n    } else {\n      if (sessionTimerRef.current) {\n        clearInterval(sessionTimerRef.current)\n      }\n    }\n\n    return () => {\n      if (sessionTimerRef.current) {\n        clearInterval(sessionTimerRef.current)\n      }\n    }\n  }, [isWriting])\n\n  useEffect(() => {\n    // 自动保存\n    if (autoSaveEnabled && content !== initialContent) {\n      autoSaveRef.current = setTimeout(() => {\n        handleAutoSave()\n      }, 30000) // 30秒自动保存\n    }\n\n    return () => {\n      if (autoSaveRef.current) {\n        clearTimeout(autoSaveRef.current)\n      }\n    }\n  }, [content, autoSaveEnabled, initialContent])\n\n  useEffect(() => {\n    // 全屏控制\n    if (isFullscreen) {\n      document.documentElement.requestFullscreen?.()\n    } else {\n      document.exitFullscreen?.()\n    }\n  }, [isFullscreen])\n\n  const handleAutoSave = async () => {\n    try {\n      setSaving(true)\n      await onSave(content)\n      setLastSaved(new Date())\n    } catch (error) {\n      console.error('自动保存失败:', error)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleManualSave = async () => {\n    try {\n      setSaving(true)\n      await onSave(content)\n      setLastSaved(new Date())\n    } catch (error) {\n      console.error('保存失败:', error)\n      alert('保存失败，请重试')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleContentChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const newContent = e.target.value\n    setContent(newContent)\n    \n    if (!isWriting && newContent.trim()) {\n      setIsWriting(true)\n      startFocusTimer()\n    }\n\n    // 播放打字音效\n    if (soundEnabled) {\n      playTypingSound()\n    }\n  }\n\n  const startFocusTimer = () => {\n    setIsTimerRunning(true)\n    setTimeRemaining(focusTimeState * 60)\n  }\n\n  const pauseTimer = () => {\n    setIsTimerRunning(false)\n  }\n\n  const resetTimer = () => {\n    setIsTimerRunning(false)\n    setTimeRemaining(focusTimeState * 60)\n  }\n\n  const playTypingSound = () => {\n    if (!soundEnabled) return\n    \n    // 创建简单的打字音效\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)()\n    const oscillator = audioContext.createOscillator()\n    const gainNode = audioContext.createGain()\n    \n    oscillator.connect(gainNode)\n    gainNode.connect(audioContext.destination)\n    \n    oscillator.frequency.value = 800\n    oscillator.type = 'sine'\n    gainNode.gain.value = 0.1\n    \n    oscillator.start()\n    oscillator.stop(audioContext.currentTime + 0.01)\n  }\n\n  const playNotificationSound = () => {\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)()\n    const oscillator = audioContext.createOscillator()\n    const gainNode = audioContext.createGain()\n    \n    oscillator.connect(gainNode)\n    gainNode.connect(audioContext.destination)\n    \n    oscillator.frequency.value = 523.25 // C5音符\n    oscillator.type = 'sine'\n    gainNode.gain.value = 0.3\n    \n    oscillator.start()\n    oscillator.stop(audioContext.currentTime + 0.2)\n  }\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60)\n    const secs = seconds % 60\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n  }\n\n  const handleExit = async () => {\n    if (content !== initialContent) {\n      const confirmed = window.confirm('内容有未保存的更改，确定要退出吗？')\n      if (!confirmed) return\n    }\n    \n    await handleManualSave()\n    onExit()\n  }\n\n  const stats = calculateStats()\n  const progress = Math.min((stats.wordsWritten / writingGoalState) * 100, 100)\n\n  return (\n    <div className={`h-screen flex flex-col ${isDarkMode ? 'bg-gray-900 text-white' : 'bg-white text-gray-900'}`}>\n      {/* 顶部控制栏 */}\n      <div className={`flex items-center justify-between px-4 py-3 border-b ${isDarkMode ? 'border-gray-800 bg-gray-900' : 'border-gray-200 bg-gray-50'}`}>\n        <div className=\"flex items-center space-x-4\">\n          {/* 退出按钮 */}\n          <button\n            onClick={handleExit}\n            className={`flex items-center px-3 py-1.5 rounded-lg transition-colors ${\n              isDarkMode ? 'hover:bg-gray-800 text-gray-300' : 'hover:bg-gray-200 text-gray-600'\n            }`}\n          >\n            <X className=\"h-4 w-4 mr-2\" />\n            退出沉浸式\n          </button>\n\n          {/* 写作状态 */}\n          <div className=\"flex items-center space-x-3\">\n            <div className={`flex items-center text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n              {isWriting ? (\n                <>\n                  <Play className=\"h-4 w-4 mr-1 text-green-500\" />\n                  写作中\n                </>\n              ) : (\n                <>\n                  <Pause className=\"h-4 w-4 mr-1 text-yellow-500\" />\n                  暂停\n                </>\n              )}\n            </div>\n            \n            {saving && (\n              <div className=\"flex items-center text-sm text-blue-600\">\n                <RefreshCw className=\"h-4 w-4 mr-1 animate-spin\" />\n                保存中...\n              </div>\n            )}\n            \n            {lastSaved && !saving && (\n              <div className=\"flex items-center text-sm text-green-600\">\n                <Save className=\"h-4 w-4 mr-1\" />\n                已保存 {lastSaved.toLocaleTimeString()}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          {/* 专注模式控制 */}\n          <div className={`flex items-center space-x-2 px-3 py-1.5 rounded-lg ${isDarkMode ? 'bg-gray-800' : 'bg-gray-100'}`}>\n            <Timer className={`h-4 w-4 ${isTimerRunning ? 'text-green-500' : 'text-gray-500'}`} />\n            <span className=\"text-sm font-mono\">\n              {formatTime(timeRemaining)}\n            </span>\n            <button\n              onClick={isTimerRunning ? pauseTimer : startFocusTimer}\n              className=\"p-1 hover:bg-gray-600 rounded transition-colors\"\n            >\n              {isTimerRunning ? <Pause className=\"h-3 w-3\" /> : <Play className=\"h-3 w-3\" />}\n            </button>\n            <button\n              onClick={resetTimer}\n              className=\"p-1 hover:bg-gray-600 rounded transition-colors\"\n            >\n              <RotateCcw className=\"h-3 w-3\" />\n            </button>\n          </div>\n\n          {/* 快捷功能 */}\n          <button\n            onClick={() => setShowStats(!showStats)}\n            className={`p-2 rounded-lg transition-colors ${\n              isDarkMode ? 'hover:bg-gray-800 text-gray-300' : 'hover:bg-gray-200 text-gray-600'\n            }`}\n            title=\"写作统计\"\n          >\n            <TrendingUp className=\"h-4 w-4\" />\n          </button>\n          \n          <button\n            onClick={() => setIsDarkMode(!isDarkMode)}\n            className={`p-2 rounded-lg transition-colors ${\n              isDarkMode ? 'hover:bg-gray-800 text-gray-300' : 'hover:bg-gray-200 text-gray-600'\n            }`}\n            title=\"切换主题\"\n          >\n            {isDarkMode ? <Sun className=\"h-4 w-4\" /> : <Moon className=\"h-4 w-4\" />}\n          </button>\n          \n          <button\n            onClick={() => setIsFullscreen(!isFullscreen)}\n            className={`p-2 rounded-lg transition-colors ${\n              isDarkMode ? 'hover:bg-gray-800 text-gray-300' : 'hover:bg-gray-200 text-gray-600'\n            }`}\n            title=\"全屏模式\"\n          >\n            {isFullscreen ? <Minimize2 className=\"h-4 w-4\" /> : <Maximize2 className=\"h-4 w-4\" />}\n          </button>\n\n          <button\n            onClick={handleManualSave}\n            className=\"flex items-center px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            保存\n          </button>\n        </div>\n      </div>\n\n      {/* 写作统计面板 */}\n      {showStats && (\n        <div className={`border-b ${isDarkMode ? 'border-gray-800 bg-gray-900' : 'border-gray-200 bg-gray-50'} px-4 py-3`}>\n          <div className=\"grid grid-cols-6 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center mb-1\">\n                <Type className=\"h-4 w-4 text-blue-500 mr-1\" />\n                <span className=\"text-sm text-gray-500\">字数</span>\n              </div>\n              <div className=\"text-lg font-semibold\">{stats.wordsWritten.toLocaleString()}</div>\n            </div>\n            \n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center mb-1\">\n                <Clock className=\"h-4 w-4 text-green-500 mr-1\" />\n                <span className=\"text-sm text-gray-500\">时长</span>\n              </div>\n              <div className=\"text-lg font-semibold\">{formatTime(sessionTime)}</div>\n            </div>\n            \n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center mb-1\">\n                <TrendingUp className=\"h-4 w-4 text-purple-500 mr-1\" />\n                <span className=\"text-sm text-gray-500\">速度</span>\n              </div>\n              <div className=\"text-lg font-semibold\">{stats.wordsPerMinute} 字/分</div>\n            </div>\n            \n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center mb-1\">\n                <Target className=\"h-4 w-4 text-orange-500 mr-1\" />\n                <span className=\"text-sm text-gray-500\">目标</span>\n              </div>\n              <div className=\"text-lg font-semibold\">{Math.round(progress)}%</div>\n            </div>\n            \n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center mb-1\">\n                <Zap className=\"h-4 w-4 text-yellow-500 mr-1\" />\n                <span className=\"text-sm text-gray-500\">专注</span>\n              </div>\n              <div className=\"text-lg font-semibold\">{formatTime(timeRemaining)}</div>\n            </div>\n            \n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center mb-1\">\n                <Coffee className=\"h-4 w-4 text-red-500 mr-1\" />\n                <span className=\"text-sm text-gray-500\">状态</span>\n              </div>\n              <div className=\"text-lg font-semibold\">\n                {progress >= 100 ? '✅ 完成' : '📝 进行中'}\n              </div>\n            </div>\n          </div>\n          \n          {/* 进度条 */}\n          <div className=\"mt-3\">\n            <div className=\"w-full h-3 bg-gray-200 rounded-full overflow-hidden\">\n              <div \n                className=\"h-full bg-gradient-to-r from-blue-500 to-green-500 transition-all duration-300\"\n                style={{ width: `${progress}%` }}\n              />\n            </div>\n            <div className=\"flex justify-between mt-1 text-xs text-gray-500\">\n              <span>{stats.wordsWritten.toLocaleString()} / {writingGoalState.toLocaleString()} 字</span>\n              <span>{Math.round(progress)}% 完成</span>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* 主编辑区域 */}\n      <div className=\"flex-1 flex\">\n        {/* 编辑器 */}\n        <div className=\"flex-1 p-8\">\n          <div className=\"max-w-4xl mx-auto\">\n            {!isFocusMode && (\n              <h1 className=\"text-3xl font-bold mb-6\">开始你的创作</h1>\n            )}\n            \n            <textarea\n              ref={textareaRef}\n              id=\"immersive-editor\"\n              value={content}\n              onChange={handleContentChange}\n              placeholder=\"在这里开始写作...\"\n              className={`w-full h-full min-h-[500px] p-6 border-2 ${\n                isDarkMode \n                  ? 'bg-gray-800 border-gray-700 text-white placeholder-gray-500' \n                  : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400'\n              } rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n              style={{\n                fontSize: `${fontSize}px`,\n                lineHeight: lineHeight,\n                fontFamily: '\"Times New Roman\", serif'\n              }}\n            />\n          </div>\n        </div>\n\n        {/* 侧边栏（非专注模式时显示） */}\n        {!isFocusMode && (\n          <div className={`w-80 border-l ${isDarkMode ? 'border-gray-800 bg-gray-900' : 'border-gray-200 bg-gray-50'} p-6`}>\n            <h3 className=\"text-lg font-semibold mb-4\">写作助手</h3>\n            \n            {/* 快捷操作 */}\n            <div className=\"space-y-3\">\n              <button className=\"w-full flex items-center px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors\">\n                <Brain className=\"h-4 w-4 mr-2\" />\n                AI 续写\n              </button>\n              \n              <button className=\"w-full flex items-center px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors\">\n                <Zap className=\"h-4 w-4 mr-2\" />\n                创意提示\n              </button>\n              \n              <button className=\"w-full flex items-center px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors\">\n                <Wind className=\"h-4 w-4 mr-2\" />\n                放松音乐\n              </button>\n            </div>\n\n            {/* 写作目标设置 */}\n            <div className=\"mt-6\">\n              <h4 className=\"text-sm font-medium mb-3\">目标设置</h4>\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center justify-between text-sm\">\n                  <span>字数目标</span>\n                  <input\n                    type=\"number\"\n                    value={writingGoalState}\n                    onChange={(e) => setWritingGoalState(Number(e.target.value))}\n                    className={`w-20 px-2 py-1 border rounded ${\n                      isDarkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-300 bg-white'\n                    }`}\n                  />\n                </label>\n                \n                <label className=\"flex items-center justify-between text-sm\">\n                  <span>专注时间</span>\n                  <select\n                    value={focusTimeState}\n                    onChange={(e) => setFocusTimeState(Number(e.target.value))}\n                    className={`w-20 px-2 py-1 border rounded ${\n                      isDarkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-300 bg-white'\n                    }`}\n                  >\n                    <option value=\"15\">15分钟</option>\n                    <option value=\"25\">25分钟</option>\n                    <option value=\"45\">45分钟</option>\n                    <option value=\"60\">60分钟</option>\n                  </select>\n                </label>\n              </div>\n            </div>\n\n            {/* 鼓励语 */}\n            <div className=\"mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg\">\n              <div className=\"flex items-center mb-2\">\n                <Coffee className=\"h-5 w-5 text-orange-500 mr-2\" />\n                <h4 className=\"font-medium\">加油！</h4>\n              </div>\n              <p className=\"text-sm text-gray-600\">\n                {progress < 25 ? '刚开始，继续保持！' :\n                 progress < 50 ? '不错的开始，继续加油！' :\n                 progress < 75 ? '已经过半了，太棒了！' :\n                 progress < 100 ? '快要完成了，坚持住！' :\n                 '🎉 恭喜完成今日目标！'}\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* 底部快捷栏 */}\n      <div className={`border-t ${isDarkMode ? 'border-gray-800 bg-gray-900' : 'border-gray-200 bg-gray-50'} px-4 py-2`}>\n        <div className=\"flex items-center justify-between text-sm text-gray-600\">\n          <div className=\"flex items-center space-x-4\">\n            <span>字数: {stats.wordsWritten.toLocaleString()}</span>\n            <span>速度: {stats.wordsPerMinute} 字/分</span>\n            <span>目标: {Math.round(progress)}%</span>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setIsFocusMode(!isFocusMode)}\n              className={`px-3 py-1 rounded transition-colors ${\n                isFocusMode \n                  ? 'bg-indigo-100 text-indigo-700' \n                  : isDarkMode ? 'bg-gray-800 text-gray-300' : 'bg-gray-100 text-gray-700'\n              }`}\n            >\n              {isFocusMode ? <EyeOff className=\"h-3 w-3 mr-1\" /> : <Eye className=\"h-3 w-3 mr-1\" />}\n              {isFocusMode ? '专注模式' : '普通模式'}\n            </button>\n            \n            <button\n              onClick={() => setSoundEnabled(!soundEnabled)}\n              className={`px-3 py-1 rounded transition-colors ${\n                soundEnabled \n                  ? 'bg-green-100 text-green-700' \n                  : isDarkMode ? 'bg-gray-800 text-gray-300' : 'bg-gray-100 text-gray-700'\n              }`}\n            >\n              {soundEnabled ? <Volume2 className=\"h-3 w-3 mr-1\" /> : <VolumeX className=\"h-3 w-3 mr-1\" />}\n              打字音效\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\NovelEditorLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plus"},"fix":{"range":[172,181],"text":""},"desc":"Remove unused variable \"Plus\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit3' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Edit3"},"fix":{"range":[181,191],"text":""},"desc":"Remove unused variable \"Edit3\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Trash2"},"fix":{"range":[191,202],"text":""},"desc":"Remove unused variable \"Trash2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Sparkles"},"fix":{"range":[228,241],"text":""},"desc":"Remove unused variable \"Sparkles\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Palette' is defined but never used.","line":25,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Palette"},"fix":{"range":[341,352],"text":""},"desc":"Remove unused variable \"Palette\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[352,361],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":27,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[361,375],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":30,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Target"},"fix":{"range":[398,408],"text":""},"desc":"Remove unused variable \"Target\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Archive' is defined but never used.","line":32,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Archive"},"fix":{"range":[418,429],"text":""},"desc":"Remove unused variable \"Archive\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generatingChapter' is assigned a value but never used.","line":94,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setGeneratingChapter' is assigned a value but never used.","line":94,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":49},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNovelData'. Either include it or remove the dependency array.","line":102,"column":6,"nodeType":"ArrayExpression","endLine":102,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNovelData, novelId]","fix":{"range":[2383,2392],"text":"[fetchNovelData, novelId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":125,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":125,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":157,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":157,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":451,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":451,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17623,17626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17623,17626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":454,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":454,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17710,17713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17710,17713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":456,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":456,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17840,17843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17840,17843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { \n  ArrowLeft, \n  Save, \n  Plus, \n  Edit3, \n  Trash2, \n  FileText, \n  Settings, \n  Sparkles, \n  Users, \n  Globe, \n  BarChart3,\n  Moon,\n  Sun,\n  Eye,\n  EyeOff,\n  Maximize2,\n  Minimize2,\n  Type,\n  Palette,\n  Clock,\n  TrendingUp,\n  BookOpen,\n  PenTool,\n  Target,\n  Layers,\n  Archive\n} from 'lucide-react'\nimport ChapterListEnhanced from '@/components/ChapterListEnhanced'\nimport ChapterDetailModal from '@/components/ChapterDetailModal'\n\ninterface Novel {\n  id: string\n  title: string\n  description?: string\n  outline?: string\n  worldSetting?: string\n  protagonist?: string\n  chapters?: Chapter[]\n  createdAt: string\n  updatedAt: string\n  wordCount: number\n  chapterCount: number\n}\n\ninterface Chapter {\n  id: string\n  title: string\n  summary?: string\n  content?: string\n  order: number\n  wordCount?: number\n  status: string\n  isAIGenerated: boolean\n  createdAt: string\n  updatedAt: string\n}\n\ninterface NovelStats {\n  totalWords: number\n  totalChapters: number\n  publishedChapters: number\n  draftChapters: number\n  archivedChapters: number\n  wordsToday: number\n  averageWordsPerChapter: number\n  lastUpdated: string\n}\n\nexport default function NovelEditorLayout() {\n  const params = useParams()\n  const router = useRouter()\n  const novelId = typeof params.id === 'string' ? params.id : Array.isArray(params.id) ? params.id[0] : ''\n  \n  const [novel, setNovel] = useState<Novel | null>(null)\n  const [stats, setStats] = useState<NovelStats | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [editingSettings, setEditingSettings] = useState(false)\n  const [error, setError] = useState('')\n  \n  // 界面状态\n  const [darkMode, setDarkMode] = useState(false)\n  const [focusMode, setFocusMode] = useState(false)\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false)\n  const [activeTab, setActiveTab] = useState<'chapters' | 'outline' | 'settings'>('chapters')\n  \n  // 章节相关\n  const [generatingChapter, setGeneratingChapter] = useState<string | null>(null)\n  const [selectedChapter, setSelectedChapter] = useState<Chapter | null>(null)\n  const [showDetailModal, setShowDetailModal] = useState(false)\n\n  useEffect(() => {\n    if (novelId) {\n      fetchNovelData()\n    }\n  }, [novelId])\n\n  const fetchNovelData = async () => {\n    try {\n      const token = localStorage.getItem('token')\n      const [novelResponse, statsResponse] = await Promise.all([\n        fetch(`/api/novels/${novelId}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        }),\n        fetch(`/api/novels/${novelId}/stats`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        })\n      ])\n      \n      if (novelResponse.ok) {\n        const data = await novelResponse.json()\n        setNovel(data.novel)\n      }\n      \n      if (statsResponse.ok) {\n        const statsData = await statsResponse.json()\n        setStats(statsData.stats)\n      }\n    } catch (error) {\n      setError('网络错误')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSaveSettings = async () => {\n    setSaving(true)\n    try {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          title: novel?.title,\n          description: novel?.description,\n          outline: novel?.outline,\n          worldSetting: novel?.worldSetting,\n          protagonist: novel?.protagonist\n        })\n      })\n      \n      if (response.ok) {\n        setEditingSettings(false)\n        alert('保存成功')\n      } else {\n        alert('保存失败')\n      }\n    } catch (error) {\n      alert('保存失败')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleNovelChange = (field: string, value: string) => {\n    if (novel) {\n      setNovel({\n        ...novel,\n        [field]: value\n      })\n      setEditingSettings(true)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">正在加载创作中心...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (error || !novel) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <BookOpen className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n          <p className=\"text-red-600 text-lg font-medium\">{error || '小说不存在'}</p>\n          <button \n            onClick={() => router.back()}\n            className=\"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n          >\n            返回上页\n          </button>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className={`h-screen flex flex-col ${darkMode ? 'dark bg-gray-900' : 'bg-gray-50'}`}>\n      {/* 顶部工具栏 */}\n      <header className={`${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border-b px-4 py-3`}>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-4\">\n            <button\n              onClick={() => router.back()}\n              className={`p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'} transition-colors`}\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </button>\n            \n            <div className=\"flex items-center space-x-2\">\n              <BookOpen className={`h-5 w-5 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`} />\n              <h1 className={`text-lg font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n                {novel.title}\n              </h1>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            {/* 字数统计 */}\n            {stats && (\n              <div className={`hidden sm:flex items-center space-x-4 px-3 py-1.5 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>\n                <div className=\"flex items-center space-x-1\">\n                  <Type className=\"h-4 w-4 text-blue-500\" />\n                  <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n                    总字数: {stats.totalWords.toLocaleString()}\n                  </span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <FileText className=\"h-4 w-4 text-green-500\" />\n                  <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n                    章节: {stats.totalChapters}\n                  </span>\n                </div>\n              </div>\n            )}\n\n            {/* 保存状态 */}\n            {editingSettings && (\n              <button\n                onClick={handleSaveSettings}\n                disabled={saving}\n                className=\"flex items-center px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors\"\n              >\n                <Save className=\"h-4 w-4 mr-1\" />\n                {saving ? '保存中...' : '保存'}\n              </button>\n            )}\n\n            {/* 视图控制 */}\n            <div className=\"flex items-center space-x-1\">\n              <button\n                onClick={() => setDarkMode(!darkMode)}\n                className={`p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'} transition-colors`}\n              >\n                {darkMode ? <Sun className=\"h-4 w-4\" /> : <Moon className=\"h-4 w-4\" />}\n              </button>\n              \n              <button\n                onClick={() => setFocusMode(!focusMode)}\n                className={`p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'} transition-colors`}\n              >\n                {focusMode ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n              </button>\n              \n              <button\n                onClick={() => setSidebarCollapsed(!sidebarCollapsed)}\n                className={`p-2 rounded-lg ${darkMode ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'} transition-colors`}\n              >\n                {sidebarCollapsed ? <Maximize2 className=\"h-4 w-4\" /> : <Minimize2 className=\"h-4 w-4\" />}\n              </button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* 主要内容区域 */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* 左侧边栏 - 工具栏和导航 */}\n        {!focusMode && (\n          <div className={`${sidebarCollapsed ? 'w-16' : 'w-64'} ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border-r transition-all duration-300`}>\n            {/* 导航标签 */}\n            <div className={`flex ${sidebarCollapsed ? 'flex-col' : 'space-x-1'} p-2 border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>\n              {!sidebarCollapsed ? (\n                <>\n                  <button\n                    onClick={() => setActiveTab('chapters')}\n                    className={`flex-1 flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                      activeTab === 'chapters' \n                        ? 'bg-indigo-100 text-indigo-700' \n                        : darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-100'\n                    }`}\n                  >\n                    <Layers className=\"h-4 w-4 mr-2\" />\n                    章节\n                  </button>\n                  <button\n                    onClick={() => setActiveTab('outline')}\n                    className={`flex-1 flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                      activeTab === 'outline' \n                        ? 'bg-indigo-100 text-indigo-700' \n                        : darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-100'\n                    }`}\n                  >\n                    <PenTool className=\"h-4 w-4 mr-2\" />\n                    大纲\n                  </button>\n                  <button\n                    onClick={() => setActiveTab('settings')}\n                    className={`flex-1 flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                      activeTab === 'settings' \n                        ? 'bg-indigo-100 text-indigo-700' \n                        : darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-100'\n                    }`}\n                  >\n                    <Settings className=\"h-4 w-4 mr-2\" />\n                    设置\n                  </button>\n                </>\n              ) : (\n                <>\n                  <button\n                    onClick={() => setActiveTab('chapters')}\n                    className={`w-full p-2 rounded-lg transition-colors ${\n                      activeTab === 'chapters' \n                        ? 'bg-indigo-100 text-indigo-700' \n                        : darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-100'\n                    }`}\n                  >\n                    <Layers className=\"h-4 w-4 mx-auto\" />\n                  </button>\n                  <button\n                    onClick={() => setActiveTab('outline')}\n                    className={`w-full p-2 rounded-lg transition-colors ${\n                      activeTab === 'outline' \n                        ? 'bg-indigo-100 text-indigo-700' \n                        : darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-100'\n                    }`}\n                  >\n                    <PenTool className=\"h-4 w-4 mx-auto\" />\n                  </button>\n                  <button\n                    onClick={() => setActiveTab('settings')}\n                    className={`w-full p-2 rounded-lg transition-colors ${\n                      activeTab === 'settings' \n                        ? 'bg-indigo-100 text-indigo-700' \n                        : darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-100'\n                    }`}\n                  >\n                    <Settings className=\"h-4 w-4 mx-auto\" />\n                  </button>\n                </>\n              )}\n            </div>\n\n            {/* 快捷操作 */}\n            {!sidebarCollapsed && (\n              <div className=\"p-4\">\n                <h3 className={`text-xs font-semibold uppercase tracking-wider mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n                  快捷操作\n                </h3>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <Link\n                    href={`/dashboard/novels/${novelId}/characters`}\n                    className=\"flex flex-col items-center p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors group\"\n                  >\n                    <Users className=\"h-5 w-5 text-blue-600 group-hover:scale-110 transition-transform\" />\n                    <span className=\"text-xs text-blue-700 mt-1\">角色</span>\n                  </Link>\n                  <Link\n                    href={`/dashboard/novels/${novelId}/world-settings`}\n                    className=\"flex flex-col items-center p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors group\"\n                  >\n                    <Globe className=\"h-5 w-5 text-green-600 group-hover:scale-110 transition-transform\" />\n                    <span className=\"text-xs text-green-700 mt-1\">世界观</span>\n                  </Link>\n                  <Link\n                    href={`/dashboard/novels/${novelId}/statistics`}\n                    className=\"flex flex-col items-center p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors group\"\n                  >\n                    <BarChart3 className=\"h-5 w-5 text-purple-600 group-hover:scale-110 transition-transform\" />\n                    <span className=\"text-xs text-purple-700 mt-1\">统计</span>\n                  </Link>\n                  <button\n                    onClick={() => setEditingSettings(true)}\n                    className=\"flex flex-col items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors group\"\n                  >\n                    <Settings className=\"h-5 w-5 text-gray-600 group-hover:scale-110 transition-transform\" />\n                    <span className=\"text-xs text-gray-700 mt-1\">设置</span>\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* 统计信息 */}\n            {stats && !sidebarCollapsed && (\n              <div className=\"p-4 border-t border-gray-200 dark:border-gray-700\">\n                <h3 className={`text-xs font-semibold uppercase tracking-wider mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n                  写作统计\n                </h3>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>今日字数</span>\n                    <span className={`text-sm font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n                      {stats.wordsToday.toLocaleString()}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>平均字数</span>\n                    <span className={`text-sm font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n                      {stats.averageWordsPerChapter.toLocaleString()}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>状态分布</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"flex items-center\">\n                        <div className=\"w-2 h-2 bg-green-500 rounded-full mr-1\"></div>\n                        <span className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n                          {stats.publishedChapters}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center\">\n                        <div className=\"w-2 h-2 bg-yellow-500 rounded-full mr-1\"></div>\n                        <span className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n                          {stats.draftChapters}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* 主内容区域 */}\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\n          {activeTab === 'chapters' && (\n            <div className=\"flex-1 overflow-hidden\">\n              <ChapterListEnhanced\n                novelId={novelId}\n                chapters={novel.chapters || []}\n                onChapterReorder={(reorderedChapters) => {\n                  setNovel({\n                    ...novel,\n                    chapters: reorderedChapters as any\n                  })\n                }}\n                onChapterSelect={(chapter: any) => setSelectedChapter(chapter)}\n                onShowDetail={(chapter) => {\n                  setSelectedChapter(chapter as any)\n                  setShowDetailModal(true)\n                }}\n              />\n            </div>\n          )}\n\n          {activeTab === 'outline' && (\n            <div className=\"flex-1 overflow-y-auto p-6\">\n              <div className=\"max-w-4xl mx-auto\">\n                <h2 className={`text-2xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n                  故事大纲\n                </h2>\n                <textarea\n                  value={novel.outline || ''}\n                  onChange={(e) => handleNovelChange('outline', e.target.value)}\n                  placeholder=\"在这里编写你的故事大纲...\"\n                  className={`w-full h-96 p-4 rounded-lg border ${\n                    darkMode \n                      ? 'bg-gray-800 border-gray-700 text-white placeholder-gray-500' \n                      : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400'\n                  } focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                />\n              </div>\n            </div>\n          )}\n\n          {activeTab === 'settings' && (\n            <div className=\"flex-1 overflow-y-auto p-6\">\n              <div className=\"max-w-4xl mx-auto\">\n                <h2 className={`text-2xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n                  小说设置\n                </h2>\n                <div className=\"space-y-6\">\n                  <div>\n                    <label className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                      小说标题\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={novel.title}\n                      onChange={(e) => handleNovelChange('title', e.target.value)}\n                      className={`w-full p-3 rounded-lg border ${\n                        darkMode \n                          ? 'bg-gray-800 border-gray-700 text-white' \n                          : 'bg-white border-gray-300 text-gray-900'\n                      } focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                    />\n                  </div>\n                  <div>\n                    <label className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                      小说简介\n                    </label>\n                    <textarea\n                      value={novel.description || ''}\n                      onChange={(e) => handleNovelChange('description', e.target.value)}\n                      rows={4}\n                      className={`w-full p-3 rounded-lg border ${\n                        darkMode \n                          ? 'bg-gray-800 border-gray-700 text-white placeholder-gray-500' \n                          : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400'\n                      } focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                      placeholder=\"请输入小说简介...\"\n                    />\n                  </div>\n                  <div>\n                    <label className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                      世界观设定\n                    </label>\n                    <textarea\n                      value={novel.worldSetting || ''}\n                      onChange={(e) => handleNovelChange('worldSetting', e.target.value)}\n                      rows={6}\n                      className={`w-full p-3 rounded-lg border ${\n                        darkMode \n                          ? 'bg-gray-800 border-gray-700 text-white placeholder-gray-500' \n                          : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400'\n                      } focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                      placeholder=\"描述故事的世界观、时代背景等...\"\n                    />\n                  </div>\n                  <div>\n                    <label className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                      主角设定\n                    </label>\n                    <textarea\n                      value={novel.protagonist || ''}\n                      onChange={(e) => handleNovelChange('protagonist', e.target.value)}\n                      rows={4}\n                      className={`w-full p-3 rounded-lg border ${\n                        darkMode \n                          ? 'bg-gray-800 border-gray-700 text-white placeholder-gray-500' \n                          : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400'\n                      } focus:outline-none focus:ring-2 focus:ring-indigo-500`}\n                      placeholder=\"描述主角的性格、背景、目标等...\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* 章节详情模态框 */}\n      {showDetailModal && selectedChapter && (\n        <ChapterDetailModal\n          chapter={selectedChapter}\n          isOpen={showDetailModal}\n          onClose={() => {\n            setShowDetailModal(false)\n            setSelectedChapter(null)\n          }}\n          darkMode={darkMode}\n        />\n      )}\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\PlatformHome.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[98,111],"text":""},"desc":"Remove unused variable \"Settings\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport Link from 'next/link'\nimport { \n  BookOpen, \n  PenTool, \n  Brain, \n  Database, \n  Settings,\n  ArrowRight,\n  Star,\n  Users,\n  FileText,\n  Zap,\n  Shield,\n  TrendingUp,\n  Lightbulb\n} from 'lucide-react'\n\nexport default function PlatformHome() {\n  const features = [\n    {\n      icon: PenTool,\n      title: '智能写作',\n      description: 'AI辅助创作，提供灵感、情节建议和内容生成',\n      color: 'bg-blue-500'\n    },\n    {\n      icon: BookOpen,\n      title: '作品管理',\n      description: '完善的小说和章节管理系统，支持多种编辑模式',\n      color: 'bg-green-500'\n    },\n    {\n      icon: Brain,\n      title: '多模型支持',\n      description: '集成多种AI模型，自定义配置满足不同创作需求',\n      color: 'bg-purple-500'\n    },\n    {\n      icon: Database,\n      title: '数据管理',\n      description: '强大的后台管理功能，用户数据安全管理',\n      color: 'bg-orange-500'\n    }\n  ]\n\n  const quickStart = [\n    {\n      icon: PenTool,\n      title: '创建新小说',\n      description: '立即开始你的创作之旅',\n      href: '/dashboard/novels/create'\n    },\n    {\n      icon: Brain,\n      title: 'AI创作助手',\n      description: '让AI帮助你激发创作灵感',\n      href: '/dashboard/ai-workshop'\n    },\n    {\n      icon: BookOpen,\n      title: '我的作品',\n      description: '管理你的所有小说作品',\n      href: '/dashboard/novels'\n    },\n    {\n      icon: Shield,\n      title: '系统管理',\n      description: '管理平台数据和配置',\n      href: '/111'\n    }\n  ]\n\n  const stats = [\n    {\n      icon: Users,\n      label: '注册用户',\n      value: '1,000+'\n    },\n    {\n      icon: FileText,\n      label: '创作作品',\n      value: '5,000+'\n    },\n    {\n      icon: Star,\n      label: '完成小说',\n      value: '500+'\n    },\n    {\n      icon: TrendingUp,\n      label: '日均写作',\n      value: '10万字'\n    }\n  ]\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Hero Section */}\n      <div className=\"bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n          <div className=\"text-center\">\n            <h1 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              小说创作平台\n            </h1>\n            <p className=\"text-xl md:text-2xl text-indigo-100 mb-8 max-w-3xl mx-auto\">\n              智能AI辅助，让创作灵感无限延伸。专业的小说创作工具，助力每个作家的梦想。\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n              <Link\n                href=\"/dashboard/workspace\"\n                className=\"inline-flex items-center justify-center px-8 py-3 bg-white text-indigo-600 font-semibold rounded-lg hover:bg-indigo-50 transition-colors\"\n              >\n                进入工作台\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Link>\n              <Link\n                href=\"/dashboard/novels/create\"\n                className=\"inline-flex items-center justify-center px-8 py-3 bg-indigo-700 text-white font-semibold rounded-lg hover:bg-indigo-800 transition-colors\"\n              >\n                开始创作\n                <PenTool className=\"ml-2 h-5 w-5\" />\n              </Link>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Stats Section */}\n      <div className=\"py-12 bg-white\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-8\">\n            {stats.map((stat, index) => {\n              const Icon = stat.icon\n              return (\n                <div key={index} className=\"text-center\">\n                  <div className=\"inline-flex items-center justify-center w-12 h-12 bg-indigo-100 rounded-lg mb-4\">\n                    <Icon className=\"h-6 w-6 text-indigo-600\" />\n                  </div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{stat.value}</div>\n                  <div className=\"text-sm text-gray-500\">{stat.label}</div>\n                </div>\n              )\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Features Section */}\n      <div className=\"py-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">核心功能</h2>\n            <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n              我们提供全方位的创作工具，从灵感激发到作品发布，助力你的创作之旅\n            </p>\n          </div>\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-8\">\n            {features.map((feature, index) => {\n              const Icon = feature.icon\n              return (\n                <div key={index} className=\"bg-white rounded-xl shadow-sm hover:shadow-lg transition-shadow p-6\">\n                  <div className={`inline-flex items-center justify-center w-12 h-12 ${feature.color} rounded-lg mb-4`}>\n                    <Icon className=\"h-6 w-6 text-white\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">{feature.title}</h3>\n                  <p className=\"text-gray-600 text-sm\">{feature.description}</p>\n                </div>\n              )\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Quick Start Section */}\n      <div className=\"py-16 bg-white\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">快速开始</h2>\n            <p className=\"text-lg text-gray-600\">选择你想要的功能，立即开始创作</p>\n          </div>\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            {quickStart.map((item, index) => {\n              const Icon = item.icon\n              return (\n                <Link\n                  key={index}\n                  href={item.href}\n                  className=\"group block p-6 border border-gray-200 rounded-xl hover:border-indigo-500 hover:shadow-lg transition-all\"\n                >\n                  <div className=\"inline-flex items-center justify-center w-12 h-12 bg-indigo-100 rounded-lg mb-4 group-hover:bg-indigo-200 transition-colors\">\n                    <Icon className=\"h-6 w-6 text-indigo-600\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">{item.title}</h3>\n                  <p className=\"text-sm text-gray-600 mb-4\">{item.description}</p>\n                  <div className=\"flex items-center text-indigo-600 font-medium group-hover:text-indigo-700\">\n                    立即使用\n                    <ArrowRight className=\"ml-1 h-4 w-4 group-hover:translate-x-1 transition-transform\" />\n                  </div>\n                </Link>\n              )\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Advantages Section */}\n      <div className=\"py-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid lg:grid-cols-2 gap-12 items-center\">\n            <div>\n              <h2 className=\"text-3xl font-bold text-gray-900 mb-6\">为什么选择我们？</h2>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-start\">\n                  <div className=\"flex-shrink-0\">\n                    <Zap className=\"h-6 w-6 text-yellow-500\" />\n                  </div>\n                  <div className=\"ml-3\">\n                    <h3 className=\"text-lg font-semibold text-gray-900\">高效创作</h3>\n                    <p className=\"text-gray-600\">AI智能辅助，大幅提升创作效率</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start\">\n                  <div className=\"flex-shrink-0\">\n                    <Shield className=\"h-6 w-6 text-green-500\" />\n                  </div>\n                  <div className=\"ml-3\">\n                    <h3 className=\"text-lg font-semibold text-gray-900\">数据安全</h3>\n                    <p className=\"text-gray-600\">云端存储，多重备份保护你的作品</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start\">\n                  <div className=\"flex-shrink-0\">\n                    <Lightbulb className=\"h-6 w-6 text-purple-500\" />\n                  </div>\n                  <div className=\"ml-3\">\n                    <h3 className=\"text-lg font-semibold text-gray-900\">创新工具</h3>\n                    <p className=\"text-gray-600\">持续更新的创作工具和功能</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-8 text-white\">\n              <h3 className=\"text-2xl font-bold mb-4\">开始你的创作之旅</h3>\n              <p className=\"text-indigo-100 mb-6\">\n                加入数千名作家的行列，使用专业的创作工具，让你的故事感动更多人。\n              </p>\n              <div className=\"flex flex-col sm:flex-row gap-4\">\n                <Link\n                  href=\"/register\"\n                  className=\"inline-flex items-center justify-center px-6 py-3 bg-white text-indigo-600 font-semibold rounded-lg hover:bg-indigo-50 transition-colors\"\n                >\n                  免费注册\n                </Link>\n                <Link\n                  href=\"/dashboard/workspace\"\n                  className=\"inline-flex items-center justify-center px-6 py-3 bg-indigo-700 text-white font-semibold rounded-lg hover:bg-indigo-800 transition-colors\"\n                >\n                  查看演示\n                </Link>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Footer */}\n      <footer className=\"bg-gray-900 text-white py-12\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <h3 className=\"text-2xl font-bold mb-4\">小说创作平台</h3>\n            <p className=\"text-gray-400 mb-8\">专业、智能、高效的创作工具</p>\n            <div className=\"flex justify-center space-x-6\">\n              <Link href=\"/dashboard\" className=\"text-gray-400 hover:text-white transition-colors\">\n                首页\n              </Link>\n              <Link href=\"/dashboard/workspace\" className=\"text-gray-400 hover:text-white transition-colors\">\n                工作台\n              </Link>\n              <Link href=\"/dashboard/novels\" className=\"text-gray-400 hover:text-white transition-colors\">\n                创作中心\n              </Link>\n              <Link href=\"/dashboard/ai-workshop\" className=\"text-gray-400 hover:text-white transition-colors\">\n                AI模型\n              </Link>\n            </div>\n            <p className=\"text-gray-500 text-sm mt-8\">\n              © 2024 小说创作平台. All rights reserved.\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\QuickActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":5,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plus"},"fix":{"range":[59,64],"text":""},"desc":"Remove unused variable \"Plus\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used.","line":6,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Sparkles"},"fix":{"range":[63,76],"text":""},"desc":"Remove unused variable \"Sparkles\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit3' is defined but never used.","line":7,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Edit3"},"fix":{"range":[76,86],"text":""},"desc":"Remove unused variable \"Edit3\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Save"},"fix":{"range":[86,95],"text":""},"desc":"Remove unused variable \"Save\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[95,108],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lightbulb' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Lightbulb"},"fix":{"range":[108,121],"text":""},"desc":"Remove unused variable \"Lightbulb\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Target"},"fix":{"range":[121,131],"text":""},"desc":"Remove unused variable \"Target\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Hash' is defined but never used.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Hash"},"fix":{"range":[131,139],"text":""},"desc":"Remove unused variable \"Hash\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bookmark' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":11,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Bookmark"},"fix":{"range":[47,173],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[207,210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[207,210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { \n  Plus, \n  Sparkles, \n  Edit3, \n  Save, \n  FileText,\n  Lightbulb,\n  Target,\n  Hash,\n  Bookmark\n} from 'lucide-react'\n\ninterface QuickAction {\n  icon: any\n  label: string\n  color: 'blue' | 'purple' | 'green' | 'orange'\n  action?: () => void\n}\n\ninterface QuickActionsProps {\n  actions: QuickAction[]\n}\n\nexport default function QuickActions({ actions }: QuickActionsProps) {\n  const [hoveredAction, setHoveredAction] = useState<string | null>(null)\n\n  const getColorClasses = (color: string) => {\n    const colors = {\n      blue: 'bg-blue-50 text-blue-600 hover:bg-blue-100',\n      purple: 'bg-purple-50 text-purple-600 hover:bg-purple-100',\n      green: 'bg-green-50 text-green-600 hover:bg-green-100',\n      orange: 'bg-orange-50 text-orange-600 hover:bg-orange-100'\n    }\n    return colors[color as keyof typeof colors] || colors.blue\n  }\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      {actions.map((action, index) => {\n        const Icon = action.icon\n        return (\n          <button\n            key={index}\n            onClick={action.action}\n            onMouseEnter={() => setHoveredAction(action.label)}\n            onMouseLeave={() => setHoveredAction(null)}\n            className={`relative px-3 py-2 rounded-lg transition-all duration-200 ${getColorClasses(action.color)} group quick-action-button`}\n            title={action.label}\n          >\n            <Icon className=\"h-4 w-4\" />\n            \n            {/* 悬停提示 */}\n            {hoveredAction === action.label && (\n              <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded whitespace-nowrap z-10\">\n                {action.label}\n                <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1\">\n                  <div className=\"border-4 border-transparent border-t-gray-900\"></div>\n                </div>\n              </div>\n            )}\n          </button>\n        )\n      })}\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\ResponsiveLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used.","line":7,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronLeft"},"fix":{"range":[80,96],"text":""},"desc":"Remove unused variable \"ChevronLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[148,157],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit3' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Edit3"},"fix":{"range":[201,210],"text":""},"desc":"Remove unused variable \"Edit3\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Eye"},"fix":{"range":[210,217],"text":""},"desc":"Remove unused variable \"Eye\"."}]},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/dashboard/novels/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":312,"column":13,"nodeType":"JSXOpeningElement","endLine":312,"endColumn":124},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/dashboard/novels/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":312,"column":13,"nodeType":"JSXOpeningElement","endLine":312,"endColumn":124},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/dashboard/novels/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":407,"column":15,"nodeType":"JSXOpeningElement","endLine":407,"endColumn":122},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/dashboard/novels/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":407,"column":15,"nodeType":"JSXOpeningElement","endLine":407,"endColumn":122}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { \n  Menu, \n  X, \n  ChevronLeft, \n  ChevronRight, \n  Home, \n  BookOpen, \n  Settings, \n  User,\n  Plus,\n  Search,\n  Filter,\n  Grid,\n  List,\n  Edit3,\n  Eye,\n  BarChart3,\n  Smartphone,\n  Tablet,\n  Monitor\n} from 'lucide-react'\n\ninterface ResponsiveLayoutProps {\n  children: React.ReactNode\n  sidebar?: React.ReactNode\n  header?: React.ReactNode\n  title?: string\n  showBreadcrumb?: boolean\n  breadcrumbItems?: Array<{ label: string; href?: string }>\n}\n\ntype DeviceType = 'mobile' | 'tablet' | 'desktop'\ntype ViewMode = 'grid' | 'list'\n\nexport default function ResponsiveLayout({\n  children,\n  sidebar,\n  header,\n  title,\n  showBreadcrumb = false,\n  breadcrumbItems = []\n}: ResponsiveLayoutProps) {\n  const [deviceType, setDeviceType] = useState<DeviceType>('desktop')\n  const [sidebarOpen, setSidebarOpen] = useState(false)\n  const [viewMode, setViewMode] = useState<ViewMode>('grid')\n  const [searchQuery, setSearchQuery] = useState('')\n  const [showMobileMenu, setShowMobileMenu] = useState(false)\n\n  useEffect(() => {\n    const handleResize = () => {\n      const width = window.innerWidth\n      if (width < 768) {\n        setDeviceType('mobile')\n        setSidebarOpen(false)\n      } else if (width < 1024) {\n        setDeviceType('tablet')\n        setSidebarOpen(false)\n      } else {\n        setDeviceType('desktop')\n        setSidebarOpen(true)\n      }\n    }\n\n    handleResize()\n    window.addEventListener('resize', handleResize)\n    return () => window.removeEventListener('resize', handleResize)\n  }, [])\n\n  const isMobile = deviceType === 'mobile'\n  const isTablet = deviceType === 'tablet'\n  const isDesktop = deviceType === 'desktop'\n\n  const getDeviceIcon = () => {\n    switch (deviceType) {\n      case 'mobile': return <Smartphone className=\"h-4 w-4\" />\n      case 'tablet': return <Tablet className=\"h-4 w-4\" />\n      case 'desktop': return <Monitor className=\"h-4 w-4\" />\n    }\n  }\n\n  const toggleSidebar = () => {\n    setSidebarOpen(!sidebarOpen)\n  }\n\n  const renderMobileHeader = () => (\n    <div className=\"bg-white border-b border-gray-200 px-4 py-3\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-3\">\n          <button\n            onClick={() => setShowMobileMenu(!showMobileMenu)}\n            className=\"p-2 hover:bg-gray-100 rounded-lg\"\n          >\n            <Menu className=\"h-5 w-5\" />\n          </button>\n          {title && (\n            <h1 className=\"text-lg font-semibold text-gray-900 truncate\">\n              {title}\n            </h1>\n          )}\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          <button className=\"p-2 hover:bg-gray-100 rounded-lg\">\n            <Search className=\"h-5 w-5\" />\n          </button>\n          <button className=\"p-2 hover:bg-gray-100 rounded-lg\">\n            <Plus className=\"h-5 w-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* 面包屑导航 */}\n      {showBreadcrumb && breadcrumbItems.length > 0 && (\n        <div className=\"flex items-center space-x-1 mt-3 text-sm text-gray-600 overflow-x-auto\">\n          {breadcrumbItems.map((item, index) => (\n            <div key={index} className=\"flex items-center\">\n              {item.href ? (\n                <a \n                  href={item.href}\n                  className=\"hover:text-indigo-600 transition-colors\"\n                >\n                  {item.label}\n                </a>\n              ) : (\n                <span className=\"text-gray-900 font-medium\">{item.label}</span>\n              )}\n              {index < breadcrumbItems.length - 1 && (\n                <ChevronRight className=\"h-4 w-4 mx-1 flex-shrink-0\" />\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n\n  const renderTabletHeader = () => (\n    <div className=\"bg-white border-b border-gray-200 px-6 py-4\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <button\n            onClick={toggleSidebar}\n            className=\"p-2 hover:bg-gray-100 rounded-lg\"\n          >\n            <Menu className=\"h-5 w-5\" />\n          </button>\n          {title && (\n            <h1 className=\"text-xl font-semibold text-gray-900\">{title}</h1>\n          )}\n        </div>\n\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"搜索...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10 pr-4 py-2 w-64 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            />\n          </div>\n          \n          <button className=\"p-2 hover:bg-gray-100 rounded-lg\">\n            <Filter className=\"h-5 w-5\" />\n          </button>\n          \n          <div className=\"flex items-center bg-gray-100 rounded-lg p-1\">\n            <button\n              onClick={() => setViewMode('grid')}\n              className={`p-1.5 rounded ${viewMode === 'grid' ? 'bg-white shadow-sm' : ''}`}\n            >\n              <Grid className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => setViewMode('list')}\n              className={`p-1.5 rounded ${viewMode === 'list' ? 'bg-white shadow-sm' : ''}`}\n            >\n              <List className=\"h-4 w-4\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* 面包屑导航 */}\n      {showBreadcrumb && breadcrumbItems.length > 0 && (\n        <div className=\"flex items-center space-x-2 mt-4 text-sm\">\n          {breadcrumbItems.map((item, index) => (\n            <div key={index} className=\"flex items-center\">\n              {item.href ? (\n                <a \n                  href={item.href}\n                  className=\"text-gray-600 hover:text-indigo-600 transition-colors\"\n                >\n                  {item.label}\n                </a>\n              ) : (\n                <span className=\"text-gray-900 font-medium\">{item.label}</span>\n              )}\n              {index < breadcrumbItems.length - 1 && (\n                <ChevronRight className=\"h-4 w-4 mx-2 text-gray-400\" />\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n\n  const renderDesktopHeader = () => (\n    <div className=\"bg-white border-b border-gray-200 px-8 py-4\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          {title && (\n            <h1 className=\"text-2xl font-semibold text-gray-900\">{title}</h1>\n          )}\n          {showBreadcrumb && breadcrumbItems.length > 0 && (\n            <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n              {breadcrumbItems.map((item, index) => (\n                <div key={index} className=\"flex items-center\">\n                  {item.href ? (\n                    <a \n                      href={item.href}\n                      className=\"hover:text-indigo-600 transition-colors\"\n                    >\n                      {item.label}\n                    </a>\n                  ) : (\n                    <span className=\"text-gray-900 font-medium\">{item.label}</span>\n                  )}\n                  {index < breadcrumbItems.length - 1 && (\n                    <ChevronRight className=\"h-4 w-4 mx-2 text-gray-400\" />\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"搜索...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10 pr-4 py-2 w-80 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            />\n          </div>\n          \n          <button className=\"p-2 hover:bg-gray-100 rounded-lg\">\n            <Filter className=\"h-5 w-5\" />\n          </button>\n          \n          <div className=\"flex items-center bg-gray-100 rounded-lg p-1\">\n            <button\n              onClick={() => setViewMode('grid')}\n              className={`p-1.5 rounded ${viewMode === 'grid' ? 'bg-white shadow-sm' : ''}`}\n            >\n              <Grid className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => setViewMode('list')}\n              className={`p-1.5 rounded ${viewMode === 'list' ? 'bg-white shadow-sm' : ''}`}\n            >\n              <List className=\"h-4 w-4\" />\n            </button>\n          </div>\n\n          <div className=\"flex items-center text-sm text-gray-600\">\n            {getDeviceIcon()}\n            <span className=\"ml-2\">\n              {deviceType === 'mobile' ? '手机视图' : \n               deviceType === 'tablet' ? '平板视图' : '桌面视图'}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n\n  const renderMobileSidebar = () => (\n    <div className={`fixed inset-0 z-50 ${showMobileMenu ? 'block' : 'hidden'}`}>\n      {/* 遮罩层 */}\n      <div \n        className=\"absolute inset-0 bg-black bg-opacity-50\"\n        onClick={() => setShowMobileMenu(false)}\n      />\n      \n      {/* 侧边栏 */}\n      <div className=\"absolute left-0 top-0 h-full w-72 bg-white shadow-xl\">\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\n          <h2 className=\"text-lg font-semibold\">菜单</h2>\n          <button\n            onClick={() => setShowMobileMenu(false)}\n            className=\"p-2 hover:bg-gray-100 rounded-lg\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n        \n        <div className=\"p-4\">\n          <nav className=\"space-y-2\">\n            <a href=\"/dashboard\" className=\"flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg\">\n              <Home className=\"h-5 w-5 mr-3\" />\n              首页\n            </a>\n            <a href=\"/dashboard/novels\" className=\"flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg\">\n              <BookOpen className=\"h-5 w-5 mr-3\" />\n              我的小说\n            </a>\n            <a href=\"/dashboard/statistics\" className=\"flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg\">\n              <BarChart3 className=\"h-5 w-5 mr-3\" />\n              数据统计\n            </a>\n            <a href=\"/dashboard/settings\" className=\"flex items-center px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg\">\n              <Settings className=\"h-5 w-5 mr-3\" />\n              设置\n            </a>\n          </nav>\n        </div>\n      </div>\n    </div>\n  )\n\n  const renderTabletSidebar = () => (\n    <div className={`fixed left-0 top-0 h-full w-64 bg-white border-r border-gray-200 transform transition-transform duration-300 z-40 ${\n      sidebarOpen ? 'translate-x-0' : '-translate-x-full'\n    }`}>\n      <div className=\"p-4\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h2 className=\"text-lg font-semibold\">创作中心</h2>\n          <button\n            onClick={toggleSidebar}\n            className=\"p-2 hover:bg-gray-100 rounded-lg\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n        \n        {sidebar}\n      </div>\n    </div>\n  )\n\n  const renderDesktopSidebar = () => (\n    <div className=\"w-64 bg-white border-r border-gray-200\">\n      <div className=\"p-6\">\n        {sidebar}\n      </div>\n    </div>\n  )\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* 移动端侧边栏 */}\n      {isMobile && renderMobileSidebar()}\n      \n      {/* 平板端侧边栏 */}\n      {isTablet && renderTabletSidebar()}\n      \n      {/* 遮罩层（平板端） */}\n      {isTablet && sidebarOpen && (\n        <div \n          className=\"fixed inset-0 bg-black bg-opacity-50 z-30\"\n          onClick={toggleSidebar}\n        />\n      )}\n\n      <div className=\"flex h-screen flex-col\">\n        {/* 头部 */}\n        {header || (\n          <header>\n            {isMobile && renderMobileHeader()}\n            {isTablet && renderTabletHeader()}\n            {isDesktop && renderDesktopHeader()}\n          </header>\n        )}\n\n        {/* 主内容区域 */}\n        <div className=\"flex flex-1 overflow-hidden\">\n          {/* 桌面端侧边栏 */}\n          {isDesktop && renderDesktopSidebar()}\n\n          {/* 内容区域 */}\n          <main className={`flex-1 overflow-y-auto ${\n            isMobile ? '' : isTablet ? (sidebarOpen ? 'ml-64' : '') : 'ml-64'\n          }`}>\n            <div className={`${isMobile ? 'p-4' : isTablet ? 'p-6' : 'p-8'}`}>\n              {children}\n            </div>\n          </main>\n        </div>\n\n        {/* 移动端底部导航 */}\n        {isMobile && (\n          <div className=\"bg-white border-t border-gray-200 px-4 py-2\">\n            <div className=\"flex items-center justify-around\">\n              <a href=\"/dashboard\" className=\"flex flex-col items-center p-2 text-gray-600 hover:text-indigo-600\">\n                <Home className=\"h-5 w-5\" />\n                <span className=\"text-xs mt-1\">首页</span>\n              </a>\n              <a href=\"/dashboard/novels\" className=\"flex flex-col items-center p-2 text-gray-600 hover:text-indigo-600\">\n                <BookOpen className=\"h-5 w-5\" />\n                <span className=\"text-xs mt-1\">小说</span>\n              </a>\n              <button className=\"flex flex-col items-center p-2 text-indigo-600\">\n                <Plus className=\"h-5 w-5\" />\n                <span className=\"text-xs mt-1\">新建</span>\n              </button>\n              <a href=\"/dashboard/statistics\" className=\"flex flex-col items-center p-2 text-gray-600 hover:text-indigo-600\">\n                <BarChart3 className=\"h-5 w-5\" />\n                <span className=\"text-xs mt-1\">统计</span>\n              </a>\n              <a href=\"/dashboard/settings\" className=\"flex flex-col items-center p-2 text-gray-600 hover:text-indigo-600\">\n                <Settings className=\"h-5 w-5\" />\n                <span className=\"text-xs mt-1\">设置</span>\n              </a>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* 响应式调试信息（开发环境） */}\n      {process.env.NODE_ENV === 'development' && (\n        <div className=\"fixed bottom-4 right-4 bg-black bg-opacity-75 text-white p-2 rounded-lg text-xs\">\n          <div className=\"flex items-center space-x-2\">\n            {getDeviceIcon()}\n            <span>{deviceType} - {window.innerWidth}px</span>\n            <span>{viewMode}</span>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\Workspace.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[116,131],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[245,257],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchWorkspaceData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\Workspace.tsx:57:5\n  55 |\n  56 |   useEffect(() => {\n> 57 |     fetchWorkspaceData()\n     |     ^^^^^^^^^^^^^^^^^^ `fetchWorkspaceData` accessed before it is declared\n  58 |   }, [])\n  59 |\n  60 |   const fetchWorkspaceData = async () => {\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\Workspace.tsx:60:3\n  58 |   }, [])\n  59 |\n> 60 |   const fetchWorkspaceData = async () => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |     try {\n     | ^^^^^^^^^\n> 62 |       // 获取基础统计数据（不需要token）\n     …\n     | ^^^^^^^^^\n> 93 |     }\n     | ^^^^^^^^^\n> 94 |   }\n     | ^^^^ `fetchWorkspaceData` is declared here\n  95 |\n  96 |   const handleBackup = async () => {\n  97 |     try {","line":57,"column":5,"nodeType":null,"endLine":57,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":416,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":416,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15786,15789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15786,15789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { \n  BookOpen, \n  Plus, \n  TrendingUp, \n  Clock, \n  Target, \n  Zap, \n  FileText,\n  Edit3,\n  BarChart3,\n  Star,\n  Calendar,\n  Users,\n  Brain,\n  Database,\n  Settings,\n  Download,\n  RefreshCw,\n  Shield,\n  Activity\n} from 'lucide-react'\n\nexport default function Workspace() {\n  const [stats, setStats] = useState({\n    totalNovels: 0,\n    totalChapters: 0,\n    totalWords: 0,\n    recentNovels: [],\n    todayWords: 0,\n    weekWords: 0,\n    streakDays: 0,\n    writingGoals: {\n      daily: 2000,\n      weekly: 10000\n    }\n  })\n\n  const [adminStats, setAdminStats] = useState({\n    totalUsers: 0,\n    totalNovels: 0,\n    totalChapters: 0,\n    totalWords: 0,\n    systemStatus: 'normal',\n    lastBackup: null,\n    databaseSize: '0 MB'\n  })\n\n  const [loading, setLoading] = useState(true)\n  const [showAdmin, setShowAdmin] = useState(false)\n  const [aiTips, setAiTips] = useState<string[]>([])\n\n  useEffect(() => {\n    fetchWorkspaceData()\n  }, [])\n\n  const fetchWorkspaceData = async () => {\n    try {\n      // 获取基础统计数据（不需要token）\n      const statsResponse = await fetch('/api/user/stats')\n      \n      if (statsResponse.ok) {\n        const data = await statsResponse.json()\n        setStats(prev => ({\n          ...prev,\n          ...data\n        }))\n      }\n\n      // 获取管理员统计数据\n      const adminResponse = await fetch('/api/admin/stats')\n      if (adminResponse.ok) {\n        const adminData = await adminResponse.json()\n        setAdminStats(adminData)\n      }\n\n      // 生成AI写作建议\n      setAiTips([\n        \"尝试设定固定的写作时间，养成创作习惯\",\n        \"大纲是小说的骨架，先构建好框架再填充细节\",\n        \"人物塑造要立体，给角色设定明确的动机和目标\",\n        \"多读优秀作品，学习他人的写作技巧和结构安排\",\n        \"每天坚持写作，即使只是几百字也很重要\"\n      ])\n\n      setLoading(false)\n    } catch (error) {\n      console.error('获取工作台数据失败:', error)\n      setLoading(false)\n    }\n  }\n\n  const handleBackup = async () => {\n    try {\n      const response = await fetch('/api/admin/backup', {\n        method: 'POST'\n      })\n      if (response.ok) {\n        const blob = await response.blob()\n        const url = window.URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `backup-${new Date().toISOString().split('T')[0]}.db`\n        document.body.appendChild(a)\n        a.click()\n        window.URL.revokeObjectURL(url)\n        document.body.removeChild(a)\n        alert('备份成功！')\n      }\n    } catch (error) {\n      console.error('备份失败:', error)\n      alert('备份失败，请重试')\n    }\n  }\n\n  const getProgressPercentage = (current: number, goal: number) => {\n    return Math.min((current / goal) * 100, 100)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-gray-200 rounded w-2/3\"></div>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {[1, 2, 3].map(i => (\n            <div key={i} className=\"bg-white p-6 rounded-lg shadow animate-pulse\">\n              <div className=\"h-4 bg-gray-200 rounded w-1/2 mb-2\"></div>\n              <div className=\"h-8 bg-gray-200 rounded w-3/4\"></div>\n            </div>\n          ))}\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 工作台标题 */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">工作台</h1>\n          <p className=\"mt-1 text-gray-600\">\n            管理你的创作项目，追踪写作进度，获取AI创作建议\n          </p>\n        </div>\n        <Link\n          href=\"/dashboard/novels/create\"\n          className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          新建小说\n        </Link>\n      </div>\n\n      {/* 个人创作统计横幅 */}\n      <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-6 text-white\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-xl font-semibold mb-2\">个人创作统计</h2>\n            <p className=\"text-blue-100\">\n              今日已写作 {stats.todayWords} 字，本周累计 {stats.weekWords} 字\n            </p>\n          </div>\n          <div className=\"hidden md:flex items-center space-x-6\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\">{stats.todayWords.toLocaleString()}</div>\n              <div className=\"text-sm text-blue-100\">今日字数</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\">{stats.streakDays}</div>\n              <div className=\"text-sm text-blue-100\">连续天数</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\">{stats.totalNovels}</div>\n              <div className=\"text-sm text-blue-100\">作品数量</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* 左侧主要内容 */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* 写作目标进度 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Target className=\"h-5 w-5 mr-2 text-blue-600\" />\n              写作目标\n            </h3>\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span className=\"text-gray-600\">今日目标</span>\n                  <span className=\"font-medium\">{stats.todayWords} / {stats.writingGoals.daily}</span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                  <div \n                    className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                    style={{ width: `${getProgressPercentage(stats.todayWords, stats.writingGoals.daily)}%` }}\n                  ></div>\n                </div>\n              </div>\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span className=\"text-gray-600\">本周目标</span>\n                  <span className=\"font-medium\">{stats.weekWords} / {stats.writingGoals.weekly}</span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                  <div \n                    className=\"bg-green-600 h-2 rounded-full transition-all duration-300\"\n                    style={{ width: `${getProgressPercentage(stats.weekWords, stats.writingGoals.weekly)}%` }}\n                  ></div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* 快速操作 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Zap className=\"h-5 w-5 mr-2 text-yellow-500\" />\n              快速操作\n            </h3>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <Link\n                href=\"/dashboard/novels/create\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-blue-100 rounded-lg p-2 group-hover:bg-blue-200\">\n                  <Plus className=\"h-5 w-5 text-blue-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"font-medium text-gray-900 text-sm\">创建新小说</p>\n                  <p className=\"text-xs text-gray-500\">开始新的创作</p>\n                </div>\n              </Link>\n\n              <Link\n                href=\"/dashboard/novels\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-green-100 rounded-lg p-2 group-hover:bg-green-200\">\n                  <BookOpen className=\"h-5 w-5 text-green-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"font-medium text-gray-900 text-sm\">我的作品</p>\n                  <p className=\"text-xs text-gray-500\">管理小说</p>\n                </div>\n              </Link>\n\n              <Link\n                href=\"/dashboard/ai-workshop\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-purple-100 rounded-lg p-2 group-hover:bg-purple-200\">\n                  <Brain className=\"h-5 w-5 text-purple-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"font-medium text-gray-900 text-sm\">AI助手</p>\n                  <p className=\"text-xs text-gray-500\">获取灵感</p>\n                </div>\n              </Link>\n\n              <Link\n                href=\"/dashboard/settings\"\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all\"\n              >\n                <div className=\"flex-shrink-0 bg-orange-100 rounded-lg p-2 group-hover:bg-orange-200\">\n                  <BarChart3 className=\"h-5 w-5 text-orange-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"font-medium text-gray-900 text-sm\">数据分析</p>\n                  <p className=\"text-xs text-gray-500\">查看统计</p>\n                </div>\n              </Link>\n\n              <button\n                onClick={() => setShowAdmin(!showAdmin)}\n                className=\"group flex items-center p-4 border border-gray-200 rounded-lg hover:border-red-500 hover:bg-red-50 transition-all w-full text-left\"\n              >\n                <div className=\"flex-shrink-0 bg-red-100 rounded-lg p-2 group-hover:bg-red-200\">\n                  <Shield className=\"h-5 w-5 text-red-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"font-medium text-gray-900 text-sm\">后台管理</p>\n                  <p className=\"text-xs text-gray-500\">系统管理</p>\n                </div>\n              </button>\n            </div>\n          </div>\n\n          {/* 后台管理面板 */}\n          {showAdmin && (\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                <Shield className=\"h-5 w-5 mr-2 text-red-600\" />\n                后台管理\n              </h3>\n              \n              {/* 系统统计 */}\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n                <div className=\"bg-blue-50 p-4 rounded-lg\">\n                  <div className=\"flex items-center\">\n                    <Users className=\"h-8 w-8 text-blue-600 mr-3\" />\n                    <div>\n                      <p className=\"text-sm text-gray-600\">总用户数</p>\n                      <p className=\"text-xl font-bold text-blue-600\">{adminStats.totalUsers}</p>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"bg-green-50 p-4 rounded-lg\">\n                  <div className=\"flex items-center\">\n                    <BookOpen className=\"h-8 w-8 text-green-600 mr-3\" />\n                    <div>\n                      <p className=\"text-sm text-gray-600\">总小说数</p>\n                      <p className=\"text-xl font-bold text-green-600\">{adminStats.totalNovels}</p>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"bg-purple-50 p-4 rounded-lg\">\n                  <div className=\"flex items-center\">\n                    <FileText className=\"h-8 w-8 text-purple-600 mr-3\" />\n                    <div>\n                      <p className=\"text-sm text-gray-600\">总章节数</p>\n                      <p className=\"text-xl font-bold text-purple-600\">{adminStats.totalChapters}</p>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"bg-orange-50 p-4 rounded-lg\">\n                  <div className=\"flex items-center\">\n                    <Edit3 className=\"h-8 w-8 text-orange-600 mr-3\" />\n                    <div>\n                      <p className=\"text-sm text-gray-600\">总字数</p>\n                      <p className=\"text-xl font-bold text-orange-600\">{adminStats.totalWords.toLocaleString()}</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* 系统操作 */}\n              <div className=\"border-t pt-4\">\n                <h4 className=\"text-md font-medium text-gray-900 mb-3\">系统操作</h4>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                  <button\n                    onClick={handleBackup}\n                    className=\"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n                  >\n                    <Download className=\"h-4 w-4 mr-2\" />\n                    数据库备份\n                  </button>\n                  \n                  <button\n                    onClick={fetchWorkspaceData}\n                    className=\"flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors\"\n                  >\n                    <RefreshCw className=\"h-4 w-4 mr-2\" />\n                    刷新数据\n                  </button>\n                  \n                  <div className=\"flex items-center justify-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg\">\n                    <Database className=\"h-4 w-4 mr-2\" />\n                    {adminStats.databaseSize}\n                  </div>\n                </div>\n              </div>\n\n              {/* 系统状态 */}\n              <div className=\"mt-4 p-4 bg-gray-50 rounded-lg\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <Activity className=\"h-5 w-5 text-green-600 mr-2\" />\n                    <span className=\"text-sm font-medium text-gray-900\">系统状态</span>\n                  </div>\n                  <span className={`px-2 py-1 text-xs font-medium rounded-full ${\n                    adminStats.systemStatus === 'normal' \n                      ? 'bg-green-100 text-green-800' \n                      : 'bg-red-100 text-red-800'\n                  }`}>\n                    {adminStats.systemStatus === 'normal' ? '正常运行' : '异常'}\n                  </span>\n                </div>\n                {adminStats.lastBackup && (\n                  <p className=\"text-xs text-gray-500 mt-2\">\n                    最后备份: {new Date(adminStats.lastBackup).toLocaleString()}\n                  </p>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* 最近作品 */}\n          {stats.recentNovels && stats.recentNovels.length > 0 && (\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-semibold text-gray-900 flex items-center\">\n                  <Clock className=\"h-5 w-5 mr-2 text-blue-600\" />\n                  最近编辑\n                </h3>\n                <Link\n                  href=\"/dashboard/novels\"\n                  className=\"text-sm text-blue-600 hover:text-blue-800\"\n                >\n                  查看全部\n                </Link>\n              </div>\n              <div className=\"space-y-3\">\n                {stats.recentNovels.slice(0, 3).map((novel: any) => (\n                  <Link\n                    key={novel.id}\n                    href={`/dashboard/novels/${novel.id}`}\n                    className=\"block p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\"\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-base font-medium text-gray-900 truncate\">{novel.title}</p>\n                        <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\n                          {novel.description || '暂无描述'}\n                        </p>\n                      </div>\n                      <div className=\"ml-4 flex-shrink-0 text-right\">\n                        <p className=\"text-sm text-gray-500\">\n                          {new Date(novel.updatedAt).toLocaleDateString()}\n                        </p>\n                        <div className=\"flex items-center mt-1\">\n                          <Star className=\"h-4 w-4 text-yellow-400 fill-current\" />\n                          <span className=\"text-xs text-gray-500 ml-1\">进行中</span>\n                        </div>\n                      </div>\n                    </div>\n                  </Link>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* 右侧面板 */}\n        <div className=\"space-y-6\">\n          {/* 创作统计卡片 */}\n          <div className=\"grid grid-cols-1 gap-4\">\n            <div className=\"bg-white shadow rounded-lg p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0 bg-blue-100 rounded-lg p-2\">\n                  <FileText className=\"h-5 w-5 text-blue-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"text-sm text-gray-500\">章节总数</p>\n                  <p className=\"text-lg font-semibold text-gray-900\">{stats.totalChapters}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white shadow rounded-lg p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0 bg-green-100 rounded-lg p-2\">\n                  <Edit3 className=\"h-5 w-5 text-green-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"text-sm text-gray-500\">总字数</p>\n                  <p className=\"text-lg font-semibold text-gray-900\">{stats.totalWords.toLocaleString()}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* AI写作建议 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Brain className=\"h-5 w-5 mr-2 text-purple-600\" />\n              AI写作建议\n            </h3>\n            <div className=\"space-y-3\">\n              {aiTips.map((tip, index) => (\n                <div key={index} className=\"flex items-start\">\n                  <div className=\"flex-shrink-0 w-2 h-2 bg-purple-400 rounded-full mt-2\"></div>\n                  <p className=\"ml-3 text-sm text-gray-600 leading-relaxed\">{tip}</p>\n                </div>\n              ))}\n            </div>\n            <div className=\"mt-4 pt-4 border-t border-gray-200\">\n              <Link\n                href=\"/dashboard/ai-workshop\"\n                className=\"flex items-center text-sm text-purple-600 hover:text-purple-800 font-medium\"\n              >\n                获取更多灵感\n                <svg className=\"ml-1 h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </Link>\n            </div>\n          </div>\n\n          {/* 创作日历 */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <Calendar className=\"h-5 w-5 mr-2 text-blue-600\" />\n              创作记录\n            </h3>\n            <div className=\"text-center py-4\">\n              <div className=\"text-3xl font-bold text-blue-600\">{stats.streakDays}</div>\n              <p className=\"text-sm text-gray-500 mt-1\">连续创作天数</p>\n              <div className=\"mt-4 flex justify-center\">\n                <div className=\"flex space-x-1\">\n                  {[1, 2, 3, 4, 5, 6, 7].map((day) => (\n                    <div\n                      key={day}\n                      className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium ${\n                        day <= 3 \n                          ? 'bg-green-100 text-green-800' \n                          : 'bg-gray-100 text-gray-500'\n                      }`}\n                    >\n                      {day <= 3 ? '✓' : day}\n                    </div>\n                  ))}\n                </div>\n              </div>\n              <p className=\"text-xs text-gray-400 mt-3\">最近7天创作情况</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\WritingProgress.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":5,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[70,81],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[101,114],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[315,318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[315,318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generatingChapter' is defined but never used.","line":32,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDailyGoal' is assigned a value but never used.","line":33,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalWords' is assigned a value but never used.","line":40,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'averageWordsPerChapter' is assigned a value but never used.","line":53,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":53,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { \n  TrendingUp, \n  Target, \n  Clock, \n  Calendar, \n  Award,\n  BookOpen,\n  Zap,\n  Coffee,\n  Flame,\n  BarChart3,\n  Lightbulb\n} from 'lucide-react'\n\ninterface Novel {\n  id: string\n  title: string\n  wordCount: number\n  chapterCount: number\n  chapters?: any[]\n  updatedAt: string\n}\n\ninterface WritingProgressProps {\n  novel: Novel\n  generatingChapter?: string | null\n}\n\nexport default function WritingProgress({ novel, generatingChapter }: WritingProgressProps) {\n  const [dailyGoal, setDailyGoal] = useState(1000)\n  const [todayWords, setTodayWords] = useState(0)\n  const [weeklyWords, setWeeklyWords] = useState(0)\n  const [streak, setStreak] = useState(0)\n\n  useEffect(() => {\n    // 模拟数据计算\n    const totalWords = novel.chapters?.reduce((sum, chapter) => \n      sum + (chapter.wordCount || 0), 0) || 0\n    \n    // 模拟今日写作字数（实际应用中应从后端获取）\n    setTodayWords(Math.floor(Math.random() * 1500))\n    setWeeklyWords(Math.floor(Math.random() * 8000))\n    setStreak(Math.floor(Math.random() * 30) + 1)\n  }, [novel.chapters])\n\n  const progressPercentage = Math.min((todayWords / dailyGoal) * 100, 100)\n  const totalWords = novel.chapters?.reduce((sum, chapter) => \n    sum + (chapter.wordCount || 0), 0) || 0\n  const completedChapters = novel.chapters?.filter(ch => ch.content).length || 0\n  const averageWordsPerChapter = completedChapters > 0 ? Math.round(totalWords / completedChapters) : 0\n\n  const stats = [\n    {\n      title: '今日进度',\n      value: `${todayWords}/${dailyGoal}`,\n      subtitle: `${progressPercentage.toFixed(0)}% 完成`,\n      icon: Target,\n      color: 'bg-blue-50 text-blue-600',\n      progress: progressPercentage\n    },\n    {\n      title: '本周写作',\n      value: `${weeklyWords} 字`,\n      subtitle: `日均 ${(weeklyWords / 7).toFixed(0)} 字`,\n      icon: BarChart3,\n      color: 'bg-green-50 text-green-600',\n      progress: Math.min((weeklyWords / 7000) * 100, 100)\n    },\n    {\n      title: '写作连续',\n      value: `${streak} 天`,\n      subtitle: '保持写作习惯',\n      icon: Flame,\n      color: 'bg-orange-50 text-orange-600',\n      progress: Math.min((streak / 30) * 100, 100)\n    },\n    {\n      title: '总进度',\n      value: `${totalWords.toLocaleString()} 字`,\n      subtitle: `${completedChapters}/${novel.chapters?.length || 0} 章节`,\n      icon: BookOpen,\n      color: 'bg-purple-50 text-purple-600',\n      progress: novel.chapters?.length ? (completedChapters / novel.chapters.length) * 100 : 0\n    }\n  ]\n\n  const writingTips = [\n    { icon: Coffee, text: '适当休息，保持创作状态' },\n    { icon: Lightbulb, text: '记录灵感，随时捕捉想法' },\n    { icon: Zap, text: '设定小目标，逐步完成' },\n    { icon: Clock, text: '固定写作时间，养成习惯' }\n  ]\n\n  const achievements = [\n    { title: '新手上路', description: '完成第一个章节', unlocked: completedChapters >= 1 },\n    { title: '勤奋作家', description: '连续写作7天', unlocked: streak >= 7 },\n    { title: '万字巨作', description: '总字数突破1万字', unlocked: totalWords >= 10000 },\n    { title: '章节大师', description: '完成20个章节', unlocked: completedChapters >= 20 }\n  ]\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n      {stats.map((stat, index) => {\n        const Icon = stat.icon\n        return (\n          <div key={index} className=\"bg-white rounded-xl border border-gray-200 p-4 hover:shadow-md transition-shadow\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className={`p-2 rounded-lg ${stat.color}`}>\n                <Icon className=\"h-5 w-5\" />\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-2xl font-bold text-gray-900\">{stat.value}</div>\n                <div className=\"text-xs text-gray-500\">{stat.subtitle}</div>\n              </div>\n            </div>\n            \n            {/* 进度条 */}\n            <div className=\"mt-3\">\n              <div className=\"w-full bg-gray-200 rounded-full h-1.5\">\n                <div \n                  className=\"bg-gradient-to-r from-indigo-500 to-purple-500 h-1.5 rounded-full transition-all duration-300\"\n                  style={{ width: `${stat.progress}%` }}\n                ></div>\n              </div>\n            </div>\n\n            <div className=\"mt-2\">\n              <p className=\"text-sm font-medium text-gray-900\">{stat.title}</p>\n            </div>\n          </div>\n        )\n      })}\n    </div>\n  )\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 写作统计卡片 */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {stats.map((stat, index) => {\n          const Icon = stat.icon\n          return (\n            <div key={index} className=\"bg-white rounded-xl border border-gray-200 p-4 hover:shadow-md transition-shadow\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <div className={`p-2 rounded-lg ${stat.color}`}>\n                  <Icon className=\"h-5 w-5\" />\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-2xl font-bold text-gray-900\">{stat.value}</div>\n                  <div className=\"text-xs text-gray-500\">{stat.subtitle}</div>\n                </div>\n              </div>\n              \n              {/* 进度条 */}\n              <div className=\"mt-3\">\n                <div className=\"w-full bg-gray-200 rounded-full h-1.5\">\n                  <div \n                    className=\"bg-gradient-to-r from-indigo-500 to-purple-500 h-1.5 rounded-full transition-all duration-300\"\n                    style={{ width: `${stat.progress}%` }}\n                  ></div>\n                </div>\n              </div>\n\n              <div className=\"mt-2\">\n                <p className=\"text-sm font-medium text-gray-900\">{stat.title}</p>\n              </div>\n            </div>\n          )\n        })}\n      </div>\n\n      {/* 写作建议 */}\n      <div className=\"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 border border-indigo-100\">\n        <div className=\"flex items-center gap-3 mb-4\">\n          <Lightbulb className=\"h-6 w-6 text-indigo-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">写作建议</h3>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {writingTips.map((tip, index) => {\n            const Icon = tip.icon\n            return (\n              <div key={index} className=\"flex items-center gap-3 bg-white rounded-lg p-3\">\n                <Icon className=\"h-5 w-5 text-indigo-500\" />\n                <p className=\"text-sm text-gray-700\">{tip.text}</p>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n\n      {/* 成就系统 */}\n      <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n        <div className=\"flex items-center gap-3 mb-4\">\n          <Award className=\"h-6 w-6 text-yellow-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">写作成就</h3>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {achievements.map((achievement, index) => (\n            <div \n              key={index}\n              className={`p-4 rounded-lg border-2 transition-all ${\n                achievement.unlocked \n                  ? 'border-yellow-300 bg-yellow-50' \n                  : 'border-gray-200 bg-gray-50 opacity-60'\n              }`}\n            >\n              <div className=\"flex items-center gap-2 mb-2\">\n                <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                  achievement.unlocked ? 'bg-yellow-400' : 'bg-gray-300'\n                }`}>\n                  <Award className={`h-4 w-4 ${achievement.unlocked ? 'text-white' : 'text-gray-500'}`} />\n                </div>\n                <h4 className={`font-medium ${achievement.unlocked ? 'text-gray-900' : 'text-gray-500'}`}>\n                  {achievement.title}\n                </h4>\n              </div>\n              <p className=\"text-xs text-gray-600\">{achievement.description}</p>\n              {achievement.unlocked && (\n                <div className=\"mt-2 text-xs text-yellow-600 font-medium\">\n                  ✓ 已解锁\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\WritingToolbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Link"},"fix":{"range":[195,203],"text":""},"desc":"Remove unused variable \"Link\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Image"},"fix":{"range":[203,212],"text":""},"desc":"Remove unused variable \"Image\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Video' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Video"},"fix":{"range":[212,221],"text":""},"desc":"Remove unused variable \"Video\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Smile' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Smile"},"fix":{"range":[221,230],"text":""},"desc":"Remove unused variable \"Smile\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Hash' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Hash"},"fix":{"range":[230,238],"text":""},"desc":"Remove unused variable \"Hash\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AtSign' is defined but never used.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AtSign"},"fix":{"range":[238,248],"text":""},"desc":"Remove unused variable \"AtSign\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Palette' is defined but never used.","line":22,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Palette"},"fix":{"range":[256,267],"text":""},"desc":"Remove unused variable \"Palette\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Highlighter' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Highlighter"},"fix":{"range":[267,282],"text":""},"desc":"Remove unused variable \"Highlighter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Undo' is defined but never used.","line":25,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Undo"},"fix":{"range":[290,298],"text":""},"desc":"Remove unused variable \"Undo\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Redo' is defined but never used.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Redo"},"fix":{"range":[298,306],"text":""},"desc":"Remove unused variable \"Redo\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Copy' is defined but never used.","line":27,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Copy"},"fix":{"range":[306,314],"text":""},"desc":"Remove unused variable \"Copy\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used.","line":29,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Upload"},"fix":{"range":[326,336],"text":""},"desc":"Remove unused variable \"Upload\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Maximize2' is defined but never used.","line":32,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Maximize2"},"fix":{"range":[353,366],"text":""},"desc":"Remove unused variable \"Maximize2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Minimize2' is defined but never used.","line":33,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Minimize2"},"fix":{"range":[366,379],"text":""},"desc":"Remove unused variable \"Minimize2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":34,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[379,391],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":45,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Play"},"fix":{"range":[501,509],"text":""},"desc":"Remove unused variable \"Play\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pause' is defined but never used.","line":46,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Pause"},"fix":{"range":[509,518],"text":""},"desc":"Remove unused variable \"Pause\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showFormatMenu' is assigned a value but never used.","line":77,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowFormatMenu' is assigned a value but never used.","line":77,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showInsertMenu' is assigned a value but never used.","line":78,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowInsertMenu' is assigned a value but never used.","line":78,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAIMenu' is assigned a value but never used.","line":79,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowAIMenu' is assigned a value but never used.","line":79,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'writingStreak' is assigned a value but never used.","line":81,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":81,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setWritingStreak' is assigned a value but never used.","line":81,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":81,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleAutoSave'. Either include it or remove the dependency array.","line":107,"column":6,"nodeType":"ArrayExpression","endLine":107,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [content, handleAutoSave]","fix":{"range":[2021,2030],"text":"[content, handleAutoSave]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedText' is assigned a value but never used.","line":183,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":183,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":205,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { \n  Bold, \n  Italic, \n  Underline, \n  AlignLeft, \n  AlignCenter, \n  AlignRight,\n  List, \n  ListOrdered, \n  Quote, \n  Code,\n  Link,\n  Image,\n  Video,\n  Smile,\n  Hash,\n  AtSign,\n  Type,\n  Palette,\n  Highlighter,\n  Save,\n  Undo,\n  Redo,\n  Copy,\n  Download,\n  Upload,\n  Eye,\n  EyeOff,\n  Maximize2,\n  Minimize2,\n  Settings,\n  HelpCircle,\n  Zap,\n  Target,\n  Clock,\n  TrendingUp,\n  BookOpen,\n  Coffee,\n  Brain,\n  Sparkles,\n  RefreshCw,\n  Play,\n  Pause,\n  Sun,\n  Moon\n} from 'lucide-react'\n\ninterface WritingToolbarProps {\n  content: string\n  onContentChange: (content: string) => void\n  onSave?: () => void\n  darkMode?: boolean\n  focusMode?: boolean\n  onDarkModeToggle?: () => void\n  onFocusModeToggle?: () => void\n  wordCount?: number\n  readingTime?: number\n  writingGoal?: number\n}\n\nexport default function WritingToolbar({\n  content,\n  onContentChange,\n  onSave,\n  darkMode = false,\n  focusMode = false,\n  onDarkModeToggle,\n  onFocusModeToggle,\n  wordCount = 0,\n  readingTime = 0,\n  writingGoal = 5000\n}: WritingToolbarProps) {\n  const [isSaving, setIsSaving] = useState(false)\n  const [showFormatMenu, setShowFormatMenu] = useState(false)\n  const [showInsertMenu, setShowInsertMenu] = useState(false)\n  const [showAIMenu, setShowAIMenu] = useState(false)\n  const [lastSaved, setLastSaved] = useState<Date | null>(null)\n  const [writingStreak, setWritingStreak] = useState(0)\n  const [sessionTime, setSessionTime] = useState(0)\n  const timerRef = useRef<NodeJS.Timeout | null>(null)\n\n  useEffect(() => {\n    // 会话计时器\n    timerRef.current = setInterval(() => {\n      setSessionTime(prev => prev + 1)\n    }, 1000)\n\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current)\n      }\n    }\n  }, [])\n\n  useEffect(() => {\n    // 自动保存\n    const autoSaveTimer = setTimeout(() => {\n      if (content && content.trim()) {\n        handleAutoSave()\n      }\n    }, 30000) // 30秒自动保存\n\n    return () => clearTimeout(autoSaveTimer)\n  }, [content])\n\n  const handleAutoSave = async () => {\n    setIsSaving(true)\n    try {\n      if (onSave) {\n        await onSave()\n      }\n      setLastSaved(new Date())\n    } catch (error) {\n      console.error('自动保存失败:', error)\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  const handleManualSave = async () => {\n    setIsSaving(true)\n    try {\n      if (onSave) {\n        await onSave()\n      }\n      setLastSaved(new Date())\n    } catch (error) {\n      console.error('保存失败:', error)\n      alert('保存失败，请重试')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  const formatText = (format: string) => {\n    const textarea = document.getElementById('editor-textarea') as HTMLTextAreaElement\n    if (!textarea) return\n\n    const start = textarea.selectionStart\n    const end = textarea.selectionEnd\n    const selectedText = content.substring(start, end)\n    let formattedText = ''\n\n    switch (format) {\n      case 'bold':\n        formattedText = `**${selectedText}**`\n        break\n      case 'italic':\n        formattedText = `*${selectedText}*`\n        break\n      case 'underline':\n        formattedText = `__${selectedText}__`\n        break\n      case 'heading':\n        formattedText = `## ${selectedText}`\n        break\n      case 'quote':\n        formattedText = `> ${selectedText}`\n        break\n      case 'code':\n        formattedText = `\\`${selectedText}\\``\n        break\n      case 'link':\n        formattedText = `[${selectedText}](url)`\n        break\n      default:\n        formattedText = selectedText\n    }\n\n    const newContent = content.substring(0, start) + formattedText + content.substring(end)\n    onContentChange(newContent)\n  }\n\n  const generateAIContent = async (type: string) => {\n    const textarea = document.getElementById('editor-textarea') as HTMLTextAreaElement\n    if (!textarea) return\n\n    const start = textarea.selectionStart\n    const end = textarea.selectionEnd\n    const selectedText = content.substring(start, end)\n\n    try {\n      // 模拟AI生成，实际应用中应该调用API\n      let aiContent = ''\n      switch (type) {\n        case 'continue':\n          aiContent = '\\n\\n[AI续写内容]这是根据上下文自动生成的内容...'\n          break\n        case 'improve':\n          aiContent = '[AI优化内容]这段文字经过AI优化，表达更加流畅...'\n          break\n        case 'summary':\n          aiContent = '[AI摘要]本文主要讲述了...'\n          break\n        case 'ideas':\n          aiContent = '[AI创意]以下是一些写作建议和创意点子...'\n          break\n      }\n\n      const newContent = content.substring(0, start) + aiContent + content.substring(end)\n      onContentChange(newContent)\n    } catch (error) {\n      alert('AI生成失败，请重试')\n    }\n  }\n\n  const exportContent = (format: 'txt' | 'md' | 'docx') => {\n    const exportContent = content\n    let filename = `writing_${new Date().toISOString().split('T')[0]}`\n    let mimeType = 'text/plain'\n\n    switch (format) {\n      case 'md':\n        filename += '.md'\n        mimeType = 'text/markdown'\n        break\n      case 'docx':\n        filename += '.docx'\n        mimeType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n        break\n      default:\n        filename += '.txt'\n    }\n\n    const blob = new Blob([exportContent], { type: mimeType })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = filename\n    document.body.appendChild(a)\n    a.click()\n    document.body.removeChild(a)\n    URL.revokeObjectURL(url)\n  }\n\n  const formatSessionTime = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600)\n    const minutes = Math.floor((seconds % 3600) / 60)\n    const secs = seconds % 60\n    \n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`\n  }\n\n  const writingProgress = Math.min((wordCount / writingGoal) * 100, 100)\n\n  return (\n    <div className={`border-b ${darkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-white'} px-4 py-2`}>\n      {/* 第一行：格式化工具 */}\n      <div className=\"flex items-center justify-between mb-2\">\n        <div className=\"flex items-center space-x-1\">\n          {/* 文本格式化 */}\n          <div className=\"flex items-center space-x-1 px-2 py-1 rounded border border-gray-300\">\n            <button\n              onClick={() => formatText('bold')}\n              className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\"\n              title=\"加粗 (Ctrl+B)\"\n            >\n              <Bold className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => formatText('italic')}\n              className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\"\n              title=\"斜体 (Ctrl+I)\"\n            >\n              <Italic className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => formatText('underline')}\n              className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\"\n              title=\"下划线 (Ctrl+U)\"\n            >\n              <Underline className=\"h-4 w-4\" />\n            </button>\n            <div className=\"w-px h-4 bg-gray-300 mx-1\" />\n            <button\n              onClick={() => formatText('heading')}\n              className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\"\n              title=\"标题\"\n            >\n              <Type className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => formatText('quote')}\n              className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\"\n              title=\"引用\"\n            >\n              <Quote className=\"h-4 w-4\" />\n            </button>\n            <button\n              onClick={() => formatText('code')}\n              className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\"\n              title=\"代码\"\n            >\n              <Code className=\"h-4 w-4\" />\n            </button>\n          </div>\n\n          {/* 列表和对齐 */}\n          <div className=\"flex items-center space-x-1 px-2 py-1 rounded border border-gray-300\">\n            <button className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\" title=\"无序列表\">\n              <List className=\"h-4 w-4\" />\n            </button>\n            <button className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\" title=\"有序列表\">\n              <ListOrdered className=\"h-4 w-4\" />\n            </button>\n            <div className=\"w-px h-4 bg-gray-300 mx-1\" />\n            <button className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\" title=\"左对齐\">\n              <AlignLeft className=\"h-4 w-4\" />\n            </button>\n            <button className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\" title=\"居中对齐\">\n              <AlignCenter className=\"h-4 w-4\" />\n            </button>\n            <button className=\"p-1.5 hover:bg-gray-100 rounded transition-colors\" title=\"右对齐\">\n              <AlignRight className=\"h-4 w-4\" />\n            </button>\n          </div>\n\n          {/* AI工具 */}\n          <div className=\"flex items-center space-x-1 px-2 py-1 rounded border border-purple-300 bg-purple-50\">\n            <button\n              onClick={() => generateAIContent('continue')}\n              className=\"p-1.5 hover:bg-purple-100 rounded transition-colors\"\n              title=\"AI续写\"\n            >\n              <Sparkles className=\"h-4 w-4 text-purple-600\" />\n            </button>\n            <button\n              onClick={() => generateAIContent('improve')}\n              className=\"p-1.5 hover:bg-purple-100 rounded transition-colors\"\n              title=\"AI优化\"\n            >\n              <Brain className=\"h-4 w-4 text-purple-600\" />\n            </button>\n            <button\n              onClick={() => generateAIContent('ideas')}\n              className=\"p-1.5 hover:bg-purple-100 rounded transition-colors\"\n              title=\"AI创意\"\n            >\n              <Zap className=\"h-4 w-4 text-purple-600\" />\n            </button>\n          </div>\n        </div>\n\n        {/* 右侧操作按钮 */}\n        <div className=\"flex items-center space-x-2\">\n          {/* 保存状态 */}\n          <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n            {isSaving ? (\n              <div className=\"flex items-center\">\n                <RefreshCw className=\"h-4 w-4 animate-spin mr-1\" />\n                保存中...\n              </div>\n            ) : lastSaved ? (\n              <div className=\"flex items-center\">\n                <Save className=\"h-4 w-4 mr-1\" />\n                已保存 {lastSaved.toLocaleTimeString()}\n              </div>\n            ) : (\n              <button\n                onClick={handleManualSave}\n                className=\"flex items-center px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors\"\n              >\n                <Save className=\"h-4 w-4 mr-1\" />\n                保存\n              </button>\n            )}\n          </div>\n\n          {/* 视图控制 */}\n          <div className=\"flex items-center space-x-1\">\n            {onDarkModeToggle && (\n              <button\n                onClick={onDarkModeToggle}\n                className=\"p-2 hover:bg-gray-100 rounded transition-colors\"\n                title=\"切换主题\"\n              >\n                {darkMode ? <Sun className=\"h-4 w-4\" /> : <Moon className=\"h-4 w-4\" />}\n              </button>\n            )}\n            {onFocusModeToggle && (\n              <button\n                onClick={onFocusModeToggle}\n                className=\"p-2 hover:bg-gray-100 rounded transition-colors\"\n                title=\"专注模式\"\n              >\n                {focusMode ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n              </button>\n            )}\n            <button\n              onClick={() => exportContent('md')}\n              className=\"p-2 hover:bg-gray-100 rounded transition-colors\"\n              title=\"导出\"\n            >\n              <Download className=\"h-4 w-4\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* 第二行：写作统计和进度 */}\n      <div className=\"flex items-center justify-between text-sm\">\n        <div className=\"flex items-center space-x-4\">\n          {/* 字数统计 */}\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"flex items-center text-gray-600\">\n              <Type className=\"h-4 w-4 mr-1\" />\n              字数: <span className=\"font-medium ml-1\">{wordCount.toLocaleString()}</span>\n            </div>\n            <div className=\"flex items-center text-gray-600\">\n              <Clock className=\"h-4 w-4 mr-1\" />\n              预计阅读: <span className=\"font-medium ml-1\">{readingTime}分钟</span>\n            </div>\n            <div className=\"flex items-center text-gray-600\">\n              <TrendingUp className=\"h-4 w-4 mr-1\" />\n              会话时长: <span className=\"font-medium ml-1\">{formatSessionTime(sessionTime)}</span>\n            </div>\n          </div>\n\n          {/* 写作目标进度 */}\n          <div className=\"flex items-center space-x-2\">\n            <Target className=\"h-4 w-4 text-gray-600\" />\n            <div className=\"w-32 h-2 bg-gray-200 rounded-full overflow-hidden\">\n              <div \n                className=\"h-full bg-gradient-to-r from-blue-500 to-green-500 transition-all duration-300\"\n                style={{ width: `${writingProgress}%` }}\n              />\n            </div>\n            <span className=\"text-xs text-gray-600\">\n              {wordCount.toLocaleString()} / {writingGoal.toLocaleString()}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"flex items-center space-x-3 text-gray-600\">\n          {/* 写作激励 */}\n          <div className=\"flex items-center\">\n            <Coffee className=\"h-4 w-4 mr-1\" />\n            <span className=\"text-xs\">保持专注！</span>\n          </div>\n          {writingProgress >= 100 && (\n            <div className=\"flex items-center text-green-600\">\n              <BookOpen className=\"h-4 w-4 mr-1\" />\n              <span className=\"text-xs font-medium\">目标达成！🎉</span>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* 快捷键提示 */}\n      <div className=\"hidden md:flex items-center justify-between mt-2 text-xs text-gray-500\">\n        <div className=\"flex items-center space-x-4\">\n          <span>Ctrl+S 保存</span>\n          <span>Ctrl+B 加粗</span>\n          <span>Ctrl+I 斜体</span>\n          <span>Ctrl+U 下划线</span>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <HelpCircle className=\"h-3 w-3\" />\n          <span>按 H 查看更多快捷键</span>\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\components\\WritingWorkspace.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[31,42],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":6,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[78,91],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BarChart3"},"fix":{"range":[111,125],"text":""},"desc":"Remove unused variable \"BarChart3\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Target"},"fix":{"range":[158,168],"text":""},"desc":"Remove unused variable \"Target\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Zap"},"fix":{"range":[178,185],"text":""},"desc":"Remove unused variable \"Zap\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PenTool' is defined but never used.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"PenTool"},"fix":{"range":[231,242],"text":""},"desc":"Remove unused variable \"PenTool\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lightbulb' is defined but never used.","line":22,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Lightbulb"},"fix":{"range":[242,255],"text":""},"desc":"Remove unused variable \"Lightbulb\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MessageSquare"},"fix":{"range":[255,272],"text":""},"desc":"Remove unused variable \"MessageSquare\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Hash' is defined but never used.","line":24,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Hash"},"fix":{"range":[272,280],"text":""},"desc":"Remove unused variable \"Hash\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bookmark' is defined but never used.","line":25,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Bookmark"},"fix":{"range":[280,292],"text":""},"desc":"Remove unused variable \"Bookmark\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":27,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[302,312],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":29,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[320,334],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":30,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[334,346],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Award' is defined but never used.","line":31,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Award"},"fix":{"range":[346,355],"text":""},"desc":"Remove unused variable \"Award\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Coffee' is defined but never used.","line":32,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Coffee"},"fix":{"range":[355,365],"text":""},"desc":"Remove unused variable \"Coffee\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5060,5063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5060,5063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { \n  BookOpen, \n  Settings, \n  Users, \n  Globe, \n  BarChart3,\n  FileText,\n  Sparkles,\n  Clock,\n  Target,\n  Layers,\n  Zap,\n  Edit3,\n  Save,\n  Menu,\n  X,\n  ChevronRight,\n  PenTool,\n  Lightbulb,\n  MessageSquare,\n  Hash,\n  Bookmark,\n  Search,\n  Filter,\n  Plus,\n  TrendingUp,\n  Calendar,\n  Award,\n  Coffee\n} from 'lucide-react'\nimport { useAutoSave } from '@/hooks/useAutoSave'\nimport AutoSaveIndicator from '@/components/AutoSaveIndicator'\nimport ChapterList from '@/components/ChapterList'\nimport AIAssistant from '@/components/AIAssistant'\nimport QuickActions from '@/components/QuickActions'\nimport WritingProgress from '@/components/WritingProgress'\n\ninterface Novel {\n  id: string\n  title: string\n  description?: string\n  outline?: string\n  worldSetting?: string\n  protagonist?: string\n  chapters?: Chapter[]\n  createdAt: string\n  updatedAt: string\n  wordCount: number\n  chapterCount: number\n}\n\ninterface Chapter {\n  id: string\n  title: string\n  summary?: string\n  content?: string\n  order: number\n  wordCount?: number\n  status?: string\n  isAIGenerated?: boolean\n  createdAt: string\n  updatedAt: string\n}\n\ninterface WritingWorkspaceProps {\n  novel: Novel\n  onChapterSelect: (chapter: Chapter) => void\n  onChapterEdit: (chapter: Chapter) => void\n  onChapterDelete: (chapter: Chapter) => void\n  onChapterReorder: (chapters: Chapter[]) => void\n  generatingChapter?: string | null\n}\n\nexport default function WritingWorkspace({\n  novel,\n  onChapterSelect,\n  onChapterEdit,\n  onChapterDelete,\n  onChapterReorder,\n  generatingChapter\n}: WritingWorkspaceProps) {\n  const [activeTab, setActiveTab] = useState<'chapters' | 'outline' | 'worldview' | 'characters'>('chapters')\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false)\n  const [rightPanelCollapsed, setRightPanelCollapsed] = useState(false)\n  const [searchQuery, setSearchQuery] = useState('')\n\n  // 使用自动保存Hook\n  const { savingStatus, save, hasUnsavedChanges } = useAutoSave(novel, {\n    delay: 5000,\n    onSave: async (currentNovel) => {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novel.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(currentNovel)\n      })\n      \n      if (!response.ok) {\n        throw new Error('保存失败')\n      }\n      \n      return response.json()\n    }\n  })\n\n  const navigationItems = [\n    { id: 'chapters', label: '章节管理', icon: FileText, count: novel.chapters?.length || 0 },\n    { id: 'outline', label: '大纲结构', icon: Layers, count: 0 },\n    { id: 'worldview', label: '世界观', icon: Globe, count: 0 },\n    { id: 'characters', label: '角色管理', icon: Users, count: 0 },\n  ]\n\n  const quickActions = [\n    { icon: Plus, label: '新建章节', color: 'blue' as const },\n    { icon: Sparkles, label: 'AI生成', color: 'purple' as const },\n    { icon: Edit3, label: '批量编辑', color: 'green' as const },\n    { icon: Save, label: '导出文档', color: 'orange' as const },\n  ]\n\n  const getSavingStatus = () => {\n    switch (savingStatus) {\n      case 'saving':\n        return { text: '保存中...', color: 'text-yellow-600', icon: Clock }\n      case 'saved':\n        return { text: '已保存', color: 'text-green-600', icon: Save }\n      case 'error':\n        return { text: '保存失败', color: 'text-red-600', icon: X }\n      default:\n        return { text: '就绪', color: 'text-gray-600', icon: Check }\n    }\n  }\n\n  const status = getSavingStatus()\n  const StatusIcon = status.icon\n\n  return (\n    <div className=\"h-screen bg-gray-50 flex overflow-hidden workspace-container\">\n      {/* 左侧导航栏 */}\n      <div className={`${sidebarCollapsed ? 'w-16' : 'w-64'} bg-white border-r border-gray-200 flex flex-col transition-all duration-300 workspace-sidebar ${sidebarCollapsed ? 'collapsed' : ''}`}>\n        {/* 导航头部 */}\n        <div className=\"p-4 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            {!sidebarCollapsed && (\n              <div className=\"flex items-center gap-3\">\n                <BookOpen className=\"h-6 w-6 text-indigo-600\" />\n                <div>\n                  <h2 className=\"font-semibold text-gray-900\">创作中心</h2>\n                  <p className=\"text-xs text-gray-500\">{novel.title}</p>\n                </div>\n              </div>\n            )}\n            <button\n              onClick={() => setSidebarCollapsed(!sidebarCollapsed)}\n              className=\"p-1 rounded-lg hover:bg-gray-100 transition-colors\"\n            >\n              {sidebarCollapsed ? <ChevronRight className=\"h-4 w-4\" /> : <Menu className=\"h-4 w-4\" />}\n            </button>\n          </div>\n        </div>\n\n        {/* 导航菜单 */}\n        <nav className=\"flex-1 p-4\">\n          <div className=\"space-y-1\">\n            {navigationItems.map((item) => {\n              const Icon = item.icon\n              return (\n                <button\n                  key={item.id}\n                  onClick={() => setActiveTab(item.id as any)}\n                  className={`w-full flex items-center ${sidebarCollapsed ? 'justify-center' : 'justify-between'} gap-3 px-3 py-2 rounded-lg transition-colors sidebar-nav-button ${\n                    activeTab === item.id\n                      ? 'bg-indigo-50 text-indigo-600'\n                      : 'text-gray-600 hover:bg-gray-100'\n                  }`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <Icon className=\"h-5 w-5\" />\n                    {!sidebarCollapsed && <span className=\"text-sm font-medium\">{item.label}</span>}\n                  </div>\n                  {!sidebarCollapsed && item.count > 0 && (\n                    <span className=\"text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full\">\n                      {item.count}\n                    </span>\n                  )}\n                </button>\n              )\n            })}\n          </div>\n        </nav>\n\n        {/* 底部状态 */}\n        {!sidebarCollapsed && (\n          <div className=\"p-4 border-t border-gray-200\">\n            <div className=\"flex items-center gap-2 text-xs\">\n              <StatusIcon className={`h-3 w-3 ${status.color}`} />\n              <span className={status.color}>{status.text}</span>\n              {hasUnsavedChanges && (\n                <span className=\"text-orange-600 ml-2\">(未保存)</span>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* 主内容区 */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* 顶部工具栏 */}\n        <div className=\"bg-white border-b border-gray-200 px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4 flex-1\">\n              {/* 搜索框 */}\n              <div className=\"relative max-w-md flex-1\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"搜索章节...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                />\n              </div>\n              \n              {/* 快速操作 */}\n              <div className=\"quick-actions\">\n                <QuickActions actions={quickActions} />\n              </div>\n            </div>\n\n            {/* 视图控制 */}\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={() => setRightPanelCollapsed(!rightPanelCollapsed)}\n                className=\"p-2 rounded-lg hover:bg-gray-100 transition-colors\"\n                title={rightPanelCollapsed ? '显示辅助面板' : '隐藏辅助面板'}\n              >\n                <Layers className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* 内容区域 */}\n        <div className=\"flex-1 overflow-auto\">\n          <div className=\"h-full\">\n            {activeTab === 'chapters' && (\n              <div className=\"p-6\">\n                <div className=\"mb-6\">\n                  <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">章节管理</h1>\n                  <p className=\"text-gray-600\">管理小说章节，编辑内容，跟踪写作进度</p>\n                </div>\n\n                {/* 写作进度卡片 */}\n                <WritingProgress \n                  novel={novel}\n                  generatingChapter={generatingChapter}\n                />\n\n                {/* 章节列表 */}\n                <div className=\"mt-6\">\n                  <ChapterList\n                    chapters={novel.chapters || []}\n                    onEditSummary={(chapter) => onChapterEdit(chapter)}\n                    onEditContent={(chapter) => onChapterEdit(chapter)}\n                    onAIGenerate={(chapter) => onChapterEdit(chapter)}\n                    onDelete={onChapterDelete}\n                    onView={onChapterSelect}\n                    onReorder={onChapterReorder}\n                    generatingChapter={generatingChapter}\n                    novelId={novel.id}\n                  />\n                </div>\n              </div>\n            )}\n\n            {activeTab === 'outline' && (\n              <div className=\"p-6\">\n                <div className=\"mb-6\">\n                  <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">大纲结构</h1>\n                  <p className=\"text-gray-600\">规划小说的整体结构和情节发展</p>\n                </div>\n                \n                <div className=\"bg-white rounded-xl border border-gray-200 p-8 text-center\">\n                  <Layers className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">大纲编辑器</h3>\n                  <p className=\"text-gray-600 mb-4\">大纲编辑功能正在开发中...</p>\n                  <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\">\n                    开始规划\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {activeTab === 'worldview' && (\n              <div className=\"p-6\">\n                <div className=\"mb-6\">\n                  <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">世界观设定</h1>\n                  <p className=\"text-gray-600\">构建小说的世界背景和设定</p>\n                </div>\n                \n                <div className=\"bg-white rounded-xl border border-gray-200 p-8 text-center\">\n                  <Globe className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">世界观编辑器</h3>\n                  <p className=\"text-gray-600 mb-4\">世界观设定功能正在开发中...</p>\n                  <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\">\n                    构建世界\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {activeTab === 'characters' && (\n              <div className=\"p-6\">\n                <div className=\"mb-6\">\n                  <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">角色管理</h1>\n                  <p className=\"text-gray-600\">创建和管理小说中的角色</p>\n                </div>\n                \n                <div className=\"bg-white rounded-xl border border-gray-200 p-8 text-center\">\n                  <Users className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">角色编辑器</h3>\n                  <p className=\"text-gray-600 mb-4\">角色管理功能正在开发中...</p>\n                  <button className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors\">\n                    创建角色\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* 右侧AI助手面板 */}\n      {!rightPanelCollapsed && (\n        <div className={`w-80 bg-white border-l border-gray-200 flex flex-col workspace-right-panel`}>\n          <div className=\"p-4 border-b border-gray-200\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Sparkles className=\"h-5 w-5 text-purple-600\" />\n                <h3 className=\"font-semibold text-gray-900\">AI写作助手</h3>\n              </div>\n              <button\n                onClick={() => setRightPanelCollapsed(true)}\n                className=\"p-1 rounded-lg hover:bg-gray-100 transition-colors\"\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n          \n          <div className=\"flex-1 overflow-auto\">\n            <AIAssistant novel={novel} />\n          </div>\n        </div>\n      )}\n\n      {/* 自动保存指示器 */}\n      <AutoSaveIndicator\n        status={savingStatus}\n        lastSavedTime={savingStatus === 'saved' ? new Date() : undefined}\n        hasUnsavedChanges={hasUnsavedChanges}\n        onManualSave={save}\n      />\n    </div>\n  )\n}\n\n// 导入缺失的图标\nconst Check = ({ className }: { className?: string }) => (\n  <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n  </svg>\n)","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\hooks\\useAutoSave.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[204,207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[204,207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[235,238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[235,238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect was passed a dependency list that is not an array literal. This means we can't statically verify whether you've passed the correct dependencies.","line":81,"column":6,"nodeType":"Identifier","endLine":81,"endColumn":10},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'delay', 'deps.length', and 'save'. Either include them or remove the dependency array.","line":81,"column":6,"nodeType":"Identifier","endLine":81,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [delay, deps.length, save]","fix":{"range":[2057,2061],"text":"[delay, deps.length, save]"}}]},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\hooks\\useAutoSave.ts:95:24\n  93 |     savingStatus,\n  94 |     save,\n> 95 |     hasUnsavedChanges: isDirtyRef.current,\n     |                        ^^^^^^^^^^^^^^^^^^ Cannot access ref value during render\n  96 |     lastSavedData\n  97 |   }\n  98 | }","line":95,"column":24,"nodeType":null,"endLine":95,"endColumn":42},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nC:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\hooks\\useAutoSave.ts:95:24\n  93 |     savingStatus,\n  94 |     save,\n> 95 |     hasUnsavedChanges: isDirtyRef.current,\n     |                        ^^^^^^^^^^^^^^^^^^ Cannot access ref value during render\n  96 |     lastSavedData\n  97 |   }\n  98 | }","line":95,"column":24,"nodeType":null,"endLine":95,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2412,2415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2412,2415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3080,3083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3080,3083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3110,3113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3110,3113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3329,3332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3329,3332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3993,3996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3993,3996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4023,4026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4023,4026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useRef } from 'react'\n\ntype SavingStatus = 'idle' | 'saving' | 'saved' | 'error'\n\ninterface AutoSaveOptions {\n  delay?: number // 自动保存延迟时间（毫秒）\n  onSave?: (data: any) => Promise<void>\n  deps?: any[] // 依赖项数组，当这些值改变时触发自动保存\n}\n\nexport function useAutoSave<T>(data: T, options: AutoSaveOptions = {}) {\n  const { delay = 2000, onSave, deps = [] } = options\n  const [savingStatus, setSavingStatus] = useState<SavingStatus>('idle')\n  const [lastSavedData, setLastSavedData] = useState<T>(data)\n  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined)\n  const isDirtyRef = useRef(false)\n\n  // 检查数据是否有变化\n  const hasChanges = useCallback((current: T, saved: T) => {\n    return JSON.stringify(current) !== JSON.stringify(saved)\n  }, [])\n\n  // 手动保存\n  const save = useCallback(async () => {\n    if (!onSave) return\n\n    try {\n      setSavingStatus('saving')\n      await onSave(data)\n      setLastSavedData(data)\n      isDirtyRef.current = false\n      setSavingStatus('saved')\n      \n      // 2秒后重置状态\n      setTimeout(() => {\n        setSavingStatus('idle')\n      }, 2000)\n    } catch (error) {\n      console.error('保存失败:', error)\n      setSavingStatus('error')\n      \n      // 3秒后重置状态\n      setTimeout(() => {\n        setSavingStatus('idle')\n      }, 3000)\n    }\n  }, [data, onSave])\n\n  // 当数据变化时，设置延迟自动保存\n  useEffect(() => {\n    if (hasChanges(data, lastSavedData)) {\n      isDirtyRef.current = true\n      \n      // 清除之前的定时器\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current)\n      }\n\n      // 设置新的定时器\n      saveTimeoutRef.current = setTimeout(() => {\n        if (isDirtyRef.current) {\n          save()\n        }\n      }, delay)\n    }\n  }, [data, lastSavedData, delay, hasChanges, save])\n\n  // 监听依赖项变化\n  useEffect(() => {\n    if (deps.length > 0) {\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current)\n      }\n      \n      saveTimeoutRef.current = setTimeout(() => {\n        if (isDirtyRef.current) {\n          save()\n        }\n      }, delay)\n    }\n  }, deps)\n\n  // 清理定时器\n  useEffect(() => {\n    return () => {\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current)\n      }\n    }\n  }, [])\n\n  return {\n    savingStatus,\n    save,\n    hasUnsavedChanges: isDirtyRef.current,\n    lastSavedData\n  }\n}\n\n// 用于章节编辑的自动保存Hook\nexport function useChapterAutoSave(chapterId: string, initialData: any) {\n  const [data, setData] = useState(initialData)\n  \n  const { savingStatus, save, hasUnsavedChanges } = useAutoSave(data, {\n    delay: 3000,\n    onSave: async (currentData) => {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/chapters/${chapterId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(currentData)\n      })\n      \n      if (!response.ok) {\n        throw new Error('保存失败')\n      }\n      \n      return response.json()\n    }\n  })\n\n  const updateData = useCallback((newData: Partial<any>) => {\n    setData((prev: any) => ({ ...prev, ...newData }))\n  }, [])\n\n  return {\n    data,\n    updateData,\n    savingStatus,\n    save,\n    hasUnsavedChanges\n  }\n}\n\n// 用于小说设置保存的Hook\nexport function useNovelAutoSave(novelId: string, initialData: any) {\n  const [data, setData] = useState(initialData)\n  \n  const { savingStatus, save, hasUnsavedChanges } = useAutoSave(data, {\n    delay: 5000,\n    onSave: async (currentData) => {\n      const token = localStorage.getItem('token')\n      const response = await fetch(`/api/novels/${novelId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(currentData)\n      })\n      \n      if (!response.ok) {\n        throw new Error('保存失败')\n      }\n      \n      return response.json()\n    }\n  })\n\n  const updateData = useCallback((newData: Partial<any>) => {\n    setData((prev: any) => ({ ...prev, ...newData }))\n  }, [])\n\n  return {\n    data,\n    updateData,\n    savingStatus,\n    save,\n    hasUnsavedChanges\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\hooks\\useDragAndDrop.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\lib\\ai.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\lib\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[492,495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[492,495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":22,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[628,631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[628,631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":29,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[708,711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[708,711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import jwt from 'jsonwebtoken'\nimport { NextRequest } from 'next/server'\nimport { prisma } from './prisma'\n\nexport function getTokenFromRequest(request: NextRequest): string | null {\n  const authHeader = request.headers.get('Authorization')\n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    return authHeader.substring(7)\n  }\n\n  const cookies = request.cookies.get('token')\n  if (cookies) {\n    return cookies.value\n  }\n\n  return null\n}\n\nexport function verifyToken(token: string): any {\n  try {\n    return jwt.verify(token, process.env.NEXTAUTH_SECRET!)\n  } catch (error) {\n    return null\n  }\n}\n\nlet cachedDemoUser: any = null\n\nexport async function getCurrentUser(request: NextRequest): Promise<any> {\n  // 如果已有缓存的虚拟用户，直接返回\n  if (cachedDemoUser) {\n    console.log('getCurrentUser: 返回缓存的虚拟用户数据')\n    return cachedDemoUser\n  }\n\n  // 尝试获取数据库中的第一个用户作为默认用户\n  try {\n    const user = await prisma.user.findFirst({\n      select: {\n        id: true,\n        email: true,\n        username: true\n      }\n    })\n\n    if (user) {\n      cachedDemoUser = {\n        userId: user.id,\n        username: user.username,\n        email: user.email,\n        role: 'user'\n      }\n      console.log('getCurrentUser: 返回数据库用户数据', user.username)\n      return cachedDemoUser\n    }\n  } catch (error) {\n    console.error('获取默认用户失败:', error)\n  }\n\n  // 如果数据库中没有用户，返回默认虚拟用户\n  console.log('getCurrentUser: 返回默认虚拟用户数据')\n  cachedDemoUser = {\n    userId: 'demo-user-id',\n    username: 'demo',\n    email: 'demo@example.com',\n    role: 'user'\n  }\n  return cachedDemoUser\n\n  // 原始验证逻辑（已禁用）\n  /*\n  const token = getTokenFromRequest(request)\n  if (!token) {\n    return null\n  }\n\n  const decoded = verifyToken(token)\n  if (!decoded) {\n    return null\n  }\n\n  return decoded\n  */\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\src\\lib\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\10153\\OneDrive\\桌面\\NovelFlow\\novel-writing-platform\\start.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":39,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\r\n\r\n \r\nconst { execSync } = require('child_process');\r\nconst http = require('http');\r\n\r\nconsole.log('🚀 Starting NovelFlow application in Docker environment...');\r\n\r\n// 数据库初始化函数\r\nfunction initializeDatabase() {\r\n  console.log('📊 Initializing database...');\r\n  \r\n  try {\r\n    // 运行数据库迁移\r\n    execSync('npx prisma generate', { stdio: 'inherit' });\r\n    execSync('npx prisma db push', { stdio: 'inherit' });\r\n    console.log('✅ Database initialized successfully');\r\n  } catch (error) {\r\n    console.error('❌ Database initialization failed:', error);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n// 健康检查函数\r\nfunction healthCheck() {\r\n  const TARGET_URL = `http://${process.env.HOSTNAME || 'localhost'}:${process.env.PORT || 5000}/api/test-api`;\r\n  \r\n  return new Promise((resolve) => {\r\n    const req = http.get(TARGET_URL, (res) => {\r\n      if (res.statusCode && res.statusCode >= 200 && res.statusCode < 300) {\r\n        console.log('✅ Server is healthy and responding');\r\n        resolve(true);\r\n      } else {\r\n        console.log(`⚠️  Server responded with status: ${res.statusCode}`);\r\n        resolve(false);\r\n      }\r\n    });\r\n    \r\n    req.on('error', (err) => {\r\n      console.log('⏳ Server not ready yet...');\r\n      resolve(false);\r\n    });\r\n    \r\n    req.setTimeout(5000, () => {\r\n      console.log('⏳ Health check timeout');\r\n      req.destroy();\r\n      resolve(false);\r\n    });\r\n  });\r\n}\r\n\r\n// 主启动函数\r\nasync function startApplication() {\r\n  // 初始化数据库\r\n  initializeDatabase();\r\n  \r\n  // 启动服务器\r\n  console.log('🌐 Starting Next.js server...');\r\n  require('./server.js');\r\n  \r\n  // 等待服务器启动并执行健康检查\r\n  console.log('🔍 Waiting for server to be ready...');\r\n  \r\n  let isHealthy = false;\r\n  let retryCount = 0;\r\n  const maxRetries = 30; // 最多重试30次（约2.5分钟）\r\n  \r\n  while (!isHealthy && retryCount < maxRetries) {\r\n    await new Promise(resolve => setTimeout(resolve, 5000)); // 等待5秒\r\n    isHealthy = await healthCheck();\r\n    retryCount++;\r\n  }\r\n  \r\n  if (isHealthy) {\r\n    console.log('🎉 Application started successfully!');\r\n  } else {\r\n    console.error('💥 Application failed to start within timeout period');\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n// 启动应用\r\nstartApplication().catch(error => {\r\n  console.error('💥 Failed to start application:', error);\r\n  process.exit(1);\r\n});","usedDeprecatedRules":[]}]
